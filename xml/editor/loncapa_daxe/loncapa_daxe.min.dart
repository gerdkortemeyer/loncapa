import "dart:html";import "dart:collection";import "dart:math";import "dart:async";import "dart:js";import "dart:typed_data";const zW='mangledGlobalNames';const AX='mangledNames';const BX='metadata';const CX='getIsolateTag';class nS{static const String DX="Chrome";static const String EX="Firefox";static const String FX="Internet Explorer";static const String GX="Opera";static const String HX="Safari";final String BV;final String minimumVersion;const nS(this.BV,[this.minimumVersion]);}class oS{const oS();}class pS{final String name;const pS(this.name);}class qS{const qS();}class rS{const rS();}class VF{static String fP="LocalStrings";static HashMap<String,String> mM=null;static String gJ;static const nM='en';static Future<bool> sS(){Completer<bool> i=new Completer<bool>();bQ().then((String k){if(k!=null)gJ=k;else gJ=nM;String m=gJ.split('_')[0];String o="${fP}_${m}.properties";HttpRequest g=new HttpRequest();g.open("GET",o);g.onLoad.listen((ProgressEvent s){String v=g.responseText;mM=new HashMap<String,String>();List<String> BB=v.split("\n");for(String h in BB){if(h.startsWith('#'))continue;int j=h.indexOf('=');if(j==-1)continue;String EB=h.substring(0,j).trim();String HB=h.substring(j+1).trim();mM[EB]=HB;}i.complete(true);});g.onError.listen((ProgressEvent s){i.completeError("Error when reading the strings in ${fP}");});g.send();});return (i.future);}static String FH(String g){return (mM[g]);}}class hJ{static int gP=0;String VZ;String wK;FD action;String id;bool enabled;bool selected;StreamSubscription<MouseEvent> listener;hJ(this.VZ,this.wK,this.action,{this.enabled: true,this.selected: false}){id="lcdbutton_${gP}";gP++ ;}Element html(){DivElement g=new DivElement();g.id=id;g.classes.add('lcdbutton');if(!enabled)g.classes.add('lcdbutton-disabled');if(selected)g.classes.add('lcdbutton-selected');g.setAttribute('title',VZ);ImageElement h=new ImageElement();h.setAttribute('src','images/'+wK);if(enabled)listener=g.onClick.listen((MouseEvent i)=>action());g.append(h);return (g);}String get title{return (VZ);}void set title(String g){VZ=g;Element h=oB();h.setAttribute('title',VZ);}Element oB(){return (querySelector("#${id}"));}void disable(){if(!enabled)return;enabled=false;Element g=oB();g.classes.add('lcdbutton-disabled');listener.cancel();}void enable(){if(enabled)return;enabled=true;Element g=oB();g.classes.remove('lcdbutton-disabled');listener=g.onClick.listen((MouseEvent h)=>action());}void select(){if(selected)return;selected=true;Element g=oB();g.classes.add('lcdbutton-selected');}void xE(){if(!selected)return;selected=false;Element g=oB();g.classes.remove('lcdbutton-selected');}}class NL extends jJ{static List<String> tS=['if','unless','else','elsif','while','until','for','each','foreach','next','last','break','continue','return','my','our','local','state','BEGIN','END','package','sub','do','given ','when ','default','__END__','__DATA__','__FILE__','__LINE__','__PACKAGE__'];NL.MX(l g):super.OX(g);NL.NX(AB g,n h):super.PX(g,h){if(firstChild is OB&&firstChild.nextSibling==null){firstChild.replaceWith(new pG(firstChild.nodeValue));}}Element html(){Element h=super.html();if(firstChild==null||firstChild.nextSibling!=null||firstChild is!pG)return h;if(state!=2&&zH){DivElement i=h.lastChild;i.classes.add('perl-text');DivElement g=MV();i.style.position='relative';g.style.position='absolute';g.style.top='0px';g.style.left='0px';i.append(g);}return h;}Element MV(){final String SB='\$@%&abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_';final String KB='0123456789';DivElement j=new DivElement();j.classes.add('perl-colored');String QB=firstChild.nodeValue;StringBuffer g=new StringBuffer();bool k=false;bool m=false;bool v=false;bool o=false;bool BB=false;String EB;int HB=0;while(HB<QB.length){String i=QB[HB];if(!o&&!m&&(SB.contains(i)||k&&KB.contains(i)||k&&i=='#'&&g.toString()[g.length-1]=='\$')){if(!k){if(g.length>0){j.append(new Text(g.toString()));g.clear();}k=true;}}else if(!o&&!k&&!m&&(KB.contains(i)||(i=='.'&&v))){if(!v){if(g.length>0){j.append(new Text(g.toString()));g.clear();}v=true;}}else{if(k){String s=g.toString();SpanElement h=new SpanElement();if(tS.contains(s))h.classes.add('keyword');else if(s.startsWith('\$')||s.startsWith('@')||s.startsWith('%'))h.classes.add('variable');else if(s.startsWith('&')||i=='(')h.classes.add('function-call');else h.classes.add('name');h.appendText(s);j.append(h);g.clear();k=false;}else if(v){SpanElement h=new SpanElement();h.classes.add('number');h.appendText(g.toString());j.append(h);g.clear();v=false;}else if(m&&(i=='\n'||i=='\r')){SpanElement h=new SpanElement();h.classes.add('comment');h.appendText(g.toString());j.append(h);g.clear();m=false;}if(!m&&(i=='"'||i=="'")&&!BB){if(o){if(i==EB){j.append(new Text(EB));SpanElement h=new SpanElement();h.classes.add('string');h.appendText(g.toString().substring(1));j.append(h);g.clear();o=false;}}else{if(g.length>0){j.append(new Text(g.toString()));g.clear();}EB=i;o=true;}}else if(!o&&i=='#'){if(g.length>0){j.append(new Text(g.toString()));g.clear();}m=true;}}if(o){if(i=='\\')BB=!BB;else if(BB)BB=false;}g.write(i);HB++ ;}if(g.length>0){if(m){SpanElement h=new SpanElement();h.classes.add('comment');h.appendText(g.toString());j.append(h);}else j.append(new Text(g.toString()));}return (j);}}class OL extends n{static String oM='c, pi, e, hbar, amu';static JsObject pM;static JsObject qM;OL.KX(l g):super.tX(g){}OL.LX(AB g,n h):super.oX(g,h){}Element html(){Element g;if(nodeName=='dlm')g=new DivElement();else g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('math');if(!valid)g.classes.add('invalid');g.onClick.listen((MouseEvent h)=>KS());JL(g);return (g);}void HP(FD g){g();KS();}q QE(){return (null);}q SF(){return (null);}void RO(){Element g=document.getElementById(id);JL(g);}void JL(Element g){String j='?';if(firstChild!=null&&firstChild.nodeValue.trim()!='')j=firstChild.nodeValue;JsObject h;if(getAttribute('mode')=='units'){if(qM==null)qM=new JsObject(context['LCMATH']['Parser'],[true,true,oM]);h=qM;}else{if(pM==null)pM=new JsObject(context['LCMATH']['Parser'],[true,false,oM]);h=pM;}for(Node m in g.childNodes)m.remove();try {JsObject k=h.callMethod('parse',[j]);if(k!=null){Element i=document.createElement('math');i.setAttribute('display',nodeName=='dlm'?'block':'inline');JsObject o=new JsObject.jsify(['#000000']);i.append(k.callMethod('toMathML',[o]));g.append(i);Timer.run((){JsArray s=new JsObject.jsify(['Typeset',context['MathJax']['Hub'],id]);context['MathJax']['Hub'].callMethod('Queue',[s]);context['MathJax']['Hub'].callMethod('Queue',[()=>IB.cursor.refresh()]);});}}catch (v){g.text='Error: '+v.toString();}}void KS(){Element s=document.getElementById(id);if(s==null)return;Element h;if(nodeName=='dlm')h=new DivElement();else h=new SpanElement();h.id=id;TextInputElement g=new TextInputElement();g.classes.add('math');g.setAttribute('data-unit_mode',getAttribute('mode')=='units'?'true':'false');g.setAttribute('data-constants',oM);g.setAttribute('data-implicit_operators','true');g.setAttribute('spellcheck','false');if(firstChild!=null){g.value=firstChild.nodeValue;if(g.value.length>20)g.size=g.value.length;}h.append(g);SelectElement i=new SelectElement();OptionElement m=new OptionElement();m.value='symbols';m.appendText(VF.FH('lm_symbols'));if(getAttribute('mode')!='units')m.setAttribute('selected','selected');i.append(m);OptionElement o=new OptionElement();o.value='units';o.appendText(VF.FH('lm_units'));if(getAttribute('mode')=='units')o.setAttribute('selected','selected');i.append(o);i.onInput.listen((Event k){if(i.value=='symbols'&&getAttribute('mode')=='units'){setAttribute('mode','symbols');g.setAttribute('data-unit_mode','false');context['LCMATH'].callMethod('initEditors');}else if(i.value=='units'&&getAttribute('mode')!='units'){setAttribute('mode','units');g.setAttribute('data-unit_mode','true');context['LCMATH'].callMethod('initEditors');}g.focus();});h.append(i);s.replaceWith(h);g.focus();context['LCMATH'].callMethod('initEditors');var v=(){String j=g.value;if(j!=''){if(firstChild!=null)firstChild.nodeValue=j;else jB(new OB(j));}else{if(firstChild!=null)gC(firstChild);}h.replaceWith(html());};g.onBlur.listen((Event k){Timer.run((){if(document.activeElement==i)return;v();});});i.onBlur.listen((Event k){Timer.run((){if(document.activeElement==g)return;v();});});if(h is DivElement){h.onClick.listen((MouseEvent k){if(k.target!=g&&k.target!=i){IB.JD(new q(parent,parent.ZB(this)+1));}});}g.onKeyDown.listen((KeyboardEvent k){String j=g.value;int BB=g.size;if(j!=null&&j.length>BB)g.size=j.length;});}}class iJ extends n{iJ.IX(l g):super.tX(g){}iJ.JX(AB g,n h):super.oX(g,h){}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.classes.add('tex');g.onClick.listen((MouseEvent h)=>bR(()=>JL()));return (g);}void HP(FD g){bR(()=>g());}q QE(){return (null);}q SF(){return (null);}void RO(){JL();}void JL(){String g='?';if(firstChild!=null&&firstChild.nodeValue.trim()!='')g=firstChild.nodeValue;JsObject j=context['MathJax']['Hub']['Queue'];SpanElement h=document.getElementById(id);h.text=WR(g);JsArray i=new JsObject.jsify(['Typeset',context['MathJax']['Hub'],id]);context['MathJax']['Hub'].callMethod('Queue',[i]);}void bR([FD g]){rM h=new rM(this,g);h.show();}String WR(String g){bool i=false;JsObject j=context['MathJax']['Hub']['Queue'];if(nodeName=='dtm')g="\\[${g}\\]";else g="\\(${g}\\)";g=g.replaceAllMapped(new RegExp(r'\$[a-zA-Z]*[0-9]*(\[[^\]]*\])?'),(h){return "\\mathtt{${h.group(0)}}";});return (g);}}class jJ extends n{List<l> IE;int state;HashMap<String,SD> qH;HashMap<aB,TextInputElement> TG;bool zH;hJ iK;hJ jK;hJ hK;jJ.OX(l g):super.tX(g){state=0;yE();}jJ.PX(AB j,n k):super.oX(j,k){n g=firstChild;while(g!=null){n i=g.nextSibling;if(g is pF){if(g.previousSibling is OB&&g.previousSibling.nodeValue=='\n')gC(g.previousSibling);if(g.nextSibling is OB&&g.nextSibling.nodeValue=='\n'){i=g.nextSibling.nextSibling;gC(g.nextSibling);}String h;if(g.firstChild!=null)h=g.firstChild.nodeValue;else h=null;if(h!=null)insertBefore(new OB(h),g);gC(g);}g=i;}normalize();state=1;yE();MG();}void yE(){IE=t.CB.fE(DB);if(IE!=null&&IE.length>0)qH=new HashMap<String,SD>();TG=null;zH=t.CB.PE(DB)||t.CB.XC(DB).length>0;}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.classes.add('lcdblock');DivElement k=new DivElement();k.classes.add('lcdblock-header');DivElement o=new DivElement();DivElement m=new DivElement();m.classes.add('lcd-button-box');hK=new hJ(VF.FH('lcdblock_collapsed'),'block_collapsed.png',(){HV();},selected:(state==2));m.append(hK.html());jK=new hJ(VF.FH('lcdblock_normal'),'block_normal.png',(){HW();},selected:(state==1));m.append(jK.html());iK=new hJ(VF.FH('lcdblock_editable'),'block_editable.png',(){cR();},enabled:IE!=null&&IE.length>0,selected:(state==0));m.append(iK.html());o.append(m);SpanElement s=new SpanElement();s.classes.add('lcdblock-title');String EB=t.CB.OD(DB);if(EB==null)EB=nodeName;s.append(new Text(EB));s.onDoubleClick.listen((MouseEvent cB){IB.selectNode(this);});o.append(s);o.append(iP(DB,null));k.append(o);if(state==0){TableElement v=new TableElement();v.classes.add('expand');for(l hB in IE){v.append(SO(hB));}for(aB j in attributes){bool QB=false;for(l SB in IE){if(j.localName==t.CB.attributeName(SB)&&j.pB==t.CB.attributeNamespace(SB)){QB=true;break;}}if(!QB){v.append(qW(j));}}k.append(v);}else if(state==1){DivElement h=new DivElement();h.classes.add('lcdblock-attributes');for(aB j in attributes){h.append(new Text(" "));Element HB=new SpanElement();HB.attributes['class']='attribute_name';HB.text=j.localName;h.append(HB);h.append(new Text("="));Element KB=new SpanElement();KB.attributes['class']='attribute_value';KB.text=j.value;h.append(KB);}h.onClick.listen((MouseEvent cB){cR();});k.append(h);}g.append(k);if(state!=2&&zH){DivElement i=new DivElement();i.id='contents-'+id;i.classes.add('indent');i.classes.add('lcdblock-content');gM(i);n BB=firstChild;while(BB!=null){i.append(BB.html());BB=BB.nextSibling;}if(lastChild==null||lastChild.nodeType==n.mB)i.appendText('\n');g.append(i);}return (g);}void BF(List<n> i){super.BF(i);if(zH&&state!=2){DivElement h=dD();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');}}void uI(){if(state==0){DivElement m=oB();TableElement o=querySelector("#${id}>table");int k=0;for(l h in IE){String i=t.CB.PH(DB,h);String g=getAttribute(i);String j=t.CB.dF(h);if(g==null){if(j!=null)g=j;else g='';}qH[i].hM(g);k++ ;}lF();}}Element dD(){if(state==2||!zH)return (null);return (document.getElementById('contents-'+id));}bool RE(){return (true);}bool QG(){return (zH);}void JE([FD g]){state=0;if(dD()!=null)sD();if(g!=null)g();}q QE(){if(zH)return (new q(this,0));else return (null);}q SF(){if(zH)return (new q(this,PB));else return (null);}void cR(){iK.select();jK.xE();hK.xE();state=0;sD();if(IE.length>0){String g=t.CB.PH(DB,IE.first);qH[g].focus();}}void HW(){iK.xE();jK.select();hK.xE();state=1;sD();}void HV(){iK.xE();jK.xE();hK.select();state=2;sD();}TableRowElement SO(l h){String o=t.CB.PH(DB,h);TableRowElement j=new TableRowElement();TableCellElement g=new TableCellElement();g.classes.add('shrink');if(t.CB.vG(DB,h)!=null){ButtonElement v=iP(DB,h);g.append(v);}j.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=t.CB.fK(DB,h);if(t.CB.BL(DB,h))g.classes.add('required');else g.classes.add('optional');j.append(g);g=new TableCellElement();g.classes.add('expand');String k=getAttribute(o);String s=t.CB.dF(h);if(k==null){if(s!=null)k=s;else k='';}SD m;m=new SD.wY(DB,h,k,valueChanged:()=>YO(h,m),catchUndo:true);qH[o]=m;Element i=m.html();if(i.firstChild is TextInputElement)(i.firstChild as TextInputElement).classes.add('form_field');else if(i.firstChild is DataListElement&&i.firstChild.nextNode is TextInputElement)(i.firstChild.nextNode as TextInputElement).classes.add('form_field');g.append(i);j.append(g);g=new TableCellElement();g.classes.add('shrink');j.append(g);return (j);}TableRowElement qW(aB i){if(TG==null)TG=new HashMap<aB,TextInputElement>();TextInputElement h=new TextInputElement();h.spellcheck=false;h.size=40;h.value=i.value;h.classes.add('invalid');h.onInput.listen((Event k)=>RR(i,h));h.onKeyUp.listen((KeyboardEvent k)=>RR(i,h));TG[i]=h;TableRowElement j=new TableRowElement();TableCellElement g=new TableCellElement();g.classes.add('shrink');j.append(g);g=new TableCellElement();g.classes.add('shrink');g.appendText(i.name);j.append(g);g=new TableCellElement();g.classes.add('expand');g.append(h);j.append(g);g=new TableCellElement();g.classes.add('shrink');j.append(g);return (j);}void YO(l j,SD m){String h=m.hF();String k=t.CB.PH(DB,j);String i=t.CB.dF(j);aB g;if((h==''&&i==null)||h==i)g=new aB(k,null);else if(h!=''||i!=null)g=new aB(k,h);else g=null;if(g!=null)t.DC(new GB.rX(this,g,updateDisplay:false));lF();}void RR(aB g,TextInputElement k){String h=k.value;if(getAttributeNS(g.pB,g.localName)!=h){String j=g.name;aB i;if(h=='')i=new aB(j,null);else i=new aB(j,h);t.DC(new GB.rX(this,i,updateDisplay:false));lF();}}static ButtonElement iP(final l i,final l j){ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('help');g.value='?';g.text='?';if(j==null){String h=t.CB.uH(i);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new WG.SX(i)).show());}else{String h=t.CB.vG(i,j);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new WG.UX(j,i)).show());}return (g);}}void main(){ND.YT();SL('lcdblock',(l g)=>new jJ.OX(g),(AB h,n i)=>new jJ.PX(h,i));SL('texmathjax',(l g)=>new iJ.IX(g),(AB h,n i)=>new iJ.JX(h,i));SL('lm',(l g)=>new OL.KX(g),(AB h,n i)=>new OL.LX(h,i));SL('perl',(l g)=>new NL.MX(g),(AB h,n i)=>new NL.NX(h,i));Future.wait([LB.JU(),VF.sS(),wS('templates.xml')]).then((List k){uS().then((HB){WF m=vS();if(m!=null)IB.toolbar.add(m);l j=t.CB.gG('m');if(j!=null){jD o=new jD();MC v=new MC(VF.FH('tex_equation'),'images/tex.png',()=>t.AI(j,'element'),NI.BN,data:new wC([j],null,null));o.add(v);IB.toolbar.add(o);}Element BB=querySelector('.toolbar');BB.replaceWith(IB.toolbar.html());IB.QO();IB.LC();if(k[2] is sB){XB s=xS(k[2]);IB.iG.add(s);Element EB=document.getElementsByClassName('menubar')[0];EB.append(IB.iG.cO(s));IB.LC();}else print("Error reading templates file, could not build the menu.");});});}class rM{iJ u;FD WZ;rM(this.u,[this.WZ]){}void show(){DivElement h=new DivElement();h.id='dlg1';h.classes.add('dlg1');DivElement o=new DivElement();o.classes.add('dlg2');DivElement s=new DivElement();s.classes.add('dlg3');FormElement i=new FormElement();TextAreaElement g=new TextAreaElement();g.id='eqtext';if(u.firstChild!=null)g.value=u.firstChild.nodeValue.trim();g.style.width='100%';g.style.height='4em';g.attributes['spellcheck']='false';g.onInput.listen((Event v)=>input());i.append(g);DivElement BB=new DivElement();BB.id='preview';i.append(BB);DivElement j=new DivElement();j.classes.add('buttons');ButtonElement k=new ButtonElement();k.attributes['type']='button';k.appendText(LB.NB("button.Cancel"));k.onClick.listen((MouseEvent v)=>h.remove());j.append(k);ButtonElement m=new ButtonElement();m.attributes['type']='submit';m.appendText(LB.NB("button.OK"));m.onClick.listen((MouseEvent v)=>iF(v));j.append(m);i.append(j);s.append(i);o.append(s);h.append(o);document.body.append(h);g.focus();input();}void iF(MouseEvent h){TextAreaElement i=querySelector('textarea#eqtext');String g=i.value;if(g!=''){if(u.firstChild!=null)u.firstChild.nodeValue=g;else u.jB(new OB(g));}else{if(u.firstChild!=null)u.gC(u.firstChild);}querySelector('div#dlg1').remove();if(h!=null)h.preventDefault();if(WZ!=null)WZ();}void input(){TextAreaElement g=querySelector('textarea#eqtext');String h=g.value;DivElement i=document.getElementById('preview');i.text=u.WR(h);JsArray j=new JsObject.jsify(['Typeset',context['MathJax']['Hub'],'preview']);context['MathJax']['Hub'].callMethod('Queue',[j]);}}Future uS(){Completer i=new Completer();t=new PL();IB=new yM();String k=null;String h=null;String m=null;Location o=window.location;String j=o.search;if(j.startsWith('?'))j=j.substring(1);List<String> s=j.split('&');for(String v in s){List<String> g=v.split('=');if(g.length!=2)continue;if(g[0]=='config')h=g[1];else if(g[0]=='file')k=Uri.decodeComponent(g[1]);else if(g[0]=='save')m=g[1];}if(m!=null)t.CL=m;if(h!=null&&k!=null)IB.KP(k,h).then((BB)=>i.complete());else if(h!=null)IB.FP(h).then((BB)=>i.complete());else{window.alert(LB.NB('daxe.missing_config'));i.completeError(LB.NB('daxe.missing_config'));}return (i.future);}WF vS(){XB j=new XB(VF.FH('Section'));List<l> g=t.CB.nK('section');if(g==null||g.length==0)return (null);l o=t.CB.gG('h1');for(String k in ['introduction','conclusion','prerequisites','objectives','reminder','definition','demonstration','example','advise','remark','warning','more_information','method','activity','bibliography','citation']){CC h=new CC(VF.FH(k),null,data:new wC(g,null,null));h.action=(){wC s=h.data;l v=s.aH;n i=ND.NF(v);i.setAttribute('class','role-'+k);n m=ND.NF(o);if(t.BS(i,IB.vC())){t.insertNode(m,new q(i,0));IB.cursor.moveTo(new q(m,0));IB.LC();}};j.add(h);}WF BB=new WF(j,NI.iT,IB.toolbar);return (BB);}Future<sB> wS(String g){DG h=new DG();return (h.AL(g));}XB xS(sB i){XB h=new XB(VF.FH('Templates'));l j=i.documentElement;for(AB g in j.childNodes){if(g.nodeType==AB.FE&&g.nodeName=='menu'){h.add(hP(g));}}return (h);}XB hP(l j){String k=VF.gJ;String m=VF.nM;String h;for(AB g in j.childNodes){if(g.nodeType==AB.FE&&g.nodeName=='title'){if(g.firstChild!=null&&g.firstChild.nodeType==AB.kE){if((g as l).getAttribute('lang')==k){h=g.firstChild.nodeValue;break;}else if((g as l).getAttribute('lang')==m){h=g.firstChild.nodeValue;}}}}if(h==null)h='?';XB i=new XB(h);for(AB g in j.childNodes){if(g.nodeType==AB.FE){if(g.nodeName=='menu'){i.add(hP(g));}else if(g.nodeName=='item'){i.add(yS(g));}}}return (i);}CC yS(l v){String k=VF.gJ;String m=VF.nM;String o,j,h,i;for(AB g in v.childNodes){if(g.nodeType==AB.FE){if(g.nodeName=='title'){if(g.firstChild!=null&&g.firstChild.nodeType==AB.kE){if((g as l).getAttribute('lang')==k){h=g.firstChild.nodeValue;}else if(h==null&&(g as l).getAttribute('lang')==m){h=g.firstChild.nodeValue;}}}else if(g.nodeName=='path'&&g.firstChild!=null&&g.firstChild.nodeType==AB.kE){o=g.firstChild.nodeValue;}else if(g.nodeName=='type'&&g.firstChild!=null&&g.firstChild.nodeType==AB.kE){j=g.firstChild.nodeValue;}else if(g.nodeName=='help'){if(g.firstChild!=null&&g.firstChild.nodeType==AB.kE){if((g as l).getAttribute('lang')==k){i=g.firstChild.nodeValue;}else if(i==null&&(g as l).getAttribute('lang')==m){i=g.firstChild.nodeValue;}}}}}if(j==null){print("Warning: missing type for template ${h}\n");j='problem';}l BB=t.CB.gG(j);CC s=new CC(h,()=>zS(o),data:BB);if(i!=null)s.JI=i;return s;}void zS(String k){try {DG m=new DG();m.AL(k).then((sB o){l g=o.documentElement;if(g==null)return;t.VS(g);n h=ND.dH(g,null);GB i;q j=IB.vC();if(h.nodeName=='loncapa'&&t.mI()!=null)i=t.LE(h,j,checkValidity:true);else i=new GB.mX(j,h);t.DC(i);IB.LC();});}on UD catch (s){window.alert(s.toString());}}abstract class AT{static const int sM=61;static const int BT=13;static const int CT=10;static const int DT=76;static const String ET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static const String FT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";static String IT(List<int> k,[bool KB=false,bool BB=false]){int o=k.length;if(o==0){return "";}final String j=KB?FT:ET;final int s=o.remainder(3);final int QB=o-s;int v=((o~/3)*4)+((s>0)?4:0);if(BB){v+= ((v-1)~/DT)<<1;}List<int> g=new List<int>(v);int h=0,m=0,EB=0;while(m<QB){int i=((k[m++ ]<<16)&0xFFFFFF)|((k[m++ ]<<8)&0xFFFFFF)|k[m++ ];g[h++ ]=j.codeUnitAt(i>>18);g[h++ ]=j.codeUnitAt((i>>12)&0x3F);g[h++ ]=j.codeUnitAt((i>>6)&0x3F);g[h++ ]=j.codeUnitAt(i&0x3f);if(BB&& ++EB==19&&h<v-2){g[h++ ]=BT;g[h++ ]=CT;EB=0;}}if(s==1){int i=k[m];g[h++ ]=j.codeUnitAt(i>>2);g[h++ ]=j.codeUnitAt((i<<4)&0x3F);g[h++ ]=sM;g[h++ ]=sM;}else if(s==2){int i=k[m];int HB=k[m+1];g[h++ ]=j.codeUnitAt(i>>2);g[h++ ]=j.codeUnitAt(((i<<4)|(HB>>4))&0x3F);g[h++ ]=j.codeUnitAt((HB<<2)&0x3F);g[h++ ]=sM;}return new String.fromCharCodes(g);}}class GT{static String HT(List<int> g,{bool urlSafe: false,bool addLineSeparator: false}){return AT.IT(g,urlSafe,addLineSeparator);}}class yF{List<XB> CI;bool xK;XB mF;yF(){CI=new List<XB>();xK=false;mF=null;}add(XB g){CI.add(g);}insert(XB g,int h){CI.insert(h,g);}Element html(){DivElement g=new DivElement();g.classes.add('menubar');bool h=false;for(XB i in CI){DivElement j=cO(i);g.append(j);if(!h&&i.enabled){j.setAttribute('tabindex','0');h=true;}}document.onMouseUp.listen((MouseEvent k)=>PV(k));return (g);}DivElement cO(XB g){DivElement h=new DivElement();h.text=g.title;h.id=g.hG;h.classes.add('menu_title');if(g.parent is NI)h.setAttribute('tabindex','0');else h.setAttribute('tabindex','-1');h.onMouseDown.listen((MouseEvent i)=>DW(i,g));h.onMouseOver.listen((MouseEvent i)=>EW(i,g));h.onClick.listen((MouseEvent i)=>click(g));h.onKeyDown.listen((KeyboardEvent i){if(document.activeElement!=h)return;int j=i.keyCode;if(j==KeyCode.ENTER||j==KeyCode.DOWN){i.preventDefault();if(g==mF)g.bW();else aJ(g);}else if(j==KeyCode.LEFT){YJ(g);}else if(j==KeyCode.RIGHT){DL(g);}else if(j==KeyCode.TAB){Timer.run(zR);}});Element k=g.UM();k.style.display='none';h.append(k);return (h);}void DW(MouseEvent h,XB g){h.preventDefault();if(!g.GS()){aJ(g);xK=true;}else{xK=false;}}void EW(MouseEvent h,XB g){if(mF==null||mF==g)return;VJ(mF);aJ(g);}void click(XB g){if(xK){return;}if(!g.GS()){aJ(g);}else{VJ(g);}}void PV(MouseEvent g){if(mF==null)return;DivElement i=querySelector("#${mF.hG}");Rectangle h=i.getBoundingClientRect();if(g.client.x<h.left||g.client.x>h.right||g.client.y<h.top||g.client.y>h.bottom){VJ(mF);xK=true;}}void aJ(XB g){mF=g;DivElement h=querySelector("#${g.hG}");h.classes.add('selected');g.show();g.xH().focus();}void VJ(XB g){mF=null;DivElement h=querySelector("#${g.hG}");h.classes.remove('selected');g.TH();}void zR(){if(mF!=null)VJ(mF);}void YJ(XB g){if(g==null)g=mF;if(g==null)return;bool i=false;for(XB h in CI.reversed){if(h==g){i=true;}else if(i&&h.enabled){VJ(g);aJ(h);return;}}}void DL(XB g){if(g==null)g=mF;if(g==null)return;bool i=false;for(XB h in CI){if(h==g){i=true;}else if(i&&h.enabled){VJ(g);aJ(h);return;}}}}class jD extends lG{List<MC> GG;jD(){GG=new List<MC>();}add(MC g){GG.add(g);}insert(MC g,int h){GG.insert(h,g);}remove(int g){GG.remove(g);}get length{return (GG.length);}Element html(){DivElement g=new DivElement();g.classes.add('toolbar-box');for(MC h in GG){g.append(h.html());}return (g);}}class WE{String language;String sH;WE(){List<String> g=LB.hL.split('_');language=g[0];if(g.length>1)sH=g[1];else sH=null;}WE.TX(String g){this.language=g;this.sH=null;}WE.YX(String g,String h){this.language=g;this.sH=h;}int get hashCode{int g=17;g=37*g+language.hashCode;g=37*g+sH.hashCode;return g;}bool operator==(WE g){return (language==g.language&&sH==g.sH);}}class XB extends CC{List<CC> items;String CP;XB(String g):super(g,null){items=new List<CC>();this.CP="menu_${CC.uM-1}";}add(CC g){g.parent=this;items.add(g);}Element AS(){TableRowElement g=new TableRowElement();g.id=hG;g.setAttribute('tabindex','-1');g.onKeyDown.listen((KeyboardEvent k){if(document.activeElement!=g)return;int i=k.keyCode;if(i==KeyCode.ENTER){select();}else if(i==KeyCode.UP){(parent as XB).YJ(this);}else if(i==KeyCode.DOWN){(parent as XB).DL(this);}else if(i==KeyCode.LEFT){if(parent is XB){if((parent as XB).parent is XB)(parent as XB).select();else if((parent as XB).parent is yF)((parent as XB).parent as yF).YJ(parent as XB);}}else if(i==KeyCode.RIGHT){for(CC m in items){if(m.enabled){m.select();break;}}}else if(i==KeyCode.TAB){Timer.run(bO);}});TableCellElement h=new TableCellElement();h.text=XZ;h.onMouseOver.listen((MouseEvent k){if(enabled){select();show();}});g.append(h);h=new TableCellElement();h.text=">";DivElement j=UM();j.classes.remove('dropdown_menu');j.classes.add('submenu');j.style.display='none';h.append(j);h.onMouseOver.listen((MouseEvent k){if(enabled){select();show();}});g.append(h);if(!enabled)g.classes.add('disabled');if(JI!=null)g.title=JI;return (g);}Element UM(){DivElement g=new DivElement();g.classes.add('dropdown_menu');g.id=CP;TableElement h=new TableElement();h.classes.add('menu');for(CC i in items){h.append(i.AS());}g.append(h);return (g);}Element vK(){return (querySelector("#${CP}"));}void show(){DivElement g=vK();g.style.display='block';}void TH(){for(CC g in items){if(g is XB)g.TH();g.xE();}DivElement h=vK();h.style.display='none';}bool GS(){DivElement g=vK();return (g.style.display!='none');}void PO(){items.add(new CC.cX());}void OV(CC h){for(CC g in items){if(g!=h)g.xE();}}void set title(String h){XZ=h;Element g=querySelector("#${hG}");if(g is TableRowElement){TableRowElement j=g;TableCellElement k=j.nodes.first;k.text=h;}else if(g is DivElement){Node i=g.firstChild;if(i is Text)i.text=h;}}void aO(){bool g=false;for(CC i in items){if(i.enabled){g=true;break;}}if(g==enabled)return;Element h=querySelector("#${hG}");if(g)h.classes.remove('disabled');else h.classes.add('disabled');enabled=g;if(parent is XB)(parent as XB).aO();}void bW(){for(CC g in items){if(g.enabled){g.select();return;}}}void YJ(CC h){bool i=false;for(CC g in items.reversed){if(g==h){i=true;}else if(i&&g.enabled){h.xE();g.select();break;}}}void DL(CC h){bool i=false;for(CC g in items){if(g==h){i=true;}else if(i&&g.enabled){h.xE();g.select();break;}}}}class CC{static int uM=0;String hG;String XZ;Object parent;FD action;String shortcut;Object data;bool enabled;bool selected;bool yO;String JI;bool checked;CC(this.XZ,this.action,{this.shortcut,this.data}){this.hG="item_${uM}";uM++ ;parent=null;enabled=true;selected=false;yO=false;checked=false;}CC.cX(){yO=true;enabled=false;checked=false;selected=false;}Element AS(){TableRowElement h=new TableRowElement();if(yO){TableCellElement g=new TableCellElement();g.append(new HRElement());h.append(g);}else{h.id=hG;h.setAttribute('tabindex','-1');h.onKeyDown.listen((KeyboardEvent i){int j=i.keyCode;if(j==KeyCode.ENTER){i.preventDefault();bO();MO();}else if(j==KeyCode.UP){(parent as XB).YJ(this);}else if(j==KeyCode.DOWN){(parent as XB).DL(this);}else if(j==KeyCode.LEFT){if((parent as XB).parent is XB){(parent as XB).TH();(parent as XB).xH().focus();i.preventDefault();i.stopPropagation();}else if((parent as XB).parent is yF)((parent as XB).parent as yF).YJ(parent as XB);}else if(j==KeyCode.RIGHT){Object k=parent;while(k is XB)k=(k as XB).parent;if(k is yF)k.DL(null);}else if(j==KeyCode.TAB){Timer.run(bO);}});TableCellElement g=new TableCellElement();g.text=XZ;g.onMouseUp.listen((MouseEvent i)=>MO());g.onMouseOver.listen((MouseEvent i){if(enabled)select();});g.onMouseOut.listen((MouseEvent i)=>xE());h.append(g);g=new TableCellElement();if(this.shortcut!=null)g.text="Ctrl+${shortcut}";g.onMouseUp.listen((MouseEvent i)=>MO());g.onMouseOver.listen((MouseEvent i){if(enabled)select();});g.onMouseOut.listen((MouseEvent i)=>xE());if(checked)h.classes.add('checked');h.append(g);if(!enabled)h.classes.add('disabled');}if(JI!=null)h.title=JI;return (h);}Element xH(){return (querySelector("#${hG}"));}void MO(){if(!enabled)return;IB.AH();action();}void select(){if(selected)return;selected=true;Element g=xH();g.classes.add('selected');if(this is XB){(this as XB).show();}if(parent is XB)(parent as XB).OV(this);g.focus();}void xE(){if(!selected)return;selected=false;Element g=xH();if(g!=null){g.classes.remove('selected');g.blur();}if(this is XB){(this as XB).TH();}}void disable(){if(!enabled)return;enabled=false;Element g=xH();g.classes.remove('selected');g.classes.add('disabled');if(parent is XB)(parent as XB).aO();}void enable(){if(enabled)return;enabled=true;Element g=xH();g.classes.remove('disabled');if(parent is XB)(parent as XB).aO();}void check(){if(checked)return;checked=true;Element g=xH();g.classes.add('checked');}void dS(){if(!checked)return;checked=false;Element g=xH();g.classes.remove('checked');}String get title{return (XZ);}void set title(String g){XZ=g;TableRowElement h=querySelector("#${hG}");TableCellElement i=h.nodes.first;i.text=g;}void bO(){if(parent is!XB)return;XB g=parent;while(g.parent is XB)g=g.parent;if(g.parent is yF)(g.parent as yF).zR();else g.TH();}}class uD extends MapBase<String,String>{LinkedHashMap<String,String> map;uD(String h){map=new LinkedHashMap<String,String>();if(h!=null){for(String k in h.split(';')){List<String> g=k.split(':');if(g.length==2){String i=g[0].trim().toLowerCase();String j=g[1].trim().toLowerCase();if(i!=''&&j!='')map[i]=j;}}}}String operator[](String g)=>map[g];void operator[]=(String g,String h){map[g]=h;}String remove(String g){return (map.remove(g));}Iterable<String> get keys{return (map.keys);}void clear(){map.clear;}String toString(){List<String> g=new List<String>();map.forEach((String h,String i)=>g.add(h+': '+i));return (g.join('; '));}bool SV(uD g){List<String> j=keys;List<String> k=g.map.keys;return (j.every((String h)=>map[h]==g.map[h])&&k.every((String i)=>map[i]==g.map[i]));}}class NI{List<lG> items;List<l> VO=null;static final String MD='packages/daxe/images/toolbar/';NI([HH g]){items=new List<lG>();if(t.CL!=null){jD cB=new jD();cB.add(new MC(LB.NB('menu.save'),MD+'document_save.png',()=>IB.save(),null));items.add(cB);}jD QB=new jD();QB.add(new MC(LB.NB('undo.undo'),MD+'history_undo.png',()=>t.YH(),null,data:"undo",enabled:false));QB.add(new MC(LB.NB('undo.redo'),MD+'history_redo.png',()=>t.bM(),null,data:"redo",enabled:false));items.add(QB);jD hB=new jD();hB.add(new MC(LB.NB('find.find_replace'),MD+'find.png',()=>(new jP()).show(),null));items.add(hB);if(g!=null){jD m=new jD();List<l> h=g.yG('fichier');if(h!=null&&h.length>0){cK(g,m,h,MD+'insert_image.png');}h=g.yG('equationmem');if(h!=null&&h.length>0){cK(g,m,h,MD+'equation.png');}h=g.yG('symbole2');if(h!=null&&h.length>0){cK(g,m,h,MD+'insert_symbol.png');}h=g.yG('tabletexte');if(h!=null&&h.length>0){cK(g,m,h,MD+'insert_table.png');}h=g.yG('liste');if(h!=null&&h.length>0){cK(g,m,h,MD+'ul.png');}items.add(m);List<l> o=iC.FU();List<l> s=iC.GU();if(o.length>0||s.length>0){jD BB=new jD();if(o.length>0){MC i=new MC(YZ(o[0]),MD+'ul.png',null,oP,data:new wC(o,null,null));i.action=(){if(i.selected)iC.PN();else iC.FQ((i.data as wC).aH);};BB.add(i);}if(s.length>0){MC i=new MC(YZ(s[0]),MD+'ol.png',null,oP,data:new wC(s,null,null));i.action=(){if(i.selected)iC.PN();else iC.FQ((i.data as wC).aH);};BB.add(i);}BB.add(new MC(LB.NB('toolbar.rise_list_level'),MD+'list_rise_level.png',()=>iC.PN(),cT,data:'rise_list_level'));bool SB=true;for(l IC in o)if(t.CB.fF(iC.cL(IC),o)==null)SB=false;for(l QD in s)if(t.CB.fF(iC.cL(QD),s)==null)SB=false;if(SB)BB.add(new MC(LB.NB('toolbar.lower_list_level'),MD+'list_lower_level.png',()=>iC.DU(),dT,data:'lower_list_level'));items.add(BB);}List<l> EB=oG.sT();if(EB!=null&&EB.length>0){jD KB=new jD();MC i=new MC(LB.NB('toolbar.insert_link'),MD+'add_link.png',null,eT,data:new wC(EB,null,null));i.action=()=>oG.tT((i.data as wC).aH);KB.add(i);i=new MC(LB.NB('toolbar.remove_link'),MD+'remove_link.png',()=>oG.yT(),fT,data:new wC(EB,null,null));KB.add(i);i=new MC(LB.NB('toolbar.insert_anchor'),MD+'anchor.png',null,BN,data:new wC(EB,null,null));i.action=()=>oG.xT((i.data as wC).aH);KB.add(i);items.add(KB);}jD j=new jD();List<l> tD=g.sU();for(l k in tD){String qE=g.fO(k);if(qE=='style'){String v=g.bC(k,'style',null);if(v=='GRAS'){NJ(g,j,k,MD+'style_bold.png','B');}else if(v=='ITALIQUE'){NJ(g,j,k,MD+'style_italic.png','I');}else if(v=='EXPOSANT'){NJ(g,j,k,MD+'style_superscript.png');}else if(v=='INDICE'){NJ(g,j,k,MD+'style_subscript.png');}else if(v=='BARRE'){NJ(g,j,k,MD+'style_strikethrough.png');}else if(v=='SOULIGNE'){NJ(g,j,k,MD+'style_underline.png');}}}if(j.length>0){j.add(new MC(LB.NB('toolbar.remove_styles'),MD+'remove_styles.png',()=>yB.eL(),null,data:"remove_styles"));items.add(j);}if(t.ZC!=null){String MF=t.CB.bC(t.ZC[0],'styleAtt','style');List<l> VG=t.CB.fE(t.ZC[0]);bool BC=false;for(l MI in VG){if(t.CB.attributeName(MI)==MF){BC=true;break;}}if(BC){jD HB=new jD();NM(HB,'text-align','left',LB.NB('toolbar.align_left'),MD+'align_left.png');NM(HB,'text-align','right',LB.NB('toolbar.align_right'),MD+'align_right.png');NM(HB,'text-align','center',LB.NB('toolbar.align_center'),MD+'align_center.png');NM(HB,'text-align','justify',LB.NB('toolbar.align_justify'),MD+'align_justify.png');items.add(HB);}}l eJ=YE.EQ();if(eJ!=null){List<String> fJ=['serif','sans-serif','cursive','fantasy','monospace'];WF ML=ZZ(LB.NB('toolbar.font'),"font-family",fJ);items.add(ML);}}}WF ZZ(String BB,String h,List<String> EB,[String s]){XB k=new XB(BB);k.parent=this;l i=YE.EQ();for(String v in EB){String j=v;if(s!=null)j+= s;CC m=new CC(v,null,data:new wC([i],h,j));m.action=(){if(m.checked){q g=IB.vC();q HB=IB.GF();if(g==HB&&g.u is OB&&g.u.parent.DB==i&&(g.u.parent as yB).CH(h,j)&&g.JB==g.u.PB&&g.u.nextSibling==null){n o=g.u.parent;IB.JD(new q(o.parent,o.parent.ZB(o)+1));IB.LC();}else yB.eL(i,h);}else{yB.HU(i,h,j);}};k.add(m);}WF KB=new WF(k,gT,this);return (KB);}add(lG g){items.add(g);}insert(lG g,int h){items.insert(h,g);}remove(int g){items.remove(g);}List<MC> get GG{List<MC> g=new List<MC>();for(lG h in items){if(h is jD)g.addAll(h.GG);}return (g);}List<l> dR(){if(VO!=null)return (VO);List<l> h=new List<l>();for(lG i in items){if(i is jD){for(MC j in i.GG){if(j.data is wC){wC g=j.data;if(g.kF!=null)h.addAll(g.kF);}}}else if(i is WF){XB m=i.oI;for(CC k in m.items){if(k.data is wC){wC g=k.data;if(g.kF!=null)h.addAll(g.kF);}}}}VO=h;return (h);}Element html(){DivElement g=new DivElement();g.classes.add('toolbar');for(lG h in items){g.append(h.html());}return (g);}String YZ(l h){String g=t.CB.uH(h);if(g==null)g=t.CB.OD(h);return (g);}cK(HH k,jD i,List<l> h,String j){MC g=new MC(YZ(h[0]),j,null,BN,data:new wC(h,null,null));g.action=()=>t.AI((g.data as wC).aH,'element');i.add(g);}static void BN(MC g,n j,n k,List<l> i,List<l> m){wC h=g.data;List<l> o=h.kF;if(h.rK(i))g.enable();else g.disable();}NJ(HH v,jD k,l h,String m,[String o=null]){MC i=new MC(YZ(h),m,null,aT,data:new wC([h],null,null),shortcut:o);i.action=(){if(i.selected){q g=IB.vC();q s=IB.GF();if(g==s&&g.u is OB&&g.u.parent.DB==h&&g.JB==g.u.PB&&g.u.nextSibling==null){n j=g.u.parent;IB.JD(new q(j.parent,j.parent.ZB(j)+1));IB.LC();}else yB.eL(h);}else{yB.KQ(h);}};k.add(i);}static void aT(MC g,n v,n h,List<l> m,List<l> o){wC i=g.data;List<l> j=i.kF;bool k=false;for(l s in j){if(o.contains(s)){k=true;break;}}if(k){g.enable();g.select();}else{if(h!=null&&j.contains(h.DB))g.select();else g.xE();if(i.rK(m))g.enable();else g.disable();}}NM(jD j,String g,String i,String k,String m){MC h=new MC(k,m,null,bT,data:new wC(t.ZC,g,i));h.action=(){if(h.selected){kB.rT(g);}else{kB.wT(g,i);}};j.add(h);}static void bT(MC g,n m,n j,List<l> o,List<l> s){wC i=g.data;bool k=false;for(n h=m;h!=null;h=h.parent){if(t.ZC.contains(h.DB)){if((h as kB).CH(i.iI,i.QJ)){k=true;break;}}}if(k){g.enable();g.select();}else{if(j!=null&&t.ZC.contains(j.DB)&&(j as kB).CH(i.iI,i.QJ)){g.select();}else{g.xE();}if(kB.dL().length>0)g.enable();else g.disable();}}static void oP(MC g,n k,n s,List<l> m,List<l> v){wC i=g.data;List<l> o=i.kF;bool j=false;for(n h=k;h!=null;h=h.parent){if(o.contains(h.DB)){j=true;break;}}if(j){g.enable();g.select();}else{g.xE();if(i.rK(m))g.enable();else g.disable();}}static void cT(MC h,n j,n k,List<l> m,List<l> o){q i=IB.vC();n g=i.u;while(g!=null&&g is!xD)g=g.parent;if(g!=null)h.enable();else h.disable();}static void dT(MC h,n j,n k,List<l> m,List<l> o){q i=IB.vC();n g=i.u;while(g!=null&&g is!xD)g=g.parent;if(g==null||g.previousSibling==null)h.disable();else h.enable();}static void eT(MC g,n j,n k,List<l> h,List<l> m){wC i=g.data;if(IB.vC().u is OB&&i.rK(h))g.enable();else g.disable();}static void fT(MC g,n o,n s,List<l> v,List<l> i){wC j=g.data;List<l> k=j.kF;bool h=false;for(l m in k){if(i.contains(m)){h=true;break;}}if(h)g.enable();else g.disable();}static void gT(WF HB,n KB,n j,List<l> v,List<l> QB){XB BB=HB.oI;CC k=null;for(CC g in BB.items){if(g.data is wC){wC EB=g.data;l h=EB.kF[0];String o=EB.iI;String s=EB.QJ;if(t.ZC.contains(h)){bool m=false;for(n i=KB;i!=null;i=i.parent){if(t.ZC.contains(i.DB)&&(i as kB).CH(o,s)){m=true;break;}}if(m){g.enable();k=g;g.check();}else{if(j!=null&&t.ZC.contains(j.DB)&&(j as kB).CH(o,s)){k=g;g.check();}else{g.dS();}if(kB.dL().length>0)g.enable();else g.disable();}}else if(t.CB.fO(h)=='style'){if(QB.contains(h)){g.enable();k=g;}else{if(j!=null&&h==j.DB)k=g;if(v.contains(h))g.enable();else g.disable();}}else if(t.CB.fO(h)=='stylespan'){bool m=false;for(n i=KB;i!=null;i=i.parent){if(i.DB==h&&(i as YE).CH(o,s)){m=true;break;}}if(m){g.enable();k=g;g.check();}else{if(j!=null&&h==j.DB&&(j as YE).CH(o,s)){k=g;g.check();}else{g.dS();}if(v.contains(h))g.enable();else g.disable();}}else if(h!=null){if(v.contains(h))g.enable();else g.disable();}}}if(k==null)BB.title=HB.title;else BB.title=k.title;}static void iT(WF j,n o,n s,List<l> k,List<l> v){XB m=j.oI;for(CC g in m.items){if(g.data is wC){wC h=g.data;List<l> i=h.kF;if(i!=null&&i.length>0){if(h.rK(k))g.enable();else g.disable();}}}}void update(n i,List<l> s){List<l> j=new List<l>();for(n h=i;h!=null;h=h.parent)j.add(h.DB);n k=null;q g=IB.vC();q v=IB.GF();if(g.u is!OB&&g.u.PB>g.JB){if(v==new q(g.u,g.JB+1))k=g.u.eB(g.JB);}for(MC m in GG){if(m.update!=null)m.update(m,i,k,s,j);}for(lG o in items){if(o is WF){o.update(o,i,k,s,j);}}}}class tM{n RF;l DB;List<l> IE;HashMap<l,SD> controls;HashMap<aB,TextInputElement> TG;FD okfct;tM(this.RF,[this.okfct]){DB=RF.DB;controls=new HashMap<l,SD>();TG=null;}void show(){DivElement s=new DivElement();s.id='attributes_dlg';s.classes.add('dlg1');DivElement SB=new DivElement();SB.classes.add('dlg2');DivElement v=new DivElement();v.classes.add('dlg3');DivElement m=new DivElement();m.classes.add('dlgtitle');m.text=t.CB.OD(DB);v.append(m);FormElement cB=new FormElement();TableElement hB=new TableElement();IE=t.CB.fE(DB);SD BB=null;for(l h in IE){TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();String QD=t.CB.vG(DB,h);if(QD!=null){ButtonElement j=new ButtonElement();j.attributes['type']='button';j.classes.add('help');j.value='?';j.text='?';j.title=QD;j.onClick.listen((Event BC)=>tO(h,DB));g.append(j);}i.append(g);g=new TableCellElement();String VG=t.CB.PH(DB,h);String m=t.CB.fK(DB,h);g.appendText(m);if(t.CB.BL(DB,h))g.classes.add('required');else g.classes.add('optional');i.append(g);g=new TableCellElement();String EB=RF.getAttribute(VG);String tD=t.CB.dF(h);if(EB==null){if(tD!=null)EB=tD;else EB='';}SD IC=new SD.wY(DB,h,EB);controls[h]=IC;List<String> qE=t.CB.gI(h);if(qE==null||qE.length==0)if(BB==null)BB=IC;g.append(IC.html());i.append(g);hB.append(i);}for(aB o in RF.attributes){bool MF=false;for(l h in controls.keys){if(o.localName==t.CB.attributeName(h)&&o.pB==t.CB.attributeNamespace(h)){MF=true;break;}}if(!MF){if(TG==null)TG=new HashMap<aB,TextInputElement>();TextInputElement k=new TextInputElement();k.spellcheck=false;k.size=40;k.value=o.value;k.classes.add('invalid');TG[o]=k;TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();i.append(g);g=new TableCellElement();g.appendText(o.name);i.append(g);g=new TableCellElement();g.append(k);i.append(g);hB.append(i);}}cB.append(hB);DivElement HB=new DivElement();HB.classes.add('buttons');ButtonElement KB=new ButtonElement();KB.attributes['type']='button';KB.appendText(LB.NB("button.Cancel"));KB.onClick.listen((MouseEvent BC)=>cancel());HB.append(KB);ButtonElement QB=new ButtonElement();QB.attributes['type']='submit';QB.appendText(LB.NB("button.OK"));QB.onClick.listen((MouseEvent BC)=>iF(BC));HB.append(QB);cB.append(HB);v.append(cB);SB.append(v);s.append(SB);document.body.append(s);if(BB!=null)BB.focus();}void iF(MouseEvent v){for(l h in controls.keys){SD k=controls[h];String g=k.hF();bool EB=t.CB.BL(DB,h);if(g==''&&EB){v.preventDefault();window.alert(LB.NB('attribute.missing_required'));return;}}LinkedHashMap<String,aB> j=RF.gR();for(l h in controls.keys){SD k=controls[h];String i=t.CB.PH(DB,h);String g=k.hF();String m=t.CB.attributeNamespace(h);String o=t.CB.dF(h);if((g==''&&o==null)||g==o)j.remove(i);else if(g!=''||o!=null)j[i]=new aB.aX(m,i,g);}if(TG!=null){for(aB s in TG.keys){TextInputElement HB=TG[s];String i=s.name;String g=HB.value;String m=s.pB;if(g=='')j.remove(i);else j[i]=new aB.aX(m,i,g);}}querySelector('div#attributes_dlg').remove();v.preventDefault();List<aB> BB=new List.from(j.values);if(RF.oB()!=null){GB KB=new GB.qX(RF,BB);t.DC(KB);}else{RF.attributes=BB;}IB.AH();if(okfct!=null)okfct();}void cancel(){querySelector('div#attributes_dlg').remove();IB.AH();}void tO(l g,l h){WG i=new WG.UX(g,h);i.show();}}abstract class lG{Element html();}class LD implements Exception{final String message;final Exception parentException;const LD([this.message,this.parentException]);String toString(){String g;if(message==null)g='DaxeException';else g=message;if(parentException!=null)g="${g} (parent exception: ${parentException})";return (g);}}class wC{List<l> kF;l aH;String iI;String QJ;wC(this.kF,this.iI,this.QJ){assert(kF!=null&&kF.length>0&&(iI==null||QJ!=null));aH=null;}String get css{if(iI==null)return (null);return ("${iI}: ${QJ}");}bool rK(List<l> h){for(l g in kF){if(h.contains(g)){aH=g;return (true);}}aH=null;return (false);}}typedef void JT(WF tbmenu,n parent,n selectedNode,List<l> validRefs,List<l> ancestorRefs);typedef void KT(MC button,n parent,n selectedNode,List<l> validRefs,List<l> ancestorRefs);typedef n kJ(AB node,n parent);class aB{String pB;String EC;String localName;String value;aB.QX(lC g){pB=g.pB;EC=g.EC;if(g.EC!=null)localName=g.localName;else localName=g.name;value=g.nodeValue;}aB(String g,String h){pB=null;EC=null;localName=g;this.value=h;}aB.aX(String i,String g,String j){pB=i;int h=g.indexOf(':');if(h==-1){EC=null;localName=g;}else{EC=g.substring(0,h);localName=g.substring(h+1);}this.value=j;}aB.gX(aB g){pB=g.pB;EC=g.EC;localName=g.localName;value=g.value;}String get name{if(EC==null)return (localName);else return ("${EC}:${localName}");}String toString(){StringBuffer g=new StringBuffer();if(EC!=null){g.write(EC);g.write(':');}g.write(localName);g.write('="');g.write(n.hT(value));g.write('"');return (g.toString());}}class jP{static bool QL=false;static bool zM=false;static String zF='';void show(){DivElement h=document.getElementById('find_dlg');if(h!=null){TextInputElement o=document.getElementById('find_dlg_find_field');o.focus();return;}Element QD=querySelector("#doc1");QD.style.bottom='10.5em';h=new DivElement();h.id='find_dlg';h.classes.add('find');FormElement s=new FormElement();TableElement v=new TableElement();TableRowElement j=new TableRowElement();TableCellElement g=new TableCellElement();g.text=LB.NB('find.find');j.append(g);g=new TableCellElement();TextInputElement o=new TextInputElement();o..id='find_dlg_find_field'..name='find'..size=40..value=zF;g.append(o);j.append(g);v.append(j);j=new TableRowElement();g=new TableCellElement();g.text=LB.NB('find.replace_by');j.append(g);g=new TableCellElement();TextInputElement HB=new TextInputElement();HB..id='find_dlg_replace_field'..name='replace_by'..size=40;g.append(HB);j.append(g);v.append(j);h.append(v);DivElement m=new DivElement();m.classes.add('options');CheckboxInputElement BB=new CheckboxInputElement();BB..id='find_cb_ignore_case'..checked=QL..onChange.listen((Event i)=>QL=BB.checked);m.append(BB);LabelElement KB=new LabelElement();KB..htmlFor='find_cb_ignore_case'..text=LB.NB("find.case_sensitive");m.append(KB);CheckboxInputElement EB=new CheckboxInputElement();EB..id='find_cb_backwards'..checked=zM..onChange.listen((Event i)=>zM=EB.checked);m.append(EB);LabelElement QB=new LabelElement();QB..htmlFor='find_cb_backwards'..text=LB.NB("find.backwards");m.append(QB);s.append(m);DivElement k=new DivElement();k.classes.add('buttons');ButtonElement SB=new ButtonElement();SB..attributes['type']='button'..appendText(LB.NB("button.Close"))..onClick.listen((MouseEvent i)=>close());k.append(SB);ButtonElement cB=new ButtonElement();cB..attributes['type']='button'..appendText(LB.NB("find.replace"))..onClick.listen((MouseEvent i)=>replace());k.append(cB);ButtonElement hB=new ButtonElement();hB..attributes['type']='button'..appendText(LB.NB("find.replace_find"))..onClick.listen((MouseEvent i)=>TW());k.append(hB);ButtonElement BC=new ButtonElement();BC..attributes['type']='button'..appendText(LB.NB("find.replace_all"))..onClick.listen((MouseEvent i)=>replaceAll());k.append(BC);ButtonElement IC=new ButtonElement();IC..attributes['type']='button'..appendText(LB.NB("find.next"))..onClick.listen((MouseEvent i)=>next());k.append(IC);s.append(k);h.append(s);document.body.append(h);h.onKeyDown.listen((KeyboardEvent i){if(i.keyCode==KeyCode.ESC){close();}});o.focus();}void next(){zF=((document.getElementById('find_dlg_find_field')) as TextInputElement).value;if(zF=='')return;q g;if(!zM){q h=IB.GF();if(h==null)h=new q(t.sC,0);g=GW(h);}else{q i=IB.vC();if(i==null)i=new q(t.sC,t.sC.PB);g=NP(i);}if(g!=null){IB.JD(g);IB.cursor.gE(g,new q(g.u,g.JB+zF.length));}}q GW(q j){n g=j.u;int h=j.JB;if(g is!OB){g=g.eB(h);h=0;}while(g!=null){if(g is OB){int i;if(!QL)i=g.nodeValue.toLowerCase().indexOf(zF.toLowerCase(),h);else i=g.nodeValue.indexOf(zF,h);if(i!=-1)return (new q(g,i));}g=g.nextNode();h=0;}return (null);}q NP(q k){n g=k.u;int h=k.JB;if(g is!OB){if(h>0)g=g.eB(h-1);else{n i=g;g=null;while(i!=null){if(i.previousSibling!=null){g=i.previousSibling;break;}i=i.parent;}}if(g!=null)h=g.PB;}while(g!=null){if(g is OB){int j;if(!QL)j=g.nodeValue.toLowerCase().substring(0,h).lastIndexOf(zF.toLowerCase());else j=g.nodeValue.substring(0,h).lastIndexOf(zF);if(j!=-1)return (new q(g,j));}g=g.previousNode();if(g!=null)h=g.PB;}return (null);}void replace(){q g=new q.nX(IB.vC());q h=new q.nX(IB.GF());if(g==null||g.u is!OB)return;String i=((document.getElementById('find_dlg_replace_field')) as TextInputElement).value;GB j=new GB.sX(LB.NB('find.replace'));if(i!='')j.TB(new GB.bX(h,i));if(g!=h&&g.u==h.u)j.TB(new GB.iX(g,h.JB-g.JB));t.DC(j);IB.cursor.gE(g,new q(g.u,g.JB+i.length));}void TW(){replace();next();}void replaceAll(){zF=((document.getElementById('find_dlg_find_field')) as TextInputElement).value;if(zF=='')return;String i=((document.getElementById('find_dlg_replace_field')) as TextInputElement).value;q g=NP(new q(t.sC,t.sC.PB));GB h=new GB.sX(LB.NB('find.replace_all'));while(g!=null){if(i!='')h.TB(new GB.bX(new q(g.u,g.JB+zF.length),i));h.TB(new GB.iX(g,zF.length));g=NP(g);}t.DC(h);}void close(){DivElement g=document.getElementById('find_dlg');g.remove();Element h=querySelector("#doc1");h.style.bottom='1.5em';IB.AH();}}abstract class q{factory q(n g,int h){return (new dC(g,h));}factory q.RX(int g){return (new CE(g));}factory q.XX(int g){return (new vD(g));}factory q.eX(q g){if(g is dC)return (new CE.VX(g));else if(g is CE)return (new CE.kX(g));else if(g is vD)return (new CE.fX(g));}factory q.jX(q g){if(g is dC)return (new vD.WX(g));else if(g is CE)return (new vD.hX(g));else if(g is vD)return (new vD.lX(g));}factory q.nX(q g){if(g is dC)return (new dC(g.u,g.JB));else if(g is CE)return (new CE(g.HF));else if(g is vD)return (new vD(g.UF));}n get u;int get JB;int get HF;int get UF;bool operator==(q g);bool operator<(q g);bool operator<=(q g);bool operator>(q g);bool operator>=(q g);void OG(int g);void zE();GD jF();String LI({bool titles: false});String toString();}class RD{n u;RD parent;RD firstChild;RD nextSibling;bool LG;DivElement div;SpanElement WH;SpanElement oE;RD(this.u,this.parent){LG=false;JV();if(u.parent==t.sC){cJ();}}void IV(){for(n g=u.firstChild;g!=null;g=g.nextSibling){if(g is!OB){jB(new RD(g,this));}}}void US(){if(firstChild!=null)PP(firstChild);}void PP(RD h){RD g=h;while(g!=null){if(g.div!=null)g.div.remove();g=g.nextSibling;}if(firstChild==h)firstChild=null;else h.previousSibling.nextSibling=null;}RD get lastChild{if(firstChild==null)return null;RD g=firstChild;while(g.nextSibling!=null){g=g.nextSibling;}return g;}RD get previousSibling{if(parent==null)return null;for(RD g=parent.firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==this)return g;}return null;}List<RD> get children{List<RD> h=new List<RD>();for(RD g=firstChild;g!=null;g=g.nextSibling)h.add(g);return (h);}void jB(RD g){RD h=lastChild;if(h==null){firstChild=g;}else{h.nextSibling=g;}g.nextSibling=null;g.parent=this;div.append(g.div);}bool get XO{return TL(u);}JV(){div=new DivElement();div.classes.add('tree_div');WH=new SpanElement();WH.classes.add('tree_node_title');WH.setAttribute('tabindex','-1');WH.onKeyDown.listen((KeyboardEvent i){int h=i.keyCode;if(h==KeyCode.DOWN){if(firstChild!=null)firstChild.focus();else if(nextSibling!=null)nextSibling.focus();else if(parent!=null){RD g=parent;while(g.nextSibling==null&&g.parent!=null)g=g.parent;if(g.nextSibling!=null)g.nextSibling.focus();}}else if(h==KeyCode.UP){if(previousSibling!=null){RD g=previousSibling;while(g.lastChild!=null)g=g.lastChild;g.focus();}else if(parent!=null)parent.focus();else document.getElementById('tree_tab_button').focus();}else if(h==KeyCode.ENTER){IB.XS(u);}else if(h==KeyCode.RIGHT&&XO){if(!LG)cJ();firstChild.focus();}else if(h==KeyCode.LEFT&&LG){cJ();}else if(h==KeyCode.LEFT&&parent!=null){parent.focus();}});if(u.DB!=null)WH.appendText(t.CB.OD(u.DB));else WH.appendText(u.nodeName);WH.onClick.listen((MouseEvent i)=>IB.XS(u));if(TL(u)&&u.parent!=t.sC){LR();}div.append(WH);}void LR(){oE=new SpanElement();oE.classes.add('expand_button');ImageElement g=new ImageElement(width:9,height:9);if(LG){oE.classes.add('expanded');g.src='packages/daxe/images/expanded_tree.png';}else{oE.classes.add('collapsed');g.src='packages/daxe/images/collapsed_tree.png';}oE.append(g);oE.onClick.listen((MouseEvent h)=>cJ());div.append(oE);}void cJ(){if(!LG){IV();if(oE!=null){oE.classes.remove('collapsed');oE.classes.add('expanded');ImageElement g=oE.firstChild;g.src='packages/daxe/images/expanded_tree.png';}}else{US();if(oE!=null){oE.classes.remove('expanded');oE.classes.add('collapsed');ImageElement g=oE.firstChild;g.src='packages/daxe/images/collapsed_tree.png';}}LG=!LG;}void update(){if(oE==null&&TL(u)&&u.parent!=t.sC){LR();LG=true;}else if(oE!=null&&!TL(u)){US();LG=false;oE.remove();}if(!LG)return;RD g=firstChild;for(n h=u.firstChild;h!=null;h=h.nextSibling){if(h is!OB){if(g==null){g=new RD(h,this);jB(g);}else if(g.u!=h){PP(g);g=new RD(h,this);jB(g);}else{g.update();}}if(g!=null)g=g.nextSibling;}if(g!=null)PP(g);}void focus(){WH.focus();}static bool TL(n h){for(n g=h.firstChild;g!=null;g=g.nextSibling){if(g is!OB){return (true);}}return (false);}}class PL{int aZ=0;Map<String,n> bZ=new Map<String,n>();nG sC;HH CB;List<GB> WD=new List<GB>();int hE=-1;String RJ;String CL;List<l> ZC;l uO;Future FP(String j){Completer g=new Completer();CB=new HH();CB.load(j).then((m){ZC=CB.yG('hiddenp');if(ZC.length==0)ZC=null;uO=CB.mO('hiddendiv');RJ=null;sC=new nG();List<l> i=CB.HI();if(i.length==1){n h=ND.NF(i[0]);CB.NO(h);sC.jB(h);h.lF();}g.complete();},onError:(LD k){g.completeError(k);});return (g.future);}Future KP(String i,String k,{bool removeIndents: true}){Completer g=new Completer();CB=new HH();CB.load(k).then((v){ZC=CB.yG('hiddenp');if(ZC.length==0)ZC=null;uO=CB.mO('hiddendiv');this.RJ=i;DG s=new DG();s.AL(i).then((sB m){if(removeIndents)VS(m.documentElement);sC=ND.dH(m,null);if(CB!=null&&ZC!=null)QP(sC);g.complete();},onError:(UD h){if(h.errorCode==404){sC=new nG();List<l> o=CB.HI();if(o.length==1){n j=ND.NF(o[0]);CB.NO(j);sC.jB(j);j.lF();}g.complete();}else g.completeError(new LD("Opening ${i}: ${h}"));});},onError:(LD h){g.completeError(new LD("Reading config ${k}: ${h}"));});return (g.future);}Future ZW(){assert(CL!=null);Completer i=new Completer();String j='AaB03x';HttpRequest h=new HttpRequest();h.onLoad.listen((ProgressEvent o){String k=h.responseText;if(k.startsWith('ok'))i.complete();else{String m;if(k.startsWith('erreur\n'))m=k.substring('erreur\n'.length);else m=k;i.completeError(new LD(m));}});h.onError.listen((ProgressEvent o){i.completeError(new LD(h.status.toString()));});h.open('POST',CL);h.setRequestHeader('Content-Type',"multipart/form-data; boundary=${j}");StringBuffer g=new StringBuffer();g.write("--${j}\r\n");g.write('Content-Disposition: form-data; name="chemin"\r\n');g.write('Content-type: text/plain; charset=UTF-8\r\n');g.write('Content-transfer-encoding: 8bit\r\n\r\n');g.write(RJ);g.write("\r\n--${j}\r\n");g.write('Content-Disposition: form-data; name="contenu"; filename="${RJ}"\r\n');g.write('Content-Type: application/octet-stream\r\n\r\n');sC.xF='UTF-8';g.write(toString());g.write('\r\n--${j}--\r\n\r\n');h.send(g.toString());return (i.future);}String aM(n h){aZ++ ;String g="a${aZ}";bZ[g]=h;return (g);}Element html(){return (sC.html());}n mI(){for(n g=sC.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==n.tC)return (g);}return (null);}void insertNode(n g,q h){GB i=new GB.mX(h,g);DC(i);}void cM(n g){GB h=new GB.pX(g);DC(h);}void WM(q g,String h){GB i=new GB.bX(g,h);DC(i);}void SW(q g,int h){GB i=new GB.iX(g,h);DC(i);}void OP(q g,q h){GB i=FI(g,h);DC(i);}GB FI(q h,q i){assert(h<i);GB j=new GB.sX(LB.NB('undo.remove'));if(h.u==i.u){n o=h.u;if(o.nodeType==n.mB){j.TB(new GB.iX(new q(o,h.JB),i.JB-h.JB));}else{for(int k=h.JB;k<i.JB;k++ ){if(o.eB(k) is OB)j.TB(new GB.pX(o.eB(k)));}for(int k=h.JB;k<i.JB;k++ ){if(o.eB(k) is!OB)j.TB(new GB.pX(o.eB(k)));}}}else{bool v=false;n m;if(h.u.nodeType==n.tC){m=h.u.eB(h.JB);q BB=new q(h.u,h.JB+1);if(i>=BB)v=true;}else{m=h.u;if(m.PB-h.JB>0){j.TB(new GB.iX(new q(m,h.JB),m.PB-h.JB));}}if(i.u.nodeType==n.mB&&i.JB>0){j.TB(new GB.iX(new q(i.u,0),i.JB));}for(n g=m.nextSibling;g!=null;g=g.nextSibling){q s=new q(g.parent,g.parent.ZB(g));if(s<i){if(g.nodeType==n.mB&&i>=new q(g.parent,g.parent.ZB(g)+1)){j.TB(new GB.pX(g));}}else break;}if(v)j.TB(new GB.pX(m));for(n g=m.nextSibling;g!=null;g=g.nextSibling){q s=new q(g.parent,g.parent.ZB(g));if(s<i){if(g.nodeType!=n.mB){j.TB(new GB.pX(g));}}else break;}}return (j);}n hI(q g,q i){assert(g<i);n m=g.u;if(m is OB)m=m.parent;n j=ND.NF(m.DB);if(g.u==i.u){n o=g.u;if(o.nodeType==n.mB){j.jB(new OB(o.nodeValue.substring(g.JB,i.JB)));}else{for(int s=g.JB;s<i.JB;s++ ){j.jB(new n.wX(o.eB(s)));}}}else{n k;if(g.u.nodeType==n.tC){k=g.u.eB(g.JB);q v=new q(g.u,g.JB+1);if(i>=v){j.jB(new n.wX(k));}}else{k=g.u;if(k.PB-g.JB>0){j.jB(new OB(k.nodeValue.substring(g.JB,k.PB)));}}for(n h=k.nextSibling;h!=null;h=h.nextSibling){q BB=new q(h.parent,h.parent.ZB(h));if(BB<i){if(h.nodeType!=n.mB||(h.nodeType==n.mB&&i>=new q(h.parent,h.parent.ZB(h)+1))){j.jB(new n.wX(h));}}else break;}if(i.u.nodeType==n.mB&&i.JB>0){j.jB(new OB(i.u.nodeValue.substring(0,i.JB)));}}return (j);}n HG(n k,q h,q i){while(h.JB==h.u.PB&&h<i){h=new q(h.u.parent,h.u.parent.ZB(h.u)+1);}while(i.JB==0&&i>h){i=new q(i.u.parent,i.u.parent.ZB(i.u));}n j=new n.wX(k);for(n g=j.firstChild;g!=null;g=j.firstChild)j.gC(g);int BB=0;for(n g=k.firstChild;g!=null;g=g.nextSibling){q m=new q(k,BB);q o=new q(k,BB+1);if(m>=h&&o<=i){n EB=new n.wX(g);j.jB(EB);}else if(o<=h||m>=i){}else{if(g is OB){if(m>h&&o>i){assert(g==i.u);if(0<i.JB)j.jB(new OB(g.nodeValue.substring(0,i.JB)));}else if(m<h&&o<i){assert(g==h.u);if(h.JB<g.PB)j.jB(new OB(g.nodeValue.substring(h.JB,g.PB)));}else{int s;if(h.u==g)s=h.JB;else s=0;int v;if(i.u==g)v=i.JB;else v=g.PB;if(s<v)j.jB(new OB(g.nodeValue.substring(s,v)));}}else{n EB=HG(g,h,i);j.jB(EB);}}BB++ ;}return (j);}GB LE(n BB,q i,{bool checkValidity: true}){if(i.u is OB&&i.JB==0)i=new q(i.u.parent,i.u.parent.ZB(i.u));n h=i.u;int o=i.JB;if(h is OB){o=h.parent.ZB(h);h=h.parent;}GB EB=new GB.sX('insertChildren');List<n> s=new List<n>();while(BB.firstChild!=null){s.add(BB.firstChild);BB.gC(BB.firstChild);}q j=new q.nX(i);for(n g in s){if(g is!OB){if(checkValidity&&(h is AG||h is pF||h is IH)){String m;if(g.DB==null)m=g.nodeName;else m=CB.OD(g.DB);throw new LD(m+' '+LB.NB('insert.not_authorized_here'));}if(g is pF){if(checkValidity&&h.nodeType==n.XG)throw new LD(LB.NB('insert.text_not_allowed'));String k=null;if(g.firstChild!=null)k=g.firstChild.nodeValue;if(k==null)k='';if(checkValidity&&k.trim()!=''&&!CB.PE(h.DB)){throw new LD(LB.NB('insert.text_not_allowed'));}EB.TB(new GB.mX(j,g));}else{if(checkValidity){if(h.nodeType==n.XG){if(!CB.HI().contains(g.DB))throw new LD(CB.OD(g.DB)+' '+LB.NB('insert.not_authorized_here'));}else if(g is!AG&&g is!IH){if(g.DB==null||!CB.fD(h.DB,g.DB)){String m;if(g.DB==null)m=g.nodeName;else m=CB.OD(g.DB);String QB=CB.OD(h.DB);throw new LD(m+' '+LB.NB('insert.not_authorized_inside')+' '+QB);}if(!CB.VM(h,o,o,g.DB)){throw new LD(CB.OD(g.DB)+' '+LB.NB('insert.not_authorized_here'));}}}EB.TB(new GB.mX(j,g));}if(j.u is OB)j=new q(h,o+2);else j=new q(h,j.JB+1);}}bool HB=false;bool KB=true;for(n g in s){if(g is OB){if(checkValidity&&h.nodeType==n.XG)throw new LD(LB.NB('insert.text_not_allowed'));String k=g.nodeValue;if(k==null)k='';if(checkValidity&&k.trim()!=''&&!CB.PE(h.DB)){throw new LD(LB.NB('insert.text_not_allowed'));}int v=o+s.indexOf(g);if(i.u is OB)v++ ;if(HB)v-- ;if(s.length==1)j=i;else j=new q(h,v);if(KB){if(v>0&&(i.u is OB||h.eB(v-1) is OB))HB=true;KB=false;}EB.TB(new GB.bX(j,g.nodeValue));}}return (EB);}String toString(){return (sC.toString());}sB oW(){iH h=new zJ();sB g=h.createDocument(null,null,null);sC.KF(g);return (g);}void DC(GB g){g.eO();if(hE<WD.length-1)WD.removeRange(hE+1,WD.length);if(hE<0||!WD[hE].mU(g)){WD.add(g);hE++ ;}IB.KL();}void YH(){if(hE<0)return;GB g=WD[hE];g.YH();hE-- ;IB.KL();IB.LC();}void bM(){if(hE>=WD.length-1)return;GB g=WD[hE+1];g.eO();hE++ ;IB.KL();IB.LC();}bool FS(){return (hE>=0);}bool ES(){return (hE<WD.length-1);}String xR(){String g;if(hE>=0)g=WD[hE].title;else g=null;if(g==null)return (LB.NB('undo.undo'));else return ("${LB.NB('undo.undo')} ${g}");}String vR(){String g;if(hE<WD.length-1)g=WD[hE+1].title;else g=null;if(g==null)return (LB.NB('undo.redo'));else return ("${LB.NB('undo.redo')} ${g}");}void lK(String j,int g){GB i=new GB.sX(j);for(int h=WD.length-g;h<WD.length;h++ )i.TB(WD[h]);WD.removeRange(WD.length-g,WD.length);WD.add(i);hE-= (g-1);}void CS(String j,bool EB){q g=IB.vC();q k=IB.GF();if(j=='\n'&&!EB){if(((g.u is JH)||(g.u.nextSibling==null&&g.u.parent is JH))&&g.JB==g.u.PB){TI.vT(g);return;}else{n i=g.u;while(i is OB||i is kB||i is yB||i is YE)i=i.parent;if(i is xD){iC.EU(g);return;}}}if(j=='\n'&&ZC!=null){if(kB.AU())return;}bool m=false;n h=g.u;if(h.nodeType==n.mB)h=h.parent;if(h.lM)m=true;else if(j.trim()!=''){if(h.nodeType==n.XG)m=true;else if(h.DB!=null&&!t.CB.PE(h.DB)){if(ZC!=null){l v=CB.fF(h.DB,ZC);if(v!=null&&g==k){kB o=new kB.UY(v);o.jB(new OB(j));insertNode(o,g);IB.JD(new q(o,o.PB));IB.LC();return;}else m=true;}else m=true;}}if(m){window.alert(LB.NB('insert.text_not_allowed'));IB.cursor.GV();return;}bool BB=false;if(g!=k){g=new q.nX(g);k=new q.nX(k);IB.cursor.xG();OP(g,k);BB=true;if(g.u.parent==null)g=IB.vC();}t.WM(g,j);if(BB){GB s=new GB.sX(LB.NB('undo.insert_text'));s.TB(WD.removeAt(WD.length-2));s.TB(WD.removeLast());WD.add(s);hE-= 1;}}void AI(l j,String h){q i=IB.vC();if(i==null)return;n g=ND.NF(j,h);if(h=='element'&&mI()==null){CB.NO(g);}g.HP(()=>BS(g,i));}bool BS(n i,q g){n k=null;if(IB.vC()!=IB.GF()){q EB=IB.vC();q HB=IB.GF();k=hI(EB,HB);IB.cursor.xG();if(g.u is!OB&&g.JB>0&&g.u.eB(g.JB-1) is OB){n KB=g.u.eB(g.JB-1);g=new q(KB,KB.PB);}OP(EB,HB);if(g.u.parent==null)g=IB.vC();}bool v=false;n j=g.u;if(j is OB)j=j.parent;if(j is kB){kB h=j;if(!CB.fD(h.DB,i.DB)){GB m=new GB.sX(LB.NB('undo.insert_text'));q s=new q(h,h.PB);s.zE();if(g<s){n SB=hI(g,s);m.TB(FI(g,s));kB QB=ND.NF(h.DB);m.TB(new GB.mX(new q(h.parent,h.parent.ZB(h)+1),QB));m.TB(LE(SB,new q(QB,0)));}m.TB(new GB.mX(new q(h.parent,h.parent.ZB(h)+1),i));DC(m);v=true;}}else if(ZC!=null&&j.DB!=null&&!CB.fD(j.DB,i.DB)){l BB=CB.fF(j.DB,ZC);if(BB!=null&&CB.fD(BB,i.DB)){kB h=new kB.UY(BB);h.jB(i);insertNode(h,g);v=true;}}if(!v)insertNode(i,g);q o=i.QE();if(o==null)o=new q(i.parent,i.parent.ZB(i)+1);IB.JD(o);IB.LC();if(k!=null){try {if(o==null)throw new LD(k.toString()+LB.NB('insert.not_authorized_here'));if(t.ZC!=null){kB.QN(i,k);}DC(LE(k,o,checkValidity:true));lK(LB.NB('undo.insert_element'),3);IB.KL();return (true);}on LD catch (cB){window.alert(cB.toString());YH();YH();WD.removeRange(WD.length-2,WD.length);IB.KL();return (false);}}return (true);}void TV(String g,l h){if(g=='jaxe.FonctionNormal'){yB.eL();}else if(nP[g]!=null)nP[g]();}List<l> kO(n i){List<l> g;if(i.nodeType==n.XG){g=t.CB.HI();}else if(i.DB==null){g=new List<l>();}else{n h;if(i.nodeType==n.mB)h=i.parent;else h=i;g=CB.XC(h.DB);if(h is kB&&h.parent.DB!=null){LinkedHashSet j=new LinkedHashSet.from(g);j.addAll(CB.XC(h.parent.DB));g=new List.from(j);}else if(ZC!=null){l k=CB.fF(h.DB,ZC);if(k!=null){LinkedHashSet j=new LinkedHashSet.from(g);j.addAll(CB.XC(k));g=new List.from(j);}}}return (g);}List<l> dP(List<l> m){List<l> i=new List<l>();q s=IB.vC();q v=IB.GF();n h=s.u;int BB=s.JB;n k=v.u;int EB=v.JB;if(h.nodeType==n.mB){BB=h.parent.ZB(h);h=h.parent;}if(k.nodeType==n.mB){EB=k.parent.ZB(k);k=k.parent;}if(h!=k)return (i);for(l g in m){if(t.CB.VM(h,BB,EB,g))i.add(g);}if(h is kB&&h.parent.DB!=null){int HB=h.parent.ZB(h)+1;LinkedHashSet j=new LinkedHashSet.from(i);for(l g in m){if(!j.contains(g)){if(t.CB.VM(h.parent,HB,HB,g))j.add(g);}}i=new List.from(j);}else if(ZC!=null){l o=null;for(l g in ZC)if(i.contains(g)){o=g;break;}if(o!=null){LinkedHashSet j=new LinkedHashSet.from(i);for(l g in m){if(!j.contains(g)){if(t.CB.fD(o,g))j.add(g);}}i=new List.from(j);}}return (i);}q zG(num g,num h){return (sC.zG(g,h));}void VS(final l g){cZ(g,null,false,true);}void cZ(final l m,final l s,final bool HB,final bool KB){l o;if(CB!=null)o=CB.TM(m,s);else o=null;bool v=dZ(m,o,s,HB);final bool BB=eZ(m,o,s,KB);AB EB;for(AB j=m.firstChild;j!=null;j=EB){EB=j.nextSibling;if(j.nodeType==AB.FE)cZ(j as l,o,v,BB);else if(!v&&j.nodeType==AB.kE){String g=j.nodeValue;if(BB&&j.parentNode.firstChild==j&&s!=null){int h=0;while(h<g.length&&(g[h]==' '||g[h]=='\t'))h++ ;if(h>0)g=g.substring(h);}int i=g.indexOf("\n ");int k=g.indexOf("\n\t");if(k!=-1&&(i==-1||k<i))i=k;while(i!=-1){int h=i;while(h+1<g.length&&(g[h+1]==' '||g[h+1]=='\t'))h++ ;g=g.substring(0,i+1)+g.substring(h+1);i=g.indexOf("\n ");k=g.indexOf("\n\t");if(k!=-1&&(i==-1||k<i))i=k;}i=g.indexOf("  ");while(i!=-1){int h=i;while(h+1<g.length&&g[h+1]==' ')h++ ;g=g.substring(0,i)+g.substring(h);i=g.indexOf("  ");}if(g.length==0)m.gC(j);else j.nodeValue=g;}}}bool dZ(final l m,final l j,final l v,final bool o){bool g;final String h=m.getAttribute("xml:space");if(h=="preserve")g=true;else if(h=="default")g=false;else g=o;if(j!=null&&h==""){final List<l> s=CB.fE(j);for(l i in s){if(CB.attributeName(i)=="space"&&CB.attributeNamespace(i)=="http://www.w3.org/XML/1998/namespace"){final String k=CB.dF(i);if(k=="preserve")g=true;else if(k=="default")g=false;break;}}}return (g);}bool eZ(final l m,final l j,final l k,final bool o){if(j==null)return true;if(k==null||!CB.PE(j)||!CB.PE(k))return true;AB g=m.previousSibling;while(g!=null){if(g.nodeType==AB.kE){final String h=g.nodeValue;if(!(h.endsWith(" ")||h.endsWith("\n")))return false;return true;}else if(g.nodeType==AB.FE){final AB i=g.lastChild;if(i!=null&&i.nodeType==AB.kE){final String h=i.nodeValue;if(!(h.endsWith(" ")||h.endsWith("\n")))return false;}return true;}g=g.previousSibling;}if(g==null)return o;return true;}void QP(n i){l j;if(i.DB!=null)j=CB.fF(i.DB,ZC);else j=null;bool k=(j!=null);bool m=i is kB;bool s=i is yB;n o;for(n g=i.firstChild;g!=null;g=o){o=g.nextSibling;if(g is OB){if(k||m||s){String h=g.nodeValue;if(g.previousSibling==null||g.previousSibling is!AG||g.nextSibling==null||g.nextSibling is!AG){h=h.replaceAll('\n',' ');}h=h.replaceAll('  ',' ');if(k){if(g.previousSibling!=null&&g.previousSibling.DB!=null&&!CB.fD(j,g.previousSibling.DB)){h=h.trimLeft();}if(g.nextSibling!=null&&g.nextSibling.DB!=null&&!CB.fD(j,g.nextSibling.DB)){h=h.trimRight();}}else if(m){if(g.previousSibling==null)h=h.trimLeft();if(g.nextSibling==null)h=h.trimRight();}if(h.length==0)i.gC(g);else g.nodeValue=h;}}else if(g.firstChild!=null)QP(g);}}void rV(sB g){if(g.documentElement!=null)fZ(g.documentElement,null,false,1);}void fZ(final l i,final l j,final bool BB,final int k){l h;if(CB!=null)h=CB.TM(i,j);else h=null;bool m=dZ(i,h,j,BB);for(AB g=i.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==AB.FE)fZ(g as l,h,m,k+1);else if(!m&&g.nodeType==AB.kE&&g.nodeValue.contains("\n")){StringBuffer o=new StringBuffer("\n");int s=k;if(g.nextSibling==null)s-- ;for(int v=0;v<s;v++ )o.write('  ');String EB=o.toString();g.nodeValue=g.nodeValue.replaceAll("\n",EB);}}}}class vM{RD JF;vM(){}void update(){if(JF==null&&t.mI()!=null){JF=new RD(t.mI(),null);gZ();DivElement g=document.getElementById('tree');g.append(JF.div);}else{if(JF==null){if(t.mI()!=null){JF=new RD(t.mI(),null);DivElement g=document.getElementById('tree');g.append(JF.div);}}else{if(t.mI()==null){JF.div.remove();JF=null;}else JF.update();}}}void gZ(){if(!JF.XO)return;if(!JF.LG)JF.cJ();if(JF.children.length<10){for(RD g=JF.firstChild;g!=null;g=g.nextSibling){if(g.XO&&!g.LG)g.cJ();}}}}class GB{static const int bH=0;static const int cH=1;static const int mJ=2;static const int nJ=3;int gD;String title;q qB;String text;int length;n u;n wF;List<aB> attributes;List<GB> EH;bool LF;GB.bX(q h,String g,{bool updateDisplay: true}){assert(g!=null&&g!='');gD=bH;title=LB.NB('undo.insert_text');this.qB=new q.nX(h);this.text=g;u=null;wF=null;attributes=null;EH=null;this.LF=updateDisplay;}GB.iX(q g,int h,{bool updateDisplay: true}){assert(h>0);assert(g.u.nodeType==n.mB);gD=cH;title=LB.NB('undo.remove_text');this.qB=new q.nX(g);text=null;this.length=h;u=null;wF=null;attributes=null;EH=null;this.LF=updateDisplay;}GB.mX(q g,n h,{bool updateDisplay: true}){gD=bH;title=LB.NB('undo.insert_element');this.qB=new q.nX(g);text=null;this.u=h;wF=null;attributes=null;EH=null;this.LF=updateDisplay;}GB.pX(n g,{bool updateDisplay: true}){gD=cH;title=LB.NB('undo.remove_element');qB=null;text=null;this.u=g;wF=null;attributes=null;EH=null;this.LF=updateDisplay;}GB.qX(n g,List<aB> h,{bool updateDisplay: true}){gD=mJ;title=LB.NB('undo.attributes');qB=null;text=null;this.u=g;wF=null;this.attributes=h;EH=null;this.LF=updateDisplay;}GB.rX(n i,aB g,{bool updateDisplay: true}){gD=mJ;title=LB.NB('undo.attributes');qB=null;text=null;this.u=i;wF=null;LinkedHashMap<String,aB> h=i.gR();if(g.value==null){if(h[g.name]!=null)h.remove(g.name);}else h[g.name]=g;this.attributes=new List.from(h.values);EH=null;this.LF=updateDisplay;}GB.sX(String g){gD=nJ;this.title=g;qB=null;text=null;u=null;wF=null;attributes=null;EH=new List<GB>();LF=true;}bool mU(GB g){if(gD!=g.gD)return (false);if(gD==bH&&u is OB&&g.text!=null&&g.qB.u==u&&g.qB.JB+1==u.PB){return (true);}if(text==null||g.text==null)return (false);if(u!=g.u)return (false);if((gD==bH&&g.qB.JB==qB.JB+text.length)||(gD==cH&&g.qB.JB==qB.JB)){text="${text}${g.text}";return (true);}if((gD==bH&&g.qB.JB==qB.JB)||(gD==cH&&qB.JB==g.qB.JB+g.text.length)){text="${g.text}${text}";if(gD==cH)qB=new q(qB.u,qB.JB-g.text.length);return (true);}return (false);}void TB(GB g){assert(gD==nJ);EH.add(g);}void eO(){if(gD==bH)hZ(LF);else if(gD==cH)iZ(LF);else if(gD==mJ)jZ(LF);else if(gD==nJ){for(GB g in EH){g.eO();}}LF=true;}void YH(){if(gD==bH)iZ(LF);else if(gD==cH)hZ(LF);else if(gD==mJ)jZ(LF);else if(gD==nJ){for(GB g in EH.reversed){g.YH();}}}void hZ(bool j){if(text!=null){qB.zE();if(qB.u.nodeType==n.tC){u=new OB(text);text=null;}}if(text!=null){assert(qB.u.nodeType==n.mB);(qB.u as OB).WM(qB,text);if(j){qB.u.sD();IB.JD(new q(qB.u,qB.JB+text.length));if(qB.u.previousSibling==null&&qB.u.nextSibling==null){qB.u.parent.lF();}}}else{n g=qB.u;n h;List<n> i=new List<n>();i.add(u);if(g.nodeType==n.mB&&u.nodeType==n.mB){String k=g.nodeValue.substring(0,qB.JB);String m=g.nodeValue.substring(qB.JB);g.nodeValue="${k}${u.nodeValue}${m}";h=g;}else if(qB.JB==0){if(g.nodeType==n.mB){g.parent.insertBefore(u,g);h=g.parent;}else{g.insertBefore(u,g.firstChild);h=g;}}else if(g.PB==qB.JB){if(g.nodeType==n.mB){g.parent.insertBefore(u,g.nextSibling);h=g.parent;}else{g.jB(u);h=g;}}else if(g.nodeType==n.mB){if(wF==null)wF=(g as OB).NV(qB.JB);else{g.nodeValue=g.nodeValue.substring(0,qB.JB);g.parent.insertAfter(wF,g);}g.parent.insertBefore(u,wF);i.add(g);i.add(wF);h=g.parent;}else{n o=g.eB(qB.JB);g.insertBefore(u,o);h=g;}if(j){if(u.nodeType==n.tC)u.lF();h.lF();h.BF(i);if(u is OB)IB.JD(new q(u,u.nodeValue.length));else IB.JD(new q(u.parent,u.parent.ZB(u)+1));}u.WO();}}void iZ(bool k){if(u==null&&text==null){if(qB.JB==0&&qB.u.PB==length){u=qB.u;qB=new q(u.parent,u.parent.ZB(u));}else{text=qB.u.nodeValue.substring(qB.JB,qB.JB+length);}}if(text!=null){assert(qB.u.nodeType==n.mB);qB.u.remove(qB,text.length);if(k){qB.u.sD();IB.JD(qB);if(qB.u.previousSibling==null&&qB.u.nextSibling==null){qB.u.parent.lF();}}}else{u.PR();n h=u.parent;assert(h!=null);if(qB==null){if(u.previousSibling!=null&&u.previousSibling.nodeType==n.mB)qB=new q(u.previousSibling,u.previousSibling.PB);else qB=new q(h,h.ZB(u));}n i=u.previousSibling;n g=u.nextSibling;h.gC(u);List<n> j=new List<n>();if(i!=null&&i.nodeType==n.mB&&g!=null&&g.nodeType==n.mB){wF=g;i.nodeValue="${i.nodeValue}${g.nodeValue}";g.parent.gC(g);j.add(i);j.add(u);j.add(g);}else j.add(u);if(k){h.lF();h.BF(j);IB.JD(qB);}}}void jZ(bool g){List<aB> h=u.attributes;u.attributes=attributes;attributes=h;if(g){u.lF();u.uI();}}String toString(){StringBuffer g=new StringBuffer();switch (gD){case bH:g.write("Insert ");break;case cH:g.write("Remove ");break;case mJ:g.write("Attributes ");break;case nJ:g.write("Compound ");break;}if(text!=null)g.write("text '${text}'");else if(u!=null)g.write("node ${u.nodeName}");else if(qB!=null)g.write("${length} chars at ${qB}");return (g.toString());}}class LT{void show(){sB o=t.oW();t.rV(o);DivElement h=new DivElement();h.id='dlg1';h.classes.add('dlg1');DivElement i=new DivElement();i.classes.add('source_window');DivElement m=new DivElement();m.classes.add('source_content');OO(o,m);i.append(m);DivElement j=new DivElement();j.classes.add('source_bottom');ButtonElement k=new ButtonElement();k.attributes['type']='button';k.appendText(LB.NB("source.select_all"));k.onClick.listen((MouseEvent s)=>RP());j.append(k);ButtonElement g=new ButtonElement();g.attributes['type']='submit';g.appendText(LB.NB("button.Close"));g.onClick.listen((MouseEvent s)=>close());j.append(g);i.append(j);h.append(i);document.body.append(h);g.focus();}void OO(AB i,Element g){switch (i.nodeType){case AB.FK:SpanElement m=new SpanElement();m.classes.add('source_pi');String BB=(i as sB).UG;String EB=(i as sB).xF;m.appendText('<?xml version="${BB}" encoding="${EB}"?>');g.append(m);g.appendText('\n');for(AB k=i.firstChild;k!=null;k=k.nextSibling){OO(k,g);}break;case AB.FE:g.appendText('<');SpanElement j=new SpanElement();j.classes.add('source_element_name');j.appendText(i.nodeName);g.append(j);if(i.attributes!=null){for(lC v in i.attributes.values){g.appendText(' ');SpanElement o=new SpanElement();o.classes.add('source_attribute_name');o.appendText(v.nodeName);g.append(o);g.appendText('="');SpanElement s=new SpanElement();s.classes.add('source_attribute_value');kZ(s,v.nodeValue);g.append(s);g.appendText('"');}}if(i.firstChild!=null){g.appendText('>');if(i.childNodes!=null){for(AB k in i.childNodes){OO(k,g);}}g.appendText('</');j=new SpanElement();j.classes.add('source_element_name');j.appendText(i.nodeName);g.append(j);g.appendText('>');}else{g.appendText('/>');}break;case AB.kE:kZ(g,i.nodeValue);break;case AB.DK:SpanElement h=new SpanElement();h.classes.add('source_comment');h.appendText(i.toString());g.append(h);break;case AB.TQ:SpanElement h=new SpanElement();h.classes.add('source_entity');h.appendText(i.toString());g.append(h);break;case AB.BK:SpanElement h=new SpanElement();h.classes.add('source_cdata');h.appendText(i.toString());g.append(h);break;case AB.CK:SpanElement h=new SpanElement();h.classes.add('source_pi');h.appendText(i.toString());g.append(h);break;case AB.qL:SpanElement h=new SpanElement();h.classes.add('source_doctype');h.appendText(i.toString());g.append(h);break;default:g.appendText(i.toString());break;}}void kZ(Element i,String g){Map<String,String> k=<String,String>{'&':'&amp;','"':'&quot;','<':'&lt;','>':'&gt;'};Iterable<String> o=k.keys;int h=0;while(h<g.length){String m=g[h];if(o.contains(m)){if(h>0)i.appendText(g.substring(0,h));SpanElement j=new SpanElement();j.classes.add('source_entity');j.appendText(k[m]);i.append(j);g=g.substring(h+1);h=0;}else h++ ;}if(g.length>0)i.appendText(g);}void close(){DivElement g=document.getElementById('dlg1');g.remove();IB.AH();}void RP(){Selection g=window.getSelection();Range h=new Range();h.selectNodeContents(querySelector('.source_content'));g.removeAllRanges();g.addRange(h);}}class wM{int lZ;lP mZ;vM nZ;wM(){lZ=0;mZ=new lP();nZ=new vM();}DivElement html(){DivElement k=new DivElement();k.id='left_panel';DivElement m=new DivElement();m.id='tab_buttons';SpanElement h=new SpanElement();h.id='insert_tab_button';h.classes.add('tab_button');h.classes.add('selected');h.setAttribute('tabindex','-1');h.appendText(LB.NB('left.insert'));h.onClick.listen((MouseEvent j)=>SP());h.onKeyDown.listen((KeyboardEvent j){int g=j.keyCode;if(g==KeyCode.ENTER||g==KeyCode.DOWN){Element s=document.getElementById('insert');if(s.firstChild is ButtonElement){j.preventDefault();(s.firstChild as ButtonElement).focus();}}else if(g==KeyCode.RIGHT){VP();}else if(g==KeyCode.TAB){Timer.run((){IB.cursor.show();IB.cursor.focus();});}});m.append(h);SpanElement i=new SpanElement();i.id='tree_tab_button';i.classes.add('tab_button');i.setAttribute('tabindex','-1');i.appendText(LB.NB('left.tree'));i.onClick.listen((MouseEvent j)=>VP());i.onKeyDown.listen((KeyboardEvent j){int g=j.keyCode;if(g==KeyCode.ENTER||g==KeyCode.DOWN){if(nZ.JF!=null)nZ.JF.focus();}else if(g==KeyCode.LEFT){SP();}else if(g==KeyCode.TAB){Timer.run((){IB.cursor.show();IB.cursor.focus();});}});m.append(i);k.append(m);DivElement v=new DivElement();v.id='insert';k.append(v);DivElement o=new DivElement();o.id='tree';o.style.display='none';k.append(o);return (k);}void SP(){document.getElementById('insert').style.display='block';document.getElementById('tree').style.display='none';document.getElementById('insert_tab_button').classes.add('selected');document.getElementById('tree_tab_button').classes.remove('selected');document.getElementById('insert_tab_button').setAttribute('tabindex','0');document.getElementById('tree_tab_button').setAttribute('tabindex','-1');document.getElementById('insert_tab_button').focus();lZ=0;if(IB.vC()==null)return;n g=IB.vC().u;if(g is OB)g=g.parent;List<l> h=t.kO(g);List<l> i=t.dP(h);mZ.update(g,h,i);}void VP(){document.getElementById('tree').style.display='block';document.getElementById('insert').style.display='none';document.getElementById('tree_tab_button').classes.add('selected');document.getElementById('insert_tab_button').classes.remove('selected');document.getElementById('tree_tab_button').setAttribute('tabindex','0');document.getElementById('insert_tab_button').setAttribute('tabindex','-1');document.getElementById('tree_tab_button').focus();lZ=1;nZ.update();}void update(n g,List<l> h,List<l> i){if(lZ==0)mZ.update(g,h,i);else nZ.update();}}class WG{l eF;l QH;StreamSubscription<KeyboardEvent> zO;WG.SX(this.eF){}WG.UX(this.QH,this.eF){}void show(){DivElement m=new DivElement();m.id='dlg1';m.classes.add('dlg1');DivElement HB=new DivElement();HB.classes.add('dlg2');DivElement g=new DivElement();g.classes.add('dlg3');DivElement h=new DivElement();h.style.position='absolute';h.style.top='0px';h.style.right='0px';h.style.width='16px';h.style.height='16px';ImageElement i=new ImageElement();i.src='packages/daxe/images/close_dialog.png';i.width=16;i.height=16;i.style.position='fixed';i.onClick.listen((MouseEvent j)=>close());h.append(i);g.append(h);DivElement KB=new DivElement();KB.classes.add('dlgtitle');if(QH==null)KB.text=t.CB.OD(eF);else KB.text=t.CB.fK(eF,QH);g.append(KB);if(QH==null){ParagraphElement o=new ParagraphElement();o.appendText(LB.NB('help.element_name')+' ');SpanElement QB=new SpanElement();QB.classes.add('help_element_name');QB.text=t.CB.cD(eF);o.append(QB);g.append(o);}String k;if(QH==null)k=t.CB.uH(eF);else k=t.CB.vG(eF,QH);if(k!=null){k=HH.jT(k);ParagraphElement o=new Element.html("<p>${k}</p>");g.append(o);}if(QH==null){String BC=t.CB.ZD(eF);if(BC!=null){DivElement SB=new DivElement();SB.classes.add('help_regexp');SB.text=BC;g.append(SB);}SpanElement s=new SpanElement();s.id='help_parents';s.classes.add('help_list_title');s.text=LB.NB('help.parents');s.onClick.listen((MouseEvent j)=>VV());g.append(s);SpanElement v=new SpanElement();v.id='help_children';v.classes.add('help_list_title');v.text=LB.NB('help.children');v.onClick.listen((MouseEvent j)=>fR());g.append(v);SpanElement BB=new SpanElement();BB.id='help_attributes';BB.classes.add('help_list_title');BB.text=LB.NB('help.attributes');BB.onClick.listen((MouseEvent j)=>UV());g.append(BB);DivElement cB=new DivElement();cB.classes.add('help_list_div');UListElement IC=new UListElement();IC.id='help_list';cB.append(IC);g.append(cB);}DivElement hB=new DivElement();hB.classes.add('buttons');ButtonElement EB=new ButtonElement();EB.attributes['type']='submit';EB.appendText(LB.NB("button.Close"));EB.onClick.listen((MouseEvent j)=>close());hB.append(EB);g.append(hB);HB.append(g);m.append(HB);document.body.append(m);if(g.clientHeight>m.clientHeight*3/4){HB.style.left="33%";g.style.left="-25%";}if(QH==null)fR();zO=document.onKeyDown.listen(null);zO.onData((KeyboardEvent j){if(j.keyCode==KeyCode.ESC){close();}});EB.focus();}void VV(){SpanElement o=document.getElementById('help_parents');o.classes.add('selected_tab');SpanElement s=document.getElementById('help_children');s.classes.remove('selected_tab');SpanElement v=document.getElementById('help_attributes');v.classes.remove('selected_tab');UListElement k=document.getElementById('help_list');k.nodes.clear();List<l> g=t.CB.fC(eF);if(g==null||g.length==0)return;HashMap<l,String> i=OR(g.toSet());g.sort((BB,EB)=>i[BB].toLowerCase().compareTo(i[EB].toLowerCase()));for(l j in g){LIElement h=new LIElement();h.text=i[j];String m=t.CB.uH(j);if(m!=null)h.title=m;h.onClick.listen((MouseEvent HB)=>cS(j));h.classes.add('help_selectable');k.append(h);}}HashMap<l,String> OR(Set<l> EB,[int k=0]){HashMap<String,Set<l>> m=new HashMap<String,Set<l>>();for(l g in EB){Set<l> s=tU(g,k);String o=t.CB.OD(s.first);if(o!=null){bool v=true;for(l HB in s){if(t.CB.OD(HB)!=o){v=false;break;}}if(v){String h;if(k==0)h=t.CB.OD(g);else h=t.CB.OD(g)+" ("+o+")";Set i=m[h];if(i==null){i=new HashSet<l>();m[h]=i;}i.add(g);}}}HashMap<l,String> j=new HashMap<l,String>();for(String h in m.keys){Set<l> i=m[h];if(i.length>1&&k<10){HashMap<l,String> BB=OR(i,k+1);j.addAll(BB);for(l g in i)if(BB[g]==null){if(h.indexOf('(')==-1&&g.getAttribute('type')!='')j[g]=h+" ("+g.getAttribute('type')+")";else j[g]=h;}}else{for(l g in i)j[g]=h;}}return (j);}Set<l> tU(l k,int m){Set<l> g=new Set<l>();g.add(k);for(int h=0;h<m;h++ ){Set<l> i=new Set<l>();for(l o in g){List<l> j=t.CB.fC(o);if(j!=null)i.addAll(j);}g=i;}return (g);}void fR(){SpanElement o=document.getElementById('help_parents');o.classes.remove('selected_tab');SpanElement s=document.getElementById('help_children');s.classes.add('selected_tab');SpanElement v=document.getElementById('help_attributes');v.classes.remove('selected_tab');UListElement k=document.getElementById('help_list');k.nodes.clear();List<l> g=t.CB.XC(eF);if(g==null||g.length==0)return;HashMap<l,String> i=new HashMap.fromIterable(g,value:(l BB)=>t.CB.OD(BB));g.sort((EB,HB)=>i[EB].toLowerCase().compareTo(i[HB].toLowerCase()));for(l j in g){LIElement h=new LIElement();h.text=i[j];String m=t.CB.uH(j);if(m!=null)h.title=m;h.onClick.listen((MouseEvent KB)=>cS(j));h.classes.add('help_selectable');k.append(h);}}void UV(){SpanElement o=document.getElementById('help_parents');o.classes.remove('selected_tab');SpanElement s=document.getElementById('help_children');s.classes.remove('selected_tab');SpanElement v=document.getElementById('help_attributes');v.classes.add('selected_tab');UListElement k=document.getElementById('help_list');k.nodes.clear();List<l> g=t.CB.fE(eF);if(g==null||g.length==0)return;HashMap<l,String> i=new HashMap.fromIterable(g,value:(l h)=>t.CB.fK(eF,h));g.sort((BB,EB)=>i[BB].toLowerCase().compareTo(i[EB].toLowerCase()));for(l h in g){LIElement j=new LIElement();j.text=i[h];String m=t.CB.vG(eF,h);if(m!=null)j.title=m;k.append(j);}}void cS(l g){this.eF=g;QH=null;close();show();}void close(){zO.cancel();DivElement g=document.getElementById('dlg1');g.remove();IB.AH();}}class GH{TextAreaElement iD;SpanElement QF;q selectionStart;q selectionEnd;List<SpanElement> YP=new List<SpanElement>();List<n> EL=new List<n>();bool visible;static const Duration OT=const Duration(milliseconds:700);Timer bP;HashMap<int,FD> GL;GH(){iD=querySelector("#tacursor");QF=querySelector("#caret");visible=true;GL=new HashMap<int,FD>();iD.onKeyUp.listen((KeyboardEvent g)=>wV(g));iD.onKeyDown.listen((KeyboardEvent g)=>vV(g));iD.onBlur.listen((Event g)=>blur(g));IP();}void hW(HashMap<String,FD> h){HashMap<String,int> g=new HashMap<String,int>();g['A']=KeyCode.A;g['B']=KeyCode.B;g['C']=KeyCode.C;g['D']=KeyCode.D;g['E']=KeyCode.E;g['F']=KeyCode.F;g['G']=KeyCode.G;g['H']=KeyCode.H;g['I']=KeyCode.I;g['J']=KeyCode.J;g['K']=KeyCode.K;g['L']=KeyCode.L;g['M']=KeyCode.M;g['N']=KeyCode.N;g['O']=KeyCode.O;g['P']=KeyCode.P;g['Q']=KeyCode.Q;g['R']=KeyCode.R;g['S']=KeyCode.S;g['T']=KeyCode.T;g['U']=KeyCode.U;g['V']=KeyCode.V;g['W']=KeyCode.W;g['X']=KeyCode.X;g['Y']=KeyCode.Y;g['Z']=KeyCode.Z;for(String i in h.keys){String j=i.toUpperCase();if(g[j]!=null)GL[g[j]]=h[i];}}static q oJ(MouseEvent h){q g=t.zG(h.client.x,h.client.y);if(g==null)return (null);g.zE();assert(g.u!=null);return (g);}void vV(KeyboardEvent h){if(selectionStart==null)return;bool i=h.ctrlKey||h.metaKey;bool j=h.shiftKey;int g=h.keyCode;if(i&&g==KeyCode.X){iD.value=copy();iD.select();}else if(i&&g==KeyCode.C){iD.value=copy();iD.select();}else if(g==KeyCode.PAGE_DOWN){IW();}else if(g==KeyCode.PAGE_UP){JW();}else if(g==KeyCode.END){xV();}else if(g==KeyCode.HOME){yV();}else if(g==KeyCode.LEFT){if(j)iW();else left();}else if(g==KeyCode.UP){rW();}else if(g==KeyCode.RIGHT){if(j)jW();else right();}else if(g==KeyCode.DOWN){QV();}else if(g==KeyCode.BACKSPACE){yU();}else if(g==KeyCode.DELETE){nW();}else if(i&&GL[g]!=null){h.preventDefault();return;}else if(iD.value!=''){String k=iD.value;iD.value='';t.CS(k,j);}else{return;}IP();}void wV(KeyboardEvent j){bool i=j.ctrlKey||j.metaKey;bool h=j.shiftKey;int g=j.keyCode;if(selectionStart==null)return;if(i&&!h&&g==KeyCode.Z){t.YH();iD.value='';}else if(i&&((!h&&g==KeyCode.Y)||(h&&g==KeyCode.Z))){t.bM();iD.value='';}else if(i&&!h&&g==KeyCode.X){dM();iD.value='';IB.LC();}else if(i&&!h&&g==KeyCode.C){iD.value='';}else if(i&&!h&&g==KeyCode.V){if(selectionStart!=selectionEnd){dM();}MW(iD.value);iD.value='';IB.LC();}else if(i&&GL[g]!=null){j.preventDefault();GL[g]();IB.LC();}else if(iD.value!=''){String k=iD.value;iD.value='';t.CS(k,h);}else{return;}IP();}void blur(Event g){TH();}void yV(){GD h=selectionStart.jF();n g=selectionStart.u;if(g==null)return;while(!g.eC&&g.parent!=null)g=g.parent;Element j=g.oB();Rectangle k=j.getBoundingClientRect();h.x=k.left+1;h.y+= 5;q i=t.zG(h.x,h.y);if(i==null)return;if(i!=null){moveTo(i);IB.LC();}}void xV(){GD h=selectionStart.jF();n g=selectionStart.u;if(g==null)return;while(!g.eC&&g.parent!=null)g=g.parent;Element j=g.oB();Rectangle k=j.getBoundingClientRect();h.x=k.right-1;h.y+= 5;q i=t.zG(h.x,h.y);if(i==null)return;if(i!=null){moveTo(i);IB.LC();}}void left(){xG();selectionStart=TS(selectionStart);selectionEnd=new q.nX(selectionStart);ZH(true);IB.LC();}void right(){q g=new q.nX(selectionEnd);g=PS(g);xG();selectionStart=new q.nX(g);selectionEnd=new q.nX(g);ZH(true);IB.LC();}void rW(){xG();GD g=selectionStart.jF();if(g==null)return;q h=selectionStart;while(h==selectionStart){g.y=g.y-7;h=t.zG(g.x,g.y);h.zE();}if(h!=null){selectionStart=h;selectionEnd=new q.nX(selectionStart);}ZH(true);IB.LC();}void QV(){xG();GD g=selectionStart.jF();if(g==null)return;q h=selectionStart;while(h==selectionStart){g.y=g.y+14;h=t.zG(g.x,g.y);h.zE();}if(h!=null){selectionStart=h;selectionEnd=new q.nX(selectionStart);}ZH(true);IB.LC();}void iW(){q g=new q.nX(selectionStart);g=TS(g);gE(g,selectionEnd);}void jW(){q g=new q.nX(selectionEnd);g=PS(g);gE(selectionStart,g);}void JW(){GD g=selectionStart.jF();if(g==null)return;DivElement h=document.getElementById('doc1');g.y-= h.offsetHeight;q i=t.zG(g.x,g.y);if(i!=null){int j=h.scrollTop;moveTo(i);h.scrollTop=j-h.offsetHeight;IB.LC();}}void IW(){GD g=selectionStart.jF();if(g==null)return;DivElement h=document.getElementById('doc1');g.y+= h.offsetHeight;q i=t.zG(g.x,g.y);if(i!=null){int j=h.scrollTop;moveTo(i);h.scrollTop=j+h.offsetHeight;IB.LC();}}void yU(){if(selectionStart==selectionEnd){n g=selectionStart.u;int h=selectionStart.JB;if(g is nG&&h==0)return;if(g is OB&&h==0&&g.nodeValue[0]=='\n'&&g.previousSibling!=null&&g.previousSibling.RE()){WJ(selectionStart);return;}if(g is OB&&h==0&&g.nodeValue[0]=='\n'&&g.previousSibling==null&&g.parent.QG()){WJ(selectionStart);return;}bool k=false;while(g!=null&&g.DD&&h==0&&g.PB>0){if(g.DD&&g.eC)k=true;else k=false;h=g.parent.ZB(g);g=g.parent;}if(g is!OB&&h>0){n i=g.eB(h-1);if(k){n j=g.eB(h);assert(j.DD&&j.eC);if(i.DB!=j.DB&&!i.eC&&((i is OB&&t.CB.PE(j.DB))||(i.DB!=null&&t.CB.fD(j.DB,i.DB)))){OS(j);return;}}if(i.DD&&i.eC&&h<g.PB){n j=g.eB(h);if(i.DB!=j.DB&&!j.eC&&((j is OB&&t.CB.PE(i.DB))||(j.DB!=null&&t.CB.fD(i.DB,j.DB)))){NS(i);return;}}if(i.DD&&(!i.eC||(h==g.PB||g.eB(h).DB!=i.DB))){g=g.eB(h-1);h=g.PB;if(g is!OB&&h>0)i=g.eB(h-1);else i=null;}}while((g is!OB&&g.DD)&&g.PB==h&&g.firstChild!=null){g=g.lastChild;h=g.PB;}selectionStart=new q(g,h);selectionEnd=new q.nX(selectionStart);selectionStart.OG(-1);WJ(selectionStart);}else{dM();}IB.LC();}void nW(){if(selectionStart==selectionEnd){if(selectionStart.u is nG&&selectionStart.JB==selectionStart.u.PB)return;n g=selectionStart.u;int i=selectionStart.JB;while(g.DD&&i==g.PB&&g.PB>0){i=g.parent.ZB(g)+1;g=g.parent;}if(g is!OB&&i>0&&i<g.PB){n h=g.eB(i);n j=g.eB(i-1);if(j.DD&&j.eC&&h.DB!=j.DB&&!h.eC&&((h is OB&&t.CB.PE(j.DB))||(h.DB!=null&&t.CB.fD(j.DB,h.DB)))){NS(j);return;}if(h.DD&&h.eC&&h.DB!=j.DB&&!j.eC){if((j is OB&&t.CB.PE(h.DB))||(j.DB!=null&&t.CB.fD(h.DB,j.DB))){OS(h);return;}}}if(g is!OB&&i<g.PB){n h=g.eB(i);while(h!=null&&h.DD&&(!h.eC||(i==0||g.eB(i-1).DB!=h.DB))){g=h;i=0;if(g is!OB&&i<g.PB)h=g.eB(i);else h=null;}}selectionStart=new q(g,i);selectionEnd=new q.nX(selectionStart);WJ(selectionStart);}else{dM();}IB.LC();}q PS(q j){if(j.u is nG&&j.JB==j.u.PB)return (j);n g=j.u;int h=j.JB;while(g!=null&&g.DD&&h==g.PB&&!g.eC){h=g.parent.ZB(g)+1;g=g.parent;}n i;if(g.firstChild!=null&&h<g.PB)i=g.eB(h);else i=null;while(i!=null&&i.DD&&!i.eC){g=i;h=0;if(g.firstChild!=null&&h<g.PB)i=g.eB(h);else i=null;}bool k=false;if(h==g.PB){k=(g.DD&&g.eC);h=g.parent.ZB(g)+1;g=g.parent;while(k&&g.DD&&g.eC&&h==g.PB){h=g.parent.ZB(g)+1;g=g.parent;}}else if(g is OB){h++ ;}else{g=g.eB(h);q m=g.QE();if(m!=null){g=m.u;h=m.JB;k=(g.DD&&g.eC);}else{h=g.parent.ZB(g)+1;g=g.parent;}}if(g.firstChild!=null&&h<g.PB)i=g.eB(h);else i=null;while(i!=null&&i.DD&&(!i.eC||k)){g=i;h=0;if(g.firstChild!=null&&h<g.PB)i=g.eB(h);else i=null;}return (new q(g,h));}q TS(q j){if(j.u is nG&&j.JB==0)return (j);n g=j.u;int h=j.JB;while(g!=null&&g.DD&&h==0&&!g.eC){h=g.parent.ZB(g);g=g.parent;}n i;if(g.firstChild!=null&&h>0)i=g.eB(h-1);else i=null;while(i!=null&&i.DD&&!i.eC){g=i;h=g.PB;if(g.firstChild!=null&&h>0)i=g.eB(h-1);else i=null;}bool k=false;if(h==0){k=(g.DD&&g.eC);h=g.parent.ZB(g);g=g.parent;while(k&&g.DD&&g.eC&&h==0){h=g.parent.ZB(g);g=g.parent;}}else if(g is OB){h-- ;}else{g=g.eB(h-1);h=g.PB;q m=g.SF();if(m!=null){g=m.u;h=m.JB;k=(g.DD&&g.eC);}else{h=g.parent.ZB(g);g=g.parent;}}if(g.firstChild!=null&&h>0)i=g.eB(h-1);else i=null;while(i!=null&&i.DD&&(!i.eC||k)){g=i;h=g.PB;if(g.firstChild!=null&&h>0)i=g.eB(h-1);else i=null;}return (new q(g,h));}void ZH(bool j){if(selectionEnd!=selectionStart)return;GD g=selectionStart.jF();if(g==null){visible=false;}else{visible=true;DivElement h=document.getElementById('doc1');int i=h.offset.top;int k=h.offset.height;if(g.y-i<0||g.y-i>k){if(j){h.scrollTop+= g.y.toInt()-i;g=selectionStart.jF();}else{visible=false;}}}if(visible){QF.style.visibility='visible';QF.style.top="${g.y}px";QF.style.left="${g.x}px";cW();iD.style.top="${g.y}px";iD.style.left="${g.x}px";iD.focus();}else{QF.style.visibility='hidden';}}void cW(){bool i;Element k=selectionStart.u.oB();bool m=oZ(k);if(m&&selectionStart.u.PB>0){bool g;if(selectionStart.JB>0){n o=selectionStart.u.eB(selectionStart.JB-1);Element s=o.oB();g=oZ(s);}else{if(selectionStart.u is xD)g=false;else g=true;}bool h;if(selectionStart.JB<selectionStart.u.PB){n j=selectionStart.u.eB(selectionStart.JB);Element v=j.oB();if(j is xD&&selectionStart.JB==0)h=false;else h=oZ(v);}else h=true;i=g&&h;}else i=false;if(i)QF.classes.add('horizontal');else if(QF.classes.contains('horizontal'))QF.classes.remove('horizontal');}bool oZ(Element g){return (g is DivElement||g is TableElement||g is UListElement||g is LIElement);}void moveTo(q g){xG();selectionStart=new q.nX(g);selectionStart.zE();selectionEnd=new q.nX(selectionStart);ZH(true);}void TH(){visible=false;QF.style.visibility='hidden';}void show(){if(selectionStart!=null&&selectionStart==selectionEnd){visible=true;QF.style.visibility='visible';}}void focus(){if(visible)show();iD.focus();}void GV(){iD.value='';}gE(q o,q s){if(selectionStart==o&&selectionEnd==s){if(o==s){ZH(false);}return;}xG();q HB=selectionStart;selectionStart=new q.nX(o);selectionEnd=new q.nX(s);if(selectionStart==selectionEnd){ZH(false);IB.LC();return;}if(selectionStart>selectionEnd){q KB=selectionStart;selectionStart=selectionEnd;selectionEnd=KB;}while((selectionStart.u is OB||selectionStart.u is yB||selectionStart.u is kB)&&selectionStart.JB==0){selectionStart=new q(selectionStart.u.parent,selectionStart.u.parent.ZB(selectionStart.u));}while((selectionStart.u is OB||selectionStart.u is yB||selectionStart.u is kB)&&selectionStart.JB==selectionStart.u.PB){selectionStart=new q(selectionStart.u.parent,selectionStart.u.parent.ZB(selectionStart.u)+1);}while((selectionEnd.u is OB||selectionEnd.u is yB||selectionEnd.u is kB)&&selectionEnd.JB==selectionEnd.u.PB){selectionEnd=new q(selectionEnd.u.parent,selectionEnd.u.parent.ZB(selectionEnd.u)+1);}while((selectionEnd.u is OB||selectionEnd.u is yB||selectionEnd.u is kB)&&selectionEnd.JB==0){selectionEnd=new q(selectionEnd.u.parent,selectionEnd.u.parent.ZB(selectionEnd.u));}if(selectionStart!=selectionEnd){if((selectionStart.u is OB||selectionStart.u is yB||selectionStart.u is kB)&&selectionStart.JB==selectionStart.u.PB){n g=selectionStart.u.nextNode();selectionStart=new q(g.parent,g.parent.ZB(g));}if((selectionEnd.u is OB||selectionEnd.u is yB||selectionEnd.u is kB)&&selectionEnd.JB==0){n j=selectionEnd.u.previousNode();selectionEnd=new q(j.parent,j.parent.ZB(j)+1);}bool m;do{m=false;if(selectionStart.u is!OB&&selectionStart.JB<selectionStart.u.PB){n g=selectionStart.u.eB(selectionStart.JB);if(new q(selectionStart.u,selectionStart.JB+1)>selectionEnd&&new q(g,0)<selectionEnd){selectionStart=new q(g,0);m=true;}}}while(m);do{m=false;if(selectionEnd.u is!OB&&selectionEnd.JB>0){n j=selectionEnd.u.eB(selectionEnd.JB-1);if(new q(selectionEnd.u,selectionEnd.JB-1)<selectionStart&&new q(j,j.PB)>selectionStart){selectionEnd=new q(j,j.PB);m=true;}}}while(m);}if(selectionStart.u==selectionEnd.u){n v=selectionStart.u;if(v.nodeType==n.mB){TP(v,selectionStart.JB,selectionEnd.JB);}else{for(int BB=selectionStart.JB;BB<selectionEnd.JB;BB++ ){n EB=v.eB(BB);EB.FL(true);EL.add(EB);}}}else{n h=selectionStart.u;if(h.nodeType==n.mB)h=h.parent;if(selectionEnd>new q(h,h.PB))selectionEnd=new q(h,h.PB);else{n k=selectionEnd.u;if(k.nodeType==n.mB)k=k.parent;if(k!=h){while(k.parent!=h){k=k.parent;}selectionEnd=new q(h,h.ZB(k));}}n i;if(selectionStart.u.nodeType==n.tC||selectionStart.u.nodeType==n.XG){i=selectionStart.u.eB(selectionStart.JB);if(i!=null){q QB=new q(selectionStart.u,selectionStart.JB+1);if(selectionEnd>=QB){i.FL(true);EL.add(i);}}}else{i=selectionStart.u;TP(i,selectionStart.JB,i.PB);}if(i!=null){for(n g=i.nextSibling;g!=null;g=g.nextSibling){q SB=new q(g.parent,g.parent.ZB(g));if(SB<selectionEnd){if(g.nodeType!=n.mB||selectionEnd>=new q(g.parent,g.parent.ZB(g)+1)){g.FL(true);EL.add(g);}}else break;}}if(selectionEnd.u.nodeType==n.mB){TP(selectionEnd.u,0,selectionEnd.JB);}}if(selectionEnd!=selectionStart)TH();if(selectionStart!=HB)IB.LC();}void TP(n o,int j,int k){Element h=o.oB();if(h==null)return;Text m=h.nodes.first;Node s=m.nextNode;TH();String i=o.nodeValue;if(j==0){m.remove();}else{m.text=i.substring(0,j);}SpanElement g=new SpanElement();YP.add(g);g.classes.add('selection');g.append(new Text(i.substring(j,k)));if(s==null)h.append(g);else h.insertBefore(g,s);if(k!=i.length){Text v=new Text(i.substring(k));if(g.nextNode==null)h.append(v);else h.insertBefore(v,g.nextNode);}}void xG(){for(SpanElement i in YP){Element g=i.parent;StringBuffer h=new StringBuffer();for(Node j in g.nodes){h.write(j.text);}g.nodes.clear();g.append(new Text(h.toString()));selectionEnd=new q.nX(selectionStart);visible=true;}YP.clear();for(n k in EL){k.FL(false);}EL.clear();}void IP(){if(!visible)return;if(bP!=null)bP.cancel();QF.style.visibility="visible";bP=new Timer.periodic(OT,(Timer g)=>CV());}void CV(){if(!visible)return;if(QF.style.visibility=="hidden")QF.style.visibility="visible";else if(QF.style.visibility=="visible")QF.style.visibility="hidden";}void WJ(q h){n g;if(h.u.nodeType==n.mB&&h.u.PB<h.JB+1&&h.u.nextSibling!=null){n j=h.u;n k=j.nextSibling;while(k==null&&j.parent!=null){j=j.parent;k=j.nextSibling;}g=k;if(g.nodeType==n.mB&&g.parent!=null&&g.PB==1)g=g.parent;}else if(h.u.nodeType==n.mB&&h.u.PB<h.JB+1&&h.u.nextSibling==null){g=h.u;if(g.parent!=null)g=g.parent;if(g.DD&&g.eC){if(g.nextSibling.DB==g.DB){DP(g,g.nextSibling);}else{q m=new q.nX(h);m.OG(1);if(m>h)WJ(m);}return;}}else if(h.u.nodeType==n.tC&&h.u.PB<h.JB+1){g=h.u;if(g.DD&&g.eC){if(g.nextSibling!=null&&g.nextSibling.DB==g.DB){DP(g,g.nextSibling);return;}}}else if(h.u.nodeType==n.tC||h.u.nodeType==n.XG){g=h.u.eB(h.JB);if(g.DD&&g.eC){if(g.previousSibling!=null&&g.previousSibling.DB==g.DB){DP(g.previousSibling,g);return;}else if(g.PB>0){q o=new q.nX(h);o.OG(-1);if(o<h)WJ(o);return;}}if(g==null){window.alert("I'm sorry Dave, I'm afraid I can't do that.");return;}}else if(h.u.nodeType==n.mB&&h.JB==0&&h.u.PB==1&&h.u.parent is yB&&h.u.parent.PB==1){g=h.u.parent;while(g.parent is yB&&g.parent.PB==1)g=g.parent;}else{t.SW(h,1);sE i=yB.UN(selectionStart);if(i!=null){t.DC(i.vH);t.lK(LB.NB('undo.remove_text'),2);gE(i.start,i.end);}return;}if(g is xD&&g.parent.PB==1){g=g.parent;}if(!g.dJ){t.cM(g);sE i=yB.UN(selectionStart);if(i!=null){t.DC(i.vH);t.lK(LB.NB('undo.remove_element'),2);gE(i.start,i.end);}}}void dM(){if(selectionStart==selectionEnd)return;q g=new q.nX(selectionStart);q h=new q.nX(selectionEnd);xG();if(g.u is iC&&g.u==h.u&&g.JB==0&&h.JB==h.u.PB){t.cM(g.u);}else{t.OP(g,h);sE i=yB.UN(g);if(i!=null){t.DC(i.vH);t.lK(LB.NB('undo.remove'),2);gE(i.start,i.end);}}}void refresh(){q g=selectionStart;q h=selectionEnd;selectionStart=null;selectionEnd=null;gE(g,h);}String copy(){StringBuffer h=new StringBuffer();if(selectionStart.u==selectionEnd.u){n j=selectionStart.u;if(j.nodeType==n.mB){h.write(j.nodeValue.substring(selectionStart.JB,selectionEnd.JB));}else{for(int k=selectionStart.JB;k<selectionEnd.JB;k++ ){n m=j.eB(k);h.write(m);}}}else{n i;if(selectionStart.u.nodeType==n.tC){i=selectionStart.u.eB(selectionStart.JB);q o=new q(selectionStart.u,selectionStart.JB+1);if(selectionEnd>=o){h.write(i);}}else{i=selectionStart.u;h.write(i.nodeValue.substring(selectionStart.JB));}for(n g=i.nextSibling;g!=null;g=g.nextSibling){q s=new q(g.parent,g.parent.ZB(g));if(s<selectionEnd){if(g.nodeType!=n.mB||selectionEnd>=new q(g.parent,g.parent.ZB(g)+1)){h.write(g);g.FL(true);}}else break;}if(selectionEnd.u.nodeType==n.mB){h.write(selectionEnd.u.nodeValue.substring(0,selectionEnd.JB));}}return (h.toString());}bool MW(String i){sB k;try {DG v=new DG();k=v.parseFromString("<root>${i}</root>");}on UD catch (m){bool j=false;if(i.trim()!=''){n g=selectionStart.u;if(g.nodeType==n.mB)g=g.parent;if(g.nodeType==n.XG)j=true;else if(g.DB!=null&&!t.CB.PE(g.DB))j=true;}if(j){window.alert(LB.NB('insert.text_not_allowed'));return (false);}t.WM(selectionStart,i);return (true);}n g=selectionStart.u;if(g is OB)g=g.parent;l o=k.documentElement;n h=ND.NF(g.DB);if(o.childNodes!=null){for(AB BB in o.childNodes){n EB=ND.dH(BB,h);h.jB(EB);}}h.MG();if(t.ZC!=null){kB.QN(g,h);t.QP(h);}GB s=new GB.sX(LB.NB('undo.paste'));try {s.TB(t.LE(h,selectionStart,checkValidity:true));}on LD catch (m){window.alert(m.toString());return (false);}t.DC(s);return (true);}void DP(n g,n h){GB j=new GB.sX(LB.NB('undo.remove_text'));n i;q m=new q(h,0);q o=new q(h,h.PB);if(o>m)i=t.hI(m,o);else i=null;j.TB(new GB.pX(h));if(i!=null)j.TB(t.LE(i,new q(g,g.PB)));q k;if(g.lastChild is OB)k=new q(g.lastChild,g.lastChild.PB);else k=new q(g,g.PB);t.DC(j);IB.JD(k);}void OS(n g){assert(g.previousSibling!=null);int s=g.parent.ZB(g);GB k=new GB.sX(LB.NB('undo.remove_text'));int h=s;bool v=t.CB.PE(g.DB);while(h>0){n i=g.parent.eB(h-1);if(i.eC||(i is OB&&!v)||(i.DB!=null&&!t.CB.fD(g.DB,i.DB)))break;h-- ;}q m=new q(g.parent,h);q o=new q(g.parent,s);assert(m<o);n BB=t.HG(g.parent,m,o);k.TB(t.FI(m,o));k.TB(t.LE(BB,new q(g,0)));q j=new q(g,0);j.zE();j=new q.jX(j);t.DC(k);moveTo(j);IB.LC();return;}void NS(n g){assert(g.nextSibling!=null);int s=g.parent.ZB(g.nextSibling);GB k=new GB.sX(LB.NB('undo.remove_text'));int h=s;bool v=t.CB.PE(g.DB);while(h<g.parent.PB){n i=g.parent.eB(h);if(i.eC||(i is OB&&!v)||(i.DB!=null&&!t.CB.fD(g.DB,i.DB)))break;h++ ;}q m=new q(g.parent,h);q o=new q(g.parent,s);assert(o<m);n BB=t.HG(g.parent,o,m);k.TB(t.FI(o,m));k.TB(t.LE(BB,new q(g,g.PB)));q j=new q(g,g.PB);j.zE();j=new q.eX(j);t.DC(k);moveTo(j);IB.LC();return;}}class bB{static const int ME=0;static const int iE=1;static const int AN=2;n pZ;int qZ;bool rZ;bB(n h,int i,[bool g]){pZ=h;qZ=i;if(g!=null)rZ=g;else rZ=false;}Element html(){Element h=new SpanElement();String i;if(qZ==ME)i="start_tag";else if(qZ==iE)i="end_tag";else if(qZ==AN)i="empty_tag";h.classes.add(i);if(rZ)h.classes.add('long');if(qZ!=iE){bool k;if(pZ.DB!=null){List<l> v=t.CB.fE(pZ.DB);k=(v!=null&&v.length>0);}else{k=(pZ is!AG&&pZ is!pF);}if(k){ImageElement BB=new ImageElement(src:'packages/daxe/images/attributes.png',width:16,height:16);BB.onClick.listen((MouseEvent j)=>vU(j));h.append(BB);}}String g;if(pZ.DB!=null){g=t.CB.OD(pZ.DB);if(g==null)g=pZ.nodeName;}else if(pZ is AG){if(qZ==ME)g="(";else g=")";}else if(pZ is IH){if(qZ==ME)g="PI ${pZ.nodeName}";else g="PI";}else if(pZ is pF)g="CDATA";else if(pZ.nodeName!=null)g=pZ.nodeName;else g="?";if(qZ!=iE){bool KB=(t.CB.bC(pZ.DB,'attributsVisibles','false')=='true');if(KB){h.append(new Text(g));for(aB EB in pZ.attributes){h.append(new Text(" "));Element m=new SpanElement();m.attributes['class']='attribute_name';m.text=EB.localName;h.append(m);h.append(new Text("="));Element o=new SpanElement();o.attributes['class']='attribute_value';o.text=EB.value;h.append(o);}}else{List<String> HB=t.CB.bV(pZ.DB)['titreAtt'];if(HB!=null){for(String QB in HB){String s=pZ.getAttribute(QB);if(s!=null&&s!=''){g+= " '${s}'";break;}}}h.append(new Text(g));}}else h.append(new Text(g));h.onDoubleClick.listen((MouseEvent j){IB.selectNode(pZ);j.preventDefault();j.stopPropagation();});return (h);}void vU(MouseEvent g){pZ.JE();}}class xM{n RF;List<InputElement> DI;List<InputElement> LL;FD okfct;xM(this.RF,[this.okfct]){DI=new List<InputElement>();LL=new List<InputElement>();}void show(){DivElement i=new DivElement();i.id='attributes_dlg';i.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement j=new DivElement();j.classes.add('dlg3');DivElement BB=new DivElement();BB.classes.add('dlgtitle');BB.text=RF.nodeName;j.append(BB);FormElement EB=new FormElement();TableElement QB=new TableElement();SD SB=null;for(aB cB in RF.attributes){TableRowElement k=new TableRowElement();TableCellElement g=new TableCellElement();InputElement HB=sZ(cB.name);DI.add(HB);g.append(HB);k.append(g);g=new TableCellElement();InputElement hB=tZ(cB.value);LL.add(hB);g.append(hB);k.append(g);uZ(k,HB);QB.append(k);}EB.append(QB);DivElement h=new DivElement();h.classes.add('buttons');ButtonElement m=new ButtonElement();m.attributes['type']='button';m.appendText(LB.NB("attribute.add"));m.onClick.listen((MouseEvent KB)=>vZ());h.append(m);ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.NB("button.Cancel"));o.onClick.listen((MouseEvent KB)=>cancel());h.append(o);ButtonElement s=new ButtonElement();s.attributes['type']='submit';s.appendText(LB.NB("button.OK"));s.onClick.listen((MouseEvent KB)=>iF(KB));h.append(s);EB.append(h);j.append(EB);v.append(j);i.append(v);document.body.append(i);if(SB!=null)SB.focus();}void iF(MouseEvent k){List<aB> j=new List<aB>();for(int h=0;h<DI.length;h++ ){TextInputElement g=DI[h];String i=g.value;if(!wZ(i)){k.preventDefault();g.select();g.selectionStart=g.selectionEnd=g.value.length;window.alert(LB.NB('attribute.invalid_attribute_name'));return;}String o=LL[h].value;int BB=i.indexOf(':');aB m;String s=t.CB!=null?t.CB.eK(i):null;m=new aB.aX(s,i,o);j.add(m);}querySelector('div#attributes_dlg').remove();k.preventDefault();if(RF.oB()!=null){GB v=new GB.qX(RF,j);t.DC(v);}else{RF.attributes=j;}IB.AH();if(okfct!=null)okfct();}void cancel(){querySelector('div#attributes_dlg').remove();IB.AH();}void uZ(i,j){TableCellElement h=new TableCellElement();ButtonElement g=new ButtonElement();g.attributes['type']='button';g.value='-';g.text='-';g.onClick.listen((Event k)=>xZ(j));h.append(g);i.append(h);}TextInputElement sZ([String h]){TextInputElement g=new TextInputElement();g.spellcheck=false;g.value=h!=null?h:"";g.size=20;g.onInput.listen((Event i)=>yZ(g));g.onKeyUp.listen((KeyboardEvent i)=>yZ(g));return (g);}bool wZ(String g){final RegExp h=new RegExp("^[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*\$");return (h.hasMatch(g));}void yZ(TextInputElement g){String h=g.value;if(wZ(h)){g.classes.add('valid');g.classes.remove('invalid');}else{g.classes.add('invalid');g.classes.remove('valid');}}TextInputElement tZ([String h]){TextInputElement g=new TextInputElement();g.spellcheck=false;g.value=h!=null?h:"";g.size=40;return (g);}vZ(){TableElement k=document.querySelector("#attributes_dlg table");TextInputElement i=sZ();TextInputElement j=tZ();DI.add(i);LL.add(j);TableRowElement h=new TableRowElement();TableCellElement g=new TableCellElement();g.append(i);h.append(g);g=new TableCellElement();g.append(j);h.append(g);uZ(h,i);k.append(h);}void xZ(InputElement h){for(int g=0;g<DI.length;g++ ){if(DI[g]==h){DI.removeAt(g);LL.removeAt(g);TableRowElement i=document.querySelector("#attributes_dlg table tr:nth-child(${g+1})");i.remove();}}}}typedef n lJ(l elementRef);class vD implements q{int zZ;vD(int g){assert(g>=0);zZ=g;}vD.WX(dC i){n j=i.u;int k=i.JB;zZ=0;n g=t.sC;int h=g.PB;while(g!=j||h!=k){if(h==0){h=g.parent.ZB(g);g=g.parent;}else if(g is OB){h-- ;}else{g=g.eB(h-1);h=g.PB;}zZ++ ;}}vD.hX(CE k){n i=t.sC;int m=i.PB;int j=0;n g=t.sC;int h=0;while(g!=i||h!=m){if(h==g.PB){h=g.parent.ZB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.eB(h);h=0;}j++ ;}zZ=j-k.HF;}vD.lX(vD g){zZ=g.UF;}n get u{dC g=new dC.dX(this);return (g.u);}int get JB{dC g=new dC.dX(this);return (g.JB);}int get HF{CE g=new CE.fX(this);return (g.HF);}int get UF{return (zZ);}bool operator==(q g){return (zZ==g.UF);}bool operator<(q g){return (zZ>g.UF);}bool operator<=(q g){return (zZ>=g.UF);}bool operator>(q g){return (zZ<g.UF);}bool operator>=(q g){return (zZ<=g.UF);}void OG(int g){zZ-= g;}void zE(){dC g=new dC.dX(this);g.zE();zZ=(new vD.WX(g)).zZ;}GD jF(){dC g=new dC.dX(this);return (g.jF());}String LI({bool titles: false}){dC g=new dC.dX(this);return (g.LI(titles:titles));}String toString(){return ("[RightOffsetPosition ${zZ}]");}}class CE implements q{int Aa;CE(int g){assert(g>=0);Aa=g;}CE.VX(dC i){n j=i.u;int k=i.JB;Aa=0;n g=t.sC;int h=0;while(g!=j||h!=k){if(h==g.PB){h=g.parent.ZB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.eB(h);h=0;}Aa++ ;}}CE.fX(vD k){n i=t.sC;int m=i.PB;int j=0;n g=t.sC;int h=0;while(g!=i||h!=m){if(h==g.PB){h=g.parent.ZB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.eB(h);h=0;}j++ ;}Aa=j-k.UF;}CE.kX(CE g){Aa=g.HF;}n get u{dC g=new dC.ZX(this);return (g.u);}int get JB{dC g=new dC.ZX(this);return (g.JB);}int get HF{return (Aa);}int get UF{vD g=new vD.hX(this);return (g.UF);}bool operator==(q g){return (Aa==g.HF);}bool operator<(q g){return (Aa<g.HF);}bool operator<=(q g){return (Aa<=g.HF);}bool operator>(q g){return (Aa>g.HF);}bool operator>=(q g){return (Aa>=g.HF);}void OG(int g){Aa+= g;}void zE(){dC g=new dC.ZX(this);g.zE();Aa=g.HF;}GD jF(){dC g=new dC.ZX(this);return (g.jF());}String LI({bool titles: false}){dC g=new dC.ZX(this);return (g.LI(titles:titles));}String toString(){return ("[LeftOffsetPosition ${Aa}]");}}class HH{static final String kP="string";l Ba;String eM;String Ca;HashMap<String,l> Da;HashMap<l,String> Ea;HashMap<l,String> Fa;HashMap<l,Pattern> Ga=null;HashMap<l,Pattern> Ha=null;HashMap<l,HashMap<String,List<String>>> Ia=null;List<String> Ja=null;XL Ka;l La;l Ma;l Na;l Oa;l Pa;List<l> Qa;HH(){}Future load(final String h){Completer g=new Completer();if(h==null){Ba=null;return (new Future.error(new LD("Config.load: null path")));}DG s=new DG();s.AL(h).then((sB i){String m;if(i.documentElement.nodeName=="CONFIG_JAXE")m=null;else m=Ra(i.documentElement);Ca=ZT(h);Ba=i.documentElement;Sa();Fa=new HashMap<l,String>();final String j=aW();if(j==null){final l o=RC(Ta(),"SCHEMA_SIMPLE");if(o==null){g.completeError(new LD("Error: no XML schema is defined in the config file ${h}"));return;}Ka=new gL(o,Ua());eM=null;Va();g.complete();return;}if(Ca!=null)eM="${Ca}/${j}";else eM=j;Ka=new vB(Ua());(Ka as vB).load(eM).then((v){Va();g.complete();},onError:(qF k){g.completeError(new LD("Error reading schemaURL: ${k}"));});},onError:(UD k){g.completeError(new LD("Error reading ${h}: ${k}"));});return (g.future);}static String ZT(final String g){final int h=g.lastIndexOf("/");if(h>=0){return (g.substring(0,h));}return (null);}List<l> HI(){final List<l> h=new List<l>();final List<l> j=Ka.HI();l g=RC(Ta(),"RACINE");while(g!=null){final String k=g.getAttribute("element");for(final l i in j)if(k==Ka.cD(i))h.add(i);g=kD(g,"RACINE");}return (h);}void NO(final n g){final List<String> o=Wa();for(final String h in o){if(h!=""){final String i=jG(h);String j;if(i!=null&&i!="")j="xmlns:${i}";else j="xmlns";g.setAttributeNS("http://www.w3.org/2000/xmlns/",j,h);}}final String k=lV();final String m=iV();if(k!=null||m!=null){g.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");if(k!=null)g.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",k);if(m!=null)g.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:noNamespaceSchemaLocation",m);}}String aW(){final l h=RC(Ta(),"FICHIER_SCHEMA");if(h==null)return (null);String g=h.getAttribute("nom");if(g=="")g=null;return (g);}HashMap<String,l> Sa(){Da=new HashMap<String,l>();if(Ba==null)return (Da);l g=RC(Xa(),"AFFICHAGE_ELEMENT");while(g!=null){final String h=g.getAttribute("element");Da[h]=g;g=kD(g,"AFFICHAGE_ELEMENT");}return (Da);}l tK(String g){return Da[g];}void Va(){Ea=new HashMap<l,String>();if(Ba==null)return;final List<l> i=Ka.ID();for(final l g in i){final String h=Ka.cD(g);if(h!=null)Ea[g]=h;}}String Ra(final l h){final l g=RC(h,"FICHIERTITRES");if(g==null)return (null);return (g.getAttribute("nom"));}String lV(){final l g=RC(Ya(),"SCHEMALOCATION");if(g!=null){final String h=g.getAttribute("schemaLocation");if(h!="")return (h);}return (null);}String iV(){final l g=RC(Ya(),"SCHEMALOCATION");if(g!=null){final String h=g.getAttribute("noNamespaceSchemaLocation");if(h!="")return (h);}return (null);}String jG(final String h){if(h=="http://www.w3.org/XML/1998/namespace")return ("xml");l g=RC(Ya(),"PREFIXE_ESPACE");while(g!=null){if(h==g.getAttribute("uri"))return (g.getAttribute("prefixe"));g=kD(g,"PREFIXE_ESPACE");}return (Ka.jG(h));}XB Za(final PL v,final l QB){final String SB=QB.getAttribute("nom");String BC=BI(SB);final XB i=new XB(BC);String cB=MS(SB);if(cB!=null){i.JI=cB;}AB g=QB.firstChild;while(g!=null){CC h=null;final String o=g.nodeName;String BB=null;if(g is l){final String EB=(g as l).getAttribute("raccourci");if(EB!=null&&EB!=""){BB=EB.toUpperCase()[0];}}if(o=="MENU_INSERTION"){final l hB=g as l;final String j=hB.getAttribute("nom");final String HB=BI(j);String s=hB.getAttribute("type_noeud");if(s=="")s="element";l k;if(s=="element"){k=gG(j);if(k==null)pJ("Erreur: MENU_INSERTION: pas de rfrence pour '${j}' dans le schma");}else k=null;h=new CC(HB,()=>v.AI(k,s),shortcut:BB,data:k);i.add(h);String m=uH(k);if(m!=null){h.JI=m;}}else if(o=="MENU_FONCTION"){final l KB=g as l;final String IC=KB.getAttribute("classe");final String j=KB.getAttribute("nom");final String HB=BI(j);h=new CC(HB,()=>v.TV(IC,KB),shortcut:BB);i.add(h);String m=MS(j);if(m!=null){h.JI=m;}}else if(o=="MENU"){h=Za(v,g as l);i.add(h);}else if(o=="SEPARATEUR")i.PO();g=g.nextSibling;}return (i);}yF zV(final PL k){final yF h=new yF();final l i=aa();if(i!=null){l g=RC(i,"MENU");while(g!=null){final XB j=Za(k,g);j.parent=h;h.add(j);g=kD(g,"MENU");}}return (h);}XL kV(){return (Ka);}List<l> sU(){final List<l> g=Ka.ID();return (g);}String cD(final l g){return (Ea[g]);}l TM(final l g,final l h){return (Ka.gG(g,h));}l gG(final String g){final l h=Ka.PM(CN(g));return (h);}List<l> nK(final String g){return (Ka.iO(CN(g)));}String jI(final l g){return (Ka.jI(g));}String OM(final l h){final String g=jI(h);if(g==null)return (null);return (jG(g));}List<String> pK(final l g){final List<String> h=Ka.pK(g);return (h);}bool wO(final l g,final String h){return (Ka.jO(g,h));}List<String> Wa(){if(Ja!=null)return (Ja);final List<String> g=new List<String>();final List<String> h=Ka.EP();if(h!=null)g.addAll(h);Ja=g;return (g);}bool GI(final l g,final l h){return (Ka.GI(g,h));}bool fD(final l h,final l i){final List<l> g=XC(h);if(g==null)return (false);return (g.contains(i));}l fF(final l i,final List<l> j){final List<l> g=XC(i);if(g==null)return (null);for(l h in j)if(g.contains(h))return (h);return (null);}List<l> XC(final l g){return (Ka.XC(g));}String ba(final l g,final bool h,final bool i){return (Ka.ZD(g,h,i));}String ZD(final l g){return (Ka.ZD(g,true,false));}bool VM(n h,final int m,final int o,final l s){if(h.nodeType==n.XG){for(n g in h.childNodes){if(g.nodeType==n.tC)return (false);}return (true);}assert(h.nodeType==n.tC);if(Ka is gL)return (true);if(m<0){pJ("Config.insertionPossible: debutSelection < parent.debut");return (false);}if(Ka is vB){final List<l> i=new List<l>();bool j=false;for(n g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==n.tC){int k=h.ZB(g);if(k<m||k>=o){if(!j&&k>=o){i.add(s);j=true;}i.add(g.DB);}}}if(!j)i.add(s);final bool v=(Ka as vB).fS(h.DB,i,true);return (v);}return (false);}bool hO(final n g){if(g is AG||g is IH||g is pF)return (true);if(g.DB==null)return (false);if(!xU(g))return (false);if(g.firstChild==null&&!wO(g.DB,''))return (false);else if(g.childNodes.length==1&&g.firstChild is OB&&g.firstChild.nodeValue!=null&&!wO(g.DB,g.firstChild.nodeValue))return (false);if(Ka is gL)return (true);if(Ka is vB){final List<l> v=new List<l>();bool j=false;for(n i=g.firstChild;i!=null;i=i.nextSibling){if(i.nodeType==n.tC&&i.DB!=null){v.add(i.DB);}else if(i.nodeType==n.mB){if(i.nodeValue.trim()!="")j=true;}else if(i is pF){if(i.firstChild!=null&&i.firstChild.nodeValue.trim()!='')j=true;}}if(j&&!Ka.PE(g.DB))return (false);final vB BB=Ka as vB;return (BB.fS(g.DB,v,false));}final l k=g.DB;final StringBuffer o=new StringBuffer();if(Ha==null)Ha=new HashMap<l,Pattern>();bool j=false;n h=g.firstChild;while(h!=null){if(h is pF){if(h.firstChild!=null&&h.firstChild.nodeValue.trim()!='')j=true;}else if(h.nodeType==n.tC&&h is!AG&&h is!IH){o.write(h.localName);o.write(",");}else if(h.nodeType==n.mB){if(h.nodeValue.trim()!='')j=true;}h=h.nextSibling;}if(j&&!Ka.PE(k))return (false);RegExp m=Ha[k];if(m==null){final String s=ba(k,false,true);if(s==null||s=="")return (true);try {m=new RegExp(r"^$expr$");}on Exception catch (EB){pJ("elementValide(JaxeElement, bool, List<String>) - Malformed Pattern: ^${s}\$:",EB);return (true);}Ha[k]=m;}final bool HB=m.hasMatch(o.toString());return (HB);}bool xU(final n h){if(h.nodeType!=n.tC){pJ("Config.attributsValides : ce n'est pas un lment: ${h}");return (false);}final List<l> m=fE(h.DB);List<String> i=new List<String>(m.length);List<String> BB=new List<String>(i.length);for(int g=0;g<m.length;g++ ){final l j=m[g];i[g]=attributeName(j);BB[g]=attributeNamespace(j);final String o=h.getAttribute(i[g]);if(o==null||o==''){if(BL(h.DB,j))return (false);}else if(!eS(j,o))return (false);}final List<aB> EB=h.attributes;for(int g=0;g<EB.length;g++ ){aB s=EB[g];final String v=s.EC;if(v=="xml"||v=="xmlns")continue;final String HB=s.localName;if(v==null&&HB=="xmlns")continue;final String KB=s.pB;if(KB=="http://www.w3.org/2001/XMLSchema-instance")continue;bool QB=false;for(int k=0;k<i.length;k++ ){if(i[k]==HB&&BB[k]==KB){QB=true;break;}}if(!QB)return (false);}return (true);}List<l> fC(final l g){return (Ka.fC(g));}bool PE(final l g){if(g==null)return (true);return (Ka.PE(g));}List<l> fE(final l g){return (Ka.fE(g));}String attributeName(final l g){return (Ka.attributeName(g));}String PH(final l j,final l g){String h=Ka.attributeName(g);String k=Ka.attributeNamespace(g);if(k!=null){String i=NR(j,g);if(i!=null)h="${i}:${h}";}return (h);}String attributeNamespace(final l g){return (Ka.attributeNamespace(g));}String NR(final l i,final l j){final String g=attributeNamespace(j);if(g==null)return (null);if(g=="http://www.w3.org/XML/1998/namespace")return ("xml");if(g=="http://www.w3.org/2000/xmlns/"&&attributeName(j)!="xmlns")return ("xmlns");String h=i.BP(g);if(h==null){if(i.ownerDocument.documentElement!=null)h=i.ownerDocument.BP(g);else h=jG(g);}return (h);}String eK(final String g){return (Ka.eK(g));}bool BL(final l g,final l h){return (Ka.TO(g,h));}List<String> gI(final l g){final List<String> h=Ka.gI(g);return (h);}String dF(final l g){return (Ka.dF(g));}bool eS(final l g,final String h){return (Ka.UO(g,h));}static String CN(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (g);return (g.substring(h+1));}String QS(final l k,final String i,final int h){if(h==AB.FE){final l j=tK(CN(i));if(j==null)return (kP);return (j.getAttribute("type"));}else if(h==AB.CK){l g=RC(Xa(),"PLUGIN_INSTRUCTION");while(g!=null){if(i!=null&&i==g.getAttribute("cible"))return ("plugin");g=kD(g,"PLUGIN_INSTRUCTION");}return ("instruction");}else if(h==AB.DK){final l g=RC(Xa(),"PLUGIN_COMMENTAIRE");if(g!=null)return ("plugin");return ("commentaire");}else if(h==AB.BK){final l g=RC(Xa(),"PLUGIN_CDATA");if(g!=null)return ("plugin");return ("cdata");}else if(h==AB.kE){return ("texte");}return (null);}String fO(final l h){final l g=tK(cD(h));if(g==null)return (kP);return (g.getAttribute("type"));}l mO(final String h){if(Ba==null)return (null);l g=RC(Xa(),"AFFICHAGE_ELEMENT");while(g!=null){if(h==g.getAttribute("type"))return (gG(g.getAttribute("element")));g=kD(g,"AFFICHAGE_ELEMENT");}return (null);}List<l> yG(final String i){if(Ba==null)return (null);List<l> h=new List<l>();l g=RC(Xa(),"AFFICHAGE_ELEMENT");while(g!=null){if(i==g.getAttribute("type"))h.addAll(nK(g.getAttribute("element")));g=kD(g,"AFFICHAGE_ELEMENT");}return (h);}String bC(final l g,final String h,final String i){return JP(g,"element",null,h,i);}String JP(final l i,final String j,final String k,final String m,final String o){final HashMap<String,List<String>> s=tR(i,j,k);final List<String> g=s[m];String h;if(g!=null&&g.length>0)h=g[0];else h=o;return h;}HashMap<String,List<String>> ca(final l j){final HashMap<String,List<String>> i=new HashMap<String,List<String>>();l g=RC(j,"PARAMETRE");while(g!=null){final String k=g.getAttribute("nom");final String m=g.getAttribute("valeur");List<String> h=i[k];if(h==null){h=new List<String>();h.add(m);i[k]=h;}else h.add(m);g=kD(g,"PARAMETRE");}Ia[j]=i;return (i);}HashMap<String,List<String>> bV(final l g){return (tR(g,"element",null));}HashMap<String,List<String>> tR(final l m,final String i,final String k){l g;if(i=="element")g=tK(cD(m));else if(i=="instruction"){g=null;l h=RC(Xa(),"PLUGIN_INSTRUCTION");while(h!=null){if(k!=null&&k==h.getAttribute("cible")){g=h;break;}h=kD(h,"PLUGIN_INSTRUCTION");}}else if(i=="commentaire"){final l h=RC(Xa(),"PLUGIN_COMMENTAIRE");if(h==null){g=null;}else{g=h;}}else g=null;if(g==null)return (new HashMap<String,List<String>>());if(Ia==null)Ia=new HashMap<l,HashMap<String,List<String>>>();HashMap<String,List<String>> j=Ia[g];if(j==null)j=ca(g);return (j);}List<String> RV(final l i){final Set<String> g=new LinkedHashSet<String>();List<String> m=Ka.jM(i);if(m!=null)g.addAll(Ka.jM(i));final l j=tK(cD(i));if(j!=null){l h=RC(j,"VALEUR_SUGGEREE");while(h!=null){final String k=YG(h);if(k!=null)g.add(k);h=kD(h,"VALEUR_SUGGEREE");}}if(g.length==0)return (null);else return (g.toList());}List<String> wU(final l s,final l j){final Set<String> h=new LinkedHashSet<String>();List<String> k=Ka.aP(j);if(k!=null)h.addAll(k);final l m=tK(cD(s));if(m!=null){final String v=attributeName(j);l g=RC(m,"AFFICHAGE_ATTRIBUT");while(g!=null){if(g.getAttribute("attribut")==v){l i=RC(g,"VALEUR_SUGGEREE");while(i!=null){final String o=YG(i);if(o!=null)h.add(o);i=kD(i,"VALEUR_SUGGEREE");}}g=kD(g,"AFFICHAGE_ATTRIBUT");}}if(h.length==0)return (null);else return (h.toList());}List<l> da(){final WE k=new WE();final List<l> i=new List<l>();final List<l> m=ea();for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){WE j;if(g.getAttribute("pays")=="")j=new WE.TX(h);else j=new WE.YX(h,g.getAttribute("pays"));if(k==j&&!i.contains(g))i.add(g);}}for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){final WE o=new WE.YX(k.language,k.sH);WE j;if(g.getAttribute("pays")=="")j=new WE.TX(h);else j=new WE.YX(h,g.getAttribute("pays"));if(o==j&&!i.contains(g))i.add(g);}}for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){final WE o=new WE.TX(k.language);if(o==new WE.TX(h)&&!i.contains(g))i.add(g);}}for(final l g in m){if(!i.contains(g))i.add(g);}return (i);}String BI(final String h){final List<l> m=da();for(final l j in m){l g=qP(j,"STRINGS_MENU");while(g!=null){if(h==g.getAttribute("menu")){final l i=RC(g,"TITRE");if(i!=null&&i.firstChild!=null){return (YG(i));}break;}g=DN(j,g,"STRINGS_MENU");}}final l k=gG(h);if(k!=null)return (OD(k));return (h);}String MS(final String j){final List<l> k=da();for(final l i in k){l g=qP(i,"STRINGS_MENU");while(g!=null){if(j==g.getAttribute("menu")){final l h=RC(g,"DOCUMENTATION");if(h!=null&&h.firstChild!=null){return (YG(h));}break;}g=DN(i,g,"STRINGS_MENU");}}return (null);}HashMap<String,String> Ua(){HashMap<String,String> h=new HashMap<String,String>();final List<l> m=da();for(final l o in m){l g=RC(o,"STRINGS_ELEMENT");while(g!=null){String i=g.getAttribute("element");if(h[i]==null){String k=i;final l j=RC(g,"TITRE");if(j!=null&&j.firstChild!=null)k=YG(j);h[i]=k;}g=kD(g,"STRINGS_ELEMENT");}}return (h);}String OD(final l i){String g=null;g=Fa[i];if(g!=null)return (g);final String j=cD(i);if(j==null){pJ("Config.elementTitle : no name for ${i}");return (null);}final List<l> m=da();for(final l o in m){if(g==null){l h=RC(o,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==j){final l k=RC(h,"TITRE");if(k!=null&&k.firstChild!=null){g=YG(k);break;}break;}h=kD(h,"STRINGS_ELEMENT");}}}if(g==null||g=="")g=j;Fa[i]=g;return (g);}String uH(final l h){if(h==null)return (null);final String j=cD(h);final List<l> k=da();for(final l m in k){l g=RC(m,"STRINGS_ELEMENT");while(g!=null){if(j==g.getAttribute("element")){final l i=RC(g,"DOCUMENTATION");if(i!=null&&i.firstChild!=null)return (YG(i));break;}g=kD(g,"STRINGS_ELEMENT");}}return (Ka.gO(h));}static String jT(final String h){String g=h;g=g.replaceAll("&","&amp;");g=g.replaceAll("<","&lt;");g=g.replaceAll(">","&gt;");g=g.replaceAll("\n","<br>");return (g);}String oK(final l k,final String i){final String m=cD(k);final List<l> o=da();final String s=(new WE()).language;for(final l j in o){l h=RC(j,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==m){l g=RC(h,"TITRE_VALEUR");while(g!=null){if(g.getAttribute("valeur")==i&&g.firstChild!=null)return (YG(g));g=kD(g,"TITRE_VALEUR");}break;}h=kD(h,"STRINGS_ELEMENT");}final String v=j.getAttribute("langue");if(v==s)return (i);}return (i);}String fK(final l k,final l m){final String s=cD(k);final String i=attributeName(m);final List<l> v=da();for(final l BB in v){l g=RC(BB,"STRINGS_ELEMENT");while(g!=null){if(g.getAttribute("element")==s){l h=RC(g,"STRINGS_ATTRIBUT");while(h!=null){if(h.getAttribute("attribut")==i){final l j=RC(h,"TITRE");if(j!=null&&j.firstChild!=null)return (YG(j));break;}h=kD(h,"STRINGS_ATTRIBUT");}}g=kD(g,"STRINGS_ELEMENT");}}final String o=NR(k,m);if(o!=null)return ("${o}:${i}");return (i);}String gK(final l m,final l o,final String j){final String s=cD(m);final String v=attributeName(o);final List<l> BB=da();final String EB=(new WE()).language;for(final l k in BB){l h=RC(k,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==s){l i=RC(h,"STRINGS_ATTRIBUT");while(i!=null){if(i.getAttribute("attribut")==v){l g=RC(i,"TITRE_VALEUR");while(g!=null){if(g.getAttribute("valeur")==j&&g.firstChild!=null)return (YG(g));g=kD(g,"TITRE_VALEUR");}break;}i=kD(i,"STRINGS_ATTRIBUT");}}h=kD(h,"STRINGS_ELEMENT");}final String HB=k.getAttribute("langue");if(HB==EB)return (j);}return (j);}String vG(final l k,final l j){final String m=cD(k);final String o=attributeName(j);final List<l> s=da();for(final l v in s){l g=RC(v,"STRINGS_ELEMENT");while(g!=null){if(g.getAttribute("element")==m){l h=RC(g,"STRINGS_ATTRIBUT");while(h!=null){if(h.getAttribute("attribut")==o){final l i=RC(h,"DOCUMENTATION");if(i!=null&&i.firstChild!=null)return (YG(i));break;}h=kD(h,"STRINGS_ATTRIBUT");}}g=kD(g,"STRINGS_ELEMENT");}}return (Ka.vG(j));}static String YG(final AB i){final AB g=i.firstChild;if(g==null)return (null);final String h=g.nodeValue;if(h==null)return (null);return (h.trim());}l Ta(){if(La==null){La=RC(Ba,"LANGAGE");}return La;}l Ya(){if(Ma==null){Ma=RC(Ba,"ENREGISTREMENT");if(Ma==null){Ma=Ba.ownerDocument.createElement("ENREGISTREMENT");}}return Ma;}l aa(){if(Na==null){Na=RC(Ba,"MENUS");if(Na==null){Na=Ba.ownerDocument.createElement("MENUS");}}return Na;}l Xa(){if(Oa==null){Oa=RC(Ba,"AFFICHAGE_NOEUDS");if(Oa==null){Oa=Ba.ownerDocument.createElement("AFFICHAGE_NOEUDS");}}return Oa;}List<l> ea(){if(Qa==null){Qa=new List<l>();AB g=Ba.firstChild;while(g!=null){if(g.nodeType==AB.FE&&g.nodeName=="STRINGS"){Qa.add(g as l);}g=g.nextSibling;}}return Qa;}static l RC(final AB g,final String h){final AB i=g.firstChild;return pP(i,h);}static l kD(final AB g,final String h){final AB i=g.nextSibling;return pP(i,h);}static l pP(AB g,final String h){if(h==null)return null;while(g!=null){if(g.nodeType==AB.FE&&h==g.nodeName){return g as l;}g=g.nextSibling;}return null;}static l qP(final AB g,final String h){return DN(g,g,h);}static l DN(final AB i,final AB j,final String k){AB g=j;AB h;while(g!=null){if(g.hasChildNodes()){g=(g.firstChild);}else if(g!=i&&null!=(h=g.nextSibling)){g=h;}else{h=null;while(g!=i){h=g.nextSibling;if(h!=null)break;g=g.parentNode;}g=h;}if(g!=i&&g!=null&&g.nodeType==AB.FE&&g.nodeName==k){return g as l;}}return null;}static void pJ(String g,[Exception h]){if(h!=null)print("Config: ${g}: ${h}");else print("Config: ${g}");}}class yM{static const int NT=400;GH fa;q selectionStart;q selectionEnd;yF iG;CC KI;CC EI;XB FF;Point dO;NI toolbar;wM ga;q YM;DateTime AP;bool rI;yM(){fa=new GH();ga=new wM();YM=null;AP=null;rI=false;}Future FP(String i){Completer g=new Completer();t.FP(i).then((m){ha();yE();ga.SP();document.title=LB.NB('page.new_document');g.complete();},onError:(LD j){Element k=document.getElementById('doc2');String h="Error creating the new document: ${j}";k.text=h;g.completeError(h);});return (g.future);}Future KP(String h,String j,{bool removeIndents: true}){Completer g=new Completer();t.KP(h,j).then((o){ha();yE();ga.VP();t.sC.WO();document.title=h.split('/').last;g.complete();},onError:(LD k){Element m=document.getElementById('doc2');String i="Error reading the document: ${k}";m.text=i;g.completeError(i);});return (g.future);}void yE(){Element h=document.getElementById('doc2');h.children.clear();document.body.insertBefore(ga.html(),document.getElementById('doc1'));QO();window.onResize.listen((Event g)=>QO());Element j=t.html();h.append(j);q k=new q(t.sC,0);fa.moveTo(k);LC();h.onMouseDown.listen((MouseEvent g)=>onMouseDown(g));h.onMouseMove.listen((MouseEvent g)=>onMouseMove(g));h.onMouseUp.listen((MouseEvent g)=>onMouseUp(g));h.onContextMenu.listen((MouseEvent g)=>onContextMenu(g));document.getElementById('doc1').onScroll.listen((Event g)=>onScroll(g));document.onMouseUp.listen((MouseEvent g){if(FF!=null){Element i=FF.vK();if(i.scrollHeight>i.clientHeight&&g.target==i&&g.client.x>i.offsetLeft+i.clientWidth)return;if(g.client!=dO)TR();g.preventDefault();}});}void QO(){Element h=document.getElementById('headers');num i=h.getBoundingClientRect().bottom;String g=(i.round()+2).toString()+"px";document.getElementById('left_panel').style.top=g;document.getElementById('doc1').style.top=g;}void ha(){iG=t.CB.zV(t);XB i=new XB(LB.NB('menu.file'));i.parent=iG;CC g;if(t.CL!=null){g=new CC(LB.NB('menu.save'),()=>save(),shortcut:'S');i.add(g);}g=new CC(LB.NB('menu.source'),()=>lW());i.add(g);g=new CC(LB.NB('menu.validation'),()=>(new MT()).show());i.add(g);iG.insert(i,0);XB h=new XB(LB.NB('menu.edit'));h.parent=iG;KI=new CC(LB.NB('undo.undo'),()=>t.YH(),shortcut:'Z');KI.enabled=false;h.add(KI);EI=new CC(LB.NB('undo.redo'),()=>t.bM(),shortcut:'Y');EI.enabled=false;h.add(EI);h.add(new CC(LB.NB('menu.select_all'),()=>RP(),shortcut:'A'));CC o=new CC(LB.NB('find.find_replace'),()=>(new jP()).show(),shortcut:'F');h.add(o);iG.insert(h,1);Element m=document.getElementById('headers');m.append(iG.html());toolbar=new NI(t.CB);m.append(toolbar.html());HashMap<String,FD> j=new HashMap<String,FD>();for(MC k in toolbar.GG)if(k.shortcut!=null)j[k.shortcut]=k.action;for(XB s in iG.CI){MR(s,j);}fa.hW(j);}MR(XB i,HashMap<String,FD> h){for(CC g in i.items){if(g.shortcut!=null&&g.action!=null)h[g.shortcut]=g.action;if(g is XB)MR(g,h);}}void onMouseDown(MouseEvent g){if(FF!=null)TR();if(g.target is ImageElement||g.target is ButtonElement||g.target is TextInputElement||g.target is SelectElement)return;Element h=g.target;while(h is Element&&!h.classes.contains('dn')){h=h.parent;}if(h!=null&&h.attributes['contenteditable']=='true')return;if(g.button==1)return;g.preventDefault();if(g.button==2){return;}if(g.shiftKey){selectionStart=new q.nX(fa.selectionStart);selectionEnd=GH.oJ(g);if(selectionEnd!=null)fa.gE(selectionStart,selectionEnd);}else{selectionStart=GH.oJ(g);if(selectionStart!=null&&YM==selectionStart&&AP.difference(new DateTime.now()).inMilliseconds.abs()<NT&&selectionStart.u.nodeType!=n.tC){List<q> i=ia(selectionStart);selectionStart=i[0];selectionEnd=i[1];fa.gE(selectionStart,selectionEnd);rI=true;}}}void onMouseMove(MouseEvent h){if(selectionStart==null)return;if(FF!=null)return;q g=GH.oJ(h);if(rI){if(selectionEnd>selectionStart&&g<=selectionStart)selectionStart=selectionEnd;else if(selectionEnd<selectionStart&&g>=selectionStart)selectionStart=selectionEnd;}selectionEnd=g;if(selectionStart!=null&&selectionEnd!=null){if(rI&&selectionEnd.u.nodeType!=n.tC){List<q> i=ia(selectionEnd);if(selectionEnd>selectionStart)selectionEnd=i[1];else selectionEnd=i[0];}fa.gE(selectionStart,selectionEnd);}h.preventDefault();}List<q> ia(q g){List<q> j=new List<q>();String k=g.u.nodeValue;int h=g.JB;int i=g.JB;String m=' \n,;:.?!/()[]{}';while(h>0&&m.indexOf(k[h-1])==-1)h-- ;while(i<k.length&&m.indexOf(k[i])==-1)i++ ;j.add(new q(g.u,h));j.add(new q(g.u,i));return (j);}void onMouseUp(MouseEvent g){if(!rI)selectionEnd=GH.oJ(g);YM=null;if(selectionStart!=null&&selectionEnd!=null){if(!rI)fa.gE(selectionStart,selectionEnd);if(selectionStart==selectionEnd){YM=selectionStart;AP=new DateTime.now();}}selectionStart=null;selectionEnd=null;rI=false;g.preventDefault();}void onContextMenu(MouseEvent h){if(h.shiftKey)return;q g=GH.oJ(h);if(g!=null){h.preventDefault();if(fa.selectionStart==null||fa.selectionEnd==null||(g<fa.selectionStart&&g<fa.selectionEnd)||(g>fa.selectionStart&&g>fa.selectionEnd)){fa.gE(g,g);}if(fa.selectionStart!=null)kW(h);}}void onScroll(Event g){fa.ZH(false);}void kW(MouseEvent EB){if(t.CB==null||fa.selectionStart.u==null)return;dO=EB.client;n h;if(fa.selectionStart.u is OB)h=fa.selectionStart.u.parent;else h=fa.selectionStart.u;List<l> QB=t.kO(h);List<l> SB=t.dP(QB);FF=new XB(null);bool o=false;if(h.DB!=null){String k=t.CB.BI(h.nodeName);String i="${LB.NB('contextual.select_element')} ${k}";FF.add(new CC(i,()=>selectNode(h)));List<l> m=t.CB.fE(h.DB);if(m!=null&&m.length>0){i="${LB.NB('contextual.edit_attributes')} ${k}";FF.add(new CC(i,()=>h.JE()));}i="${LB.NB('contextual.help_about_element')} ${k}";FF.add(new CC(i,()=>(new WG.SX(h.DB)).show()));o=true;}if(t.uO!=null){n j=h;while(j!=null&&j is!wI)j=j.parent;if(j!=null){if(o)FF.PO();String k=t.CB.BI(j.nodeName);List<l> m=t.CB.fE(j.DB);if(m!=null&&m.length>0){String i="${LB.NB('contextual.edit_attributes')} ${k}";FF.add(new CC(i,()=>j.JE()));}FF.add(new CC(LB.NB('div.remove'),()=>(j as wI).QW()));o=true;}}List<l> s;if(toolbar!=null)s=toolbar.dR();else s=null;bool HB=true;for(l v in SB){if(s!=null&&s.contains(v))continue;if(t.ZC!=null&&t.ZC.contains(v))continue;if(HB&&o)FF.PO();HB=false;String cB=t.CB.cD(v);String i=t.CB.BI(cB);CC hB=new CC(i,()=>t.AI(v,'element'));FF.add(hB);}DivElement g=FF.UM();g.style.position='fixed';g.style.display='block';int BB=EB.client.x;int KB=EB.client.y;g.style.left="${BB}px";g.style.top="${KB}px";g.style.maxHeight="${window.innerHeight-KB}px";g.style.overflowY='auto';document.body.append(g);if(g.scrollHeight>g.clientHeight)g.style.paddingRight="${g.offsetWidth-g.clientWidth}px";if(BB+g.offsetWidth>window.innerWidth){BB=window.innerWidth-g.offsetWidth;g.style.left="${BB}px";}}void TR(){DivElement g=FF.vK();g.remove();FF=null;dO=null;}GH get cursor{return (fa);}q vC(){return (fa.selectionStart);}q GF(){return (fa.selectionEnd);}void JD(q g){fa.moveTo(g);}void AH(){fa.focus();}void XS(n g){q j=new q(g.parent,g.parent.ZB(g));GD h=j.jF();if(h==null)return;DivElement i=document.getElementById('doc1');int k=i.offset.top;i.scrollTop+= h.y.toInt()-k-10;}void selectNode(n g){int h=g.parent.ZB(g);q i=new q(g.parent,h);q j=new q(g.parent,h+1);fa.moveTo(i);fa.gE(i,j);LC();}void RP(){fa.gE(new q(t.sC,0),new q(t.sC,t.sC.PB));}void LC(){if(fa.selectionStart==null)return;n g=fa.selectionStart.u;if(g is OB)g=g.parent;List<l> h=t.kO(g);List<l> i=t.dP(h);ga.update(g,h,i);tW(g,i);uW();}void tW(n h,List<l> g){List<XB> i=iG.CI;for(XB j in i){ja(j,g);}if(toolbar!=null)toolbar.update(h,g);}void ja(XB m,List<l> i){for(CC g in m.items){if(g is XB){ja(g,i);}else if(g.data is l){l j=g.data;String o=t.CB.cD(j);bool k=false;for(l h in i){if(t.CB.cD(h)==o){k=true;if(h!=j){g.data=h;g.action=()=>t.AI(h,'element');}break;}}if(k)g.enable();else g.disable();}}}void uW(){Element g=document.getElementById('path');if(fa.selectionStart==null)g.text="";else g.text=fa.selectionStart.LI(titles:true);}void KL(){if(t.FS()){if(!KI.enabled)KI.enable();}else{if(KI.enabled)KI.disable();}if(t.ES()){if(!EI.enabled)EI.enable();}else{if(EI.enabled)EI.disable();}KI.title=t.xR();EI.title=t.vR();if(toolbar!=null){for(MC g in toolbar.GG){if(g.data=="undo"){if(t.FS())g.enable();else g.disable();g.title=t.xR();}else if(g.data=="redo"){if(t.ES())g.enable();else g.disable();g.title=t.vR();}}}}void save(){t.ZW().then((h){window.alert(LB.NB('save.success'));},onError:(LD g){window.alert(LB.NB('save.error')+': '+g.message);});}void lW(){(new LT()).show();}}abstract class n{static const int tC=1;static const int mB=3;static const int XG=9;static const String PT='GRAS';static const String QT='ITALIQUE';static const String RT='EXPOSANT';static const String ST='INDICE';static const String TT='SOULIGNE';static const String UT='BARRE';static const String VT='FCOULEUR';static const String WT='PCOULEUR';static const String XT="^.*\\[(x[0-9a-fA-F]{2}|[0-9]{1,3}),(x[0-9a-fA-F]{2}|[0-9]{1,3}),(x[0-9a-fA-F]{2}|[0-9]{1,3})\\]\$";l DB;String ka;n parent;int nodeType;String la;String EC;String localName;String nodeValue;n firstChild;n nextSibling;List<aB> attributes;bool dJ=false;bool lM=false;bool valid;n.oX(AB g,n h,{bool createChildren: true}){ka=t.aM(this);this.parent=h;if(g.nodeType==AB.FE||g.nodeType==AB.kE||g.nodeType==AB.FK)nodeType=g.nodeType;else nodeType=tC;la=g.pB;EC=g.EC;if(g.nodeType==AB.CK)localName=g.nodeName;else if(g.nodeType==AB.BK)localName='#cdata-section';else if(g.nodeType==AB.DK)localName='#comment';else if(g.nodeType==AB.FK)localName='#document';else localName=g.localName;if(nodeType==n.mB)nodeValue=g.nodeValue;attributes=new List<aB>();LinkedHashMap<String,lC> m=g.attributes;if(m!=null){for(AB i in m.values){attributes.add(new aB.QX(i));}}if(g is l){DB=t.CB.TM(g,h==null?null:h.DB);if(DB==null&&h!=null){DB=t.CB.gG(localName);}}if(createChildren){if(g.childNodes!=null){n j=null;for(AB i in g.childNodes){n k=ND.dH(i,this);if(j==null)firstChild=k;else j.nextSibling=k;j=k;}}else if((g.nodeType==AB.BK||g.nodeType==AB.CK||g.nodeType==AB.DK)&&g.nodeValue!=null&&g.nodeValue!=''){jB(new OB(g.nodeValue));}}if(nodeType==n.tC)valid=t.CB.hO(this);else valid=true;}n.tX(l g){DB=g;ka=t.aM(this);parent=null;nodeType=tC;la=t.CB.jI(DB);EC=t.CB.OM(DB);localName=t.CB.cD(DB);nodeValue=null;firstChild=null;nextSibling=null;attributes=new List<aB>();valid=true;}n.uX(int g){DB=null;ka=t.aM(this);parent=null;this.nodeType=g;la=null;EC=null;localName=null;nodeValue=null;firstChild=null;nextSibling=null;attributes=new List<aB>();valid=true;}n.vX(String g){ka=t.aM(this);parent=null;nodeType=n.mB;la=null;this.EC=null;this.localName=null;nodeValue=g;firstChild=null;nextSibling=null;attributes=null;valid=true;}factory n.wX(n g){iH i=new zJ();sB j=i.createDocument(null,null,null);AB k=g.KF(j);n h=ND.dH(k,g.parent);h.parent=null;return (h);}String get id{return (ka);}Element oB(){return (document.getElementById(ka));}Element dD(){Element g=oB();if(g!=null&&!g.nodes.isEmpty&&g.firstChild is Element)g=g.firstChild;return (g);}String get nodeName{if(nodeType==mB)return ('#text');StringBuffer g=new StringBuffer();if(EC!=null){g.write(EC);g.write(":");}g.write(localName);return (g.toString());}String get pB{return (la);}int get PB{if(nodeType==mB)return (nodeValue.length);int h=0;for(n g=firstChild;g!=null;g=g.nextSibling)h++ ;return (h);}bool get DD{return (false);}bool get eC{if(RE())return (true);Element g=oB();return (g is DivElement||g is TableElement||g is UListElement);}List<n> get childNodes{List<n> h=new List<n>();for(n g=firstChild;g!=null;g=g.nextSibling){h.add(g);}return (h);}n get previousSibling{if(parent==null)return (null);for(n g=parent.firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==this)return (g);}return (null);}n get lastChild{for(n g=firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==null)return (g);}return (null);}n eB(int i){assert(nodeType!=mB);int h=0;for(n g=firstChild;g!=null;g=g.nextSibling){if(h==i)return (g);h++ ;}return (null);}n nextNode(){if(firstChild!=null)return (firstChild);if(nextSibling!=null)return (nextSibling);n g=parent;while(g!=null){if(g.nextSibling!=null)return (g.nextSibling);g=g.parent;}return (null);}n previousNode(){if(firstChild!=null)return (lastChild);if(previousSibling!=null)return (previousSibling);n g=parent;while(g!=null){if(g.previousSibling!=null)return (g.previousSibling);g=g.parent;}return (null);}int ZB(n i){int h=0;for(n g=firstChild;g!=null;g=g.nextSibling){if(g==i)return (h);h++ ;}assert(false);return (-1);}String getAttribute(String h){for(aB g in attributes){if(g.localName==h)return (g.value);}return (null);}String getAttributeNS(String h,String i){if(attributes==null)return (null);for(aB g in attributes){if(g.pB==h&&g.localName==i)return (g.value);}return (null);}void setAttribute(String g,String h){for(aB i in attributes){if(i.localName==g){i.value=h;return;}}attributes.add(new aB(g,h));return;}void setAttributeNS(String m,String g,String o){String i,j;int k=g.indexOf(":");if(k!=-1){i=g.substring(0,k);j=g.substring(k+1);}else{i=null;j=g;}aB h=RM(m,j);if(h!=null){h.EC=i;h.value=o;return;}h=new aB.aX(m,g,o);attributes.add(h);}aB QM(String h){for(aB g in attributes){if(g.localName==h)return (g);}return (null);}aB RM(String h,String i){if(attributes==null)return (null);for(aB g in attributes){if(g.pB==h&&g.localName==i){return (g);}}return (null);}LinkedHashMap<String,aB> gR(){LinkedHashMap<String,aB> g=new LinkedHashMap<String,aB>();for(aB h in attributes)g[h.name]=new aB.gX(h);return (g);}Element html();void sD(){Element g=oB();if(g==null)return;Element h=html();g.replaceWith(h);}void BF(List<n> o){List<n> s=childNodes;for(n g in o){Element m=g.oB();if(!s.contains(g)){if(m!=null)m.remove();else{sD();return;}}else if(m==null){n j=g.nextSibling;Node i=null;while(i==null&&j!=null){i=j.oB();if(i==null)j=j.nextSibling;}n k=g.previousSibling;Node h=null;while(h==null&&k!=null){h=k.oB();if(h==null)k=k.previousSibling;}if(i!=null){i.parent.insertBefore(g.html(),i);}else if(h!=null){if(h.nextNode!=null)h.parent.insertBefore(g.html(),h.nextNode);else h.parent.append(g.html());}else{sD();return;}}else{g.sD();}}}void uI(){sD();}void FL(bool h){Element g=oB();if(g==null)return;if(h)g.classes.add('selected');else g.classes.remove('selected');}void jB(n g){n h=lastChild;if(h!=null)h.nextSibling=g;else firstChild=g;g.parent=this;}void insertBefore(n h,n i){assert(i==null||this==i.parent);h.parent=this;n g=firstChild;if(g==i){n j=firstChild;firstChild=h;h.nextSibling=j;}else{while(g!=null&&g.nextSibling!=i){g=g.nextSibling;}assert(g!=null);assert(g.nextSibling==i);n j=g.nextSibling;g.nextSibling=h;h.nextSibling=j;}}void insertAfter(n h,n g){assert(this==g.parent);if(g.nextSibling==null)jB(h);else insertBefore(h,g.nextSibling);}void gC(n g){if(g.previousSibling!=null)g.previousSibling.nextSibling=g.nextSibling;if(g==firstChild)firstChild=g.nextSibling;g.parent=null;g.nextSibling=null;}void replaceWith(n g){if(parent.firstChild==this)parent.firstChild=g;else previousSibling.nextSibling=g;g.parent=parent;g.nextSibling=nextSibling;parent=null;nextSibling=null;}void normalize(){for(n g=firstChild;g!=null;g=g.nextSibling){while(g.nodeType==mB&&g.nextSibling!=null&&g.nextSibling.nodeType==mB){g.nodeValue="${g.nodeValue}${g.nextSibling.nodeValue}";gC(g.nextSibling);}}}void remove(q g,int h){if(nodeType==tC){for(int i=g.JB;i<h;i++ ){gC(eB(g.JB));}}else{String j=nodeValue;String k=j.substring(0,g.JB);String m=j.substring(g.JB+h);nodeValue="${k}${m}";}}bool RE(){return (false);}bool QG(){return (false);}void MG(){if(QG()&&firstChild!=null&&firstChild is OB){String g=firstChild.nodeValue;if(g.startsWith('\n')){if(g.length==1)gC(firstChild);else firstChild.nodeValue=g.substring(1);}}n i=lastChild;while(i!=null&&i is OB)i=i.previousSibling;if(QG()&&lastChild is OB&&(i==null||!i.RE())){String g=lastChild.nodeValue;if(g.endsWith('\n')){if(g.length==1)gC(lastChild);else lastChild.nodeValue=g.substring(0,g.length-1);}}for(n h=firstChild;h!=null;h=h.nextSibling){if(h.RE()&&h.nextSibling is OB){String g=h.nextSibling.nodeValue;if(g.startsWith('\n')){if(g.length==1)gC(h.nextSibling);else h.nextSibling.nodeValue=g.substring(1);}}}}AB KF(sB i){assert(nodeType==tC);l g=i.createElementNS(pB,nodeName);for(aB k in attributes)g.setAttributeNS(k.pB,k.name,k.value);if(QG()||firstChild!=null){if(QG())g.jB(i.wG('\n'));for(n j=firstChild;j!=null;j=j.nextSibling){g.jB(j.KF(i));if(j.RE())g.jB(i.wG('\n'));}n h=lastChild;while(h!=null&&h is OB)h=h.previousSibling;if(QG()&&lastChild!=null&&(h==null||!h.RE()))g.jB(i.wG('\n'));}return (g);}String toString(){iH g=new zJ();sB h=g.createDocument(null,null,null);AB i=KF(h);return (i.toString());}static String hT(String g){g=g.replaceAll('&','&amp;');g=g.replaceAll('"','&quot;');g=g.replaceAll('<','&lt;');g=g.replaceAll('>','&gt;');return (g);}void lF(){valid=t.CB.hO(this);Element g=oB();if(g==null)return;if(valid&&g.classes.contains('invalid'))g.classes.remove('invalid');else if(!valid&&!g.classes.contains('invalid'))g.classes.add('invalid');}void HP(FD g){if(DB!=null&&t.CB.fE(DB).length>0)JE(()=>g());else g();}void JE([FD h]){if(DB!=null){tM g=new tM(this,h);g.show();}else{xM g=new xM(this,h);g.show();}}q zG(num BC,num BB){q QD=new q(this,0);if(nodeType==tC||nodeType==XG){for(n QB=firstChild;QB!=null;QB=QB.nextSibling){Element g=QB.oB();if(g==null)continue;double SB,EB,HB,KB;double cB,hB;if(g is DivElement&&g.nodes.length>0&&g.firstChild is SpanElement&&(g.firstChild as SpanElement).classes.contains('start_tag')&&g.lastChild is SpanElement&&(g.lastChild as SpanElement).classes.contains('end_tag')){Element i=g.firstChild;Rectangle h=i.getBoundingClientRect();SB=h.left;EB=h.top;cB=i.offset.height.toDouble();i=g.lastChild;h=i.getBoundingClientRect();HB=h.right;KB=h.bottom;hB=i.offset.height.toDouble();}else if(g is DivElement||g is TableCellElement||g is TableRowElement||g is TableElement||g is ImageElement||g.classes.contains('form')){Rectangle h=g.getBoundingClientRect();SB=h.left;EB=h.top;if(g.classes.contains('form'))HB=g.querySelector('table').getBoundingClientRect().right;else HB=h.right;KB=h.bottom;cB=hB=h.height;}else if(g is SpanElement&&g.nodes.length==1&&g.firstChild is Text&&!g.firstChild.nodeValue.endsWith('\n')){List<Rectangle> k=g.getClientRects();if(k.length==0)return (null);Rectangle h=k.first;SB=h.left;EB=h.top;cB=h.height*1.4;h=k.last;HB=h.right;KB=h.bottom;hB=h.height*1.4;}else if(g.firstChild is Element&&g.lastChild is SpanElement&&g.lastChild.lastChild is Text&&!g.lastChild.lastChild.nodeValue.endsWith('\n')){Element i=g.firstChild;List<Rectangle> k=i.getClientRects();if(k.length==0)return (null);Rectangle h=k.first;SB=h.left;EB=h.top;cB=h.height*1.3;i=g.lastChild;k=i.getClientRects();if(k.length==0)return (null);h=k.last;HB=h.right;KB=h.bottom;hB=h.height*1.3;}else{Element i=new Element.tag('span');i.append(new Text("|"));if(g.nodes.length==1&&g.firstChild is BRElement){g.append(i);Rectangle h=i.getBoundingClientRect();SB=-1.0;EB=h.top;cB=hB=i.offset.height.toDouble()*1.4;HB=-1.0;KB=h.bottom;i.remove();}else{if(g.nodes.isEmpty)g.append(i);else g.insertBefore(i,g.firstChild);Rectangle h=i.getBoundingClientRect();SB=h.left;EB=h.top;cB=i.offset.height.toDouble()*1.4;i.remove();if(g is LIElement){Node m=g;while(m.firstChild!=null&&(m.lastChild is!Text||(m.lastChild.nodeValue=='\n'&&m.lastChild.previousNode!=null))&&m.lastChild is!ImageElement){if(m.lastChild is Text&&m.lastChild.nodeValue=='\n'&&m.lastChild.previousNode!=null)m=m.lastChild.previousNode;else m=m.lastChild;}m.append(i);}else g.append(i);h=i.getBoundingClientRect();HB=h.left;KB=h.bottom;hB=i.offset.height.toDouble()*1.4;i.remove();}}if((BB<EB+cB&&(BB<EB-1||(BC<SB+1&&g is!LIElement&&QB is!kB)))){return (QD);}if(BB>KB-hB&&(BB>KB+1||(BC>HB-1&&g is!LIElement))){QD=new q(this,ZB(QB)+1);}else{QD=QB.zG(BC,BB);return (QD);}}}else if(nodeType==mB){int o=0;for(Node g in oB().nodes){Text v;if(g is Text)v=g;else if(g is Element)v=g.firstChild;else continue;Range IC=new Range();for(int j=0;j<v.length;j++ ){if(nodeValue[o+j]!='\n'){IC.setStart(v,j);IC.setEnd(v,j+1);List<Rectangle> k=IC.getClientRects();for(Rectangle s in k){if(window.navigator.appVersion.contains("Trident")&&o+j+1<nodeValue.length&&nodeValue[o+j+1]=='\n'&&s.width==0){continue;}if(j<nodeValue.length-1&&s.left==s.right&&BC<s.left&&BB<s.bottom){return (new q(this,o+j+1));}if(BC<s.right&&BB<=s.bottom){if(BC<(s.left+s.right)/2)return (new q(this,o+j));else return (new q(this,o+j+1));}else if(BB<s.top-5){if(o+j==0||nodeValue[o+j]==' ')return (new q(this,o+j));else return (new q(this,o+j-1));}}}else{String tD=v.text;v.text="${tD.substring(0,j)}|${tD.substring(j)}";IC.setStart(v,j);IC.setEnd(v,j+1);List<Rectangle> k=IC.getClientRects();v.text=tD;if(window.navigator.appVersion.contains("Trident")){if(BB<=k.first.bottom){return (new q(this,o+j));}}else{for(Rectangle s in k){if(BB<=s.bottom){return (new q(this,o+j));}}}}}o+= v.length;}}return (new q(this,PB));}q QE(){return (new q(this,0));}q SF(){return (new q(this,PB));}void gM(Element g){String j=t.CB.bC(DB,'style',null);if(j!=null){List<String> m=j.split(';');for(String h in m){if(h==PT){g.style.fontWeight='bold';}else if(h==QT){g.style.fontStyle='italic';}else if(h==RT){g.style.verticalAlign='super';g.style.fontSize='80%';}else if(h==ST){g.style.verticalAlign='sub';g.style.fontSize='80%';}else if(h==TT){g.style.textDecoration='underline';}else if(h==UT){g.style.textDecoration='line-through';}else if(h.startsWith(VT)){g.style.background=ma(h);}else if(h.startsWith(WT)){g.style.color=ma(h);}}}String i=t.CB.bC(DB,'police',null);if(i!=null){if(i=='Monospaced')i='monospace';g.style.fontFamily=i;}String k=t.CB.bC(DB,'taille',null);if(k!=null){g.style.fontSize=k;}}String ma(String j){Iterable<Match> k=XT.allMatches(j);for(Match m in k){final List<int> g=new List<int>();for(int h=0;h<3;h++ ){String i=m.group(h+1);if(i.startsWith("x"))g[h]=int.parse(i.substring(1),radix:16);else g[h]=int.parse(i);}return ("rgb(${g[0]}, ${g[1]}, ${g[2]})");}return (null);}void WO(){RO();for(n g=firstChild;g!=null;g=g.nextSibling){g.WO();}}void PR(){AV();for(n g=firstChild;g!=null;g=g.nextSibling){g.PR();}}void RO(){}void AV(){}}class dC implements q{n pZ;int na;dC(n g,int h){assert(g!=null);assert(h>=0);pZ=g;na=h;}dC.ZX(CE g){pZ=t.sC;na=0;OG(g.HF);}dC.dX(vD g){pZ=t.sC;na=pZ.PB;OG(-g.UF);}n get u{return (pZ);}int get JB{return (na);}int get HF{CE g=new CE.VX(this);return (g.HF);}int get UF{vD g=new vD.WX(this);return (g.UF);}bool operator==(q g){dC h;if(g is dC)h=g;else if(g is CE)h=new dC.ZX(g);else if(g is vD)h=new dC.dX(g);return (pZ==h.pZ&&na==h.na);}bool operator<(q i){dC j;if(i is dC)j=i;else if(i is CE)j=new dC.ZX(i);else if(i is vD)j=new dC.dX(i);n o=null;n g=pZ;double k=na.toDouble();while(g!=null){n h=j.pZ;double m=j.na.toDouble();while(h!=null){if(g==h){return (k<m);}if(h.parent==null)break;m=h.parent.ZB(h)+0.5;h=h.parent;}if(g.parent==null)break;k=g.parent.ZB(g)+0.5;g=g.parent;}assert(false);return (false);}bool operator<=(q g){return (this<g||this==g);}bool operator>(q g){return (!(this==g||this<g));}bool operator>=(q g){return (this>g||this==g);}void OG(int h){if(h>0){int g=h;while(g>0){if(na==pZ.PB){na=pZ.parent.ZB(pZ)+1;pZ=pZ.parent;}else if(pZ is OB){na++ ;}else{pZ=pZ.eB(na);na=0;}g-- ;}}else if(h<0){int g=h;while(g<0){if(na==0){na=pZ.parent.ZB(pZ);pZ=pZ.parent;}else if(pZ is OB){na-- ;}else{pZ=pZ.eB(na-1);na=pZ.PB;}g++ ;}}}void zE(){if(pZ.nodeType==n.tC&&na>0&&pZ.eB(na-1).nodeType==n.mB){pZ=pZ.eB(na-1);na=pZ.PB;}else if(pZ.nodeType==n.tC&&na<pZ.PB&&pZ.eB(na).nodeType==n.mB){pZ=pZ.eB(na);na=0;}else if(na==0&&pZ.firstChild!=null&&pZ.firstChild.nodeType==n.mB){pZ=pZ.firstChild;}}GD jF(){if(pZ.nodeType==n.mB){Element o=pZ.dD();if(o==null||o.nodes.length==0)return (null);assert(o.nodes.first is Text);Text h=o.nodes.first;int i=na;String k=h.text;assert(k.length!=0);Range j=new Range();GD v;if(i==0){j.setStart(h,i);j.setEnd(h,k.length);Rectangle g=j.getClientRects().first;v=new GD(g.left,g.top);}else if(k[i-1]=='\n'||k[i-1]==' '){if(i==k.length){if(pZ.nextSibling!=null&&pZ.nextSibling.nodeType==n.tC&&(k[i-1]=='\n'||!pZ.nextSibling.eC)){Rectangle g=(pZ.nextSibling.oB()).getClientRects()[0];v=new GD(g.left,g.top);}else if(k[i-1]==' '){j.setStart(h,0);j.setEnd(h,i);Rectangle g=j.getClientRects().last;v=new GD(g.right,g.top);}else{SpanElement BB=new SpanElement();BB.appendText("|");if(h.nextNode==null)o.append(BB);else o.insertBefore(BB,h.nextNode);Rectangle g=BB.getClientRects()[0];v=new GD(g.left,g.top);BB.remove();}}else{j.setStart(h,i);j.setEnd(h,i+1);List<Rectangle> m=j.getClientRects();Rectangle g;if(k[i-1]==' '&&i<k.length&&k[i]=='\n'){if(window.navigator.appVersion.contains("Trident")){j.setStart(h,i-1);j.setEnd(h,i);m=j.getClientRects();g=m.first;g=new Rectangle(g.left+7,g.top,g.width,g.height);}else g=m.first;}else if(k[i]=='\n'&&m.length==3)g=m[1];else if((window.navigator.userAgent.toLowerCase().indexOf('msie')>=0||window.navigator.appVersion.contains("Trident"))&&k[i-1]=='\n'&&k[i]=='\n'&&m.length==2)g=m.first;else{g=m.last;for(Rectangle QB in m)if(QB.width>1){g=QB;break;}}v=new GD(g.left,g.top);}}else{Rectangle g;if(window.navigator.appVersion.contains("Trident")&&i<k.length&&k[i]=='\n'){j.setStart(h,i-1);j.setEnd(h,i);g=j.getClientRects().first;}else{j.setStart(h,0);j.setEnd(h,i);g=j.getClientRects().last;}v=new GD(g.right,g.top);}return (v);}else{List<n> s=pZ.childNodes;if(s!=null&&na>0&&na==s.length){Element h=s[na-1].oB();if(h==null)return (null);Rectangle g;if(h is ImageElement||h is TableRowElement){g=h.getBoundingClientRect();return (new GD(g.right,g.top));}else if(h is DivElement||h is TableElement||h is UListElement||h is LIElement){g=h.getBoundingClientRect();return (new GD(g.left,g.bottom));}else{List<Rectangle> m=h.getClientRects();if(m.length==0)return (null);Rectangle g=m.last;return (new GD(g.right,g.top));}}else if(s!=null&&na<s.length){Element o=s[na].oB();if(o==null)return (null);if(na>0){n KB=s[na-1];n SB=s[na];Element cB=KB.oB();Element hB=o;if(KB.eC&&!SB.eC){List<Rectangle> BC=hB.getClientRects();if(BC.length==0)return (null);Rectangle EB=BC.first;return (new GD(EB.left,EB.top));}else if(KB.eC&&SB.eC){Rectangle HB=cB.getBoundingClientRect();Rectangle EB=hB.getBoundingClientRect();return (new GD(EB.left,(HB.bottom+EB.top)/2));}else{List<Rectangle> IC=cB.getClientRects();if(IC.length==0)return (null);Rectangle HB=IC.last;return (new GD(HB.right,HB.top));}}if(s[na] is xD){Rectangle g=o.getClientRects()[0];return (new GD(g.left-21,g.top+2));}Rectangle g=o.getClientRects()[0];return (new GD(g.left,g.top));}else{assert(na==0);Element o=pZ.dD();if(o==null)return (null);List<Rectangle> m=o.getClientRects();if(m.length==0)return (null);Rectangle g=m[0];return (new GD(g.left,g.top));}}}String LI({bool titles: false}){String i="";n g=pZ;while(g!=null){String k="";if(g.parent!=null){int m=1;for(n h=g.parent.firstChild;h!=null;h=h.nextSibling){if(h==g)break;if(h.nodeType==n.tC&&h.nodeName==g.nodeName)m++ ;}k="[${m}]";}if(g.nodeType==n.tC){String j;if(titles&&t.CB!=null&&g.DB!=null)j=t.CB.OD(g.DB);else j=g.nodeName;i="${j}${k}/${i}";}else if(g.nodeType==n.mB)i="#text";g=g.parent;}return ("/${i}");}String toString(){return ("[NodeOffsetPosition ${pZ.nodeName} ${na}]");}}class MT{void show(){DivElement k=new DivElement();k.id='dlg1';k.classes.add('dlg1');DivElement s=new DivElement();s.classes.add('dlg2');DivElement h=new DivElement();h.classes.add('dlg3');DivElement g=new DivElement();g.classes.add('dlgtitle');g.text=LB.NB('validation.validation');h.append(g);List<n> EB=DS(t.sC);if(EB.length==0){h.appendText(LB.NB('validation.no_error'));}else{DivElement i=new DivElement();i.style.maxHeight='30em';i.style.overflow='auto';i.appendText(LB.NB('validation.errors'));UListElement HB=new UListElement();for(n m in EB){LIElement o=new LIElement();String g;if(m.DB!=null)g=t.CB.OD(m.DB);else g=null;q KB=new q(m,0);String v;if(g!=null)v="${g} ${KB.LI()}";else v=KB.LI();o.appendText(v);o.onClick.listen((MouseEvent QB)=>select(m));o.style.cursor='default';HB.append(o);}i.append(HB);h.append(i);}DivElement BB=new DivElement();BB.classes.add('buttons');ButtonElement j=new ButtonElement();j.attributes['type']='submit';j.appendText(LB.NB("button.Close"));j.onClick.listen((MouseEvent QB)=>close());BB.append(j);h.append(BB);s.append(h);k.append(s);document.body.append(k);j.focus();}List<n> DS(n g){List<n> h=new List<n>();if(g.nodeType==n.tC&&g is!pF){if(g.parent is jE){bool j=t.CB.GI(g.parent.DB,g.DB);if(j&&g.firstChild==null){h.add(g);return (h);}else if(!j&&g.firstChild==null&&(g.attributes==null||g.attributes.length==0)){return (h);}}if(!t.CB.hO(g))h.add(g);}for(n i=g.firstChild;i!=null;i=i.nextSibling)h.addAll(DS(i));return (h);}void select(n g){DivElement h=document.getElementById('dlg1');h.remove();IB.selectNode(g);}void close(){DivElement g=document.getElementById('dlg1');g.remove();IB.AH();}}ND RL=new ND();class lP{void update(n k,List<l> BB,List<l> EB){Element h=document.getElementById('insert');for(Element HB in h.children)HB.remove();HH j=t.CB;if(j==null)return;if(k.nodeType==n.tC&&k.DB!=null){h.append(oa(k.DB));String m=j.cD(k.DB);SpanElement v=new SpanElement();v.appendText(j.BI(m));h.append(v);h.append(new HRElement());}List<l> o;if(IB.toolbar!=null)o=IB.toolbar.dR();else o=null;for(l i in BB){if(o!=null&&o.contains(i))continue;if(t.ZC!=null&&t.ZC.contains(i))continue;h.append(oa(i));ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('insertb');String m=j.cD(i);g.value=m;g.text=j.BI(m);if(!EB.contains(i))g.disabled=true;g.onClick.listen((Event s)=>insert(i));g.onKeyDown.listen((KeyboardEvent s){int KB=s.keyCode;if(KB==KeyCode.ENTER){s.preventDefault();insert(i);}});h.append(g);h.append(new BRElement());}}ButtonElement oa(l h){ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('help');g.value='?';g.text='?';String i=t.CB.uH(h);if(i!=null)g.title=i;g.onClick.listen((Event j)=>tO(h));return (g);}void insert(l g){t.AI(g,'element');}void tO(l g){WG h=new WG.SX(g);h.show();}}class WF extends lG{XB oI;String title;JT update;WF(this.oI,this.update,NI g){title=oI.title;oI.parent=g;}Element html(){DivElement g=new DivElement();g.classes.add('toolbar-menu');g.append(IB.iG.cO(oI));return (g);}}class MC{static int mP=0;String XZ;String wK;FD action;KT update;Object data;String id;bool enabled;bool selected;StreamSubscription<MouseEvent> listener;String shortcut;int iconWidth;int iconHeight;MC(this.XZ,this.wK,this.action,this.update,{this.data,this.enabled: true,this.shortcut,this.iconWidth: 16,this.iconHeight: 16}){selected=false;id="button_${mP}";mP++ ;}Element html(){DivElement g=new DivElement();g.id=id;g.classes.add('toolbar-button');if(!enabled)g.classes.add('button-disabled');else g.setAttribute('tabindex','0');if(selected)g.classes.add('button-selected');g.setAttribute('title',XZ);ImageElement h=new ImageElement();h.src=wK;h.width=iconWidth;h.height=iconHeight;if(enabled)listener=g.onClick.listen((MouseEvent i)=>action());g.append(h);g.onKeyDown.listen((KeyboardEvent i){int j=i.keyCode;if(j==KeyCode.ENTER){i.preventDefault();action();}});return (g);}String get title{return (XZ);}void set title(String g){XZ=g;Element h=oB();h.setAttribute('title',XZ);}Element oB(){return (querySelector("#${id}"));}void disable(){if(!enabled)return;enabled=false;Element g=oB();g.classes.add('button-disabled');listener.cancel();g.setAttribute('tabindex','-1');}void enable(){if(enabled)return;enabled=true;Element g=oB();g.classes.remove('button-disabled');listener=g.onClick.listen((MouseEvent h)=>action());g.setAttribute('tabindex','0');}void select(){if(selected)return;selected=true;Element g=oB();g.classes.add('button-selected');}void xE(){if(!selected)return;selected=false;Element g=oB();g.classes.remove('button-selected');}}class ND{HashMap<String,lJ> VR=new HashMap<String,lJ>();HashMap<String,kJ> UR=new HashMap<String,kJ>();static void YT(){hC('anchor',(l i)=>new oG.EY(i),(AB g,n h)=>new oG.hY(g,h));hC('area',(l i)=>new BJ.TY(i),(AB g,n h)=>new BJ.iY(g,h));hC('br',(l i)=>new ZL.BY(i),(AB g,n h)=>new ZL.PY(g,h));hC('champ',(l i)=>new vI.FY(i),(AB g,n h)=>new vI.gY(g,h));hC('division',(l i)=>new bL.WY(i),(AB g,n h)=>new bL.kY(g,h));hC('empty',(l i)=>new xI.DY(i),(AB g,n h)=>new xI.XY(g,h));hC('equationmem',(l i)=>new CJ.oY(i),(AB g,n h)=>new CJ.tY(g,h));hC('equatexmem',(l i)=>new DJ.uY(i),(AB g,n h)=>new DJ.yY(g,h));hC('field',(l i)=>new vI.FY(i),(AB g,n h)=>new vI.gY(g,h));hC('hr',(l i)=>new YL.yX(i),(AB g,n h)=>new YL.GY(g,h));hC('item',(l i)=>new JH.AY(i),(AB g,n h)=>new JH.MY(g,h));hC('list',(l i)=>new TI.HY(i),(AB g,n h)=>new TI.mY(g,h));hC('liste',(l i)=>new TI.HY(i),(AB g,n h)=>new TI.mY(g,h));hC('fichier',(l i)=>new hH.fY(i),(AB g,n h)=>new hH.pY(g,h));hC('file',(l i)=>new hH.fY(i),(AB g,n h)=>new hH.pY(g,h));hC('form',(l i)=>new jE.cY(i),(AB g,n h)=>new jE.rY(g,h));hC('formulaire',(l i)=>new jE.cY(i),(AB g,n h)=>new jE.rY(g,h));hC('hiddendiv',(l i)=>new wI.CY(i),(AB g,n h)=>new wI.aY(g,h));hC('hiddenp',(l i)=>new kB.UY(i),(AB g,n h)=>new kB.jY(g,h));hC('simpletype',(l i)=>new AJ.QY(i),(AB g,n h)=>new AJ.bY(g,h));hC('string',(l i)=>new zI.JY(i),(AB g,n h)=>new zI.dY(g,h));hC('style',(l i)=>new yB.qY(i),(AB g,n h)=>new yB.sY(g,h));hC('stylespan',(l i)=>new YE.LY(i),(AB g,n h)=>new YE.eY(g,h));hC('symbol2',(l i)=>new yI.KY(i),(AB g,n h)=>new yI.YY(g,h));hC('symbole2',(l i)=>new yI.KY(i),(AB g,n h)=>new yI.YY(g,h));hC('table',(l i)=>new aG.vY(i),(AB g,n h)=>new aG.xY(g,h));hC('texttable',(l i)=>new aG.vY(i),(AB g,n h)=>new aG.xY(g,h));hC('tabletexte',(l i)=>new aG.vY(i),(AB g,n h)=>new aG.xY(g,h));hC('text',null,(AB g,n h)=>new OB.xX(g,h));hC('texte',null,(AB g,n h)=>new OB.xX(g,h));hC('typesimple',(l i)=>new AJ.QY(i),(AB g,n h)=>new AJ.bY(g,h));hC('vide',(l i)=>new xI.DY(i),(AB g,n h)=>new xI.XY(g,h));hC('zone',(l i)=>new BJ.TY(i),(AB g,n h)=>new BJ.iY(g,h));hC('witem',(l i)=>new xD.zX(i),(AB g,n h)=>new xD.IY(g,h));hC('wlist',(l i)=>new iC.SY(i),(AB g,n h)=>new iC.nY(g,h));}static void hC(String g,lJ h,kJ i){if(h!=null)RL.VR[g]=h;if(i!=null)RL.UR[g]=i;}static n dH(AB g,n h){l j;if(g is sB){return (new nG.RY(g));}else if(g is oL){return (new AG.OY(g,h));}else if(g is nL){return (new IH.VY(g,h));}else if(g is pL){return (new pF.NY(g,h));}if(g is l){j=t.CB.TM(g,h!=null?h.DB:null);}else{j=null;}String m=t.CB.QS(j,g.nodeName,g.nodeType);kJ o=RL.UR[m];n i;if(o!=null)i=o(g,h);else if(m=='plugin'){String k=t.CB.JP(j,'element',g.nodeName,"classe",null);if(k=='xpages.JEEquationMemoire')i=new CJ.tY(g,h);else if(k=='xpages.JEEquaTeXMemoire')i=new DJ.yY(g,h);else if(k=='xpages.jeimage.JEImage')i=new hH.pY(g,h);}else i=new zI.dY(g,h);return (i);}static n NF(l g,[String i='element']){if(i=='commentaire'){return (new AG());}else if(i=='instruction'){return (new IH());}else if(i=='cdata'){return (new pF());}String k=t.CB.QS(g,t.CB.cD(g),AB.FE);lJ m=RL.VR[k];n h;if(m!=null)h=m(g);else if(k=='plugin'){String j=t.CB.JP(g,'element',t.CB.cD(g),"classe",null);if(j=='xpages.JEEquationMemoire')h=new CJ.oY(g);else if(j=='xpages.JEEquaTeXMemoire')h=new DJ.uY(g);else if(j=='xpages.jeimage.JEImage')h=new hH.fY(g);}else h=new zI.JY(g);return (h);}}typedef void FD();yM IB;PL t;Map<String,FD> nP=new Map<String,FD>();class GD{num x;num y;GD(num this.x,num this.y);}void SL(String g,lJ h,kJ i){ND.hC(g,h,i);}class EN{String pa;String qa;String ra;AQ sa;oD ta;EN(String g,{String labelName,String labelValue,AQ okfct}){pa=g;qa=labelName;ra=labelValue;sa=okfct;}void show(){DivElement h=new DivElement();h.id='dlg1';h.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement BB=new DivElement();BB.classes.add('dlg3');FormElement i=new FormElement();CanvasElement j=new CanvasElement(width:500,height:300);j.id='eqcanvas';lB QB=new lB(pa);ta=new oD(element:QB.uK(),context:j.context2D);ta.GC(j.context2D);i.append(j);TextAreaElement g=new TextAreaElement();g.id='eqtext';g.value=pa;g.style.width='100%';g.style.height='4em';g.attributes['spellcheck']='false';g.onInput.listen((Event EB)=>LF());i.append(g);if(qa!=null){DivElement k=new DivElement();SpanElement KB=new SpanElement();KB.text=qa;k.append(KB);k.appendText(' ');TextInputElement HB=new TextInputElement();HB.id='eqlabel';if(ra!=null)HB.value=ra;k.append(HB);i.append(k);}DivElement m=new DivElement();m.classes.add('buttons');ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.NB("button.Cancel"));o.onClick.listen((MouseEvent EB)=>h.remove());m.append(o);ButtonElement s=new ButtonElement();s.attributes['type']='submit';s.appendText(LB.NB("button.OK"));s.onClick.listen((MouseEvent EB)=>iF(EB));m.append(s);i.append(m);BB.append(i);v.append(BB);h.append(v);document.body.append(h);g.focus();}void iF(MouseEvent g){TextAreaElement h=querySelector('textarea#eqtext');pa=h.value;if(qa!=null){TextInputElement i=querySelector('input#eqlabel');ra=i.value;}querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(sa!=null)sa();}String fB(){return (pa);}String getData(){if(pa=='')return (null);CanvasElement g=new CanvasElement(width:ta.dB(),height:ta.OC());lB h=new lB(pa);oD i=new oD(element:h.uK(),context:g.context2D);i.GC(g.context2D);String j=g.toDataUrl('image/png');String k=j.substring('data:image/png;base64,'.length);return (k);}String kR(){return (ra);}void LF(){TextAreaElement g=querySelector('textarea#eqtext');pa=g.value;if(pa.length>0&&pa.contains('\n')){g.value=pa.replaceAll('\n','');iF(null);return;}CanvasElement h=querySelector('canvas#eqcanvas');lB i=new lB(pa);ta.aS(i.uK());ta.GC(h.context2D);}}class YC extends WB{YC():super();}class qJ extends WB{qJ():super();void GC(final CanvasRenderingContext2D o,final double QB,final double s){int g,h;final List<double> v=new List<double>(PC());final List<double> EB=new List<double>(PC());for(g=0;g<PC();g++ ){v[g]=qR(g);EB[g]=rR(g);}final int BB=oR();final List<double> m=new List<double>(BB);for(g=0;g<BB;g++ )m[g]=pR(g);final double HB=QB;final double SB=-OC(true)/2+v[0]-rD();double j=HB;double k=SB;for(g=0;g<PC();g++ ){final WB KB=MB(g);j=HB;for(h=0;(h<BB)&&(h<KB.PC());h++ ){final OI i=KB.MB(h) as OI;if(i.hR()=="left")i.GC(o,j+1,s+k);else if(i.hR()=="right")i.GC(o,j+m[h]-i.dB(true),s+k);else i.GC(o,j+m[h]/2-i.dB(true)/2,s+k);j+= m[h];}k+= EB[g];if(g<PC()-1)k+= v[g+1];}}double qR(final int i){if(i>=PC())return 0.0;final WB j=MB(i);double g=0.0;for(int h=0;h<j.PC();h++ )g=max(g,j.MB(h).rB(true));return g;}double rR(final int i){if(i>=PC())return 0.0;final WB j=MB(i);double g=0.0;for(int h=0;h<j.PC();h++ )g=max(g,j.MB(h).xB(true));return g;}double pR(final int i){double g=0.0;for(int h=0;h<PC();h++ ){final WB j=MB(h);if(i<j.PC())g=max(g,j.MB(i).dB(true));}return g+2;}int oR(){int g=0;for(int h=0;h<PC();h++ ){final WB i=MB(h);g=max(g,i.PC());}return g;}double dB(final bool j){double h=0.0;final int i=oR();for(int g=0;g<i;g++ )h+= pR(g);return h;}double OC(final bool i){double h=0.0;for(int g=0;g<PC();g++ )h+= qR(g)+rR(g);return h;}double rB(final bool g){return OC(true)/2+rD();}double xB(final bool g){return OC(true)/2-rD();}}class OI extends WB{String ua="center";OI():super();void dW(final String g){ua=g;}String hR(){return ua;}}class rP extends WB{rP():super();void GC(final CanvasRenderingContext2D h,final double i,final double j){if(TJ().XM())debug(h,i,j);final double m=va();double k=i;for(int g=0;g<PC();g++ ){MB(g).GC(h,k,j);k+= m;}}double va(){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).dB(true));return g;}double dB(final bool g){return va()*PC();}double OC(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).OC(i));return g;}double rB(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).rB(i));return g;}double xB(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).xB(i));return g;}}class ZG extends WB{ZG():super();void GC(final CanvasRenderingContext2D g,final double h,final double i){g.font=zC();g.fillText(fB(),h,i);}double dB(final bool g){return II(fB().replaceAll(' ','A'));}double OC(final bool g){return AD().mE+AD().tH;}double uR(){wD g=nV(fB());return (g.actualBoundingBoxAscent);}double rB(final bool g){return AD().mE;}double xB(final bool g){return AD().tH;}}class sP extends WB{sP():super();void RB(final WB g){super.RB(g);if(g!=null){if(PC()==2)g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);}void GC(final CanvasRenderingContext2D g,final double h,final double i){if(PC()<2)return;final WB m=MB(0);final WB o=MB(1);final double BB=dB(true);final double EB=m.dB(true);final double k=8.0;final double j=o.dB(true);final double HB=o.OC(true);final double s=m.rB(true);final double v=m.xB(true);g.beginPath();g.moveTo(h,i);g.lineTo(h+j,i);g.moveTo(h+j,i);g.lineTo(h+k/2+j,i+v);g.moveTo(h+j-1,i);g.lineTo(h+k/2+j,i+v);g.moveTo(h+k/2+j,i+v);g.lineTo(h+k+j,i-(s+2));g.moveTo(h+k+j,i-(s+2));g.lineTo(h+BB,i-(s+2));g.stroke();m.GC(g,h+k+j,i);o.GC(g,h,i-o.xB(true));}double dB(final bool g){if(PC()<2)return 0.0;return MB(0).dB(g)+8+MB(1).dB(g);}double OC(final bool g){if(PC()<2)return 0.0;return xB(true)+max(MB(0).rB(true)+4,MB(1).OC(true));}double rB(final bool g){if(PC()<2)return 0.0;return max(MB(0).rB(true)+4,MB(1).OC(true));}double xB(final bool g){if(PC()<2)return 0.0;return MB(0).xB(true);}}class tP extends ZG{}class uP extends WB{uP():super();void GC(final CanvasRenderingContext2D g,final double h,final double i){final double BB=dB(true);final double EB=nR();final double j=8.0;final double k=lR(true);final double m=mR(true);g.beginPath();g.moveTo(h,i);g.lineTo(h+3,i-1);g.moveTo(h+3,i);g.lineTo(h+j/2+1,i+m);g.moveTo(h+2,i-1);g.lineTo(h+j/2+1,i+m);g.moveTo(h+j/2+1,i+m);g.lineTo(h+j+3,i-(k+1));g.moveTo(h+j+3,i-(k+1));g.lineTo(h+BB,i-(k+1));g.stroke();double v=h+j+3;WB o;for(int s=0;s<PC();s++ ){o=MB(s);o.GC(g,v,i);v+= o.dB(true);}}double nR(){double h=0.0;for(int g=0;g<PC();g++ )h+= MB(g).dB(true);return h;}double dB(final bool g){return nR()+8+3;}double eV(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).OC(true));return g;}double OC(final bool g){return eV(true)+4;}double lR(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).rB(true));return g;}double rB(final bool g){return lR(true)+2;}double mR(final bool i){double g=0.0;for(int h=0;h<PC();h++ )g=max(g,MB(h).xB(true));return g;}double xB(final bool g){return mR(true)+2;}}class nB extends WB{bool wa=true;double xa=0.0;double ya=0.0;nB():super();void ZJ(final bool g){this.wa=g;}void eW(final double g){this.xa=g;}void gW(final double g){this.ya=g;}void zK(final CanvasRenderingContext2D g,final double h,final double i,final String EB,final String HB,final String KB){g.font=zC();final double j=wH();final double k=iR();wD m=new wD(EB,zC());wD o=new wD(HB,zC());wD s=new wD(KB,zC());double v=m.actualBoundingBoxAscent+m.actualBoundingBoxDescent;double SB=m.actualBoundingBoxAscent;double cB=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;double hB=o.actualBoundingBoxAscent;double BB=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;double BC=s.actualBoundingBoxAscent;if(j-v-BB>0){final double IC=j-v-BB+2;double QB=IC/cB;g.save();g.scale(1,QB);g.fillText(HB,h,(i-k+v)/QB+hB);g.restore();}g.fillText(EB,h,i-k+SB);g.fillText(KB,h,i+j-k-(BB-BC).round());}void RS(final CanvasRenderingContext2D g,final double h,final double i,final String v,final String BB,final String m,final String EB){final double HB=wH();g.fillStyle='black';g.font=zC();wD s=new wD(m,zC());final double j=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;final int o=((HB/j)/2).floor();for(int k=1;k<o;k++ ){g.fillText(m,h,i-j*k);g.fillText(m,h,i+j*k);}g.fillText(BB,h,i);g.fillText(v,h,i-j*o);g.fillText(EB,h,i+j*o);}void SS(final CanvasRenderingContext2D g,final double h,final double i,final String s,final String v,final String o,final String BB){final double EB=getParent().dB(true);final double HB=i-rD();g.save();g.fillStyle='black';g.font=zC();g.translate(h,i);g.rotate(PI/2.0);g.translate(-h,-HB);final double j=AD().mE-1;int KB=(EB/j).floor();final int m=KB~/2;for(int k=1;k<m;k++ ){g.fillText(o,h,i-j*k);g.fillText(o,h,i+j*k);}g.fillText(v,h,i);g.fillText(s,h,i-j*m);g.fillText(BB,h,i+j*m);g.restore();}void GC(final CanvasRenderingContext2D g,double h,final double i){if(xa!=0){final double s=II('A');h+= xa*s;}if(fB().length==1&&"[{(|)}]\u222B".indexOf(fB()[0])>=0&&wa){final double m=getParent().rB(false);final double o=getParent().xB(false);final double j=m+o-1;if(fB()=="("){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else zK(g,h,i,'\u239B','\u239C','\u239D');}else if(fB()==")"){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else zK(g,h,i,'\u239E','\u239F','\u23A0');}else if(fB()=="["){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else zK(g,h,i,'\u23A1','\u23A2','\u23A3');}else if(fB()=="]"){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else zK(g,h,i,'\u23A4','\u23A5','\u23A6');}else if(fB()=="{"){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else RS(g,h,i,'\u23A7','\u23A8','\u23AA','\u23A9');}else if(fB()=="}"){if(j<AD().height){g.font=zC();g.fillText(fB(),h,i);}else RS(g,h,i,'\u23AB','\u23AC','\u23AA','\u23AD');}else if(fB()=="|"){g.beginPath();g.moveTo(h+2,i-m);g.lineTo(h+2,i+o);g.stroke();}else if(fB()=="\u222B"){zK(g,h,i,'\u2320','\u23AE','\u2321');}}else if(fB().length==1&&"\uFE37\uFE38".indexOf(fB()[0])>=0){if(fB()=="\uFE37")SS(g,h,i,'\u23A7','\u23A8','\u23AA','\u23A9');else if(fB()=="\uFE38")SS(g,h,i,'\u23AB','\u23AC','\u23AA','\u23AD');}else if(fB().length==1&&"\u2211\u220F".indexOf(fB()[0])>=0&&wa){g.strokeStyle='black';g.fillStyle='black';if(wH()>AD().height){final String v=TJ().zC(HD()*2);g.font=v;}else g.font=zC();if("\u2211".indexOf(fB()[0])>=0)g.fillText("\u2211",h,i);else g.fillText("\u220F",h,i);g.font=zC();}else if(fB()=="\u00AF"&&wa){final double k=getParent().dB(false)-2;g.beginPath();g.moveTo(h,i);g.lineTo(h+k,i);g.stroke();}else if(fB()=="^"&&wa){final double k=getParent().dB(false)-3;g.beginPath();g.moveTo(h,i);g.lineTo(h+k/2,i-3);g.moveTo(h+k/2,i-3);g.lineTo(h+k,i);g.stroke();}else if(fB()=="."||fB()==".."||fB()=="..."){g.font=zC();g.fillText(fB(),h+1,i);}else{g.font=zC();g.fillText(fB(),h,i);}}WB pO(){if(fB()=="\u222B"||"\u2211\u220F".contains(fB())){YC k;if(getParent() is YC)k=getParent() as YC;else k=getParent().getParent() as YC;final WB h=k.MB(1);if(!(h is YC&&h.PC()>0))return (h);final WB i=h.MB(0);if(!(i is YC&&i.PC()>0))return (h);final WB g=i.MB(0);if(!(g is RI||g is sJ||g is oF||g is nB))return (h);WB j;if(g is RI||g is sJ||g is oF)j=g.MB(0);else j=g;if(!(j.fB()=="\u222B"||"\u2211\u220F".contains(j.fB())))return (h);return (i.MB(1));}else return (getParent());}double wH(){return (pO().OC(false));}double iR(){return (pO().rB(false));}double cV(){return (pO().xB(false));}double dB(final bool k){double g=0.0;if(xa!=0||ya!=0){final double j=II('A');final double m=xa*j;final double o=ya*j;g=m+o;}if(fB().length==1){final String h=fB()[0];if("|".indexOf(h)>=0)return 5+g;else if("\uFE37\uFE38".indexOf(h)>=0)return 1+g;else if("\u222B".indexOf(h)>=0){wD i=new wD(fB(),TJ().zC(HD()*2));return i.width+g;}else if("\u2211\u220F".indexOf(h)>=0){if(wH()>AD().height){wD i=new wD(fB(),TJ().zC(HD()*2));return i.width+g;}else return II(fB()).round()+g;}else if("^\u00AF".indexOf(h)>=0&&wa&&k)return getParent().dB(false)-2;}return II(fB()).round()+g;}double OC(final bool g){return rB(g)+xB(g);}double rB(final bool i){if(fB().length==1&&"[()]\u222B".indexOf(fB()[0])>=0){if(!i||!wa)return AD().mE;return (iR()+1);}else if(fB().length==1&&"{}".indexOf(fB()[0])>=0){if(!i||!wa)return AD().mE;final double g=AD().mE;final int h=(wH()/g).floor()+1;if("{}".indexOf(fB()[0])>=0)if(h%2==0)return (h+1)*g*0.5+rD();return h*g*0.5+rD();}else if(fB().length==1&&"\u2211\u220F".indexOf(fB()[0])>=0&&wa){if(wH()>AD().height)return TJ().AD(HD()*2).mE;else return AD().mE;}else if(fB().length==1&&"\uFE37\uFE38".indexOf(fB()[0])>=0)return 0.0;else if(fB()=="\u00AF"&&wa)return (3.0);else if(fB()=="\u223C"&&wa)return ((AD().mE~/2).toDouble());else if(fB()=="."||fB()==".."||fB()=="...")return ((AD().mE~/2).toDouble());else return AD().mE;}double xB(final bool i){if(fB().length==1&&"[()]\u222B".indexOf(fB()[0])>=0){if(!i||!wa)return AD().tH;return (cV()+1);}else if(fB().length==1&&"{}".indexOf(fB()[0])>=0){if(!i||!wa)return AD().tH;final double g=AD().mE;final int h=(wH()/g).floor()+1;if("{}".indexOf(fB()[0])>=0)if(h%2==0)return (h+1)*g*0.5-rD();return h*g*0.5-rD();}else if(fB().length==1&&"\u2211\u220F".indexOf(fB()[0])>=0&&wa){if(wH()>AD().height)return TJ().AD(HD()*2).tH;else return AD().tH;}else if(fB().length==1&&"\uFE37\uFE38".indexOf(fB()[0])>=0)return II("}");else return AD().tH;}}class eH extends WB{static final int lT=0;static final int WL=1;int za=lT;bool Ab=false;eH():super();int hV(){return za;}void XP(final bool g){this.Ab=g;}bool XM(){return Ab;}void KW(final CanvasRenderingContext2D g){if(Ab){g.strokeStyle='blue';g.beginPath();g.moveTo(0,0);g.lineTo(SJ()-1,0);g.moveTo(SJ()-1,0);g.lineTo(SJ()-1,lI()-1);g.moveTo(0,0);g.lineTo(0,lI()-1);g.moveTo(0,lI()-1);g.lineTo(SJ()-1,lI()-1);g.stroke();g.strokeStyle='cyan';g.moveTo(0,lI()/2);g.lineTo(SJ()-1,lI()/2);g.stroke();g.strokeStyle='black';}if(MB(0)!=null){final double i=MB(0).rB(true)-rD();final double h=MB(0).xB(true)+rD();if(i>=h)GC(g,0.0,rB(true));else GC(g,0.0,h+rD());}}int SJ(){return dB(true).ceil();}int lI(){return OC(true).ceil();}void GC(final CanvasRenderingContext2D g,final double h,final double i){if(MB(0)!=null)MB(0).GC(g,h,i);}double dB(final bool g){if(MB(0)==null)return 0.0;return MB(0).dB(true)+1;}double OC(final bool i){if(MB(0)==null)return 0.0;if(za==WL)return MB(0).OC(true)+2;final double g=MB(0).rB(true)-rD();final double h=MB(0).xB(true)+rD();return max(g,h)*2;}double rB(final bool g){if(MB(0)==null)return 0.0;if(za==WL)return MB(0).rB(true);return max(MB(0).rB(true),MB(0).xB(true));}double xB(final bool g){if(MB(0)==null)return 0.0;if(za==WL)return MB(0).xB(true);return max(MB(0).rB(true),MB(0).xB(true));}}class oF extends WB{bool Bb=false;oF():super();void RB(final WB g){super.RB(g);if(g!=null){if(PC()==2&&!Bb)g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null&&!Bb)MB(1).WC(HD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final WB g=MB(0);final WB h=MB(1);final double m=dB(true);g.GC(i,j+(m-g.dB(true))/2,k);if(Bb){double o;if(g is ZG||g is QI)o=g.uR()+3;else o=g.rB(true);h.GC(i,j+(m-h.dB(true))/2,k-o);}else h.GC(i,j+(m-h.dB(true))/2,k-(g.rB(true)+h.xB(true)));}double dB(final bool g){return max(MB(0).dB(g),MB(1).dB(g));}double OC(final bool g){if(Bb)return MB(0).OC(g)+MB(1).rB(g)+1;else return MB(0).OC(g)+MB(1).OC(g);}double rB(final bool g){if(Bb)return MB(0).rB(true)+MB(1).rB(true);else return MB(0).rB(true)+MB(1).OC(true);}double xB(final bool g){return MB(0).xB(true);}void WP(final bool g){this.Bb=g;}}class rJ extends WB{int Cb=1;rJ():super();void GC(final CanvasRenderingContext2D g,final double h,final double s){final WB j=MB(0);final WB k=MB(1);final double m=s-rD();final double o=dB(true);j.GC(g,h+(o-j.dB(true))/2,m-j.xB(true)-1);g.lineWidth=Cb;g.beginPath();double i=m-Cb/2;if(Cb==1)i=i.floorToDouble()+0.5;g.moveTo(h+1,i);g.lineTo(h+o-1,i);g.stroke();g.lineWidth=1;k.GC(g,h+(o-k.dB(true))/2,m+k.rB(true)+1);}double dB(final bool g){return max(MB(0).dB(g),MB(1).dB(g))+4;}double OC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return MB(0).OC(true)+1+Cb/2+rD();}double xB(final bool g){return max(0,MB(1).OC(true)+1+Cb/2-rD());}}class sJ extends WB{sJ():super();void RB(final WB g){super.RB(g);if(g!=null){if(PC()==2)g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final WB g=MB(0);final WB h=MB(1);final double m=dB(true);g.GC(i,j+(m-g.dB(true))/2,k);h.GC(i,j+(m-h.dB(true))/2,k+g.xB(true)+h.rB(true));}double dB(final bool g){return max(MB(0).dB(g),MB(1).dB(g));}double OC(final bool g){return MB(0).OC(g)+MB(1).OC(g);}double rB(final bool g){return MB(0).rB(true);}double xB(final bool g){return MB(0).xB(true)+MB(1).OC(true);}}class QI extends ZG{String Db="italic";void ZS(final String g){this.Db=g;}void GC(final CanvasRenderingContext2D h,final double i,final double j){final String k=fB();String g;if(Db=='italic')g=dV();else if(Db=='bold')g=XV();else if(Db=='bold-italic')g=YV();else g=zC();h.font=g;h.fillText(k,i,j);}String zC(){if(base!=null)return base.zC(BH,oD.JN);return null;}}class VL extends WB{VL():super();void RB(final WB g){super.RB(g);if(g!=null){if(PC()==2)g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);}void GC(final CanvasRenderingContext2D g,final double h,final double i){final WB j=MB(0);final WB k=MB(1);j.GC(g,h,i);k.GC(g,h+j.dB(true),i+k.rB(true)-rD());}double dB(final bool g){return MB(0).dB(g)+MB(1).dB(g);}double OC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return MB(0).rB(true);}double xB(final bool g){return max(MB(0).xB(true),MB(1).OC(true)-rD());}}class UL extends WB{UL():super();void RB(final WB g){super.RB(g);if(g!=null){if(PC()==2)g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final WB g=MB(0);final WB h=MB(1);g.GC(i,j,k);h.GC(i,j+g.dB(true),k-max(h.xB(true)+rD(),g.rB(true)-h.xB(true)));}double dB(final bool g){return MB(0).dB(g)+MB(1).dB(g);}double OC(final bool g){return rB(true)+xB(true);}double rB(final bool i){final WB h=MB(0);final WB g=MB(1);return (g.rB(true)+max(g.xB(true)+rD(),h.rB(true)-g.xB(true)));}double xB(final bool g){return MB(0).xB(true);}}class oD{static String vP='STIXSubset-Regular';static String wP='STIXSubset-Italic';static String IN='STIXSubset-Bold';static bool xP=false;static const int kT=0;static const int yP=1;static const int JN=2;static const int zP=3;int Eb;int Fb;final int ZM=8;final int yK=60;List<wD> Gb=null;bool Ab=false;static final int nT=0;final int za=nT;eH Hb;CanvasRenderingContext2D Ib;oD({final eH element,final int inlinefontsize: 15,final int displayfontsize: 16,final CanvasRenderingContext2D context}){this.Eb=inlinefontsize;this.Fb=displayfontsize;if(context!=null)Gb=new List<wD>(yK);if(element!=null)aS(element);if(context!=null)this.Ib=context;}static void CQ(){if(xP)return;CanvasElement h=new CanvasElement(width:10,height:10);CanvasRenderingContext2D g=h.context2D;g.font="15px ${vP}";g.fillText('.',0,0);g.font="15px ${wP}";g.fillText('.',0,0);g.font="15px ${IN}";g.fillText('.',0,0);xP=true;}void aS(final eH g){if(g==null)return;Hb=g;Hb.fM(this);if(g.hV()==eH.WL)Hb.WC(Fb);else Hb.WC(Eb);Hb.XP(XM());}void XP(final bool g){this.Ab=g;if(Hb!=null)Hb.XP(g);}bool XM(){return Ab;}String zC(final int j,[int k=oD.kT]){int i;if(j<ZM)i=ZM;else if(j>yK)i=yK;else i=j;String g,h;if(k==oD.JN){g='';h=wP;}else if(k==oD.yP){g='';h=IN;}else if(k==oD.zP){g='italic';h=IN;}else{g='';h=vP;}return ("${g} ${i}px ${h}");}wD AD(final int h){int g;if(h<ZM)g=ZM;else if(h>yK)g=yK;else g=h;if(Gb[g]==null)Gb[g]=KV(zC(h));return Gb[g];}wD KV(String g){return (new wD('Hg',g));}double II(String g,String h){String i=Ib.font;Ib.font=h;double j=Ib.measureText(g).width;Ib.font=i;return (j);}void GC(final CanvasRenderingContext2D g){g.clearRect(0,0,g.canvas.width,g.canvas.height);if(Hb!=null)Hb.KW(g);}int dB(){if(Hb!=null&&Gb!=null)return Hb.SJ();return 0;}int OC(){if(Hb!=null&&Gb!=null)return Hb.lI();return 0;}}class WB{oD base;WB parent;int BH=14;final List<WB> children=new List<WB>();final StringBuffer text=new StringBuffer();WB([final oD g,final int h]){if(g!=null)fM(g);if(h!=null)WC(h);}void RB(final WB g){if(g!=null){children.add(g);g.fM(base);g.fW(this);g.WC(BH);}}WB MB(final int g){if((g>=0)&&(g<children.length))return children[g];return null;}int PC(){return children.length;}void VC(final String h){for(int g=0;g<h.length;g++ )if(" \t\n\r".indexOf(h[g])<0)this.text.write(h[g]);else if((' '==h[g])&&(g>0)&&(' '!=h[g-1]))this.text.write(h[g]);}String fB(){return text.toString().trim();}void fM(final oD g){this.base=g;for(final WB h in children)h.fM(g);}oD TJ(){return base;}void fW(final WB g){this.parent=g;}WB getParent(){return parent;}void WC(final int g){this.BH=max(g,8);for(final WB h in children)h.WC(this.BH);}int HD(){return BH;}String zC(){if(base!=null)return base.zC(BH);return null;}String dV(){if(base!=null)return base.zC(BH,oD.JN);return null;}String XV(){if(base!=null)return base.zC(BH,oD.yP);return null;}String YV(){if(base!=null)return base.zC(BH,oD.zP);return null;}wD AD(){if(base!=null)return base.AD(BH);return null;}double II(g){return (base.II(g,zC()));}wD nV(String g){return (new wD(g,zC()));}void debug(final CanvasRenderingContext2D g,final double h,final double i){g.strokeStyle='blue';g.beginPath();g.moveTo(h,i-rB(true));g.lineTo(h+dB(true),i-rB(true));g.moveTo(h+dB(true),i-rB(true));g.lineTo(h+dB(true),i+xB(true));g.moveTo(h,i+xB(true));g.lineTo(h+dB(true),i+xB(true));g.moveTo(h,i-rB(true));g.lineTo(h,i+xB(true));g.stroke();g.strokeStyle='red';g.beginPath();g.moveTo(h,i);g.lineTo(h+dB(true),i);g.stroke();g.strokeStyle='black';}void GC(final CanvasRenderingContext2D i,final double j,final double k){if(base.XM())debug(i,j,k);double m=j;WB g;for(int h=0;h<PC();h++ ){g=MB(h);g.GC(i,m,k);m+= g.dB(true)+2;}}double dB(final bool h){double g=0.0;for(final WB i in children)g+= i.dB(h)+2;return g-2;}double OC(final bool g){return rB(g)+xB(g);}double uR(){return rB(true);}double rB(final bool h){double g=0.0;for(final WB i in children)g=max(g,i.rB(h));return g;}double xB(final bool h){double g=0.0;for(final WB i in children)g=max(g,i.xB(h));return g;}double rD(){return base.AD(HD()).mE*0.30;}}class RI extends WB{RI():super();void RB(final WB g){super.RB(g);if(g!=null){if((PC()==2)||(PC()==3))g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);if(MB(2)!=null)MB(2).WC(HD()-2);}void GC(final CanvasRenderingContext2D h,final double i,final double j){final WB g=MB(0);final WB k=MB(1);final WB m=MB(2);final double o=dB(true);g.GC(h,i+(o-g.dB(true))/2,j);k.GC(h,i+(o-k.dB(true))/2,j+g.xB(true)+k.rB(true));m.GC(h,i+(o-m.dB(true))/2,j-(g.rB(true)+m.xB(true)));}double dB(final bool g){return max(MB(0).dB(g),max(MB(1).dB(g),MB(2).dB(g)));}double OC(final bool g){return MB(0).OC(g)+MB(1).OC(g)+MB(2).OC(g);}double rB(final bool g){return MB(0).rB(true)+MB(1).OC(true);}double xB(final bool g){return MB(0).xB(true)+MB(2).OC(true);}}class GN extends WB{GN():super();void RB(final WB g){super.RB(g);if(g!=null){if((PC()==2)||(PC()==3))g.WC(HD()-2);else g.WC(HD());}}void WC(final int g){super.WC(g);if(MB(1)!=null)MB(1).WC(HD()-2);if(MB(2)!=null)MB(2).WC(HD()-2);}void GC(final CanvasRenderingContext2D h,final double i,final double j){final WB g=MB(0);final WB k=MB(1);final WB o=MB(2);final double m=k.rD();final double s=j+g.xB(true)+m/2;final double v=j-g.rB(true)+m;g.GC(h,i,j);k.GC(h,i+g.dB(true),s);o.GC(h,i+g.dB(true),v);}double dB(final bool g){return MB(0).dB(g)+max(MB(1).dB(g),MB(2).dB(g));}double OC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return max(MB(0).rB(true),MB(2).OC(true)+rD());}double xB(final bool g){return max(MB(0).xB(true),MB(1).OC(true)-rD());}}class wD{static final HN=new CanvasElement(width:500,height:300);double width;double height;double mE;double tH;double actualBoundingBoxAscent;double actualBoundingBoxDescent;wD(final String KB,final String QB){SpanElement i=new SpanElement();i.setAttribute('style',"font: ${QB}");i.text=KB;DivElement j=new DivElement();j.setAttribute('style','display: inline-block; width: 1px; height: 0px;');DivElement m=new DivElement();m.append(i);m.append(j);document.body.append(m);width=i.offset.width.toDouble();j.style.verticalAlign='bottom';height=(j.offset.top-i.offset.top).toDouble();j.style.verticalAlign='baseline';mE=(j.offset.top-i.offset.top).toDouble();tH=height-mE;m.remove();CanvasRenderingContext2D k=HN.context2D;k.font=QB;k.fillStyle='white';k.fillRect(0,0,HN.width,HN.height);k.fillStyle='black';k.fillText(KB,0,mE);int h=width.ceil();int o=height.ceil();List<int> s=k.getImageData(0,0,h,o).data;int v=0;bool SB=false;int EB=v;int BB=o-1;bool cB=false;int HB=BB;for(int g=0;g<h*o;g++ ){if(!SB&&s[g*4]!=0xFF){v=g~/h;EB=v;SB=true;}if(s[g*4]<0x90){EB=g~/h;break;}}double hB=(v+EB)/2;for(int g=h*o-1;g>=0;g-- ){if(!cB&&s[g*4]!=0xFF){BB=g~/h;HB=BB;cB=true;}if(s[g*4]<0x90){HB=g~/h;break;}}double BC=(BB+HB)/2;actualBoundingBoxAscent=mE-hB;actualBoundingBoxDescent=BC-mE;}}class lB{eH Hb;static final List<List<String>> mT=[["<==","\u21D0"],["==>","\u21D2"],["<=>","\u21D4"],["!=","\u2260"],["~=","\u2248"],["~","\u223C"],["<=","\u2264"],[">=","\u2265"],["<<","\u226A"],[">>","\u226B"],["-->","\u2192"],["<->","\u2194"],["->","\u2192"],["<--","\u2190"],["equiv","\u2261"],["forall","\u2200"],["quelquesoit","\u2200"],["exists","\u2203"],["ilexiste","\u2203"],["part","\u2202"],["drond","\u2202"],["nabla","\u2207"],["prop","\u221D"],["times",""],["cross",""],["croix",""],["wedge","\u2227"],["pvec","\u2227"],["plusmn",""],["plusoumoins",""],["plusminus",""],["cap","\u2229"],["cup","\u222A"],["...","\u2026"]];static final String KN="_^#*/\u2207\u2213\u2227-+\u2200\u2203\u2202=\u2260\u2248\u223C\u2261<>\u2264\u2265\u226A\u226B\u221D"+"|\u2229\u222A\u2190\u2192\u2194\u21D0\u21D2\u21D4";static final List<List<String>> BQ=[["alpha","\u03B1"],["beta","\u03B2"],["gamma","\u03B3"],["delta","\u03B4"],["epsilon","\u03B5"],["zeta","\u03B6"],["eta","\u03B7"],["theta","\u03B8"],["iota","\u03B9"],["kappa","\u03BA"],["lambda","\u03BB"],["mu","\u03BC"],["nu","\u03BD"],["xi","\u03BE"],["omicron","\u03BF"],["rho","\u03C1"],["sigma","\u03C3"],["tau","\u03C4"],["upsilon","\u03C5"],["phi","\u03C6"],["chi","\u03C7"],["psi","\u03C8"],["omega","\u03C9"],["Alpha","\u0391"],["Beta","\u0392"],["Gamma","\u0393"],["Delta","\u0394"],["Epsilon","\u0395"],["Zeta","\u0396"],["Eta","\u0397"],["Theta","\u0398"],["Iota","\u0399"],["Kappa","\u039A"],["Lambda","\u039B"],["Mu","\u039C"],["Nu","\u039D"],["Xi","\u039E"],["Omicron","\u039F"],["Pi","\u03A0"],["Rho","\u03A1"],["Sigma","\u03A3"],["Tau","\u03A4"],["Upsilon","\u03A5"],["Phi","\u03A6"],["Chi","\u03A7"],["Psi","\u03A8"],["Omega","\u03A9"],["thetasym","\u03D1"],["upsih","\u03D2"],["piv","\u03D6"],["phiv","\u03D5"],["phi1","\u03D5"]];static final List<List<String>> DQ=[["pi","\u03C0"],["infin","\u221E"],["infty","\u221E"],["infini","\u221E"],["parallel","\u2225"],["parallle","\u2225"],["sun","\u2609"],["soleil","\u2609"],["star","\u2605"],["toile","\u2605"],["mercury","\u263F"],["mercure","\u263F"],["venus","\u2640"],["vnus","\u2640"],["earth","\u2295"],["terre","\u2295"],["mars","\u2642"],["jupiter","\u2643"],["saturn","\u2644"],["saturne","\u2644"],["uranus","\u26E2"],["neptun","\u2646"],["neptune","\u2646"],["planck","\u210F"],["angstrom","\u212B"],["angstrm","\u212B"],["asterisk","*"],["astrisque","*"],["ell","\u2113"],["smalll","\u2113"],["petitl","\u2113"],["Ascr","\u{1D49C}"],["biga","\u{1D49C}"],["granda","\u{1D49C}"],["Bscr","\u212C"],["bigb","\u212C"],["grandb","\u212C"],["Cscr","\u{1D49E}"],["bigc","\u{1D49E}"],["grandc","\u{1D49E}"],["Dscr","\u{1D49F}"],["bigd","\u{1D49F}"],["grandd","\u{1D49F}"],["Escr","\u2130"],["bige","\u2130"],["grande","\u2130"],["Fscr","\u2131"],["bigf","\u2131"],["grandf","\u2131"],["Gscr","\u{1D4A2}"],["bigg","\u{1D4A2}"],["grandg","\u{1D4A2}"],["Hscr","\u210B"],["bigh","\u210B"],["grandh","\u210B"],["Iscr","\u2110"],["bigi","\u2110"],["grandi","\u2110"],["Jscr","\u{1D4A5}"],["bigj","\u{1D4A5}"],["grandj","\u{1D4A5}"],["Kscr","\u{1D4A6}"],["bigk","\u{1D4A6}"],["grandk","\u{1D4A6}"],["Lscr","\u2112"],["bigl","\u2112"],["grandl","\u2112"],["Mscr","\u2133"],["bigm","\u2133"],["grandm","\u2133"],["Nscr","\u{1D4A9}"],["bign","\u{1D4A9}"],["grandn","\u{1D4A9}"],["Oscr","\u{1D4AA}"],["bigo","\u{1D4AA}"],["grando","\u{1D4AA}"],["Pscr","\u{1D4AB}"],["bigp","\u{1D4AB}"],["grandp","\u{1D4AB}"],["Qscr","\u{1D4AC}"],["bigq","\u{1D4AC}"],["grandq","\u{1D4AC}"],["Rscr","\u211B"],["bigr","\u211B"],["grandr","\u211B"],["Sscr","\u{1D4AE}"],["bigs","\u{1D4AE}"],["grands","\u{1D4AE}"],["Tscr","\u{1D4AF}"],["bigt","\u{1D4AF}"],["grandt","\u{1D4AF}"],["Uscr","\u{1D4B0}"],["bigu","\u{1D4B0}"],["grandu","\u{1D4B0}"],["Vscr","\u{1D4B1}"],["bigv","\u{1D4B1}"],["grandv","\u{1D4B1}"],["Wscr","\u{1D4B2}"],["bigw","\u{1D4B2}"],["grandw","\u{1D4B2}"],["Xscr","\u{1D4B3}"],["bigx","\u{1D4B3}"],["grandx","\u{1D4B3}"],["Yscr","\u{1D4B4}"],["bigy","\u{1D4B4}"],["grandy","\u{1D4B4}"],["Zscr","\u{1D4B5}"],["bigz","\u{1D4B5}"],["grandz","\u{1D4B5}"]];static final List<String> oT=["sin","cos","tan","acos","asin","atan"];static final RegExp pT=new RegExp("^\\s?([0-9]+([\\.,][0-9]+)?|[\\.,][0-9]+)([Ee][+-]?[0-9]+)?\\s?\$");lB(final String h){Hb=new eH();final String j=qT(UW(h));if(h!=''){final aD i=pI(j);WB g;if(i==null)g=null;else g=i.CF();Hb.RB(g);}}eH uK(){return Hb;}String UW(String g){for(final List<String> h in mT){int i=g.indexOf(h[0]);while(i!=-1){g=g.substring(0,i)+h[1]+g.substring(i+h[0].length);i=g.indexOf(h[0]);}}return g;}static bool fH(String i,int h){String g=i[h];if(KN.indexOf(g)==-1)return (false);if(g!='+'&&g!='-')return (true);if(h<2)return (true);g=i[h-1];if(g!='E'&&g!='e')return (true);g=i[h-2];if("0123456789".indexOf(g)!=-1)return (false);return (true);}static String qT(String g){int h=g.indexOf(';');while(h!=-1){int i=0;bool s=false;String o;for(int j=h-1;j>=0&&i>=0;j-- ){o=g[j];if(o==';'&&i==0)break;if(o=='(')i-- ;else if(o==')')i++ ;else if(fH(g,j))s=true;if(i<0&&s){g=g.substring(0,j)+'('+g.substring(j,h)+')'+g.substring(h);h+= 2;}}i=0;s=false;for(int j=h+1;j<g.length&&i>=0;j++ ){o=g[j];if(o=='(')i++ ;else if(o==')')i-- ;else if(fH(g,j))s=true;if((i<0||i==0&&o==';')&&s)g=g.substring(0,h+1)+'('+g.substring(h+1,j)+')'+g.substring(j);if(o==';'&&i==0)break;}final int HB=g.substring(h+1).indexOf(';');if(HB==-1)h=HB;else h+= HB+1;}for(int KB=0;KB<KN.length;KB++ ){final String QB=KN[KB];h=g.indexOf(QB);while(h!=-1&&!fH(g,h))h=g.indexOf(QB,h+1);int SB=h;int m,k;String v=' ',BB=' ';int i;bool EB;while(SB!=-1){EB=false;m=h-1;if(m>=0)v=g[m];i=0;while(m>=0&&(i!=0||v!='(')&&(i!=0||!fH(g,m))){if(v==')')i++ ;else if(v=='(')i-- ;m-- ;if(m>=0)v=g[m];}if(m<0||fH(g,m))EB=true;k=h+1;if(k>=0&&k<=g.length-1)BB=g[k];i=0;while(k<g.length&&(i!=0||BB!=')')&&(i!=0||!fH(g,k))){if(BB=='(')i++ ;else if(BB==')')i-- ;k++ ;if(k<g.length)BB=g[k];}if(k>=g.length||fH(g,k))EB=true;if(EB){g=g.substring(0,m+1)+"("+g.substring(m+1,k)+")"+g.substring(k);h++ ;}SB=g.substring(h+1).indexOf(QB);h=SB+h+1;}}return g;}aD pI(String g){if(g==null||g=='')return null;if(g[0]=='('&&g[g.length-1]==')'){int i=0;for(int h=1;h<g.length-1;h++ ){if(g[h]=='(')i++ ;else if(g[h]==')')i-- ;if(i==-1)break;}if(i!=-1)g=g.substring(1,g.length-1);}int m=-1;int i=0;for(int h=0;h<g.length;h++ ){if(i==0&&fH(g,h)){m=h;break;}else if(g[h]=='(')i++ ;else if(g[h]==')')i-- ;}if(m==-1){bool BB;try {BB=pT.hasMatch(g);}on FormatException catch (hB){BB=false;}if(BB)return (new SI(g));final int o=g.indexOf('(');if(o!=-1&&g[g.length-1]==')'){int s=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j=='('&&i==0&&h!=o){s=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}String BC=null;aD EB=null;if(s==-1){EB=new mG(g.substring(0,o));g=g.substring(o+1,g.length-1);}else{EB=pI(g.substring(0,s));g=g.substring(s+1,g.length-1);}final List<aD> v=new List<aD>();int k=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j==';'&&i==0){k=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}if(k==-1)v.add(pI(g.trim()));else while(k!=-1){v.add(pI(g.substring(0,k).trim()));g=g.substring(k+1);k=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j==';'&&i==0){k=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}if(k==-1)v.add(pI(g.trim()));}return (new gH(EB,v));}else return (new mG(g));}final String cB=g[m];final String QB=g.substring(0,m).trim();aD HB;if(QB=='')HB=null;else HB=pI(QB);final String SB=g.substring(m+1).trim();aD KB;if(SB=='')KB=null;else KB=pI(SB);return (new XE(cB,HB,KB));}static WB HC(final aD g){if(g!=null)return g.CF();final ZG h=new ZG();h.VC("?");return h;}}typedef void AQ();abstract class aD{WB CF();void VH();}class gH implements aD{aD TF;List<aD> pE;final RegExp FW=new RegExp("^[0-9]+.*\$");gH(final aD g,final List<aD> h){this.TF=g;if(g is mG&&FW.hasMatch(g.TF)){g.TF="?";}pE=h;if((UJ()=="unit"||UJ()=="unit")&&pE.length>1&&pE[1]!=null)pE[1].VH();}void VH(){for(aD g in pE)if(g!=null)g.VH();}String UJ(){if(TF is mG)return ((TF as mG).TF);else return (null);}WB CF(){aD j,o,v,EB;if(pE.length>0)j=pE[0];else j=null;if(pE.length>1)o=pE[1];else o=null;if(pE.length>2)v=pE[2];else v=null;if(pE.length>3)EB=pE[3];else EB=null;String i=UJ();WB h;if(i=="sqrt"||(i=="racine"&&(j==null||o==null))){h=new uP();h.RB(lB.HC(j));}else if(i=="racine"||i=="root"){h=new sP();h.RB(lB.HC(j));h.RB(lB.HC(o));}else if(i=="exp"){h=new UL();final QI MF=new QI();MF.VC("e");h.RB(MF);h.RB(lB.HC(j));}else if(i=="abs"){h=new YC();nB g=new nB();g.VC("|");h.RB(g);h.RB(lB.HC(j));g=new nB();g.VC("|");h.RB(g);}else if(i=="norm"||i=="norme"){h=new YC();nB g=new nB();g.VC("\u2016");h.RB(g);h.RB(lB.HC(j));g=new nB();g.VC("\u2016");h.RB(g);}else if(i=="fact"||i=="factorielle"||i=="factorial"){h=new YC();nB g;if(!(j is mG||j is SI)){g=new nB();g.VC("(");h.RB(g);}h.RB(j.CF());if(!(j is mG||j is SI)){g=new nB();g.VC(")");h.RB(g);}g=new nB();g.VC("!");h.RB(g);}else if(i=="int"||i=="intgrale"){h=new YC();nB g=new nB();g.VC("\u222B");g.ZJ(true);if(v!=null&&EB!=null){final RI s=new RI();s.RB(g);s.RB(lB.HC(v));s.RB(lB.HC(EB));h.RB(s);}else if(v!=null){final sJ IC=new sJ();IC.RB(g);IC.RB(lB.HC(v));h.RB(IC);}else if(EB!=null){final oF k=new oF();k.RB(g);k.RB(lB.HC(EB));h.RB(k);}else h.RB(g);final YC m=new YC();m.RB(lB.HC(j));if(o!=null){g=new nB();g.VC("d");m.RB(g);m.RB(o.CF());}h.RB(m);}else if(i=="prod"||i=="sum"||i=="produit"||i=="somme"){h=new YC();final RI s=new RI();final nB g=new nB();if(i=="prod"||i=="produit")g.VC("\u220F");else if(i=="sum"||i=="somme")g.VC("\u2211");g.ZJ(true);s.RB(g);s.RB(lB.HC(o));s.RB(lB.HC(v));h.RB(s);final YC m=new YC();m.RB(lB.HC(j));h.RB(m);}else if(i=="over"||i=="dessus"){final oF k=new oF();k.RB(lB.HC(j));k.RB(lB.HC(o));h=k;}else if(i=="subsup"){final GN hB=new GN();hB.RB(lB.HC(j));hB.RB(lB.HC(o));hB.RB(lB.HC(v));h=hB;}else if(i=="accent"){final oF k=new oF();k.WP(true);k.RB(lB.HC(j));if(o is XE&&(o as XE).SE=='\u223C'){final nB g=new nB();g.ZJ(true);g.VC("\u223C");k.RB(g);}else k.RB(lB.HC(o));h=k;}else if(i=="matrix"||i=="matrice"){h=new YC();nB g=new nB();g.VC("(");h.RB(g);final qJ QB=new qJ();for(final aD SB in pE)QB.RB(lB.HC(SB));h.RB(QB);g=new nB();g.VC(")");h.RB(g);}else if(i=="system"||i=="systme"){h=new YC();final nB g=new nB();g.VC("{");h.RB(g);final qJ QB=new qJ();for(final aD SB in pE){final YC m=new YC();final OI HB=new OI();HB.dW("left");HB.RB(lB.HC(SB));m.RB(HB);QB.RB(m);}h.RB(QB);}else if(i=="line"||i=="ligne"){h=new rP();for(final aD SB in pE){final OI HB=new OI();HB.RB(lB.HC(SB));h.RB(HB);}}else if(i=="slash"){h=new YC();h.RB(lB.HC(j));final nB g=new nB();g.VC("/");h.RB(g);h.RB(lB.HC(o));}else if(i=="frac"||i=="fraction"){final rJ QD=new rJ();QD.RB(lB.HC(j));QD.RB(lB.HC(o));h=QD;}else if(i=="pscalaire"||i=="scalarp"){final YC m=new YC();m.RB(lB.HC(j));final nB g=new nB();g.VC(".");m.RB(g);m.RB(lB.HC(o));return m;}else if(i=="dtemps"||i=="timed"){final oF k=new oF();k.WP(true);k.RB(lB.HC(j));nB BC=new nB();if(o is SI){try {final int eJ=int.parse((o as SI).cP);String tD="";for(int KB=0;KB<eJ;KB++ )tD=tD+'.';BC.VC(tD);}on FormatException catch (ML){BC.VC("?");}}else BC.VC("?");k.RB(BC);h=k;}else if(i=="unit"||i=="unit"){final YC m=new YC();m.RB(lB.HC(j));final nB g=new nB();g.VC(" ");m.RB(g);m.RB(lB.HC(o));return m;}else if(i=="moyenne"||i=="mean"){h=new YC();nB g=new nB();g.VC("\u2329");h.RB(g);h.RB(lB.HC(j));g=new nB();g.VC("\u232A");h.RB(g);}else if(i=="vecteur"||i=="vector"){final WB BB=lB.HC(j);if(BB is QI){BB.ZS("bold");h=BB;}else if(BB is VL&&BB.MB(0) is QI){(BB.MB(0) as QI).ZS("bold");h=BB;}else{final oF k=new oF();k.WP(true);k.RB(lB.HC(j));final nB g=new nB();g.ZJ(true);g.VC("\u2192");k.RB(g);h=k;}}else{h=new YC();bool qE=true;if(TF is mG){ZG VG=new ZG();for(final List<String> cB in lB.BQ)if(i==cB[0]){i=cB[1];break;}for(final List<String> cB in lB.DQ)if(i==cB[0]){i=cB[1];break;}VG.VC(i);if(o==null&&j is mG)for(final String fJ in lB.oT)if(i==fJ){qE=false;break;}h.RB(VG);}else h.RB(TF.CF());if(qE){final nB g=new nB();g.VC("(");h.RB(g);}h.RB(lB.HC(j));for(int KB=1;KB<pE.length;KB++ ){final nB g=new nB();g.VC(";");h.RB(g);h.RB(pE[KB].CF());}if(qE){final nB g=new nB();g.VC(")");h.RB(g);}else{final ZG MI=new ZG();MI.VC("\u00A0");h.RB(MI);}}return h;}}class XE implements aD{String SE;aD PD;aD nD;bool tI;XE(final String h,final aD i,final aD g){SE=h;this.PD=i;this.nD=g;tI=false;if(SE=='#'&&g!=null)g.VH();}void VH(){tI=true;if(PD!=null)PD.VH();if(nD!=null)nD.VH();}WB CF(){if(SE=='/'){final rJ v=new rJ();v.RB(lB.HC(PD));v.RB(lB.HC(nD));return v;}else if(SE=='^'){final UL BB=new UL();bool m;if(PD is gH){String j=(PD as gH).UJ();if(j=="sqrt"||j=="racine")m=false;else if(j=="abs")m=false;else if(j=="matrice")m=false;else if(j=="dtemps"||j=="timed")m=false;else m=true;}else if(PD is XE){String QB=(PD as XE).SE;if(QB=='_')m=false;else m=true;}else m=false;WB k;if(m)k=fI(PD.CF());else k=lB.HC(PD);BB.RB(k);BB.RB(lB.HC(nD));return BB;}else if(SE=='_'){final VL EB=new VL();EB.RB(lB.HC(PD));EB.RB(lB.HC(nD));return EB;}else if(SE=='#'){final YC g=new YC();g.RB(lB.HC(PD));g.RB(lB.HC(nD));return g;}else if(SE=='*'){final YC g=new YC();WB k=lB.HC(PD);if(PD is XE&&"+-".indexOf((PD as XE).SE)!=-1)k=fI(k);g.RB(k);aD o=nD;if(nD!=null)while(o is XE&&(o as XE).PD!=null){o=(o as XE).PD;}final bool SB=o is SI;bool HB=false;if(PD is gH){final String j=(PD as gH).UJ();if(j=="pscalaire"||j=="scalarp")HB=true;}bool KB=false;if(nD is gH){final String j=(nD as gH).UJ();if(j=="pscalaire"||j=="scalarp")KB=true;}if((SB)||(HB&&KB)){final nB i=new nB();i.VC("");g.RB(i);}else{if(tI){final nB i=new nB();i.VC(".");g.RB(i);}}WB h=lB.HC(nD);if(nD is XE&&"+-".indexOf((nD as XE).SE)!=-1)h=fI(h);g.RB(h);return g;}else if(SE=='-'){final YC g=new YC();if(PD!=null)g.RB(PD.CF());final nB i=new nB();i.VC("-");g.RB(i);if(nD!=null){WB h=nD.CF();if(nD is XE&&"+-".indexOf((nD as XE).SE)!=-1)h=fI(h);g.RB(h);}return g;}else if(SE=='+'){final YC g=new YC();if(PD!=null)g.RB(PD.CF());final nB i=new nB();i.VC("+");g.RB(i);if(nD!=null){WB h=nD.CF();if(h is YC&&h.PC()>0){WB s=h;while(s is YC&&s.PC()>0)s=s.MB(0);if(s.fB()=="-")h=fI(h);}g.RB(h);}return g;}else{final YC g=new YC();if(PD!=null){WB k=PD.CF();if(SE=='\u2227'&&PD is XE&&"+-".indexOf((PD as XE).SE)!=-1)k=fI(k);g.RB(k);}final nB i=new nB();i.VC(SE);if("=\u2260\u2248\u223C\u2261\u2264\u2265\u226A\u226B\u221D".indexOf(SE)!=-1){i.eW(0.5);i.gW(0.5);}g.RB(i);if(nD!=null){WB h=nD.CF();if(SE=='\u2227'&&nD is XE&&"+-".indexOf((nD as XE).SE)!=-1)h=fI(h);g.RB(h);}return g;}}WB fI(final WB i){final YC h=new YC();nB g=new nB();g.VC("(");h.RB(g);h.RB(i);g=new nB();g.VC(")");h.RB(g);return h;}}class SI implements aD{String cP;SI(final String g){this.cP=g;}void VH(){}WB CF(){final tP g=new tP();g.VC(cP);return g;}}class mG implements aD{String TF;bool tI;final RegExp zU=new RegExp("^[0-9]+[a-zA-Z]+\$");mG(final String g){this.TF=g.trim();tI=false;}void VH(){tI=true;}WB CF(){if(TF=="hat"||TF=="chapeau"){final nB h=new nB();h.ZJ(true);h.VC("^");return h;}else if(TF=="bar"||TF=="barre"){final nB h=new nB();h.ZJ(true);h.VC("\u00AF");return h;}else{String g=TF;bool k=tI;for(final List<String> i in lB.BQ)if(g==i[0]){g=i[1];break;}for(final List<String> i in lB.DQ)if(g==i[0]){g=i[1];k=true;break;}if(g.indexOf(',')!=-1||g.indexOf('.')!=-1||g.indexOf('(')!=-1||g.indexOf(')')!=-1)g="?";if(g.indexOf(' ')!=-1)g=g.replaceAll(" ","?");if(g.indexOf('\u00A0')!=-1)g=g.replaceAll("\u00A0","?");if(zU.hasMatch(g))g="?";WB j;if(k)j=new ZG();else j=new QI();j.VC(g);return j;}}}abstract class XL{l PM(final String g);List<l> iO(final String g);l gG(final l g,final l h);String cD(final l g);String jI(final l g);String OM(final l g);String gO(final l g);List<String> pK(final l g);List<String> jM(final l g);bool jO(final l g,final String h);List<String> EP();String jG(final String g);String KE();List<l> ID();List<l> HI();bool GI(final l g,final l h);bool mD(final l g,final l h);List<l> XC(final l g);String ZD(final l g,final bool h,final bool i);List<l> fC(final l g);List<l> fE(final l g);String attributeName(final l g);String attributeNamespace(final l g);String vG(final l g);String eK(final String g);bool TO(final l g,final l h);List<String> gI(final l g);List<String> aP(final l g);String dF(final l g);UO(final l g,final String h);bool PE(final l g);}class AG extends n{bB Jb;bB Kb;AG():super.uX(n.tC){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}AG.OY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(Jb.html());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.html());h=h.nextSibling;}g.append(i);g.append(Kb.html());g.style.color="#808080";return (g);}Element dD(){return (oB().nodes[1]);}AB KF(sB h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.YR(g));}}class pF extends n{bB Jb;bB Kb;pF():super.uX(n.tC){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}pF.NY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(Jb.html());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.html());h=h.nextSibling;}g.append(i);g.append(Kb.html());return (g);}Element dD(){return (oB().nodes[1]);}AB KF(sB h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.XR(g));}void lF(){super.lF();parent.lF();}}class nG extends n{String UG;String xF;nG():super.uX(n.XG){UG='1.0';xF='UTF-8';}nG.RY(AB g):super.oX(g,null){UG=(g as sB).UG;xF=(g as sB).xF;}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');n h=firstChild;while(h!=null){g.append(h.html());h=h.nextSibling;}if(lastChild==null||lastChild.nodeType==n.mB)g.appendText('\n');return (g);}AB KF(sB g){g.UG=UG;g.xF=xF;for(n h=firstChild;h!=null;h=h.nextSibling){g.jB(h.KF(g));}return (g);}}class OB extends n{OB(String g):super.vX(g){}OB.xX(AB g,n h):super.oX(g,h){}Element html(){Element g;g=new SpanElement();g.attributes['id']="${id}";g.attributes['class']='dn';if(nodeValue!=null){g.append(new Text(nodeValue));}return (g);}void WM(q h,String i){assert(h.u==this);String g=nodeValue;if(g==null)g='';nodeValue="${g.substring(0,h.JB)}${i}${g.substring(h.JB)}";}OB NV(int g){String i=nodeValue.substring(0,g);String j=nodeValue.substring(g);nodeValue=i;n h=new OB(j);parent.insertBefore(h,nextSibling);return (h);}AB KF(sB g){return (g.wG(nodeValue));}bool get DD{return (true);}}class IH extends n{bB Jb;bB Kb;IH():super.uX(n.tC){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}IH.VY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(Jb.html());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.html());h=h.nextSibling;}g.append(i);g.append(Kb.html());return (g);}Element dD(){return (oB().nodes[1]);}AB KF(sB h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.ZR(nodeName,g));}}class vI extends n{bool SG;SD control;vI.FY(l g):super.tX(g){List<l> h=t.CB.XC(DB);SG=(h.length==0);}vI.gY(AB h,n k):super.oX(h,k,createChildren:false){List<l> m=t.CB.XC(DB);SG=(m.length==0);if(h.childNodes!=null){n i=null;for(AB j in h.childNodes){n g;if(SG&&j.nodeType==AB.kE)g=new pG.ZY(j,this);else g=ND.dH(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}}Element html(){ButtonElement s=jE.fL(DB,null);TableRowElement h=new TableRowElement();h.id="${id}";h.classes.add('dn');TableCellElement g=new TableCellElement();g.classes.add('shrink');g.append(s);h.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=t.CB.OD(DB);if(t.CB.GI(parent.DB,DB))g.classes.add('required');else g.classes.add('optional');h.append(g);g=new TableCellElement();g.classes.add('expand');if(SG){String k;if(firstChild!=null)k=firstChild.nodeValue;else k='';control=new SD.lY(DB,k,valueChanged:()=>ZO());Element m=control.html();m.id="content_${id}";TextInputElement o=m.querySelector('input');if(o!=null)o.classes.add('form_field');g.append(m);}else{DivElement i=new DivElement();i.id="content_${id}";i.classes.add('form_field');n j=firstChild;while(j!=null){i.append(j.html());j=j.nextSibling;}g.append(i);}h.append(g);if(parent is jE)(parent as jE).dK(h,this);return (h);}Element dD(){return (document.getElementById("content_${id}"));}void ZO(){String h=control.hF();GB g=new GB.sX(LB.NB('form.text_edition'));if(firstChild is OB)g.TB(new GB.pX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.mX(new q(this,0),new pG(h),updateDisplay:false));t.DC(g);kM();}void BF(List<n> g){sD();}void kM(){if(parent is jE){TableRowElement g=oB();g.nodes.last.remove();(parent as jE).dK(g,this);}}}class wI extends n{String Lb;wI.CY(l g):super.tX(g){Lb=t.CB.bC(DB,'styleAtt','style');}wI.aY(AB g,n h):super.oX(g,h){Lb=t.CB.bC(DB,'styleAtt','style');MG();}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');if(css!=null)g.setAttribute('style',css);for(n h=firstChild;h!=null;){g.append(h.html());h=h.nextSibling;}if(lastChild==null||lastChild.nodeType==n.mB)g.appendText('\n');return (g);}Element dD(){return (oB());}void BF(List<n> i){super.BF(i);DivElement h=dD();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');}bool RE(){return (true);}bool get DD{return (true);}void set css(String g){setAttribute(Lb,g);}String get css{return (getAttribute(Lb));}void QW(){GB g=new GB.sX(LB.NB('undo.remove_element'));n h=t.hI(new q(this,0),new q(this,PB));if(t.ZC!=null){kB.QN(parent,h);}g.TB(new GB.pX(this));g.TB(t.LE(h,new q(parent,parent.ZB(this)),checkValidity:false));t.DC(g);}}class xD extends n{xD.zX(l g):super.tX(g){}xD.IY(AB g,n h):super.oX(g,h){MG();}Element html(){LIElement g=new LIElement();g.id="${id}";g.classes.add('dn');n h=firstChild;while(h!=null){g.append(h.html());h=h.nextSibling;}return (g);}Element dD(){return (oB());}bool RE(){return (true);}}class YL extends n{YL.yX(l g):super.tX(g){}YL.GY(AB g,n h):super.oX(g,h){}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');g.classes.add('hr');List<l> h=t.CB.fE(DB);if(h!=null&&h.length>0){g.onClick.listen((MouseEvent i)=>JE());}g.append(new HRElement());return (g);}q QE(){return (null);}q SF(){return (null);}}class ZL extends n{bB Jb;ZL.BY(l g):super.tX(g){}ZL.PY(AB g,n h):super.oX(g,h){}Element html(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(new BRElement());return (g);}q QE(){return (null);}q SF(){return (null);}}class JH extends n{JH.AY(l g):super.tX(g){}JH.MY(AB g,n h):super.oX(g,h){MG();}Element html(){LIElement h=new LIElement();h.id="${id}";h.classes.add('dn');ImageElement i=new ImageElement(src:'packages/daxe/images/bullet1.png',width:13,height:13);i.classes.add('bullet');List<l> j=t.CB.fE(DB);if(j!=null&&j.length>0)i.onClick.listen((MouseEvent g)=>JE());else{i.onDoubleClick.listen((MouseEvent g){IB.selectNode(this);g.preventDefault();g.stopPropagation();});}h.append(i);SpanElement o=new SpanElement();n k=firstChild;while(k!=null){o.append(k.html());k=k.nextSibling;}h.append(o);ImageElement m=new ImageElement(src:'packages/daxe/images/bullet2.png',width:13,height:13);m.classes.add('bullet');if(j!=null&&j.length>0)m.onClick.listen((MouseEvent g)=>JE());else{m.onDoubleClick.listen((MouseEvent g){IB.selectNode(this);g.preventDefault();g.stopPropagation();});}h.append(m);return (h);}Element dD(){return (oB().nodes[1]);}bool RE(){return (true);}}class oG extends n{String Mb;String Nb;oG.EY(l g):super.tX(g){Mb=t.CB.bC(DB,'nameAtt','name');Nb=t.CB.bC(DB,'hrefAtt','href');}oG.hY(AB g,n h):super.oX(g,h){Mb=t.CB.bC(DB,'nameAtt','name');Nb=t.CB.bC(DB,'hrefAtt','href');}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('anchor');if(!valid)g.classes.add('invalid');if(firstChild==null){ImageElement h=new ImageElement();h.src='packages/daxe/images/toolbar/anchor.png';h.width=16;h.height=16;if(getAttribute(Mb)!=null)h.title=getAttribute(Mb);h.onClick.listen((MouseEvent j)=>JE());g.append(h);}else{if(getAttribute(Nb)!=null)g.title=getAttribute(Nb);n i=firstChild;while(i!=null){g.append(i.html());i=i.nextSibling;}g.onDoubleClick.listen((MouseEvent j)=>JE());}return (g);}void BF(List<n> g){super.sD();}bool get DD{return (true);}static List<l> sT(){return (t.CB.yG('anchor'));}static void tT(l m){q g=IB.vC();if(g==IB.GF()){if(g.u is OB){String j=g.u.nodeValue;int k=g.JB;int h=k;if(h>0)h-- ;int i=k;while(h>0&&j[h]!=' ')h-- ;while(i<j.length&&j[i]!=' ')i++ ;IB.cursor.gE(new q(g.u,h),new q(g.u,i));}}t.AI(m,'element');}static void xT(l g){t.AI(g,'element');}static void yT(){q k=IB.vC();n h=k.u;while(h!=null){if(h is oG)break;h=h.parent;}if(h==null)return;oG g=h;if(g.firstChild==null){t.cM(g);IB.LC();return;}h=g.parent;GB i=new GB.sX(LB.NB('undo.remove_element'));n m=t.hI(new q(g,0),new q(g,g.PB));i.TB(new GB.pX(g));q j;if(g.previousSibling is OB)j=new q(g.previousSibling,g.previousSibling.PB);else j=new q(h,h.ZB(g));i.TB(t.LE(m,j,checkValidity:false));t.DC(i);IB.LC();}}class SD{static int aL=0;l IF;l AF;String value;String Ob;List<String> UE;List<String> KD;HashMap<String,String> sI;Element BD;FD valueChanged;bool catchUndo;XB MP;SD.lY(this.IF,this.value,{this.valueChanged}){AF=null;Ob="control${aL}";aL++ ;UE=t.CB.pK(IF);if(UE==null||UE.length==0)KD=t.CB.RV(IF);else{if(!UE.contains(''))UE.add('');}catchUndo=true;}SD.wY(this.IF,this.AF,this.value,{this.valueChanged,this.catchUndo: false}){Ob="control${aL}";aL++ ;UE=t.CB.gI(AF);if(UE==null||UE.length==0)KD=t.CB.wU(IF,AF);else{String g=t.CB.dF(AF);if(!UE.contains('')&&g==null)UE.add('');}}Element html(){SpanElement BB=new SpanElement();bool HB;final List<String> SB=['true','false','1','0'];if(UE==null||UE.length!=SB.length||(value!=null&&!SB.contains(value))){HB=false;}else{HB=true;for(int KB=0;KB<UE.length;KB++ ){if(UE[KB]!=SB[KB]){HB=false;break;}}}if(HB){CheckboxInputElement QB=new CheckboxInputElement();BD=QB;if(value==null)value='false';QB.checked=(value=='true'||value=='1');QB.onChange.listen((Event g)=>OJ(true));BB.append(QB);}else if(UE==null||UE.length==0){TextInputElement i=new TextInputElement();i.spellcheck=false;BD=i;i.size=40;if(value==null)value="";i.value=value;OJ(false);i.onInput.listen((Event g)=>OJ(true));i.onKeyUp.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(catchUndo&&v&&((!k&&m==KeyCode.Z)||(!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){}else OJ(true);});if(KD!=null&&KD.length>0){String h;if(AF!=null)h=t.CB.gK(IF,AF,value);else h=t.CB.oK(IF,value);i.value=h;DataListElement cB=new DataListElement();cB.id='datalist_${Ob}';sI=new HashMap<String,String>();MP=new XB('');for(String o in KD){OptionElement j=new OptionElement();String h;if(AF!=null)h=t.CB.gK(IF,AF,o);else h=t.CB.oK(IF,o);j.value=h;sI[h]=o;cB.append(j);MP.add(new CC(h,(){i.value=h;OJ(true);}));}i.attributes['list']='datalist_${Ob}';BB.append(cB);}BB.append(i);if(KD!=null&&KD.length>0){i.style.width="90%";SpanElement s=new SpanElement();s.text='';s.style.cursor='default';s.onClick.listen((Event g)=>mW(i));s.onMouseOver.listen((Event g)=>s.style.background='#E0E0E0');s.onMouseOut.listen((Event g)=>s.style.background=null);BB.append(s);}}else{SelectElement EB=new SelectElement();BD=EB;if(value==null)value='';sI=new HashMap<String,String>();for(String o in UE){OptionElement j=new OptionElement();String h;if(AF!=null)h=t.CB.gK(IF,AF,o);else h=t.CB.oK(IF,o);j.text=h;j.value=o;sI[h]=o;if(o==value){j.defaultSelected=true;j.selected=true;}EB.append(j);}if(!UE.contains(value)){OptionElement j=new OptionElement();j.text=value;j.selected=true;EB.append(j);BD.classes.add('invalid');}EB.onChange.listen((Event g)=>OJ(true));BB.append(EB);}if(catchUndo){BD.onKeyDown.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(v&&!k&&m==KeyCode.Z){g.preventDefault();}else if(v&&((!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){g.preventDefault();}});BD.onKeyUp.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(v&&!k&&m==KeyCode.Z){g.preventDefault();t.YH();}else if(v&&((!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){g.preventDefault();t.bM();}});}return (BB);}void OJ(bool i){String j=value;if(BD is InputElement&&(BD as InputElement).type=='text'){String g=(BD as TextInputElement).value;if(sI!=null&&sI[g]!=null)value=sI[g];else value=g;}else if(BD is SelectElement){value=(BD as SelectElement).value;}else if(BD is InputElement&&(BD as InputElement).type=='checkbox'){bool k=(BD as CheckboxInputElement).checked;if(k)value='true';else value='false';}bool h;if(AF!=null)h=t.CB.eS(AF,value);else h=(value==''||t.CB.wO(IF,value));if(h){BD.classes.add('valid');BD.classes.remove('invalid');}else{BD.classes.add('invalid');BD.classes.remove('valid');}if(i&&value!=j&&valueChanged!=null)valueChanged();}String hF()=>value;void hM(String g){this.value=g;if(BD is InputElement&&(BD as InputElement).type=='text'){TextInputElement k=BD as TextInputElement;if(AF!=null)k.value=t.CB.gK(IF,AF,g);else k.value=t.CB.oK(IF,g);}else if(BD is SelectElement){SelectElement i=BD as SelectElement;while(i.options.length>0)i.options[0].remove();for(String j in UE){OptionElement h=new OptionElement();if(AF!=null)h.text=t.CB.gK(IF,AF,j);else h.text=t.CB.oK(IF,j);if(j==g)h.selected=true;i.append(h);}if(!UE.contains(g)){OptionElement h=new OptionElement();h.text=g;h.selected=true;i.append(h);BD.classes.add('invalid');}i.value=g;}else if(BD is InputElement&&(BD as InputElement).type=='checkbox')(BD as CheckboxInputElement).checked=(g=='true'||g=='1');}void focus(){if(BD is TextInputElement){TextInputElement g=BD as TextInputElement;g.select();g.selectionStart=g.selectionEnd=g.value.length;}else if(BD!=null){BD.focus();}}void mW(TextInputElement j){DivElement g=MP.UM();g.style.position='absolute';g.style.display='block';Rectangle h=j.getBoundingClientRect();g.style.left="${h.left}px";g.style.top="${h.bottom}px";g.style.width="${h.width}px";((g.firstChild) as Element).style.width="${h.width}px";document.body.append(g);StreamSubscription<MouseEvent> i=document.onMouseUp.listen(null);i.onData((MouseEvent k){i.cancel();g.remove();k.preventDefault();});}}class jE extends n{List<l> rH;List<l> IE;HashMap<String,SD> qH;bool SG;SD control;jE.cY(l g):super.tX(g){rH=t.CB.XC(DB);IE=t.CB.fE(DB);SG=(rH.length==0&&IE.length==0);yE();}jE.rY(AB h,n k):super.oX(h,k,createChildren:false){rH=t.CB.XC(DB);IE=t.CB.fE(DB);SG=(rH.length==0&&IE.length==0);if(h.childNodes!=null){n i=null;for(AB j in h.childNodes){n g;if(SG&&j.nodeType==AB.kE)g=new pG.ZY(j,this);else g=ND.dH(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}if(!SG){List<n> m=childNodes;for(n g in m){if(g is OB)gC(g);}}yE();}void yE(){if(IE.length>0)qH=new HashMap<String,SD>();pU();}void pU(){n h=null;for(l i in rH){bool j=false;for(n g in childNodes){if(g.DB==i){j=true;h=g;}}if(!j){n g=ND.NF(i);if(h!=null)insertAfter(g,h);else if(firstChild!=null)insertBefore(g,firstChild);else jB(g);h=g;}}}Element html(){ButtonElement s=fL(DB,null);if(SG){TableRowElement h=new TableRowElement();h.id="${id}";h.classes.add('dn');TableCellElement g=new TableCellElement();g.classes.add('shrink');g.append(s);h.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=t.CB.OD(DB);if(t.CB.GI(parent.DB,DB))g.classes.add('required');else g.classes.add('optional');h.append(g);g=new TableCellElement();String m;if(firstChild!=null)m=firstChild.nodeValue;else m='';control=new SD.lY(DB,m,valueChanged:()=>ZO());g.append(control.html());h.append(g);if(parent is jE)(parent as jE).dK(h,this);return (h);}else{DivElement j=new DivElement();j.id="${id}";j.classes.add('dn');j.classes.add('form');SpanElement i=new SpanElement();i.classes.add('form_title');i.append(s);i.appendText(' ');i.appendText(t.CB.OD(DB));if(t.CB.GI(parent.DB,DB))i.classes.add('required');else i.classes.add('optional');j.append(i);TableElement k=new TableElement();k.classes.add('expand');for(l v in IE){k.append(SO(v));}for(l BB in rH){for(n o in childNodes){if(o.DB==BB){o.dJ=true;lU(k,o);}}}j.append(k);return (j);}}void ZO(){String h=control.hF();GB g=new GB.sX(LB.NB('form.text_edition'));if(firstChild is OB)g.TB(new GB.pX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.mX(new q(this,0),new pG(h),updateDisplay:false));t.DC(g);kM();}Element dD(){if(SG){return (oB().nodes[2]);}else{return (oB().nodes[1]);}}TableRowElement SO(l h){String o=t.CB.PH(DB,h);TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();g.classes.add('shrink');ButtonElement v=fL(DB,h);g.append(v);i.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=t.CB.fK(DB,h);if(t.CB.BL(DB,h))g.classes.add('required');else g.classes.add('optional');i.append(g);g=new TableCellElement();g.classes.add('expand');String j=getAttribute(o);String s=t.CB.dF(h);if(j==null){if(s!=null)j=s;else j='';}SD k;k=new SD.wY(DB,h,j,valueChanged:()=>YO(h,k),catchUndo:true);qH[o]=k;Element m=k.html();if(m.firstChild is TextInputElement)(m.firstChild as TextInputElement).classes.add('form_field');g.append(m);i.append(g);g=new TableCellElement();g.classes.add('shrink');i.append(g);return (i);}void YO(l j,SD m){String h=m.hF();String k=t.CB.PH(DB,j);String i=t.CB.dF(j);aB g;if((h==''&&i==null)||h==i)g=new aB(k,null);else if(h!=''||i!=null)g=new aB(k,h);else g=null;if(g!=null)t.DC(new GB.rX(this,g,updateDisplay:false));}void lU(TableElement m,n i){Element j=i.html();TableRowElement h;if(j is TableRowElement)h=j;else{h=new TableRowElement();TableCellElement g;int k;if(i is!jE){g=new TableCellElement();ButtonElement o=fL(i.DB,null);g.append(o);h.append(g);k=2;}else k=3;g=new TableCellElement();g.colSpan=k;g.append(j);h.append(g);dK(h,i);}m.append(h);}void dK(TableRowElement k,n g){TableCellElement j=new TableCellElement();j.classes.add('shrink');if(t.CB.kV().mD(DB,g.DB)){if(g.nextSibling==null||g.nextSibling.DB!=g.DB){if(g.firstChild!=null||g is!jE){ButtonElement h=new ButtonElement();h.attributes['type']='button';h.value='+';h.text='+';h.onClick.listen((Event m)=>oU(g));j.append(h);}}if((g.previousSibling!=null&&g.previousSibling.DB==g.DB)||(g.nextSibling!=null&&g.nextSibling.DB==g.DB)){ButtonElement i=new ButtonElement();i.attributes['type']='button';i.value='-';i.text='-';i.onClick.listen((Event m)=>t.cM(g));j.append(i);}}k.append(j);}void oU(n g){n h=ND.NF(g.DB);t.insertNode(h,new q(this,ZB(g)+1));}void JE([FD g]){if(g!=null)g();}void sD(){if(!SG){super.sD();return;}String g;if(firstChild!=null)g=firstChild.nodeValue;else g='';if(control.hF()!=g)control.hM(g);kM();}void BF(List<n> g){sD();}void kM(){if(parent is jE){TableRowElement g=oB();g.nodes.last.remove();(parent as jE).dK(g,this);}}void uI(){DivElement m=oB();TableElement o=querySelector("#${id}>table");int k=0;for(l h in IE){String i=t.CB.PH(DB,h);String g=getAttribute(i);String j=t.CB.dF(h);if(g==null){if(j!=null)g=j;else g='';}qH[i].hM(g);k++ ;}}bool RE(){return (rH.length!=0);}AB KF(sB h){if(rH.length==0)return (super.KF(h));l i=h.createElementNS(pB,nodeName);for(aB j in attributes)i.setAttributeNS(j.pB,j.name,j.value);i.jB(h.wG('\n'));for(n g=firstChild;g!=null;g=g.nextSibling){if(g.firstChild!=null||(g.attributes!=null&&g.attributes.length>0)){i.jB(g.KF(h));i.jB(h.wG('\n'));}}return (i);}static ButtonElement fL(final l i,final l j){ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('help');g.value='?';g.text='?';if(j==null){String h=t.CB.uH(i);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new WG.SX(i)).show());}else{String h=t.CB.vG(i,j);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new WG.UX(j,i)).show());}return (g);}}class xI extends n{bB Jb;xI.DY(l g):super.tX(g){Jb=new bB(this,bB.AN);}xI.XY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.AN);}Element html(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(Jb.html());return (g);}q QE(){return (null);}q SF(){return (null);}Element dD(){return (null);}}class yI extends n{LN Pb;String Qb;yI.KY(l g):super.tX(g){}yI.YY(AB g,n h):super.oX(g,h,createChildren:false){Qb=g.firstChild.nodeValue;}Element html(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('special');g.text=Qb;return (g);}void JE([FD g]){Pb=new LN(Qb,okfct:(){Qb=Pb.ZV();if(g!=null)g();});Pb.show();}q QE(){return (null);}q SF(){return (null);}AB KF(sB g){l h=g.createElementNS(pB,nodeName);h.jB(g.wG(Qb));return (h);}}class TI extends n{bB Jb;bB Kb;l Rb;TI.HY(l g):super.tX(g){yE();}TI.mY(AB g,n h):super.oX(g,h){yE();MG();}void yE(){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);List<l> g=t.CB.XC(DB);if(g.length>0)Rb=g[0];}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(Jb.html());UListElement i=new UListElement();i.classes.add('list');n h=firstChild;while(h!=null){i.append(h.html());h=h.nextSibling;}g.append(i);g.append(Kb.html());return (g);}Element dD(){return (oB().nodes[1]);}bool RE(){return (true);}bool QG(){return (true);}static void vT(q h){JH g;if(h.u is JH)g=h.u;else g=h.u.parent;JH i=ND.NF(g.DB);t.insertNode(i,new q(g.parent,g.parent.ZB(g)+1));IB.JD(new q(i,0));IB.LC();}}class zI extends n{bB Jb;bB Kb;zI.JY(l g):super.tX(g){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}zI.dY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}Element html(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(Jb.html());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.html());h=h.nextSibling;}gM(i);g.append(i);g.append(Kb.html());return (g);}Element dD(){return (oB().nodes[1]);}}class YE extends yB{String Lb;YE.LY(l g):super.qY(g){Lb=t.CB.bC(DB,'styleAtt','style');}YE.eY(AB g,n h):super.sY(g,h){Lb=t.CB.bC(DB,'styleAtt','style');}Element html(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');if(firstChild!=null){SpanElement h=new SpanElement();n i=firstChild;while(i!=null){h.append(i.html());i=i.nextSibling;}if(css!=null)h.setAttribute('style',css);g.append(h);}else{bB j=new bB(this,bB.ME);bB k=new bB(this,bB.iE);g.append(j.html());SpanElement h=new SpanElement();h.setAttribute('style',css);g.append(h);g.append(k.html());}return (g);}void set css(String g){setAttribute(Lb,g);}String get css{return (getAttribute(Lb));}void BF(List<n> g){super.sD();}Element dD(){if(firstChild!=null)return (oB().nodes.first);else return (oB().nodes[1]);}static l EQ(){return (t.CB.mO('stylespan'));}bool matches(yB g){if(g is YE){uD h=new uD(css);uD i=new uD(g.css);return (h.SV(i));}else{return (false);}}bool CH(String g,String h){if(css==null)return (false);uD i=new uD(css);return (i[g]==h);}bool LS(String g){if(css==null)return (false);uD h=new uD(css);return (h[g]!=null);}}class AJ extends n{SD control;AJ.QY(l g):super.tX(g){}AJ.bY(AB h,n k):super.oX(h,k,createChildren:false){if(h.childNodes!=null){n i=null;for(AB j in h.childNodes){n g;if(j.nodeType==AB.kE)g=new pG.ZY(j,this);else g=ND.dH(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}}Element html(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('simple_type');List<l> j=t.CB.fE(DB);if(j!=null&&j.length>0){ImageElement k=new ImageElement(src:'images/attributes.png',width:16,height:15);k.onClick.listen((MouseEvent h)=>JE());g.append(k);}String m=t.CB.OD(DB);g.append(new Text(m));String i;if(firstChild!=null)i=firstChild.nodeValue;else i='';control=new SD.lY(DB,i,valueChanged:()=>EV());g.append(control.html());g.onDoubleClick.listen((MouseEvent h){IB.selectNode(this);h.preventDefault();h.stopPropagation();});return (g);}void EV(){String h=control.hF();GB g=new GB.sX(LB.NB('form.text_edition'));if(firstChild is OB)g.TB(new GB.pX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.mX(new q(this,0),new pG(h),updateDisplay:false));t.DC(g);control.focus();}void sD(){String g;if(firstChild!=null)g=firstChild.nodeValue;else g='';if(control.hF()!=g)control.hM(g);}q QE(){return (null);}q SF(){return (null);}}class iC extends n{l Rb;String type;iC.SY(l g):super.tX(g){yE();}iC.nY(AB h,n i):super.oX(h,i){yE();MG();for(n g in childNodes){if(g is OB&&g.nodeValue.trim()==''){gC(g);}}}void yE(){Rb=cL(DB);type=t.CB.bC(DB,'type','ul');}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');Element h;if(type=='ul')h=new UListElement();else h=new OListElement();h.classes.add('wlist');n i=firstChild;while(i!=null){h.append(i.html());i=i.nextSibling;}g.append(h);return (g);}q QE(){if(firstChild==null){return (null);}return (new q(firstChild,0));}q SF(){if(lastChild==null){return (null);}return (new q(lastChild,lastChild.PB));}Element dD(){return (oB().firstChild);}bool RE(){return (true);}bool QG(){return (true);}static l cL(l h){List<l> g=t.CB.XC(h);if(g.length>0)return (g[0]);return (null);}static void FQ(l QB){l qE=cL(QB);q BB=IB.vC();q MI=IB.GF();GB j=new GB.sX(t.CB.OD(QB));q SB;xD i=new xD.zX(qE);n m=BB.u;while(m!=null&&m is!iC){m=m.parent;}if(m is iC&&m.DB!=QB){SB=new q.eX(BB);iC v=new iC.SY(QB);for(n h=m.firstChild;h!=null;h=h.nextSibling){v.jB(new n.wX(h));}j.TB(new GB.mX(new q(m.parent,m.parent.ZB(m)),v));j.TB(new GB.pX(m));t.DC(j);IB.JD(SB);IB.LC();return;}n g=BB.u;while(g!=null&&g is!kB)g=g.parent;if(g is kB){for(n h=g.firstChild;h!=null;h=h.nextSibling)i.jB(new n.wX(h));if(g.previousSibling is iC&&g.nextSibling is iC){j.TB(new GB.mX(new q(g.previousSibling,g.previousSibling.PB),i));n MF=new n.wX(g.nextSibling);j.TB(t.LE(MF,new q(g.previousSibling,g.previousSibling.PB+1)));j.TB(new GB.pX(g.nextSibling));}else if(g.previousSibling is iC){j.TB(new GB.mX(new q(g.previousSibling,g.previousSibling.PB),i));}else if(g.nextSibling is iC){j.TB(new GB.mX(new q(g.nextSibling,0),i));}else{n v=new iC.SY(QB);v.jB(i);j.TB(new GB.mX(new q(g.parent,g.parent.ZB(g)),v));}j.TB(new GB.pX(g));SB=new q(i,i.PB);}else{n k=BB.u;int VG=BB.JB;while(k is OB||k is yB){VG=k.parent.ZB(k);k=k.parent;}int BC=VG;while(BC>0){n h=k.eB(BC-1);if((h is!OB&&!t.CB.fD(qE,h.DB))||h.RE())break;BC-- ;}q EB=new q(k,BC);n HB=BB.u;int cB=BB.JB;while(HB is OB||HB is yB){cB=HB.parent.ZB(HB)+1;HB=HB.parent;}assert(HB==k);while(cB<k.PB){n h=k.eB(cB);if((h is!OB&&!t.CB.fD(qE,h.DB))||h.RE())break;cB++ ;}q s=new q(k,cB);n IC;if(EB<s){IC=t.hI(EB,s);for(n h=IC.firstChild;h!=null;h=IC.firstChild){IC.gC(h);i.jB(h);}n QD=i.eB(0);if(QD is OB){String hB=QD.nodeValue.trimLeft();if(hB=='')i.gC(QD);else QD.nodeValue=hB;}n tD=i.eB(i.PB-1);if(tD is OB){String hB=tD.nodeValue.trimRight();if(hB=='')i.gC(tD);else tD.nodeValue=hB;}}n o;if(EB.JB>0)o=EB.u.eB(EB.JB-1);else o=null;n KB;if(s.JB<s.u.PB)KB=s.u.eB(s.JB);else KB=null;if(o is iC&&KB is iC){j.TB(new GB.mX(new q(o,o.PB),i));n MF=new n.wX(KB);j.TB(t.LE(MF,new q(o,o.PB+1)));j.TB(new GB.pX(KB));}else if(o is iC){j.TB(new GB.mX(new q(o,o.PB),i));}else if(KB is iC){j.TB(new GB.mX(new q(KB,0),i));}else{n v=new iC.SY(QB);v.jB(i);j.TB(new GB.mX(s,v));}if(EB<s)j.TB(t.FI(EB,s));SB=new q(i,i.PB);}t.DC(j);IB.JD(SB);IB.LC();}static void PN(){q SB=IB.vC();n g=SB.u;while(g!=null&&g is!xD)g=g.parent;if(g==null)return;GB i=new GB.sX(LB.NB('toolbar.lower_level'));xD s=g;iC j=s.parent;n v=null;if(s.nextSibling!=null){v=new iC.SY(j.DB);for(g=s.nextSibling;g!=null;g=g.nextSibling){v.jB(new n.wX(g));i.TB(new GB.pX(g));}}n h=new n.wX(s);q BB;if(j.parent is xD){xD KB=j.parent;iC QB=KB.parent;if(v!=null)h.jB(v);i.TB(new GB.mX(new q(QB,QB.ZB(KB)+1),h));BB=new q(h,h.PB);}else{q m=new q(j.parent,j.parent.ZB(j)+1);if(v!=null)i.TB(new GB.mX(m,v));if(t.ZC!=null&&t.CB.fF(j.parent.DB,t.ZC)!=null){l EB=t.CB.fF(j.parent.DB,t.ZC);if(h.firstChild!=null){n o=h.firstChild;n HB=null;kB k=null;while(o!=null){HB=o.nextSibling;if(o is OB||t.CB.fD(EB,o.DB)){if(k==null)k=new kB.UY(EB);h.gC(o);k.jB(o);h.insertBefore(k,HB);}else{k=null;}o=HB;}BB=m;i.TB(t.LE(h,m));}else{kB k=new kB.UY(EB);i.TB(new GB.mX(m,k));BB=new q(k,0);}}else{if(h.firstChild!=null){BB=m;i.TB(t.LE(h,m));}else{BB=m;}}}if(s.previousSibling!=null)i.TB(new GB.pX(s));else i.TB(new GB.pX(j));t.DC(i);IB.JD(BB);IB.LC();}static void DU(){q s=IB.vC();n g=s.u;while(g!=null&&g is!xD)g=g.parent;if(g==null)return;xD i=g;xD h=i.previousSibling;if(h==null)return;GB j=new GB.sX(LB.NB('toolbar.rise_level'));j.TB(new GB.pX(i));n k=new n.wX(i);if(h.lastChild is iC){iC m=h.lastChild;j.TB(new GB.mX(new q(m,m.PB),k));}else{n o=new iC.SY(i.parent.DB);o.jB(k);j.TB(new GB.mX(new q(h,h.PB),o));}t.DC(j);IB.JD(new q(k,k.PB));IB.LC();}static void EU(q k){xD g;n h=k.u;while(h!=null&&h is!xD)h=h.parent;assert(h!=null);if(h==null)return;g=h;q i=new q(g.parent,g.parent.ZB(g));q o=new q(g.parent,g.parent.ZB(g)+1);n s=t.HG(g,i,k);n m=t.HG(g,k,o);GB j=new GB.sX(LB.NB('undo.insert_text'));j.TB(new GB.mX(i,s));i=new q(g.parent,g.parent.ZB(g)+1);j.TB(new GB.mX(i,m));j.TB(new GB.pX(g));t.DC(j);IB.JD(new q(m,0));IB.LC();}static List<l> FU(){List<l> g=new List<l>();List<l> i=t.CB.yG('wlist');for(l h in i)if(t.CB.bC(h,'type','ul')=='ul')g.add(h);return (g);}static List<l> GU(){List<l> g=new List<l>();List<l> i=t.CB.yG('wlist');for(l h in i)if(t.CB.bC(h,'type','ul')=='ol')g.add(h);return (g);}}class pG extends OB{pG(String g):super(g){}pG.ZY(AB g,n h):super.xX(g,h){}void sD(){parent.sD();}}class kB extends n{String Lb;kB.UY(l g):super.tX(g){Lb=t.CB.bC(DB,'styleAtt','style');}kB.jY(AB g,n h):super.oX(g,h){Lb=t.CB.bC(DB,'styleAtt','style');}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');g.classes.add('hiddenp');if(!valid)g.classes.add('invalid');if(css!=null)g.setAttribute('style',css);for(n h=firstChild;h!=null;){g.append(h.html());h=h.nextSibling;}return (g);}Element dD(){return (oB());}bool get DD{return (true);}bool RE(){return (true);}void set css(String g){setAttribute(Lb,g);}String get css{return (getAttribute(Lb));}bool CH(String g,String h){if(css==null)return (false);uD i=new uD(css);return (i[g]==h);}static void rT(String j){List<kB> g=dL();if(g.length==0)return;GB h=new GB.sX(LB.NB('style.remove_styles'));for(kB k in g){GB i=uT(k,j);if(i!=null)h.TB(i);}t.DC(h);IB.cursor.refresh();}static GB uT(kB g,String i){String k=g.css;if(k==null)return (null);uD h=new uD(g.css);if(h[i]!=null){h.remove(i);String m=h.toString();aB j=g.QM(g.Lb);j.value=m;return (new GB.qX(g,[j],updateDisplay:true));}return (null);}static void wT(String j,String k){List<kB> g=dL();if(g.length==0)return;GB h=new GB.sX(LB.NB('style.apply_style'));for(kB m in g){GB i=zT(m,j,k);if(i!=null)h.TB(i);}t.DC(h);IB.cursor.refresh();}static GB zT(kB g,String k,String m){uD i=new uD(g.css);i[k]=m;String j=i.toString();aB h=g.QM(g.Lb);if(h==null)h=new aB(g.Lb,j);else h.value=j;return (new GB.qX(g,[h],updateDisplay:true));}static List<kB> dL(){List<kB> j=new List<kB>();q h=IB.vC();q m=IB.GF();n i=h.u;while(i!=null&&i is!kB)i=i.parent;n g;if(i is kB)g=i;else if(h.u is OB)g=h.u.parent;else if(h.JB<h.u.PB)g=h.u.eB(h.JB);else if(h.u.PB==0)g=h.u;else g=h.u.lastChild.nextNode();if(g==null)return (j);if(g is kB)j.add(g);if(g.parent==null)return (j);q k=new q(g.parent,g.parent.ZB(g)+1);while(k<m){g=g.nextNode();if(g==null)break;if(g is kB)j.add(g);k=new q(g.parent,g.parent.ZB(g)+1);}return (j);}static bool AU(){q o=IB.vC();q k=IB.GF();n g=o.u;int SB=o.JB;while(g is OB||g is yB){SB=g.parent.ZB(g);g=g.parent;}if(g is kB){GB h=new GB.sX(LB.NB('undo.insert_text'));kB i=g;q IC=new q(i.parent,i.parent.ZB(i));q MF=new q(i,0);q QD=new q(i,i.PB);assert(k<=QD);n s=t.HG(i,MF,o);n j=t.HG(i,k,QD);h.TB(new GB.pX(i));h.TB(new GB.mX(IC,j));h.TB(new GB.mX(IC,s));t.DC(h);IB.JD(new q(j,0));IB.LC();return (true);}if(o.u!=k.u)return (false);if(g.DB==null)return (false);if(g is kB)return (false);l v=t.CB.fF(g.DB,t.ZC);if(v==null)return (false);if(!t.CB.VM(g,SB,SB,v))return (false);GB h=new GB.sX(LB.NB('undo.insert_text'));int EB=SB;while(EB>0){n HB=g.eB(EB-1);if(HB is!OB&&!t.CB.fD(v,HB.DB))break;EB-- ;}q KB=new q(g,EB);n s=null;if(KB<o)s=t.HG(g,KB,o);n m=k.u;int QB=k.JB;while(m is OB||m is yB){QB=m.parent.ZB(m)+1;m=m.parent;}assert(m==g);while(QB<g.PB){n HB=g.eB(QB);if(HB is!OB&&!t.CB.fD(v,HB.DB))break;QB++ ;}q cB=new q(g,QB);n j=null;if(cB>k){j=t.HG(g,k,cB);n hB=j.eB(j.PB-1);if(hB is OB){String BB=hB.nodeValue;if(BB.length>0&&BB[BB.length-1]=='\n'){if(BB.length==1)j.gC(hB);else hB.nodeValue=BB.substring(0,BB.length-1);}}}if(KB<cB){h.TB(t.FI(KB,cB));}int tD=EB;if(s!=null||g.PB==0){kB qE=ND.NF(v);h.TB(new GB.mX(KB,qE));if(s!=null)h.TB(t.LE(s,new q(qE,0)));tD++ ;}kB BC=ND.NF(v);h.TB(new GB.mX(new q(g,tD),BC));if(j!=null)h.TB(t.LE(j,new q(BC,0)));t.DC(h);IB.JD(new q(BC,0));IB.LC();return (true);}static void QN(n j,n i){if(t.ZC==null)return;n k;for(n g=i.firstChild;g!=null;g=k){k=g.nextSibling;if(g is kB&&!t.CB.fD(j.DB,g.DB)){n o;for(n m=g.firstChild;m!=null;m=o){o=m.nextSibling;g.gC(m);i.insertBefore(m,g);}i.gC(g);}}l h;if(j.DB!=null)h=t.CB.fF(j.DB,t.ZC);else h=null;if(h!=null){for(n g=i.firstChild;g!=null;g=k){k=g.nextSibling;if(g.DB!=h&&((g is OB&&!t.CB.PE(j.DB))||(!t.CB.fD(j.DB,g.DB)&&t.CB.fD(h,g.DB)))){i.gC(g);if(g.previousSibling!=null&&g.previousSibling.DB==h){g.previousSibling.jB(g);}else{kB s=new kB.UY(h);s.jB(g);i.insertBefore(s,k);}}}}}}class BJ extends n{bB Jb;bB Kb;BJ.TY(l g):super.tX(g){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);}BJ.iY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME);Kb=new bB(this,bB.iE);MG();}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(Jb.html());DivElement h=new DivElement();h.classes.add('indent');n i=firstChild;while(i!=null){h.append(i.html());i=i.nextSibling;}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');gM(h);g.append(h);g.append(Kb.html());return (g);}void BF(List<n> i){super.BF(i);DivElement h=dD();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');}void uI(){Element g=oB().nodes[0];Jb=new bB(this,bB.ME,true);g.replaceWith(Jb.html());}Element dD(){return (oB().nodes[1]);}bool RE(){return (true);}bool QG(){return (true);}}class bL extends n{bB Jb;bB Kb;bL.WY(l g):super.tX(g){Jb=new bB(this,bB.ME,true);Kb=new bB(this,bB.iE,true);}bL.kY(AB g,n h):super.oX(g,h){Jb=new bB(this,bB.ME,true);Kb=new bB(this,bB.iE,true);MG();}Element html(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(Jb.html());DivElement h=new DivElement();h.classes.add('indent');n i=firstChild;while(i!=null){h.append(i.html());i=i.nextSibling;}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');g.append(h);g.append(Kb.html());return (g);}void BF(List<n> i){super.BF(i);DivElement h=dD();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.mB)h.appendText('\n');}void uI(){Element g=oB().nodes[0];Jb=new bB(this,bB.ME,true);g.replaceWith(Jb.html());}Element dD(){return (oB().nodes[1]);}bool RE(){return (true);}bool QG(){return (true);}}class hH extends n{ImageElement Sb;String Tb;hH.fY(l g):super.tX(g){Tb=t.CB.bC(DB,'srcAtt','src');}hH.pY(AB g,n h):super.oX(g,h){Tb=t.CB.bC(DB,'srcAtt','src');}Element html(){assert(t.RJ!=null);Sb=new ImageElement();Sb.id="${id}";Sb.classes.add('dn');String g='';String h=t.RJ;int i=h.lastIndexOf('/');if(i!=-1)g=h.substring(0,i+1);String j="${g}${getAttribute(Tb)}";Sb.src=j;Sb.alt=getAttribute(Tb);Sb.onLoad.listen((Event k)=>qV());Sb.onClick.listen((MouseEvent k)=>JE());return (Sb);}void qV(){if(Sb.naturalWidth>500){Sb.width=500;}if(IB.vC()!=null&&IB.vC()>new q(this,0))IB.cursor.ZH(false);}q QE(){return (null);}q SF(){return (null);}}class CJ extends n{ImageElement Sb;String Ub;String Vb;EN Pb;CJ.oY(l g):super.tX(g){Ub=t.CB.bC(DB,'texteAtt','src');oD.CQ();}CJ.tY(AB g,n h):super.oX(g,h,createChildren:false){Ub=t.CB.bC(DB,'texteAtt','src');if(g.firstChild!=null)Vb=g.firstChild.nodeValue.replaceAll('\n','');else Vb=null;oD.CQ();}Element html(){Sb=new ImageElement();Sb.attributes['id']="${id}";Sb.attributes['class']='dn';if(Vb!=null){String g="data:image/png;base64,${Vb}";Sb.attributes['src']=g;}Sb.onLoad.listen((Event h)=>nO());Sb.onClick.listen((MouseEvent h)=>JE());Sb.style.verticalAlign='middle';return (Sb);}void nO(){if(Sb.naturalWidth>500){Sb.width=500;}}q QE(){return (null);}q SF(){return (null);}void JE([FD h]){String g=getAttribute(Ub);if(g==null)g='';Pb=new EN(g,okfct:(){String g=Pb.fB();if(oB()!=null){aB i=new aB(Ub,g);GB j=new GB.rX(this,i,updateDisplay:false);t.DC(j);}else{setAttribute(Ub,g);}Vb=Pb.getData();if(Sb!=null){String k="data:image/png;base64,${Vb}";Sb.attributes['src']=k;}if(h!=null)h();Sb.onLoad.listen((Event m)=>IB.JD(new q(parent,parent.ZB(this)+1)));});Pb.show();}void uI(){IL();sD();}void IL(){String j=getAttribute(Ub);lB h=new lB(j);CanvasElement k=new CanvasElement(width:500,height:300);oD i=new oD(element:h.uK(),context:k.context2D);CanvasElement g=new CanvasElement(width:i.dB(),height:i.OC());oD m=new oD(element:h.uK(),context:g.context2D);m.GC(g.context2D);String o=g.toDataUrl('image/png');Vb=o.substring('data:image/png;base64,'.length);}AB KF(sB k){l h=k.createElementNS(pB,nodeName);for(aB i in attributes)h.setAttributeNS(i.pB,i.name,i.value);if(Vb!=null){StringBuffer j=new StringBuffer();String g=Vb;while(g!=''){if(g.length<=76){j.write(g);g='';}else{j.writeln(g.substring(0,76));g=g.substring(76);}}h.jB(k.wG(j.toString()));}return (h);}}class yB extends n{String Wb;yB.qY(l g):super.tX(g){Wb=t.CB.bC(g,'style',null);}yB.sY(AB g,n h):super.oX(g,h){Wb=t.CB.bC(DB,'style',null);}Element html(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');if(firstChild!=null){SpanElement h=new SpanElement();n i=firstChild;while(i!=null){h.append(i.html());i=i.nextSibling;}gM(h);g.append(h);}else{bB j=new bB(this,bB.ME);bB k=new bB(this,bB.iE);g.append(j.html());SpanElement h=new SpanElement();g.append(h);g.append(k.html());}return (g);}void BF(List<n> g){super.sD();}Element dD(){if(firstChild!=null)return (oB().nodes.first);else return (oB().nodes[1]);}bool get DD{return (true);}void set css(String g){assert(false);}String get css{return (null);}bool matches(yB g){if(g is YE)return (false);return (DB==g.DB);}bool CH(String g,String h){return (false);}bool LS(String g){return (false);}static sE GQ(q h,q i,[l BB,String hB]){h=new q.nX(h);i=new q.nX(i);IB.cursor.xG();h.zE();i.zE();assert(h!=i);GB o=new GB.sX(LB.NB('style.remove_styles'));n g=BU(h.u,i.u);n s=g.parent;while(s!=null){if(s is yB&&(BB==null||RN(s,BB,hB)))g=s;s=s.parent;}if(g is OB){q QB=new q.eX(h);q SB=new q.jX(i);sE cB=new sE(o,QB,SB);return (cB);}if(g is yB)g=g.parent;q j=new q(g,0);q EB=new q(g,g.PB);n k;if(j!=h)k=t.HG(g,j,h);else k=null;n v=t.HG(g,h,i);n m;if(EB!=i)m=t.HG(g,i,EB);else m=null;if(BB==null)HQ(v);else ON(v,BB,cssName:hB);int BC=new q.eX(j).HF;int HB;if(k!=null){HB=IQ(k);if(k.lastChild is OB&&v.firstChild is OB){HB-- ;}}else HB=0;q QB=new q.RX(BC+HB);int IC=new q.jX(EB).UF;int KB;if(m!=null){KB=IQ(m);if(m.firstChild is OB&&v.lastChild is OB){KB-- ;}}else KB=0;q SB=new q.XX(IC+KB);o.TB(t.FI(j,EB));if(m!=null)o.TB(t.LE(m,j,checkValidity:false));o.TB(t.LE(v,j,checkValidity:false));if(k!=null)o.TB(t.LE(k,j,checkValidity:false));sE cB=new sE(o,QB,SB);return (cB);}static n BU(n i,n j){n g=i;while(g!=null){n h=j;while(h!=null){if(g==h){return (g);}if(h.parent==null)break;h=h.parent;}if(g.parent==null)break;g=g.parent;}return (null);}static HQ(n h){for(n g=h.firstChild;g!=null;){if(g is yB){n j=g.firstChild;for(n i=g.firstChild;i!=null;){n k=i.nextSibling;h.insertBefore(i,g);i=k;}h.gC(g);g=j;}else{HQ(g);g=g.nextSibling;}}h.normalize();}static ON(n h,l j,{String cssName,String cssValue}){for(n g=h.firstChild;g!=null;){if((cssValue!=null&&SN(g,j,cssName,cssValue))||RN(g,j,cssName)){if(g is YE&&cssName!=null&&(new uD((g as YE).css)).keys.length>1){uD k=new uD((g as YE).css);k.remove(cssName);(g as YE).css=k.toString();}else{n m=g.firstChild;for(n i=g.firstChild;i!=null;){n o=i.nextSibling;h.insertBefore(i,g);i=o;}h.gC(g);g=m;}}else{ON(g,j,cssName:cssName,cssValue:cssValue);g=g.nextSibling;}}h.normalize();}static int IQ(n i){n k=i;int m=i.PB;int j=0;n g=i;int h=0;while(g!=k||h!=m){if(h==g.PB){h=g.parent.ZB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.eB(h);h=0;}j++ ;}return (j);}static GB CU(q o,[l k,String i]){n h=o.u;if(h is OB)h=h.parent;for(n g=h;g!=null;g=g.parent){if((k==null&&g is yB)||RN(g,k,i)){if(g is YE&&i!=null&&(new uD((g as YE).css)).keys.length>1){uD m=new uD((g as YE).css);m.remove(i);aB s=new aB((g as YE).Lb,m.toString());return (new GB.rX(g,s));}else{GB j=new GB.sX(LB.NB('undo.remove_element'));n v=new n.wX(g);q BB=new q(g.parent,g.parent.ZB(g)+1);j.TB(t.LE(v,BB,checkValidity:false));j.TB(new GB.pX(g));return (j);}}}return (null);}static void eL([l i,String j]){q g=IB.vC();q k=IB.GF();if(g==null)return;if(g==k){GB m=CU(g,i,j);if(m!=null)t.DC(m);IB.LC();}else{sE h=GQ(g,k,i,j);t.DC(h.vH);IB.cursor.gE(h.start,h.end);IB.LC();}}static bool RN(n g,l i,String h){if(g is!yB)return (false);if(g.DB!=i)return (false);if(h==null)return (true);if((g as yB).css==null)return (false);return ((g as yB).LS(h));}static bool SN(n g,l h,String i,String j){if(g is!yB)return (false);if(g.DB!=h)return (false);if((g as yB).css==null)return (true);return ((g as yB).CH(i,j));}static sE JQ(q k,q m,l o,{String cssName,String cssValue}){assert(k!=m);GB EB=new GB.sX(LB.NB('style.apply_style'));q HB=k;q s=new q.eX(k);q g=new q.nX(k);g.zE();if(g.u is OB&&g.JB==0){n h=g.u.previousSibling;if(h is yB&&SN(h,o,cssName,cssValue)){HB=new q(h.parent,h.parent.ZB(h));s=new q.eX(g);s.OG(-2);if(h.lastChild is OB)s.OG(-1);}}q v=m;q BB=new q.jX(m);q j=new q.nX(m);j.zE();if(j.u is OB&&j.JB==j.u.PB){n i=g.u.nextSibling;if(i is yB&&SN(i,o,cssName,cssValue)){v=new q(i.parent,i.parent.ZB(i)+1);BB=new q.jX(j);BB.OG(2);if(i.firstChild is OB)BB.OG(1);}}n KB=t.hI(HB,v);ON(KB,o,cssName:cssName,cssValue:cssValue);TN(KB,o,cssName,cssValue);EB.TB(t.LE(KB,v,checkValidity:false));EB.TB(t.FI(HB,v));return (new sE(EB,s,BB));}static void KQ(l i,{String cssName,String cssValue}){q g=IB.vC();q o=IB.GF();if(g==o){n h=g.u;if(h is OB)h=h.parent;n j=ND.NF(i,'element');if(cssName!=null&&cssValue!=null)(j as yB).css="${cssName}: ${cssValue}";bool s=false;if(t.ZC!=null){if(!t.CB.fD(h.DB,i)){l k=t.CB.fF(h.DB,t.ZC);if(k!=null&&t.CB.fD(k,i)){kB v=new kB.UY(k);v.jB(j);t.insertNode(v,g);s=true;}}}if(!s)t.insertNode(j,g);q BB=j.QE();if(BB!=null){IB.JD(BB);IB.LC();}return;}sE m=JQ(g,o,i,cssName:cssName,cssValue:cssValue);t.DC(m.vH);IB.cursor.gE(m.start,m.end);IB.LC();}static void TN(n i,l j,String k,String m){if(t.CB.fD(i.DB,j)){n h=null;for(n g=i.firstChild;g!=null;){if(g is OB||t.CB.fD(j,g.DB)){n o=g.nextSibling;i.gC(g);if(h==null){h=ND.NF(j,'element');if(k!=null&&m!=null)(h as yB).css="${k}: ${m}";}h.jB(g);g=o;}else{if(h!=null){i.insertBefore(h,g);h=null;}TN(g,j,k,m);g=g.nextSibling;}}if(h!=null)i.jB(h);}else{for(n g=i.firstChild;g!=null;g=g.nextSibling){if(g is!OB)TN(g,j,k,m);}}}static void HU(l g,String h,String k){q m=IB.vC();q o=IB.GF();if(m==o){yB.KQ(g,cssName:h,cssValue:k);}else{sE i=yB.GQ(m,o,g,h);t.DC(i.vH);sE j=JQ(i.start,i.end,g,cssName:h,cssValue:k);t.DC(j.vH);t.lK(LB.NB('style.apply_style'),2);IB.cursor.gE(j.start,j.end);IB.LC();}}static sE UN(q g){yB h=null,i=null;if(g.u is yB&&g.JB==g.u.PB)h=g.u;else if(g.u is OB&&g.JB==g.u.PB&&g.u.parent is yB&&g.u.parent.ZB(g.u)==g.u.parent.PB)h=g.u.parent;else if(g.u is!OB&&g.JB>0&&g.u.PB>0&&g.u.eB(g.JB-1) is yB)h=g.u.eB(g.JB-1);if(g.u is yB&&g.JB==0)i=g.u;else if(g.u is OB&&g.JB==0&&g.u.parent is yB&&g.u.parent.ZB(g.u)==0)i=g.u.parent;else if(g.u is!OB&&g.JB<g.u.PB&&g.u.PB>0&&g.u.eB(g.JB) is yB)i=g.u.eB(g.JB);if(h==null||i==null)return (null);if(!h.matches(i))return (null);q j;if(h.lastChild is OB&&i.firstChild is OB)j=new q(h.lastChild,h.lastChild.PB);else j=new q(h,h.PB);GB k=new GB.sX('merge');k.TB(new GB.pX(i));n m=new n.wX(i);k.TB(t.LE(m,new q(h,h.PB)));return (new sE(k,j,new q.nX(j)));}}class DJ extends n{ImageElement Sb;String Ub;String Xb;String Yb;String Vb;NN Pb;DJ.uY(l g):super.tX(g){Ub=t.CB.bC(DB,'texteAtt',null);Xb=t.CB.bC(DB,'labelAtt',null);Yb=t.CB.bC(DB,'serveur',null);}DJ.yY(AB g,n h):super.oX(g,h,createChildren:false){Ub=t.CB.bC(DB,'texteAtt','texte');Yb=t.CB.bC(DB,'serveur',null);if(g.firstChild!=null)Vb=g.firstChild.nodeValue;else Vb=null;}Element html(){Sb=new ImageElement();Sb.attributes['id']="${id}";Sb.attributes['class']='dn';if(Vb!=null){String g="data:image/png;base64,${Vb}";Sb.attributes['src']=g;}Sb.onLoad.listen((Event h)=>nO());Sb.onClick.listen((MouseEvent h)=>JE());Sb.style.verticalAlign='middle';return (Sb);}void nO(){if(Sb.naturalWidth>500){Sb.width=500;}}q QE(){return (null);}q SF(){return (null);}void JE([FD g]){String h=getAttribute(Ub);String i=getAttribute(Xb);Pb=new NN(Yb,h,labelName:Xb,labelValue:i,okfct:()=>rU(g));Pb.show();}void rU(FD g){if(g!=null)g();String j=Pb.fB();String h=Pb.kR();if(g==null){List<aB> i=new List<aB>();i.add(new aB(Ub,j));if(Xb!=null&&h!='')i.add(new aB(Xb,h));GB k=new GB.qX(this,i,updateDisplay:false);t.DC(k);}else{setAttribute(Ub,j);if(Xb!=null)setAttribute(Xb,h);}IL();}void uI(){IL();}void IL(){String g=getAttribute(Ub);getData(g).then((String h){Vb=h;sD();IB.JD(new q(parent,parent.ZB(this)+1));},onError:(Object i){window.alert(i.toString());});}Future<String> getData(String g){if(g==null||g=='')g='?';Completer<String> h=new Completer<String>();String j="${Yb}?${Uri.encodeComponent(g)}";HttpRequest.request(j,method:'GET',responseType:'arraybuffer').then((HttpRequest k){Object i=k.response;if(i is ByteBuffer){Uint8List m=new Uint8List.view(i);String o=GT.HT(m);h.complete(o);}else h.completeError(new LD('request response is not a ByteBuffer'));},onError:(Object s){h.completeError(new LD("Error getting the equation image from the server ${Yb} : ${s}"));});return (h.future);}AB KF(sB i){l g=i.createElementNS(pB,nodeName);for(aB h in attributes)g.setAttributeNS(h.pB,h.name,h.value);if(Vb!=null)g.jB(i.wG(Vb));return (g);}}class aG extends n{String Zb;String ab;String bb;l cb;l eb;l fb;String gb;String hb;String ib;String jb;String kb;String lb;bool header;aG.vY(l g):super.tX(g){yE();LV();}aG.xY(AB h,n i):super.oX(h,i,createChildren:false){yE();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==AB.FE&&g.nodeName==gb)mb(g);}for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==AB.FE&&g.nodeName==hb)mb(g);}mb(h);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==AB.FE&&g.nodeName==ib)mb(g);}if(firstChild!=null&&firstChild.firstChild is BG)header=true;}void mb(AB j){for(AB h=j.firstChild;h!=null;h=h.nextSibling){if(h.nodeType==AB.FE&&h.nodeName==Zb){n i=new rE.AZ(h,this);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==AB.FE){if(g.nodeName==ab){n k=new NC.CZ(g,i);i.jB(k);}else if(g.nodeName==bb){n m=new BG.EZ(g,i);i.jB(m);}}}jB(i);}}}void yE(){lM=true;Zb=t.CB.bC(DB,'trTag','tr');List<l> g=t.CB.nK(Zb);cb=t.CB.fF(DB,g);ab=t.CB.bC(DB,'tdTag','td');List<l> h=t.CB.nK(ab);eb=t.CB.fF(cb,h);bb=t.CB.bC(DB,'thTag','th');List<l> i=t.CB.nK(bb);fb=t.CB.fF(cb,i);hb=t.CB.bC(DB,'tbodyTag','tbody');gb=t.CB.bC(DB,'theadTag','thead');ib=t.CB.bC(DB,'tfootTag','tfoot');jb=t.CB.bC(DB,'colspanAttr',null);kb=t.CB.bC(DB,'rowspanAttr',null);lb=t.CB.bC(DB,'alignAttr',null);header=false;}Element html(){DivElement j=new DivElement();j.id="${id}";j.classes.add('dn');j.classes.add('table');FormElement g=new FormElement();g.classes.add('table_buttons');ButtonElement v=new ButtonElement();v.attributes['type']='button';v.appendText(LB.NB("table.Table"));v.onClick.listen((MouseEvent h)=>JE());v.style.marginRight='1em';g.append(v);ButtonElement BB=new ButtonElement();BB.attributes['type']='button';BB.appendText(LB.NB("table.Row"));BB.onClick.listen((MouseEvent h)=>YW());BB.style.marginRight='0.2em';g.append(BB);ButtonElement EB=new ButtonElement();EB.attributes['type']='button';EB.appendText("+");EB.onClick.listen((MouseEvent h)=>insertRow());EB.style.marginRight='0.2em';g.append(EB);ButtonElement HB=new ButtonElement();HB.attributes['type']='button';HB.appendText("-");HB.onClick.listen((MouseEvent h)=>RW());HB.style.marginRight='1em';g.append(HB);g.appendText(LB.NB('table.Column'));ButtonElement KB=new ButtonElement();KB.attributes['type']='button';KB.appendText("+");KB.onClick.listen((MouseEvent h)=>sV());KB.style.marginRight='0.2em';g.append(KB);ButtonElement QB=new ButtonElement();QB.attributes['type']='button';QB.appendText("-");QB.onClick.listen((MouseEvent h)=>PW());QB.style.marginRight='1em';g.append(QB);ButtonElement SB=new ButtonElement();SB.attributes['type']='button';SB.appendText(LB.NB("table.Cell"));SB.onClick.listen((MouseEvent h)=>DV());SB.style.marginRight='1em';g.append(SB);CheckboxInputElement cB=new CheckboxInputElement();cB.id="header${id}";cB.checked=header;cB.onClick.listen((MouseEvent h)=>pW());g.append(cB);LabelElement hB=new LabelElement();hB.htmlFor="header${id}";hB.appendText(LB.NB('table.header'));hB.style.marginRight='1em';g.append(hB);ButtonElement k=new ButtonElement();k.attributes['type']='button';ImageElement i=new ImageElement();i.src='packages/daxe/images/mergeright.png';k.append(i);k.onClick.listen((MouseEvent h)=>BW());k.style.marginRight='0.2em';k.title=LB.NB('table.merge_right');g.append(k);ButtonElement m=new ButtonElement();m.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/splitx.png';m.append(i);m.onClick.listen((MouseEvent h)=>bS());m.style.marginRight='0.2em';m.title=LB.NB('table.split_x');g.append(m);ButtonElement o=new ButtonElement();o.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/mergebottom.png';o.append(i);o.onClick.listen((MouseEvent h)=>AW());o.style.marginRight='0.2em';o.title=LB.NB('table.merge_bottom');g.append(o);ButtonElement s=new ButtonElement();s.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/splity.png';s.append(i);s.onClick.listen((MouseEvent h)=>ZP());s.style.marginRight='0.2em';s.title=LB.NB('table.split_y');g.append(s);j.append(g);TableElement IC=new TableElement();IC.classes.add('indent');n BC=firstChild;while(BC!=null){IC.append(BC.html());BC=BC.nextSibling;}j.append(IC);return (j);}q QE(){if(firstChild==null||firstChild.firstChild==null){return (null);}return (new q(firstChild.firstChild,0));}q SF(){if(lastChild==null||lastChild.lastChild==null){return (null);}return (new q(lastChild.lastChild,lastChild.lastChild.PB));}void LV(){int j=2;int k=2;for(int g=0;g<j;g++ ){rE h=new rE.zY(cb);for(int i=0;i<k;i++ ){NC m=new NC.BZ(eb);h.jB(m);}jB(h);}}void YW(){rE g=rO();if(g==null)return;g.JE();}void insertRow(){rE h=rO();if(h==null)return;n g=new rE.zY(cb);for(int i=0;i<eP();i++ ){NC j=new NC.BZ(eb);g.jB(j);}t.insertNode(g,new q(this,ZB(h)+1));IB.JD(g.QE());}void RW(){rE g=rO();if(g==null)return;GB h=new GB.sX(LB.NB('undo.remove'));for(NC i in g.childNodes){if(i.RG>1)ZP(i,h);}h.TB(new GB.pX(g));t.DC(h);}void sV(){NC g=nI();if(g==null)return;GB j=new GB.sX(LB.NB('undo.insert'));int m=kI(g);for(n h in childNodes){NC i;if(firstChild==h&&header)i=new BG.DZ(fb);else i=new NC.BZ(eb);int k=0;for(NC g=h.firstChild;g!=null&&m>=kI(g);g=g.nextSibling){k++ ;}j.TB(new GB.mX(new q(h,k),i));}t.DC(j);IB.JD(new q(g.nextSibling,0));}void PW(){NC g=nI();if(g==null)return;q h;if(g.nextSibling!=null)h=new q(g.nextSibling,0);else if(g.previousSibling!=null)h=new q(g.previousSibling,0);else h=null;GB j=new GB.sX(LB.NB('undo.remove'));int k=kI(g);int i=0;for(n m in childNodes){NC g=SM(k,i);while(g.IG>1){bS(g);g=SM(k,i);}j.TB(new GB.pX(g));i++ ;}t.DC(j);if(h!=null)IB.JD(h);}void DV(){NC g=nI();if(g==null)return;g.JE();}NC nI(){q h=IB.vC();n g=h.u;while(g!=null&&g is!NC)g=g.parent;return (g);}rE rO(){q h=IB.vC();n g=h.u;while(g!=null&&g is!rE)g=g.parent;return (g);}NC SM(int g,int h){return (grid()[g][h]);}int kI(NC j){List<List<NC>> h=grid();for(int g=0;g<h.length;g++ )for(int i=0;i<h[0].length;i++ )if(h[g][i]==j)return (g);assert(false);return (-1);}int oO(NC j){List<List<NC>> h=grid();for(int i=0;i<h.length;i++ )for(int g=0;g<h[0].length;g++ )if(h[i][g]==j)return (g);assert(false);return (-1);}List<List<NC>> grid(){int j=eP();int s=iS();List<List<NC>> h=new List<List<NC>>(j);for(int g=0;g<j;g++ )h[g]=new List<NC>(s);int k=0;for(rE v in childNodes){int g=0;for(NC i in v.childNodes){while(g<j&&h[g][k]!=null)g++ ;for(int m=0;m<i.IG;m++ ){for(int o=0;o<i.RG;o++ ){h[g+m][k+o]=i;}}g+= i.IG;}k++ ;}return (h);}int eP(){int g=0;for(rE i in childNodes){int h=0;for(NC j in i.childNodes){h+= j.IG;}g=max(g,h);}return (g);}int iS(){int g=0;for(rE h in childNodes){NC i=h.firstChild;g+= i.RG;}return (g);}void pW(){rE j=firstChild;if(j==null)return;n g=j.firstChild;while(g!=null){n s=g.nextSibling;if(header&&g is BG){NC k=new NC.BZ(eb);n h=g.firstChild;while(h!=null){n m=h.nextSibling;g.gC(h);k.jB(h);h=m;}for(aB i in g.attributes)k.setAttribute(i.name,i.value);g.replaceWith(k);}else if(!header&&g is NC&&g is!BG){BG o=new BG.DZ(fb);n h=g.firstChild;while(h!=null){n m=h.nextSibling;g.gC(h);o.jB(h);h=m;}for(aB i in g.attributes)o.setAttribute(i.name,i.value);g.replaceWith(o);}g=s;}header=!header;j.sD();}void BW([NC g]){if(g==null)g=nI();if(g==null)return;int m=kI(g);int o=oO(g);int j=m+g.IG;if(j>=eP())return;NC k=SM(j,o);if(k.parent!=g.parent)ZP(k);NC h=g.nextSibling;if(h==null)return;if(h.RG!=g.RG){return;}GB i=new GB.sX(LB.NB('table.merge'));i.TB(new GB.rX(g,new aB(jb,(g.IG+h.IG).toString())));i.TB(new GB.pX(h));t.DC(i);IB.JD(g.QE());IB.LC();}void AW([NC g]){if(g==null)g=nI();if(g==null)return;int k=kI(g);int m=oO(g);int j=m+g.RG;if(j>=iS())return;NC h=SM(k,j);if(h.IG!=g.IG){return;}GB i=new GB.sX(LB.NB('table.merge'));i.TB(new GB.rX(g,new aB(kb,(g.RG+h.RG).toString())));i.TB(new GB.pX(h));t.DC(i);IB.JD(g.QE());IB.LC();}void bS([NC g,GB i]){if(g==null)g=nI();if(g==null)return;if(g.IG<2)return;NC j;if(g is BG)j=new BG.DZ(fb);else j=new NC.BZ(eb);rE k=g.parent;GB h;if(i!=null)h=i;else h=new GB.sX(LB.NB('table.split'));h.TB(new GB.mX(new q(k,k.ZB(g)+1),j));h.TB(new GB.rX(g,new aB(jb,(g.IG-1).toString())));if(i==null)t.DC(h);}void ZP([NC g,GB i]){if(g==null)g=nI();if(g==null)return;if(g.RG<2)return;int m=kI(g);int o=oO(g);int s=o+g.RG-1;rE j=eB(s);if(j==null)return;int k=0;for(NC g=j.firstChild;g!=null&&m>kI(g);g=g.nextSibling){k++ ;}NC v=new NC.BZ(eb);GB h;if(i!=null)h=i;else h=new GB.sX(LB.NB('table.split'));h.TB(new GB.mX(new q(j,k),v));h.TB(new GB.rX(g,new aB(kb,(g.RG-1).toString())));if(i==null)t.DC(h);}bool RE(){return (true);}bool QG(){return (true);}}class LN{static final List<List<String>> UI=[["\u0393","\u0394","\u0398","\u039B","\u039E","\u03A0","\u03A3","\u03A5","\u03A6","\u03A7","\u03A8","\u03A9"],["\u03B1","\u03B2","\u03B3","\u03B4","\u03B5","\u03B6","\u03B7","\u03B8","\u03B9","\u03BA","\u03BB","\u03BC","\u03BD","\u03BE","\u03BF","\u03C0","\u03C1","\u03C2","\u03C3","\u03C4","\u03C5","\u03C6","\u03C7","\u03C8","\u03C9"],["\u03D1","\u03D5","\u03D6"],["\u00AC","\u00B1","\u00D7","\u2113","\u2102","\u2115","\u211A","\u211D","\u2124","\u212B","\u2190","\u2192","\u2194","\u21D0","\u21D2","\u21D4","\u2200","\u2202","\u2203","\u2205","\u2207","\u2208","\u2209","\u2211","\u221D","\u221E","\u2227","\u2228","\u2229","\u222A","\u222B","\u223C","\u2248","\u2260","\u2261","\u2264","\u2265","\u2282"],["\u{1D49C}","\u212C","\u{1D49E}","\u{1D49F}","\u2130","\u2131","\u{1D4A2}","\u210B","\u2110","\u{1D4A5}","\u{1D4A6}","\u2112","\u2133","\u{1D4A9}","\u{1D4AA}","\u{1D4AB}","\u{1D4AC}","\u211B","\u{1D4AE}","\u{1D4AF}","\u{1D4B0}","\u{1D4B1}","\u{1D4B2}","\u{1D4B3}","\u{1D4B4}","\u{1D4B5}"]];static final int MN=13;String RH;FD okfct;TableCellElement kG;LN(this.RH,{this.okfct}){}void show(){DivElement s=new DivElement();s.id='dlg1';s.classes.add('dlg1');DivElement HB=new DivElement();HB.classes.add('dlg2');DivElement KB=new DivElement();KB.classes.add('dlg3');FormElement QB=new FormElement();int cB=0;for(int g=0;g<UI.length;g++ )cB+= (UI[g].length/MN).ceil();TableElement h=new TableElement();h.classes.add('special_dlg');int i=0;for(int g=0;g<UI.length;g++ ){TableRowElement m=new TableRowElement();for(int o=0;o<UI[g].length;o++ ){TableCellElement v=new TableCellElement();v.text=UI[g][o];v.style.textAlign='center';if(RH==UI[g][o]){kG=v;kG.style.border='1px solid black';}m.append(v);i++ ;if(i>=MN){i=0;if(o<UI[g].length-1){h.append(m);m=new TableRowElement();}}}if(i!=0){for(int SB=i;SB<MN;SB++ )m.append(new TableCellElement());i=0;}h.append(m);}h.onClick.listen((MouseEvent j)=>select(j.target));h.onDoubleClick.listen((MouseEvent j){select(j.target);if(kG!=null)iF(null);});QB.append(h);DivElement BB=new DivElement();BB.classes.add('buttons');ButtonElement EB=new ButtonElement();EB.attributes['type']='button';EB.appendText(LB.NB("button.Cancel"));EB.onClick.listen((MouseEvent j)=>cancel());BB.append(EB);ButtonElement k=new ButtonElement();k.id='special_ok';if(RH==null)k.disabled=true;k.attributes['type']='submit';k.appendText(LB.NB("button.OK"));k.onClick.listen((MouseEvent j)=>iF(j));BB.append(k);QB.append(BB);KB.append(QB);HB.append(KB);s.append(HB);document.body.append(s);}void select(EventTarget h){if(h is!Node)return;Node g=h as Node;if(g is TableCellElement){if(kG!=null)kG.style.border='';kG=g;}else if(g.parent is TableCellElement){if(kG!=null)kG.style.border=null;kG=g.parent;}else return;kG.style.border='1px solid black';RH=kG.text;ButtonElement i=querySelector('button#special_ok');i.disabled=false;}void iF(MouseEvent g){querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(okfct!=null)okfct();}void cancel(){querySelector('div#dlg1').remove();IB.AH();}String ZV(){return (RH);}}class NN{String nb;String ob;String pb;FD qb;String Yb;String Vb;NN(this.Yb,String g,{String labelName,String labelValue,FD okfct}){nb=g;ob=labelName;pb=labelValue;qb=okfct;}void show(){DivElement i=new DivElement();i.id='dlg1';i.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement BB=new DivElement();BB.classes.add('dlg3');FormElement h=new FormElement();ImageElement EB=new ImageElement();EB.id='eqimg';EB.src=jR();h.append(EB);TextAreaElement g=new TextAreaElement();g.id='eqtext';if(nb!=null)g.value=nb;g.style.width='100%';g.style.height='4em';g.attributes['spellcheck']='false';g.onInput.listen((Event j)=>FV());h.append(g);if(ob!=null){DivElement k=new DivElement();SpanElement QB=new SpanElement();QB.text=ob;k.append(QB);k.appendText(' ');TextInputElement HB=new TextInputElement();HB.id='eqlabel';if(pb!=null)HB.value=pb;k.append(HB);h.append(k);}DivElement SB=new DivElement();ButtonElement KB=new ButtonElement();KB.appendText(LB.NB("equation.preview"));KB.onClick.listen((MouseEvent j)=>OW(j));SB.append(KB);h.append(SB);DivElement m=new DivElement();m.classes.add('buttons');ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.NB("button.Cancel"));o.onClick.listen((MouseEvent j)=>i.remove());m.append(o);ButtonElement s=new ButtonElement();s.attributes['type']='submit';s.appendText(LB.NB("button.OK"));s.onClick.listen((MouseEvent j)=>iF(j));m.append(s);h.append(m);BB.append(h);v.append(BB);i.append(v);document.body.append(i);g.focus();}void iF(MouseEvent g){TextAreaElement h=querySelector('textarea#eqtext');nb=h.value;if(ob!=null){TextInputElement i=querySelector('input#eqlabel');pb=i.value;}querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(qb!=null)qb();}String fB(){return (nb);}void IL(){if(nb=='')return (null);ImageElement g=querySelector('img#eqimg');CanvasElement h=new CanvasElement(width:g.width,height:g.height);CanvasRenderingContext2D i=h.context2D;i.drawImage(g,0,0);String j=h.toDataUrl('image/png');Vb=j.substring('data:image/png;base64,'.length);}String kR(){return (pb);}String jR(){String g=nb;if(g==null||g=='')g='?';return ("${Yb}?${Uri.encodeComponent(g)}");}void sW(){ImageElement g=querySelector('img#eqimg');g.src=jR();}void OW(MouseEvent g){g.preventDefault();TextAreaElement h=querySelector('textarea#eqtext');nb=h.value;sW();}void FV(){TextAreaElement h=querySelector('textarea#eqtext');String g=h.value;if(g.length>0&&g.contains('\n')){h.value=g.replaceAll('\n','');iF(null);return;}}}class rE extends n{rE.zY(l g):super.tX(g){dJ=true;lM=true;}rE.AZ(AB g,n h):super.oX(g,h,createChildren:false){dJ=true;lM=true;MG();}Element html(){TableRowElement g=new TableRowElement();g.attributes['id']="${id}";g.attributes['class']='dn';n h=firstChild;while(h!=null){g.append(h.html());h=h.nextSibling;}return (g);}q QE(){if(firstChild==null){return (null);}return (new q(firstChild,0));}q SF(){if(lastChild==null){return (null);}return (new q(lastChild,lastChild.PB));}bool RE(){return (true);}}class NC extends n{NC.BZ(l g):super.tX(g){dJ=true;}NC.CZ(AB g,n h):super.oX(g,h){dJ=true;MG();}Element html(){TableCellElement g=new TableCellElement();g.id="${id}";g.classes.add('dn');if(this is BG)g.classes.add('header');g.attributes['rowspan']=RG.toString();g.attributes['colspan']=IG.toString();if(align!='')g.attributes['align']=align;n h=firstChild;while(h!=null){g.append(h.html());h=h.nextSibling;}if(lastChild==null||!lastChild.eC)g.appendText(' ');return (g);}void BF(List<n> h){super.BF(h);TableCellElement g=oB();if(lastChild==null||!lastChild.eC){if(g.lastChild is!Text)g.appendText(' ');}else{if(g.lastChild is Text)g.lastChild.remove();}}int get RG{aG h=parent.parent;String g=getAttribute(h.kb);if(g==null||g=='')return (1);else return (int.parse(g,onError:(String i)=>1));}int get IG{aG h=parent.parent;String g=getAttribute(h.jb);if(g==null||g=='')return (1);else return (int.parse(g,onError:(String i)=>1));}String get align{aG h=parent.parent;String g=getAttribute(h.lb);if(g==null||g=='')return ('');else return (g);}}class sE{GB vH;q start;q end;sE(this.vH,this.start,this.end);}class BG extends NC{BG.DZ(l g):super.BZ(g){}BG.EZ(AB g,n h):super.CZ(g,h){MG();}}class gL implements XL{HashMap<String,String> rb;l sb;HashMap<String,l> tb;HashMap<l,String> ub;gL(l g,HashMap<String,String> h){sb=g;rb=h;vb();}l PM(final String g){return (tb[g]);}List<l> iO(final String g){return ([tb[g]]);}l gG(final l g,final l i){String h;if(g.EC==null)h=g.nodeName;else h=g.localName;return (PM(h));}String cD(final l g){return (ub[g]);}String jI(final l g){return (null);}String OM(final l g){return (null);}String gO(final l g){return (null);}List<String> pK(final l g){return (null);}List<String> jM(final l g){return (null);}bool jO(final l g,final String h){return (true);}List<String> EP(){return (null);}String jG(final String g){return (null);}String KE(){return (null);}List<l> ID(){return (new List.from(ub.keys));}List<l> HI(){return (ID());}bool GI(final l g,final l h){return (false);}bool mD(final l g,final l h){return (true);}List<l> XC(final l j){final List<l> h=new List<l>();final List<AB> k=j.getElementsByTagName('SOUS-ELEMENT');for(int g=0;g<k.length;g++ ){final l v=k[g] as l;h.add(tb[v.getAttribute('element')]);}final List<AB> m=j.getElementsByTagName('SOUS-ENSEMBLE');for(int g=0;g<m.length;g++ ){final l BB=m[g] as l;final String EB=BB.getAttribute('ensemble');final List<AB> o=sb.getElementsByTagName('ENSEMBLE');for(int i=0;i<o.length;i++ ){final l s=o[i] as l;if(EB==s.getAttribute('nom'))h.addAll(XC(s));}}return (h);}String ZD(final l m,final bool k,final bool o){final List<l> j=XC(m);final StringBuffer g=new StringBuffer();final int i=j.length;for(int h=0;h<i;h++ ){if(h!=0)g.write('|');if(k)g.write(wb(j[h]));else g.write(cD(j[h]));if(!k)g.write(',');}if(i!=0){String i=g.toString();g.clear();g.write('(');g.write(i);g.write(')*');}return (g.toString());}List<l> fC(final l j){final List<l> i=new List<l>();if(j.nodeName=='ELEMENT'){final List<AB> k=sb.getElementsByTagName('SOUS-ELEMENT');for(int h=0;h<k.length;h++ ){final l m=k[h] as l;if(m.getAttribute('element')==j.getAttribute('nom')){final l g=m.parentNode as l;if(g.nodeName=='ELEMENT')i.add(g);else if(g.nodeName=='ENSEMBLE')i.addAll(fC(g));}}}else if(j.nodeName=='ENSEMBLE'){final String v=j.getAttribute('nom');final List<AB> o=sb.getElementsByTagName('SOUS-ENSEMBLE');for(int h=0;h<o.length;h++ ){final l s=o[h] as l;if(s.getAttribute('ensemble')==v){final l g=s.parentNode as l;if(g.nodeName=='ELEMENT')i.add(g);else if(g.nodeName=='ENSEMBLE')i.addAll(fC(g));}}}return (i);}List<l> fE(final l h){final List<AB> i=h.getElementsByTagName('ATTRIBUT');final List<l> g=new List<l>();for(AB j in i)g.add(j as l);return (g);}String attributeName(final l g){return (g.getAttribute('nom'));}String attributeNamespace(final l g){return (null);}String vG(final l g){return (null);}String eK(final String g){return (null);}bool TO(final l i,final l g){final String h=g.getAttribute('presence');return (h=='obligatoire');}List<String> gI(final l j){final List<AB> g=j.getElementsByTagName('VALEUR');if(g.length==0)return (null);final List<String> i=new List<String>();for(int h=0;h<g.length;h++ ){final l k=g[h] as l;final String m=k.firstChild.nodeValue.trim();i.add(m);}return (i);}List<String> aP(final l g){return (null);}String dF(final l g){return (null);}UO(final l h,final String g){final String j=h.getAttribute('presence');bool k=(j=='obligatoire');if((g==null||g=='')&&k)return (false);final List<String> i=gI(h);if(i!=null)return (i.contains(g));return (true);}bool PE(final l g){final String h=g.getAttribute('texte');return (h=='autorise');}void vb(){tb=new HashMap<String,l>();ub=new HashMap<l,String>();final List<AB> i=sb.getElementsByTagName('ELEMENT');for(int g=0;g<i.length;g++ ){final l h=i[g] as l;final String j=h.getAttribute('nom');tb[j]=h;ub[h]=j;}}String wb(final l h){String g=ub[h];if(rb[g]!=null)return (rb[g]);else return (g);}}class LB{static String LQ="packages/daxe/LocalStrings";static HashMap<String,String> VN=null;static String hL;static const IU='en';static Future<bool> JU(){Completer<bool> i=new Completer<bool>();bQ().then((String k){if(k!=null)hL=k;else hL=IU;String m=hL.split('_')[0];String o="${LQ}_${m}.properties";HttpRequest g=new HttpRequest();g.open("GET",o);g.onLoad.listen((ProgressEvent s){String v=g.responseText;VN=new HashMap<String,String>();List<String> BB=v.split("\n");for(String h in BB){if(h.startsWith('#'))continue;int j=h.indexOf('=');if(j==-1)continue;String EB=h.substring(0,j).trim();String HB=h.substring(j+1).trim();VN[EB]=HB;}i.complete(true);});g.onError.listen((ProgressEvent s){i.completeError("Error when reading the strings in ${LQ}");});g.send();});return (i.future);}static String NB(String g){return (VN[g]);}}class WN implements uB{List<uJ> xb;WN(final l h){xb=new List<uJ>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="documentation"){xb.add(new uJ(g as l));break;}}}String sK(){if(xb==null)return (null);StringBuffer g=new StringBuffer();for(uJ h in xb){if(h.hF()!=null)g.write(h.hF());}return (g.toString());}}class qF implements Exception{final String message;final Exception parentException;const qF([this.message,this.parentException]);String toString(){String g;if(message==null)g='WXSException';else g=message;if(parentException!=null)g="${g} (parent exception: ${parentException})";return (g);}}class kC extends EE implements bG,TD,rC{kL yb=null;TD zb=null;List<uB> Ac;String Bc=null;bool Cc=false;bool Dc=false;rC Ec;YB Fc;List<FB> Gc;List<rF> Hc;kC(final l h,final rC j,final YB i){Ic(h);Ac=new List<uB>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="simpleContent")yb=new kL(g as l,i);else if(g.localName=="complexContent")zb=new CG(g as l,this,i);else if(g.localName=="group")zb=new DE(g as l,this,i);else if(g.localName=="all")zb=new vJ(g as l,this,i);else if(g.localName=="choice")zb=new VI(g as l,this,i);else if(g.localName=="sequence")zb=new WI(g as l,this,i);else if(g.localName=="attribute")Ac.add(new iB(g as l,this,i));else if(g.localName=="attributeGroup")Ac.add(new lD(g as l,this,i));}}if(h.zB("name"))Bc=h.getAttribute("name");if(h.zB("mixed"))Cc=h.getAttribute("mixed")=="true"||h.getAttribute("mixed")=="1";if(h.zB("abstract"))Dc=h.getAttribute("abstract")=="true"||h.getAttribute("abstract")=="1";this.Ec=j;this.Fc=i;Gc=null;Hc=null;}kL mV(){return (yb);}String getName(){return (Bc);}bool gV(){return (Cc);}String gF(){return (Fc.KE());}rC getParent(){return (Ec);}void AC(final YB g,final uB i){if(yb!=null)yb.AC(g,i);if(zb!=null)zb.AC(g,i);for(uB h in Ac){if(h is iB)h.AC(g);else if(h is lD)h.AC(g,i);}}void MJ(final FB g){if(Gc==null)Gc=new List<FB>();Gc.add(g);}void nU(final rF g){if(Hc==null)Hc=new List<rF>();Hc.add(g);}List<FB> ID(){if(zb!=null)return (zb.ID());return (new List<FB>());}List<FB> XC(){final List<FB> g=new List<FB>();if(zb!=null)g.addAll(zb.XC());return (g);}List<FB> fC(){final List<FB> g=new List<FB>();if(Ec is FB){if(!(Ec as FB).SH())g.add(Ec as FB);final List<FB> h=(Ec as FB).wR();if(h!=null)g.addAll(h);}if(Gc!=null){for(FB i in Gc){if(!i.SH())g.add(i);final List<FB> h=i.wR();if(h!=null)g.addAll(h);}}if(Hc!=null){for(rF j in Hc)g.addAll(j.fC());}return (g);}String ZD(){if(zb!=null)return (zb.ZD());return (null);}bool TE(final FB g){if(zb!=null)return (zb.TE(g));return (null);}bool mD(final FB g){if(zb!=null)return (zb.mD(g));return (null);}List<String> hD(){if(yb!=null)return (yb.hD());return (null);}List<String> KD(){if(yb!=null)return (yb.KD());return (null);}List<iB> attributes(){if(yb!=null)return (yb.attributes());else if(zb is CG)return ((zb as CG).attributes());final List<iB> h=new List<iB>();for(uB g in Ac){if(g is iB)h.add(g);else if(g is lD)h.addAll(g.attributes());}return (h);}int VE(final List<FB> h,final int g,final bool i){if(yb!=null)return (g);else if(zb!=null)return (zb.VE(h,g,i));return (g);}bool eD(){if(yb!=null)return (true);else if(zb!=null)return (zb.eD());return (true);}bool ED(final String g){if(yb!=null)return (yb.ED(g));return (g.trim()==''||PJ());}bool PJ(){if(zb is CG){CG h=zb as CG;bG g=null;if(h.zb is rF){rF i=h.zb as rF;if(i.zb==null)g=i.Jc;}else{qG j=h.zb as qG;if(j.zb==null)g=j.Jc;}if(g is kC)return ((g as kC).PJ());}if(gV())return (true);if(mV()!=null)return (true);return (false);}}class DE extends EE implements TD,rC{TD Kc=null;String Bc=null;String Lc=null;DE Mc=null;int Nc=1;int Oc=1;l Pc;rC Ec;YB Fc;List<DE> Gc;DE(final l g,final rC j,final YB i){Ic(g);for(AB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l){if(h.localName=="all")Kc=new vJ(h as l,this,i);else if(h.localName=="choice")Kc=new VI(h as l,this,i);else if(h.localName=="sequence")Kc=new WI(h as l,this,i);}}if(g.zB("name"))Bc=g.getAttribute("name");if(g.zB("ref"))Lc=g.getAttribute("ref");try {if(g.zB("minOccurs"))Nc=int.parse(g.getAttribute("minOccurs"));if(g.zB("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Oc=9007199254740992;else Oc=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}Pc=g;this.Ec=j;this.Fc=i;Gc=null;}String getName(){if(Bc==null&&Mc!=null)return (Mc.getName());return (Bc);}String gF(){return (Fc.KE());}rC getParent(){return (Ec);}void AC(final YB g,final uB h){if(Kc!=null)Kc.AC(g,h);if(Lc!=null){final String i=Pc.YD(vB.aE(Lc));Mc=g.XW(vB.ZE(Lc),i,h);if(Mc!=null)Mc.MJ(this);else print("Rfrence de groupe introuvable : ${Lc}");}}void MJ(final DE g){if(Gc==null)Gc=new List<DE>();Gc.add(g);}List<FB> ID(){if(Kc!=null)return (Kc.ID());return (new List<FB>());}List<FB> XC(){if(Mc!=null)return (Mc.XC());if(Kc!=null)return (Kc.XC());return (new List<FB>());}List<FB> fC(){final List<FB> g=new List<FB>();if(Ec!=null)g.addAll(Ec.fC());if(Gc!=null){for(DE h in Gc)g.addAll(h.fC());}return (g);}String ZD(){String g;if(Mc!=null)g=Mc.ZD();else if(Kc!=null)g=Kc.ZD();else g="()";if(Nc==0&&Oc==1)return ("${g}?");else if(Nc==0&&Oc>1)return ("${g}*");else if(Nc>0&&Oc>1)return ("${g}+");else return (g);}bool TE(final FB g){if(Mc!=null)return (Mc.TE(g));bool h=null;if(Kc!=null)h=Kc.TE(g);return (h);}bool mD(final FB g){if(Mc!=null)return (Mc.mD(g));bool h=null;if(Kc!=null)h=Kc.mD(g);return (h);}int VE(final List<FB> h,final int k,final bool j){if(!j&&h.length<Nc)return (k);int m=0;for(int g=k;g<h.length;){if(m>=Oc)return (g);int i=g;if(Mc!=null)i=Mc.VE(h,g,j);else if(Kc!=null)i=Kc.VE(h,g,j);if(i==g)return (g);g=i;m++ ;}return (h.length);}bool eD(){if(Nc==0)return (true);if(Mc!=null)return (Mc.eD());if(Kc!=null)return (Kc.eD());return (true);}}class lD extends EE implements rC{List<uB> Ac;String Bc=null;String Lc=null;lD Mc=null;l Pc;rC Ec;YB Fc;lD(final l h,final rC j,final YB i){Ic(h);Ac=new List<uB>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="attribute")Ac.add(new iB(g as l,this,i));else if(g.localName=="attributeGroup")Ac.add(new lD(g as l,this,i));}}if(h.zB("name"))Bc=h.getAttribute("name");if(h.zB("ref"))Lc=h.getAttribute("ref");Pc=h;this.Ec=j;this.Fc=i;}String gF(){return (Fc.KE());}rC getParent(){return (Ec);}void AC(final YB h,final uB j){for(uB g in Ac){if(g is iB)g.AC(h);else if(g is lD)g.AC(h,j);}if(Lc!=null){final String k=vB.aE(Lc);String i;if(k=="xml")i="http://www.w3.org/XML/1998/namespace";else i=Pc.YD(k);Mc=h.VW(vB.ZE(Lc),i,j);}}String getName(){if(Bc==null&&Mc!=null)return (Mc.getName());return (Bc);}List<FB> fC(){if(Ec!=null)return (Ec.fC());return (new List<FB>());}List<iB> attributes(){if(Mc!=null)return (Mc.attributes());final List<iB> h=new List<iB>();for(uB g in Ac){if(g is iB)h.add(g);else if(g is lD)h.addAll(g.attributes());}return (h);}}class iB extends EE{jC Qc=null;String Bc=null;String Lc=null;String Rc=null;String Sc=null;String Tc=null;String Uc=null;String Vc=null;iB Mc=null;l Pc;rC Ec;YB Fc;iB(final l g,final rC j,final YB i){Ic(g);for(AB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l&&h.localName=="simpleType"){Qc=new jC(h as l,null,i);break;}}if(g.zB("name"))Bc=g.getAttribute("name");if(g.zB("ref"))Lc=g.getAttribute("ref");if(g.zB("type"))Rc=g.getAttribute("type");if(g.zB("use"))Sc=g.getAttribute("use");if(g.zB("default"))Tc=g.getAttribute("default");if(g.zB("fixed"))Uc=g.getAttribute("fixed");if(g.zB("form"))Vc=g.getAttribute("form");Pc=g;this.Ec=j;this.Fc=i;}void AC(final YB h){if(Qc!=null)Qc.AC(h,null);if(Lc!=null){final String i=vB.aE(Lc);String g;if(i=="xml")g="http://www.w3.org/XML/1998/namespace";else g=Pc.YD(i);Mc=h.WW(vB.ZE(Lc),g);if(Mc==null)print("WXSAttribute: Rfrence d'attribut introuvable : ${Lc}");}if(Qc==null&&Rc!=null){final String g=Pc.YD(vB.aE(Rc));if(g==null||g!=Pc.pB||h.KE()==null||h.KE()==Pc.pB){final bG j=h.XJ(vB.ZE(Rc),g,null);if(j is jC)Qc=j;}}if(Qc==null&&Mc!=null)Qc=Mc.Qc;}String getName(){if(Bc==null&&Mc!=null)return (Mc.getName());return (Bc);}String yR(){return (Sc);}l NG(){return (Pc);}String gF(){if(Lc!=null){final String h=vB.aE(Lc);if(h!=null){final String i=Pc.YD(h);if(i!=null)return (i);if(h=="xml")return ("http://www.w3.org/XML/1998/namespace");return (null);}}bool g;if(Fc.oV().contains(this))g=true;else if(Vc!=null)g=(Vc=="qualified");else g=(Fc.WV()=="qualified");if(g){final String j=Fc.KE();if(j=="")return (null);else return (j);}else return (null);}List<FB> fC(){if(Ec!=null)return (Ec.fC());return (new List<FB>());}List<String> hD(){if(Uc!=null){final List<String> g=new List<String>();g.add(Uc);return (g);}if(Fc.KE()!=null&&Fc.KE()==Pc.pB&&vB.ZE(Rc)=="bool")return (vB.sG(Rc,Pc));if(Qc!=null)return (Qc.hD());else if(Rc!=null)return (vB.sG(Rc,Pc));return (null);}List<String> KD(){if(Uc!=null){final List<String> g=new List<String>();g.add(Uc);return (g);}if(Fc.KE()!=null&&Fc.KE()==Pc.pB&&vB.ZE(Rc)=="bool")return (vB.sG(Rc,Pc));if(Qc!=null)return (Qc.KD());else if(Rc!=null)return (vB.sG(Rc,Pc));return (null);}String defaultValue(){if(Tc!=null)return (Tc);else if(Uc!=null)return (Uc);else if(Mc!=null)return (Mc.defaultValue());return (null);}bool ED(final String g){if(Uc!=null)return (Uc==g);if((g==null||g=="")&&Sc=="required")return (false);if(Qc!=null)return (Qc.ED(g));if(Rc!=null){final String h=Pc.YD(vB.aE(Rc));if(h!=null&&h==Pc.pB)return (jC.xJ(vB.ZE(Rc),g));}if(Mc!=null)return (Mc.ED(g));if(Rc==null)return (true);return (false);}}class qG extends EE implements TD,rC{jC Qc=null;List<DF> Wc;TD zb=null;List<uB> Ac;String Xc=null;bG Jc=null;l Pc;CG Ec;qG(final l j,final CG k,final YB i){Ic(j);Wc=new List<DF>();Ac=new List<uB>();for(AB g=j.firstChild;g!=null;g=g.nextSibling){if(g is l){String h=g.localName;if(h=="simpleType")Qc=new jC(g as l,this,i);else if(h=="minExclusive")Wc.add(new DF(g as l));else if(h=="minInclusive")Wc.add(new DF(g as l));else if(h=="maxExclusive")Wc.add(new DF(g as l));else if(h=="maxInclusive")Wc.add(new DF(g as l));else if(h=="totalDigits")Wc.add(new DF(g as l));else if(h=="fractionDigits")Wc.add(new DF(g as l));else if(h=="length")Wc.add(new DF(g as l));else if(h=="minLength")Wc.add(new DF(g as l));else if(h=="maxLength")Wc.add(new DF(g as l));else if(h=="enumeration")Wc.add(new DF(g as l));else if(h=="pattern")Wc.add(new DF(g as l));else if(h=="group")zb=new DE(g as l,this,i);else if(h=="all")zb=new vJ(g as l,this,i);else if(h=="choice")zb=new VI(g as l,this,i);else if(h=="sequence")zb=new WI(g as l,this,i);else if(h=="attribute")Ac.add(new iB(g as l,this,i));else if(h=="attributeGroup")Ac.add(new lD(g as l,this,i));}}if(j.zB("base"))Xc=j.getAttribute("base");Pc=j;this.Ec=k;}void AC(final YB g,final uB h){if(Qc!=null)Qc.AC(g,h);if(zb!=null)zb.AC(g,h);for(uB i in Ac){if(i is iB)i.AC(g);else if(i is lD)i.AC(g,h);}if(Xc!=null){final String j=Pc.YD(vB.aE(Xc));Jc=g.XJ(vB.ZE(Xc),j,h);}}List<FB> ID(){final List<FB> g=new List<FB>();if(zb!=null)g.addAll(zb.ID());return (g);}List<FB> XC(){final List<FB> g=new List<FB>();if(zb!=null)g.addAll(zb.XC());return (g);}List<FB> fC(){if(Ec is CG)return (Ec.fC());else return (new List<FB>());}String ZD(){if(zb!=null)return (zb.ZD());return (null);}bool TE(final FB g){if(zb!=null)return (zb.TE(g));return (null);}bool mD(final FB g){if(zb!=null)return (zb.mD(g));return (null);}List<String> hD(){List<String> g=null;for(DF h in Wc){if(h.qO()=="enumeration"){if(g==null)g=new List<String>();g.add(h.hF());}}return (g);}List<String> KD(){return (hD());}List<iB> attributes(){final List<iB> h=new List<iB>();for(uB i in Ac){if(i is iB)h.add(i);else if(i is lD)h.addAll(i.attributes());}if(Jc is kC){final List<iB> g=(Jc as kC).attributes();final List<iB> m=new List<iB>();for(iB j in h){final String o=j.getName();final bool s=j.yR()=="prohibited";for(iB k in g)if(o==k.getName()){if(s)m.add(k);else g[g.indexOf(k)]=j;break;}}for(iB v in m)g.remove(v);return (g);}return (h);}int VE(final List<FB> h,final int g,final bool i){if(zb==null)return (g);return (zb.VE(h,g,i));}bool eD(){if(zb!=null)return (zb.eD());return (true);}bool ED(final String h){if(Jc!=null){if(!Jc.ED(h))return (false);}bool i=false;for(final DF g in Wc){if(g.qO()=="enumeration"){if(g.ED(h))return (true);i=true;}else if(g.qO()=="pattern"){if(g.ED(h))return (true);i=true;}else if(!g.ED(h))return (false);}if(i)return (false);return (true);}}class tJ extends EE{String Yc=null;YB Zc=null;tJ(final l g,final YB h){Ic(g);if(g.zB("schemaLocation"))Yc=g.getAttribute("schemaLocation");}Future ac(final YB g){Completer h=new Completer();g.GP(Yc,null,g).then((YB g){Zc=g;h.complete();},onError:(qF i){h.completeError(i);});return (h.future);}}class vJ extends EE implements TD,rC{List<FB> bc;int Nc=1;int Oc=1;rC Ec;vJ(final l h,final rC i,final YB j){Ic(h);bc=new List<FB>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="element")bc.add(new FB(g as l,this,j));}try {if(h.zB("minOccurs"))Nc=int.parse(h.getAttribute("minOccurs"));}on FormatException {}this.Ec=i;}void AC(final YB g,final uB h){for(FB i in bc)i.AC(g,h);}List<FB> ID(){final List<FB> g=new List<FB>();for(FB h in bc)g.addAll(h.ID());return (g);}List<FB> XC(){final List<FB> g=new List<FB>();for(FB h in bc)g.addAll(h.DH());return (g);}List<FB> fC(){if(Ec!=null)return (Ec.fC());return (new List<FB>());}String ZD(){final StringBuffer g=new StringBuffer();g.write('(');bool h=true;for(FB j in bc){final String i=j.ZD();if(i!=null){if(!h)g.write(" & ");h=false;g.write(i);}}g.write(')');if(Nc==0)g.write('?');return (g.toString());}bool TE(final FB h){for(FB g in bc)for(FB i in g.DH())if(i==h)return (Nc>0&&g.sR()>0);return (null);}bool mD(final FB g){for(FB h in bc)for(FB i in h.DH())if(i==g)return (false);return (null);}int VE(final List<FB> k,final int h,final bool s){if(bc.length==0)return (h);List<int> i=new List<int>(bc.length);for(int g=0;g<bc.length;g++ )i[g]=0;int m=0;for(int g=h;g<k.length;g++ ){final FB v=k[g];bool o=false;for(int j=0;j<bc.length;j++ ){if(v==bc[j]){o=true;i[j]++;break;}}if(!o)break;m++ ;}for(int g=0;g<bc.length;g++ )if(i[g]>1)return (h);if(!s){for(int g=0;g<bc.length;g++ )if(i[g]==0&&!bc[g].eD())return (h);}return (h+m);}bool eD(){if(bc.length==0)return (true);if(Nc==0)return (true);for(FB g in bc){if(!g.eD())return (false);}return (true);}}class VI extends lL{VI(final l g,final rC h,final YB i){cc(g,h,i);}int VE(final List<FB> k,final int m,final bool i){int j=0;for(int g=m;g<k.length;){if(j>=Oc)return (g);int h=g;int o=g;for(TD s in dc){h=s.VE(k,g,i);if(i){if(h>o)o=h;}else{if(h>g)break;}}if(i)h=o;if(h==g){if(!i&&j<Nc)return (m);return (g);}g=h;j++ ;}if(!i&&j<Nc)return (m);return (k.length);}bool eD(){if(dc.length==0)return (true);if(Nc==0)return (true);for(TD g in dc){if(g.eD())return (true);}return (false);}}class iL extends EE implements TD{String ec="##any";String fc="strict";int Nc=1;int Oc=1;lL Ec;YB Fc;List<FB> bc;iL(final l g,final lL h,final YB i){if(g.zB("namespace"))ec=g.getAttribute("namespace");if(g.zB("processContents"))fc=g.getAttribute("processContents");try {if(g.zB("minOccurs"))Nc=int.parse(g.getAttribute("minOccurs"));if(g.zB("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Oc=9007199254740992;else Oc=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}this.Ec=h;this.Fc=i;bc=null;}void AC(final YB g,final uB i){bc=new List<FB>();bc.addAll(g.uU(ec));for(FB h in bc)h.MJ(this);}List<FB> ID(){return (new List<FB>());}List<FB> XC(){if(bc==null)AC(Fc,null);return (bc);}List<FB> fC(){return (Ec.fC());}String ZD(){if(bc==null)AC(Fc,null);final StringBuffer g=new StringBuffer();g.write('(');for(int h=0;h<bc.length;h++ ){g.write(Fc.OD(bc[h]));if(h!=bc.length-1)g.write('|');}g.write(')');if(Nc==0&&Oc==1)g.write('?');else if(Nc==0&&Oc>1)g.write('*');else if(Nc>0&&Oc>1)g.write('+');return (g.toString());}bool TE(final FB g){if(bc==null)AC(Fc,null);if(bc.contains(g))return (Nc>0&&bc.length==1);else return (null);}bool mD(final FB g){if(bc==null)AC(Fc,null);if(bc.contains(g))return (Oc>1);else return (null);}int VE(final List<FB> i,final int h,final bool j){if(bc==null)AC(Fc,null);if(!j&&i.length<Nc)return (h);for(int g=h;g<i.length;g++ ){if(g-h>=Oc)return (g);if(!bc.contains(i[g])){if(!j&&g-h<Nc)return (h);return (g);}}return (i.length);}bool eD(){return (Nc==0);}}class MQ extends XN{MQ(final l g){cc(g);}}abstract class XN extends EE{YN gc=null;List<jL> hc;String Bc=null;void cc(final l h){Ic(h);hc=new List<jL>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="selector")gc=new YN(g as l);else if(g.localName=="field")hc.add(new jL(g as l));}}if(h.zB("name"))Bc=h.getAttribute("name");}}class OQ extends XN{OQ(final l g){cc(g);}}class NQ extends XN{String ic=null;NQ(final l g){cc(g);}}class YN extends EE{String jc=null;YN(final l g){if(g.zB("xpath"))jc=g.getAttribute("xpath");}}class jL extends EE{String jc=null;jL(final l g){if(g.zB("xpath"))jc=g.getAttribute("xpath");}}class rF extends EE implements TD,rC{TD zb=null;List<uB> Ac;String Xc=null;bG Jc=null;l Pc;CG Ec;rF(final l i,final CG j,final YB h){Ic(i);Ac=new List<uB>();for(AB g=i.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="group")zb=new DE(g as l,this,h);else if(g.localName=="all")zb=new vJ(g as l,this,h);else if(g.localName=="choice")zb=new VI(g as l,this,h);else if(g.localName=="sequence")zb=new WI(g as l,this,h);else if(g.localName=="attribute")Ac.add(new iB(g as l,this,h));else if(g.localName=="attributeGroup")Ac.add(new lD(g as l,this,h));}}if(i.zB("base"))Xc=i.getAttribute("base");Pc=i;this.Ec=j;}void AC(final YB g,final uB i){if(zb!=null)zb.AC(g,i);for(uB h in Ac){if(h is iB)h.AC(g);else if(h is lD)h.AC(g,i);}if(Xc!=null){final String j=Pc.YD(vB.aE(Xc));Jc=g.XJ(vB.ZE(Xc),j,i);if(Jc is kC)(Jc as kC).nU(this);}}List<FB> ID(){final List<FB> g=new List<FB>();if(zb!=null)g.addAll(zb.ID());return (g);}List<FB> XC(){final List<FB> g=new List<FB>();if(Jc is kC)g.addAll((Jc as kC).XC());if(zb!=null)g.addAll(zb.XC());return (g);}List<FB> fC(){if(Ec!=null)return (Ec.fC());else return (new List<FB>());}String ZD(){String g;if(Jc is kC)g=(Jc as kC).ZD();else g=null;String h;if(zb!=null)h=zb.ZD();else h=null;if(g==null&&h==null)return ("");else if(g!=null&&h==null)return (g);else if(g==null&&h!=null)return (h);else return ("(${g}, ${h})");}bool TE(final FB i){bool g=null;if(Jc is kC)g=(Jc as kC).TE(i);if(g!=null&&g)return (g);bool h=null;if(zb!=null)h=zb.TE(i);if(h!=null&&h)return (h);return (g!=null?g:h);}bool mD(final FB h){bool g=null;if(Jc is kC)g=(Jc as kC).mD(h);if(g!=null&&g)return (g);bool i=null;if(zb!=null)i=zb.mD(h);return (g!=null?g:i);}List<String> hD(){if(Jc!=null)return (Jc.hD());else if(Xc!=null)return (vB.sG(Xc,Pc));return (null);}List<String> KD(){if(Jc!=null)return (Jc.KD());else if(Xc!=null)return (vB.sG(Xc,Pc));return (null);}List<iB> attributes(){final List<iB> g=new List<iB>();for(uB h in Ac){if(h is iB)g.add(h);else if(h is lD)g.addAll(h.attributes());}if(Jc is kC){final List<iB> i=(Jc as kC).attributes();final List<iB> j=new List<iB>();for(iB k in g){final String o=k.getName();bool m=false;for(iB s in i)if(o==s.getName()){m=true;break;}if(!m)j.add(k);}i.addAll(j);return (i);}return (g);}int VE(final List<FB> j,final int h,final bool i){int g=h;if(Jc is kC){g=(Jc as kC).VE(j,h,i);if(g==h&&!i&&!(Jc as kC).eD())return (h);}if(zb!=null){int k=zb.VE(j,g,i);if(k==g&&!i&&!zb.eD())return (h);g=k;}return (g);}bool eD(){if(Jc is kC&&!(Jc as kC).eD())return (false);if(zb!=null)return (zb.eD());return (true);}bool ED(final String g){if(Jc!=null)return (Jc.ED(g));else if(Xc!=null)return (jC.xJ(vB.ZE(Xc),g));return (false);}}class jC extends EE implements bG{qG kc=null;ZN lc=null;aN mc=null;String Bc=null;rC Ec;YB Fc;jC(final l h,final rC j,final YB i){Ic(h);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")kc=new qG(g as l,null,i);else if(g.localName=="list")lc=new ZN(g as l,i);else if(g.localName=="union")mc=new aN(g as l,i);}}if(h.zB("name"))Bc=h.getAttribute("name");this.Ec=j;this.Fc=i;}String getName(){return (Bc);}String gF(){return (Fc.KE());}rC getParent(){return (Ec);}void AC(final YB g,final uB h){if(kc!=null)kc.AC(g,h);if(lc!=null)lc.AC(g,h);if(mc!=null)mc.AC(g,h);}List<String> hD(){if(kc!=null)return (kc.hD());if(mc!=null)return (mc.hD());return (null);}List<String> KD(){if(kc!=null)return (kc.KD());if(mc!=null)return (mc.KD());return (null);}bool ED(final String g){if(kc!=null)return (kc.ED(g));if(lc!=null)return (lc.ED(g));if(mc!=null)return (mc.ED(g));return (false);}static bool xJ(final String h,final String g){if(h=="string")return (true);else if(h=="normalizedString")return (UC(g,"[^\\t\\r\\n]*"));else if(h=="token"){if(g.indexOf('\n')!=-1||g.indexOf('\r')!=-1||g.indexOf('\t')!=-1||g.indexOf("  ")!=-1)return (false);return (!g.startsWith(" ")&&!g.endsWith(" "));}else if(h=="base64Binary")return (UC(g,"(([a-zA-Z0-9+/=]\\s?){4})*"));else if(h=="hexBinary")return (UC(g,"(([0-9a-fA-F]){2})*"));else if(h=="integer")return (UC(g,"[+\\-]?\\d+"));else if(h=="positiveInteger")return (UC(g,"\\+?0*[1-9]\\d*"));else if(h=="negativeInteger")return (UC(g,"-0*[1-9]\\d*"));else if(h=="nonNegativeInteger")return (UC(g,"(-0+)|(\\+?\\d+)"));else if(h=="nonPositiveInteger")return (UC(g,"(\\+?0+)|(-\\d+)"));else if(h=="long"){if(!UC(g,"[+\\-]?\\d+"))return (false);try {final int m=int.parse(g);final int o=int.parse("9223372036854775807");final int v=int.parse("-9223372036854775808");if(m.compareTo(o)>0)return (false);if(m.compareTo(v)<0)return (false);return (true);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedLong"){if(!UC(g,"\\d+"))return (false);try {final int m=int.parse(g);final int o=int.parse("18446744073709551615");return (m.compareTo(o)<=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="int"){if(!UC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=2147483647&&i>=-2147483648);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedInt"){if(!UC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=4294967295&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="short"){if(!UC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=32767&&i>=-32768);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedShort"){if(!UC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=65535&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="byte"){if(!UC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=127&&i>=-128);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedByte"){if(!UC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=255&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="decimal"){return (UC(g,"[+\\-]?\\d+\\.?\\d*"));}else if(h=="float"){if(!UC(g,"(-?INF)|(NaN)|([+\\-]?\\d+\\.?\\d*([eE][+\\-]?\\d{1,3})?)"))return (false);if(g=="INF"||g=="-INF")return (true);try {double s=double.parse(g);if(log(s.abs())/LN2>127)return (false);if(log(s.abs())/LN2<-126)return (false);return (true);}on FormatException {return (false);}}else if(h=="double"){if(!UC(g,"(-?INF)|(NaN)|([+\\-]?\\d+\\.?\\d*([eE][+\\-]?\\d{1,3})?)"))return (false);if(g=="INF"||g=="-INF")return (true);try {double.parse(g);return (true);}on FormatException {return (false);}}else if(h=="boolean")return (UC(g,"(true)|(false)|1|0"));else if(h=="duration")return (UC(g,"-?P(\\d{1,4}Y)?(\\d{1,2}M)?(\\d{1,2}D)?(T(\\d{1,2}H)?(\\d{1,2}M)?(\\d{1,2}(\\.\\d+)?S)?)?"));else if(h=="dateTime")return (UC(g,"-?\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="date")return (UC(g,"-?\\d{4}-[01]\\d-[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="time")return (UC(g,"[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gYear")return (UC(g,"-?\\d{4}(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gYearMonth")return (UC(g,"-?\\d{4}-[01]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gMonth")return (UC(g,"--[01]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gMonthDay")return (UC(g,"--[01]\\d-[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gDay")return (UC(g,"---[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="Name")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*"));else if(h=="QName")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*"));else if(h=="NCName")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="anyURI")return (true);else if(h=="language")return (UC(g,"[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*"));else if(h=="ID")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="IDREF")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="IDREFS")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:]*"));else if(h=="ENTITY")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="ENTITIES")return (UC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:]*"));else if(h=="NOTATION")return (UC(g,"[^0-9.\\-\\s][^\\s]*(\\s[^0-9.\\-\\s][^\\s]*)*"));else if(h=="NMTOKEN")return (UC(g,"[^<>&#!/?'\",\\s]+"));else if(h=="NMTOKENS")return (UC(g,"[^<>&#!/?'\",]+"));else return (true);}static bool UC(final String g,final String h){final RegExp i=new RegExp("^${h}\$");return (i.hasMatch(g));}}class uJ implements uB{String nc=null;String oc=null;String qc=null;uJ(final l g){if(g.zB("source"))nc=g.getAttribute("source");if(g.zB("xml:lang"))oc=g.getAttribute("xml:lang");if(g.firstChild!=null)qc=g.firstChild.nodeValue;}String hF(){return (qc);}}abstract class EE implements uB{WN rc=null;void Ic(final l h){for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="annotation"){rc=new WN(g as l);break;}}}String sK(){if(rc==null)return (null);return (rc.sK());}}class CG extends EE implements TD,rC{TD zb=null;bool Cc=null;kC Ec;CG(final l h,final kC j,final YB i){Ic(h);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")zb=new qG(g as l,this,i);else if(g.localName=="extension")zb=new rF(g as l,this,i);}}if(h.zB("mixed"))Cc=(h.getAttribute("mixed")=="true"||h.getAttribute("mixed")=="1");this.Ec=j;}void AC(final YB g,final uB h){if(zb!=null)zb.AC(g,h);}List<FB> ID(){if(zb!=null)return (zb.ID());return (new List<FB>());}List<FB> XC(){if(zb!=null)return (zb.XC());return (new List<FB>());}String ZD(){if(zb!=null)return (zb.ZD());return (null);}bool TE(final FB g){if(zb!=null)return (zb.TE(g));return (null);}bool mD(final FB g){if(zb!=null)return (zb.mD(g));return (null);}List<iB> attributes(){if(zb is qG)return ((zb as qG).attributes());else if(zb is rF)return ((zb as rF).attributes());return (new List<iB>());}List<FB> fC(){return (Ec.fC());}int VE(final List<FB> h,final int g,final bool i){if(zb!=null)return (zb.VE(h,g,i));return (g);}bool eD(){if(zb!=null)return (zb.eD());return (true);}}class kL extends EE{qG kc=null;rF sc=null;kL(final l h,final YB i){Ic(h);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")kc=new qG(g as l,null,i);else if(g.localName=="extension")sc=new rF(g as l,null,i);}}}void AC(final YB g,final uB h){if(kc!=null)kc.AC(g,h);else if(sc!=null)sc.AC(g,h);}List<String> hD(){if(kc!=null)return (kc.hD());else if(sc!=null)return (sc.hD());return (null);}List<String> KD(){if(kc!=null)return (kc.KD());else if(sc!=null)return (sc.KD());return (null);}List<iB> attributes(){if(kc!=null)return (kc.attributes());else if(sc!=null)return (sc.attributes());return (new List<iB>());}bool ED(final String g){if(kc!=null)return (kc.ED(g));if(sc!=null)return (sc.ED(g));return (false);}}class WI extends lL{WI(final l g,final rC h,final YB i){cc(g,h,i);}int VE(final List<FB> j,final int k,final bool m){int i=0;for(int g=k;g<j.length;){if(i>=Oc)return (g);int h=g;for(TD o in dc){int s=o.VE(j,h,m);if(s==h){if(!m&&!o.eD()){if(i<Nc)return (k);return (g);}}h=s;}if(h==g)return (g);g=h;i++ ;}if(!m&&i<Nc)return (k);return (j.length);}bool eD(){if(Nc==0)return (true);for(TD g in dc){if(!g.eD())return (false);}return (true);}}class aN extends EE{List<jC> tc;List<String> uc=null;l Pc;List<jC> vc;aN(final l h,final YB i){Ic(h);tc=new List<jC>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="simpleType")tc.add(new jC(g as l,null,i));}if(h.zB("memberTypes"))uc=(h.getAttribute("memberTypes")).split(new RegExp(r"\s+"));Pc=h;vc=null;}void AC(final YB h,final uB i){for(jC o in tc)o.AC(h,i);if(uc!=null){vc=new List<jC>(uc.length);for(int g=0;g<uc.length;g++ ){final String j=uc[g];final String k=Pc.YD(vB.aE(j));final bG m=h.XJ(vB.ZE(j),k,i);if(m is jC)vc[g]=m;else{vc[g]=null;final String s=Pc.pB;if(s!=k)uc[g]=null;}}}}List<String> hD(){final List<String> g=new List<String>();if(uc!=null){for(int h=0;h<uc.length;h++ ){if(vc[h]!=null){final List<String> i=vc[h].hD();if(i==null)return (null);g.addAll(i);}else{final String j=uc[h];final String m=Pc.YD(vB.aE(j));final String o=Pc.pB;if(o==m){final List<String> i=vB.sG(j,Pc);if(i==null)return (null);g.addAll(i);}}}}for(jC s in tc){final List<String> k=s.hD();if(k==null)return (null);g.addAll(k);}if(g.length==0)return (null);return (g);}List<String> KD(){final List<String> g=new List<String>();if(uc!=null){for(int h=0;h<uc.length;h++ ){if(vc[h]!=null){final List<String> i=vc[h].hD();if(i!=null)g.addAll(i);}else{final String j=uc[h];final String m=Pc.YD(vB.aE(j));final String o=Pc.pB;if(o==m){final List<String> i=vB.sG(j,Pc);if(i!=null)g.addAll(i);}}}}for(jC s in tc){final List<String> k=s.hD();if(k!=null)g.addAll(k);}if(g.length==0)return (null);return (g);}bool ED(final String h){if(uc!=null){for(int g=0;g<uc.length;g++ ){if(vc[g]!=null){if(vc[g].ED(h))return (true);}else if(uc[g]!=null){if(jC.xJ(vB.ZE(uc[g]),h))return (true);}}}for(final jC i in tc){if(i.ED(h))return (true);}return (false);}}class ZN extends EE{jC Qc=null;String wc=null;l Pc;ZN(final l h,final YB i){Ic(h);for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="simpleType"){Qc=new jC(g as l,null,i);break;}}if(h.zB("itemType"))wc=h.getAttribute("itemType");Pc=h;}void AC(final YB g,final uB h){if(Qc!=null)Qc.AC(g,h);if(wc!=null&&Qc==null){final String i=Pc.YD(vB.aE(wc));final bG j=g.XJ(vB.ZE(wc),i,h);if(j is jC)Qc=j;else{final String k=Pc.pB;if(k!=i)wc=null;}}}bool ED(final String g){if(Qc==null&&wc==null)return (false);if(g==null)return (false);final List<String> i=g.trim().split(new RegExp(r"\s+"));for(String h in i){if(Qc!=null){if(!Qc.ED(h))return (false);}else{if(!jC.xJ(vB.ZE(wc),h))return (false);}}return (true);}}class FB extends EE implements TD,rC{jC Qc=null;kC xc=null;List<uB> yc;String Bc=null;String Lc=null;String Rc=null;String zc=null;int Nc=1;int Oc=1;String Tc=null;String Uc=null;bool Dc=false;String Vc=null;FB Mc=null;FB Ad=null;l Pc;rC Ec;YB Fc;List<uB> Gc;List<FB> Bd;List<FB> Cd;List<FB> Dd;FB(final l g,final rC j,final YB i){Ic(g);yc=new List<uB>();for(AB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l){if(h.localName=="simpleType")Qc=new jC(h as l,this,i);else if(h.localName=="complexType")xc=new kC(h as l,this,i);else if(h.localName=="unique")yc.add(new MQ(h as l));else if(h.localName=="key")yc.add(new OQ(h as l));else if(h.localName=="keyref")yc.add(new NQ(h as l));}}if(g.zB("name"))Bc=g.getAttribute("name");if(g.zB("ref"))Lc=g.getAttribute("ref");if(g.zB("type"))Rc=g.getAttribute("type");if(g.zB("substitutionGroup"))zc=g.getAttribute("substitutionGroup");try {if(g.zB("minOccurs"))Nc=int.parse(g.getAttribute("minOccurs"));if(g.zB("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Oc=9007199254740992;else Oc=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}if(g.zB("default"))Tc=g.getAttribute("default");if(g.zB("fixed"))Uc=g.getAttribute("fixed");if(g.zB("abstract"))Dc=g.getAttribute("abstract")=="true"||g.getAttribute("abstract")=="1";if(g.zB("form"))Vc=g.getAttribute("form");Pc=g;this.Ec=j;this.Fc=i;Gc=null;Bd=null;Dd=null;Cd=null;}String getName(){if(Bc==null&&Mc!=null)return (Mc.getName());return (Bc);}String yH(){return (Lc);}int sR(){return (Nc);}int fV(){return (Oc);}bool SH(){return (Dc);}l NG(){return (Pc);}String gF(){bool g;if(Fc.sO().contains(this))g=true;else if(Vc!=null)g=Vc=="qualified";else g=Fc.aV()=="qualified";if(g)return (Fc.KE());else return (null);}rC getParent(){return (Ec);}void AC(final YB h,final uB j){if(Qc!=null)Qc.AC(h,null);if(xc!=null)xc.AC(h,j);if(Lc!=null){final String g=Pc.YD(vB.aE(Lc));Mc=h.WS(vB.ZE(Lc),g);if(Mc!=null)Mc.MJ(this);else print("Element reference not found : ${Lc} (namespace: ${g})");}if(xc==null&&Qc==null&&Rc!=null){final String g=Pc.YD(vB.aE(Rc));final bG i=h.XJ(vB.ZE(Rc),g,j);if(i is kC){xc=i;xc.MJ(this);}else if(i is jC)Qc=i;}if(zc!=null){final String g=Pc.YD(vB.aE(zc));Ad=h.WS(vB.ZE(zc),g);Ad.qU(this);}}void MJ(final uB g){if(Gc==null)Gc=new List<uB>();Gc.add(g);}void qU(final FB g){if(Bd==null)Bd=new List<FB>();Bd.add(g);}List<FB> wR(){return (Bd);}List<FB> ID(){final List<FB> g=new List<FB>();g.add(this);if(xc!=null)g.addAll(xc.ID());return (g);}List<FB> DH(){if(Cd!=null)return (Cd);Cd=new List<FB>();if(!Dc&&Bc!=null)Cd.add(this);if(Mc!=null)Cd.addAll(Mc.DH());if(Bd!=null)for(FB g in Bd)Cd.addAll(g.DH());return (Cd);}List<FB> XC(){if(Dd!=null)return (Dd);final LinkedHashSet<FB> g=new LinkedHashSet<FB>();if(Mc!=null)g.addAll(Mc.XC());else if(xc!=null)g.addAll(xc.XC());else if(Qc==null&&Rc==null&&Ad!=null)g.addAll(Ad.XC());Dd=new List.from(g);return (Dd);}List<FB> fC(){final LinkedHashSet<FB> g=new LinkedHashSet<FB>();if(Ec!=null)g.addAll(Ec.fC());if(Gc!=null){for(uB h in Gc){if(h is FB)g.addAll(h.fC());else if(h is iL)g.addAll(h.fC());}}if(Ad!=null)g.addAll(Ad.fC());return (new List.from(g));}String eR(){if(xc==null&&Qc==null&&Rc==null&&Ad!=null)return (Ad.eR());if(xc==null)return (null);return (xc.ZD());}String ZD(){final List<FB> h=DH();if(h.length==0)return (null);final StringBuffer g=new StringBuffer();if(h.length>1)g.write('(');for(int i=0;i<h.length;i++ ){final FB j=h[i];g.write(Fc.OD(j));if(i!=h.length-1)g.write('|');}if(h.length>1)g.write(')');if(Nc==0&&Oc==1)g.write('?');else if(Nc==0&&Oc>1)g.write('*');else if(Nc>0&&Oc>1)g.write('+');return (g.toString());}bool TE(final FB g){if(xc==null&&Qc==null&&Rc==null&&Ad!=null)return (Ad.TE(g));if(xc==null)return (null);return (xc.TE(g));}bool mD(final FB g){if(xc==null&&Qc==null&&Rc==null&&Ad!=null)return (Ad.mD(g));if(xc==null)return (null);return (xc.mD(g));}List<String> hD(){if(Uc!=null){final List<String> g=new List<String>();g.add(Uc);return (g);}if(Qc!=null)return (Qc.hD());else if(xc!=null)return (xc.hD());else if(Rc!=null)return (vB.sG(Rc,Pc));else if(Qc==null&&Ad!=null)return (Ad.hD());return (null);}List<String> KD(){if(Uc!=null){final List<String> g=new List<String>();g.add(Uc);return (g);}if(Qc!=null)return (Qc.KD());else if(xc!=null)return (xc.KD());else if(Rc!=null)return (vB.sG(Rc,Pc));else if(Qc==null&&Ad!=null)return (Ad.KD());return (null);}List<iB> attributes(){if(Mc!=null)return (Mc.attributes());if(xc!=null)return (xc.attributes());else if(Qc==null&&Rc==null&&Ad!=null)return (Ad.attributes());return (new List<iB>());}bool PJ(){if(Rc!=null){final String h=Pc.YD(vB.aE(Rc));final String g=Pc.pB;if(g!=Fc.KE()&&g==h)return (true);}if(xc!=null)return (xc.PJ());if(Qc!=null)return (true);if(xc==null&&Rc==null&&Ad!=null)return (Ad.PJ());return (false);}bool gS(final List<FB> g,final bool h){if(xc==null){if(Qc==null&&Rc==null&&Ad!=null)return (Ad.gS(g,h));return (g.length==0);}if(g.length==0){if(h)return (true);if(xc.eD())return (true);}final int i=xc.VE(g,0,h);return (i>0&&i==g.length);}int VE(final List<FB> j,final int i,final bool k){int g=0;final List<FB> o=DH();for(int h=i;h<j.length;h++ ){if(g>=Oc)return (h);bool m=false;for(FB s in o)if(s==j[h])m=true;if(!m){if(!k&&g<Nc)return (i);return (h);}g++ ;}if(!k&&g<Nc)return (i);return (i+g);}bool eD(){return (Nc==0);}bool ED(final String g){if(Uc!=null)return (Uc==g);if(Qc!=null)return (Qc.ED(g));if(xc!=null)return (xc.ED(g));if(Rc!=null){final String h=Pc.YD(vB.aE(Rc));if(h!=null&&h==Pc.pB)return (jC.xJ(vB.ZE(Rc),g));return (false);}else return (true);}}class rG implements uB,rC{List<uB> Ed;String Yc=null;YB Zc=null;YB Fc;rG(final l i,final YB h){Ed=new List<uB>();for(AB g=i.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="simpleType")Ed.add(new jC(g as l,this,h));else if(g.localName=="complexType")Ed.add(new kC(g as l,this,h));else if(g.localName=="group")Ed.add(new DE(g as l,this,h));else if(g.localName=="attributeGroup")Ed.add(new lD(g as l,this,h));}}if(i.zB("schemaLocation"))Yc=i.getAttribute("schemaLocation");this.Fc=h;}Future ac(final YB g){Completer h=new Completer();g.GP(Yc,null,g).then((YB g){Zc=g;h.complete();},onError:(qF i){h.completeError(i);});return (h.future);}List<uB> jV(){return (Ed);}List<FB> fC(){return (new List<FB>());}String gF(){return (Fc.KE());}}class wJ extends EE{String ec=null;String Yc=null;YB Zc=null;wJ(final l g,final YB h){if(g.zB("namespace"))ec=g.getAttribute("namespace");if(g.zB("schemaLocation"))Yc=g.getAttribute("schemaLocation");}Future ac(final YB g){if(Yc==null)return (new Future.value(null));Completer h=new Completer();g.GP(Yc,ec,g).then((YB g){Zc=g;h.complete();},onError:(qF i){h.completeError(i);});return (h.future);}}abstract class uB{}class YB implements uB{List<tJ> Fd;List<wJ> Gd;List<rG> Hd;LinkedHashMap<String,jC> tc;LinkedHashMap<String,kC> Id;LinkedHashMap<String,DE> Jd;LinkedHashMap<String,lD> Kd;LinkedHashMap<String,FB> bc;LinkedHashMap<String,iB> Ld;String Md=null;String Nd=null;String Od=null;String Pd;vB Qd;List<YB> Rd;YB Sd;HashMap<String,String> Td;YB(final l h,final String KB,final vB QB,final YB SB){this.Pd=KB;this.Qd=QB;this.Sd=SB;Fd=new List<tJ>();Gd=new List<wJ>();Hd=new List<rG>();tc=new LinkedHashMap<String,jC>();Id=new LinkedHashMap<String,kC>();Jd=new LinkedHashMap<String,DE>();Kd=new LinkedHashMap<String,lD>();bc=new LinkedHashMap<String,FB>();Ld=new LinkedHashMap<String,iB>();Rd=new List<YB>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){String i=g.localName;if(i=="include")Fd.add(new tJ(g as l,this));else if(i=="import")Gd.add(new wJ(g as l,this));else if(i=="redefine"){final rG BB=new rG(g as l,this);Hd.add(BB);for(uB j in BB.jV()){if(j is jC){final jC k=j;tc[k.getName()]=k;}else if(j is kC){final kC m=j;Id[m.getName()]=m;}else if(j is DE){final DE o=j;Jd[o.getName()]=o;}else if(j is lD){final lD s=j;Kd[s.getName()]=s;}}}else if(i=="simpleType"){final jC k=new jC(g as l,null,this);tc[k.getName()]=k;}else if(i=="complexType"){final kC m=new kC(g as l,null,this);Id[m.getName()]=m;}else if(i=="group"){final DE o=new DE(g as l,null,this);Jd[o.getName()]=o;}else if(i=="attributeGroup"){final lD s=new lD(g as l,null,this);Kd[s.getName()]=s;}else if(i=="element"){final FB EB=new FB(g as l,null,this);bc[EB.getName()]=EB;}else if(i=="attribute"){final iB HB=new iB(g as l,null,this);Ld[HB.getName()]=HB;}}}if(h.zB("targetNamespace")){Md=h.getAttribute("targetNamespace");if(Md=="")Md=null;}if(h.zB("attributeFormDefault"))Nd=h.getAttribute("attributeFormDefault");if(h.zB("elementFormDefault"))Od=h.getAttribute("elementFormDefault");Td=new HashMap<String,String>();if(h.attributes!=null){for(lC v in h.attributes.values){if(v.name.startsWith("xmlns:")){final String cB=v.name.substring(6);Td[v.value]=cB;}}}}Future ac(){List<Future> g=new List<Future>();for(tJ h in Fd)g.add(h.ac(this));for(wJ i in Gd)g.add(i.ac(this));for(rG j in Hd)g.add(j.ac(this));return (Future.wait(g));}Iterable<FB> sO(){return (bc.values);}Iterable<iB> oV(){return (Ld.values);}String KE(){return (Md);}String WV(){return (Nd);}String aV(){return (Od);}String pV(){return (Pd);}Future<YB> GP(final String i,final String j,final YB k){Completer h=new Completer();Qd.Ud(Pd,i,j,k).then((YB g){if(g!=null&&!Rd.contains(g))Rd.add(g);h.complete(g);},onError:(qF m){h.completeError(m);});return (h.future);}void Vd(){for(jC g in tc.values)g.AC(this,g.getParent() is rG?g:null);for(kC h in Id.values)h.AC(this,h.getParent() is rG?h:null);for(DE i in Jd.values)i.AC(this,i.getParent() is rG?i:null);for(lD j in Kd.values)j.AC(this,j.getParent() is rG?j:null);for(FB k in bc.values)k.AC(this,null);for(iB m in Ld.values)m.AC(this);}String jG(final String g){return (Td[g]);}String NW(final String g){if(g==null)return (null);for(String h in Td.keys){if(g==Td[h])return (h);}return (null);}List<FB> ID(){final List<FB> g=new List<FB>();for(kC h in Id.values)g.addAll(h.ID());for(DE i in Jd.values)g.addAll(i.ID());for(FB j in bc.values)g.addAll(j.ID());return (g);}List<FB> uU(final String g){return (Qd.Wd(g,Md));}FB WS(final String g,final String h){return (Xd(g,h,null,null,'WXSElement') as FB);}bG XJ(final String g,final String h,final uB i){return (Xd(g,h,null,i,'WXSType') as bG);}DE XW(final String g,final String h,final uB i){return (Xd(g,h,null,i,'WXSGroup') as DE);}lD VW(final String g,final String h,final uB i){return (Xd(g,h,null,i,'WXSAttributeGroup') as lD);}iB WW(final String g,final String h){return (Xd(g,h,null,null,'WXSAttribute') as iB);}uB Xd(final String i,final String m,final HashSet<YB> j,final uB o,final String k){if(i==null)return (null);HashSet<YB> h=null;if(Sd!=null&&(j==null||!j.contains(Sd))){if(h==null){if(j==null)h=new HashSet<YB>();else h=j;h.add(this);}final uB g=Sd.Xd(i,m,h,o,k);if(g!=null)return (g);}if((m==null&&Md==null)||(m!=null&&m==Md)){uB g;if(k=='WXSElement')g=bc[i];else if(k=='WXSType'){g=Id[i];if(g!=null&&g!=o)return (g);g=tc[i];}else if(k=='WXSGroup')g=Jd[i];else if(k=='WXSAttributeGroup')g=Kd[i];else if(k=='WXSAttribute')g=Ld[i];else g=null;if(g!=null&&g!=o)return (g);}for(YB s in Rd){if(j==null||!j.contains(s)){if(h==null){if(j==null)h=new HashSet<YB>();else h=j;h.add(this);}final uB g=s.Xd(i,m,h,o,k);if(g!=null)return (g);}}return (null);}String OD(final FB g){return (Qd.Yd(g));}}class DF extends EE{String Zd;String qc=null;bool Uc=false;int ad=0;DF(final l h){Ic(h);Zd=h.localName;if(h.zB("value")){qc=h.getAttribute("value");ad=int.parse(qc,onError:(String i)=>0);if(Zd=="pattern"){qc=qc.replaceAll("\\i","[^<>&#!/?'\",0-9.\\-\\s]");qc=qc.replaceAll("\\I","[^a-zA-Z]");qc=qc.replaceAll("\\c","[^<>&#!/?'\",\\s]");qc=qc.replaceAll("\\C","\\W");qc=qc.replaceAll("\$","\\\$");for(int g=0;g<qc.length;g++ ){if(qc[g]=='^'&&(g==0||(qc[g-1]!='['||(g>1&&qc[g-2]=='\\')))){qc=qc.substring(0,g)+"\\^"+qc.substring(g+1);g++ ;}}}}if(h.zB("fixed"))Uc=h.getAttribute("fixed")=="true"||h.getAttribute("fixed")=="1";}String qO(){return (Zd);}String hF(){return (qc);}bool ED(final String g){if(Zd=="minExclusive"){try {final double i=double.parse(g);return (i>ad);}on FormatException {return (false);}}else if(Zd=="minInclusive"){try {final double i=double.parse(g);return (i>=ad);}on FormatException {return (false);}}else if(Zd=="maxExclusive"){try {final double i=double.parse(g);return (i<ad);}on FormatException {return (false);}}else if(Zd=="maxInclusive"){try {final double i=double.parse(g);return (i<=ad);}on FormatException {return (false);}}else if(Zd=="totalDigits"){int j=0;for(int h=0;h<g.length;h++ )if(g[h].compareTo('0')>=0&&g[h].compareTo('9')<=0)j++ ;return (j<=ad);}else if(Zd=="fractionDigits"){int j=0;bool k=false;for(int h=0;h<g.length;h++ ){if(!k){if(g[h]=='.')k=true;}else if(g[h].compareTo('0')>=0&&g[h].compareTo('9')<=0)j++ ;}return (j<=ad);}else if(Zd=="length")return (g.length==ad);else if(Zd=="minLength")return (g.length>=ad);else if(Zd=="maxLength")return (g.length<=ad);else if(Zd=="enumeration"){return (qc!=null&&qc==g);}else if(Zd=="whiteSpace"){return (true);}else if(Zd=="pattern"){return (jC.UC(g,qc));}else return (true);}}abstract class bG{String getName();String gF();rC getParent();void AC(final YB g,final uB h);List<String> hD();List<String> KD();bool ED(final String g);}abstract class lL extends EE implements TD,rC{List<TD> dc;int Nc=1;int Oc=1;rC Ec;void cc(final l h,final rC j,final YB i){Ic(h);dc=new List<TD>();for(AB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="element")dc.add(new FB(g as l,this,i));else if(g.localName=="group")dc.add(new DE(g as l,this,i));else if(g.localName=="choice")dc.add(new VI(g as l,this,i));else if(g.localName=="sequence")dc.add(new WI(g as l,this,i));else if(g.localName=="any")dc.add(new iL(g as l,this,i));}}try {if(h.zB("minOccurs"))Nc=int.parse(h.getAttribute("minOccurs"));if(h.zB("maxOccurs")){if(h.getAttribute("maxOccurs")=="unbounded")Oc=9007199254740992;else Oc=int.parse(h.getAttribute("maxOccurs"));}}on FormatException {}this.Ec=j;}void AC(final YB h,final uB i){for(TD g in dc)if(!(g is iL))g.AC(h,i);}List<FB> ID(){final List<FB> g=new List<FB>();for(TD h in dc)g.addAll(h.ID());return (g);}List<FB> XC(){final List<FB> g=new List<FB>();for(TD h in dc){if(h is FB)g.addAll(h.DH());else g.addAll(h.XC());}return (g);}List<FB> fC(){if(Ec!=null)return (Ec.fC());return (new List<FB>());}String ZD(){if(dc.length==0)return (null);final String k=(this is VI)?"|":", ";StringBuffer g=new StringBuffer();if(dc.length>1||Nc!=1||Oc!=1)g.write('(');bool i=true;for(TD m in dc){final String j=m.ZD();if(j!=null){if(!i)g.write(k);i=false;g.write(j);}}if(dc.length>1||Nc!=1||Oc!=1)g.write(')');if(dc.length==1&&g.length>2){String h=g.toString();if(h.substring(0,2)=="(("&&h.substring(g.length-2,g.length)=="))"){g=new StringBuffer(h.substring(1,h.length-1));}}if(Nc==0&&Oc==1)g.write('?');else if(Nc==0&&Oc>1)g.write('*');else if(Nc>0&&Oc>1)g.write('+');return (g.toString());}bool TE(final FB h){for(TD g in dc){if(g is FB){for(FB j in g.DH())if(j==h)return ((this is WI||dc.length==1)&&Nc!=0&&g.sR()!=0);}else{bool i=g.TE(h);if(i!=null)return (i);}}return (null);}bool mD(final FB i){for(TD h in dc){if(h is FB){for(FB j in h.DH())if(j==i)return (h.fV()>1||Oc>1);}else{bool g=h.mD(i);if(g!=null&&!g&&Oc>1)g=true;if(g!=null)return (g);}}return (null);}}class vB implements XL{YB Fc;final HashMap<l,FB> bd=new HashMap<l,FB>();final HashMap<l,iB> cd=new HashMap<l,iB>();final HashMap<String,List<FB>> dd=new HashMap<String,List<FB>>();HashMap<String,String> Td;final LinkedHashSet<FB> ed=new LinkedHashSet<FB>();Set<YB> Rd;HashMap<String,String> fd;vB(HashMap<String,String> g){this.fd=g;Rd=new HashSet<YB>();Td=new HashMap<String,String>();}Future load(final String k){Completer i=new Completer();PQ(k).then((l s){Fc=new YB(s,k,this,null);gd(Fc,null,null);Rd.add(Fc);Fc.ac().then((BB){for(final YB j in Rd)ed.addAll(j.ID());for(final YB j in Rd)j.Vd();for(FB g in ed){bd[g.NG()]=g;if(g.getName()!=null&&g.yH()==null){List<FB> h=dd[g.getName()];if(h==null){h=new List<FB>();dd[g.getName()]=h;}h.add(g);}}for(FB g in ed){final List<iB> m=g.attributes();if(m!=null){for(iB o in m)cd[o.NG()]=o;}}i.complete();});},onError:(qF v){i.completeError(v);});return (i.future);}l PM(final String h){final List<FB> g=dd[h];if(g==null)return (null);return (g[0].NG());}List<l> iO(final String i){final List<FB> g=dd[i];if(g==null)return (null);List<l> h=new List<l>();for(FB j in g)h.add(j.NG());return (h);}l gG(final l g,final l j){if(j==null){String h;if(g.EC==null)h=g.nodeName;else h=g.localName;final String o=g.pB;for(final YB s in Rd){for(final FB i in s.sO()){if(i.yH()==null&&!i.SH()&&h==i.getName()&&o==i.gF())return (i.NG());}}print("DaxeWXS: elementReference: no matching root element in the schema for ${h}");return (null);}final FB m=bd[j];if(m==null){print("DaxeWXS: elementReference: unknown element reference: ${j}");return (null);}final List<FB> v=m.XC();final String h=g.localName;final String BB=g.pB;for(final FB k in v){if(k.getName()==h&&k.gF()==BB)return (k.NG());}return (null);}String cD(final l g){final FB h=bd[g];if(h==null){print("DaxeWXS: elementName: unknown element reference: ${g}");return (null);}return (h.getName());}String jI(final l h){final FB g=bd[h];if(g==null)return (null);return (g.gF());}String OM(final l h){final String g=jI(h);if(g==null)return (null);return (Td[g]);}String gO(final l i){final FB g=bd[i];if(g==null)return (null);String h=g.sK();if(h!=null)return (h);if(g.xc!=null)return (g.xc.sK());return (null);}List<String> pK(final l h){final FB g=bd[h];if(g==null)return (null);return (g.hD());}List<String> jM(final l h){final FB g=bd[h];if(g==null)return (null);return (g.KD());}bool jO(final l h,final String i){final FB g=bd[h];if(g==null)return (false);return (g.ED(i));}List<String> EP(){final LinkedHashSet<String> g=new LinkedHashSet<String>();if(Fc.KE()!=null)g.add(Fc.KE());for(final String h in Td.keys)g.add(h);return (new List.from(g));}String jG(final String g){return (Td[g]);}String KE(){return (Fc.KE());}List<l> ID(){final List<l> h=new List<l>();for(final FB g in ed){if(g.getName()!=null&&g.yH()==null&&!g.SH())h.add(g.NG());}return (h);}List<l> HI(){final List<l> h=new List<l>();for(final YB i in Rd){for(final FB g in i.sO()){if(g.getName()!=null&&g.yH()==null&&!g.SH())h.add(g.NG());}}return (h);}bool GI(final l g,final l h){final FB i=bd[g];if(i==null){print("DaxeWXS: requiredElement: unknown element reference: ${g}");return (false);}final FB j=bd[h];if(j==null){print("DaxeWXS: requiredElement: unknown element reference: ${h}");return (false);}bool k=i.TE(j);return (k!=null&&k);}bool mD(final l g,final l h){final FB i=bd[g];if(i==null){print("DaxeWXS: multipleChildren: unknown element reference: ${g}");return (false);}final FB j=bd[h];if(j==null){print("DaxeWXS: multipleChildren: unknown element reference: ${h}");return (false);}bool k=i.mD(j);return (k!=null&&k);}List<l> XC(final l g){assert(g!=null);final FB h=bd[g];if(h==null){print("DaxeWXS: subElements: unknown element reference: ${g}");return (null);}final List<FB> j=h.XC();final List<l> i=new List<l>();for(FB k in j)i.add(k.NG());return (i);}String ZD(final l g,final bool i,final bool j){final FB h=bd[g];if(h==null){print("DaxeWXS: regularExpression: unknown element reference: ${g}");return (null);}return (h.eR());}List<l> fC(final l g){final FB h=bd[g];if(h==null){print("DaxeWXS: parentElements: unknown element reference: ${g}");return (null);}final List<FB> j=h.fC();final List<l> i=new List<l>();for(FB k in j)i.add(k.NG());return (i);}List<l> fE(final l g){final FB h=bd[g];if(h==null){print("DaxeWXS: elementAttributes: unknown element reference: ${g}");return (null);}final List<iB> j=h.attributes();final List<l> i=new List<l>();for(iB k in j)i.add(k.NG());return (i);}String attributeName(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: attributeName: unknown attribute reference: ${g}");return (null);}return (h.getName());}String attributeNamespace(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: attributeNamespace: unknown attribute reference: ${g}");return (null);}return (h.gF());}String vG(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: attributeDocumentation: unknown attribute reference: ${g}");return (null);}return (h.sK());}String eK(final String h){if(h==null)return (null);final String g=aE(h);if(g==null)return (null);if(g=="xml")return ("http://www.w3.org/XML/1998/namespace");return (Fc.NW(g));}bool tV(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: isRequired: unknown attribute reference: ${g}");return (false);}return (h.yR()=="required");}bool TO(final l h,final l g){return (tV(g));}List<String> gI(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: attributeValues: unknown attribute reference: ${g}");return (null);}return (h.hD());}List<String> aP(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: suggestedAttributeValues: unknown attribute reference: ${g}");return (null);}return (h.KD());}String dF(final l g){final iB h=cd[g];if(h==null){print("DaxeWXS: defaultAttributeValue: unknown attribute reference: ${g}");return (null);}return (h.defaultValue());}bool UO(final l g,final String i){final iB h=cd[g];if(h==null){print("DaxeWXS: attributeIsValid: unknown attribute reference: ${g}");return (false);}return (h.ED(i));}bool PE(final l g){final FB h=bd[g];if(h==null){print("DaxeWXS: canContainText: unknown element reference: ${g}");return (false);}return (h.PJ());}bool fS(final l g,final List<l> k,final bool m){final FB h=bd[g];if(h==null){print("DaxeWXS: validElement: unknown element reference: ${g}");return (false);}final List<FB> i=new List<FB>();for(l o in k){final FB j=bd[o];if(j!=null)i.add(j);}return (h.gS(i,m));}Future<YB> Ud(final String v,final String h,final String s,final YB k){String g;if(h.startsWith("http"))g=h;else g="${KU(v)}/${h}";if(g==null)return (new Future.error(new qF("include/import : location not found : ${h}")));for(YB m in Rd){if(hd(m.pV())==hd(g)){gd(m,k,s);return (new Future.value(m));}}Completer<YB> i=new Completer<YB>();PQ(g).then((l BB){final YB j=new YB(BB,g,this,k);gd(j,k,s);Rd.add(j);j.ac().then((EB){i.complete(j);},onError:(qF o){i.completeError(new qF("include/import: ${o}"));});},onError:(qF o){i.completeError(new qF("include/import: ${o}"));});return (i.future);}String hd(String g){int h=g.indexOf('/');if(h==-1)return (g);String j=g.substring(0,h);int i=g.substring(h+1).indexOf('/');if(i==-1)return (g);i+= h+1;String k=g.substring(h+1,i);if(j!='..'&&k=='..')return (hd(g.substring(i+1)));else return ("${g.substring(0,h+1)}${hd(g.substring(h+1))}");}void gd(final YB j,final YB k,final String h){if(h!=null&&Td[h]==null){String g=j.jG(h);if(g!=null)Td[h]=g;else if(k!=null){g=k.jG(h);if(g!=null)Td[h]=g;}}final String i=j.KE();if(i!=null&&i!=""){final String g=j.jG(i);if(g!=null)Td[i]=g;}}static Future<l> PQ(final String g){Completer<l> h=new Completer<l>();DG j=new DG();j.AL(g).then((sB k){h.complete(k.documentElement);},onError:(UD i){print("DaxeWXS: Error reading ${g}: ${i}");h.completeError(new qF("DaxeWXS: reading ${g}: ${i}"));});return (h.future);}static String KU(final String g){final int h=g.lastIndexOf("/");if(h==-1){return (null);}else{return (g.substring(0,h));}}List<FB> Wd(final String j,final String m){final List<FB> k=new List<FB>();if(j==null||j==""||j=="##any"){for(final FB g in ed)if(g.getName()!=null&&g.yH()==null&&!g.SH())k.add(g);}else if(j=="##local"){for(final FB g in ed){if(g.getName()!=null&&g.yH()==null&&!g.SH()){final String h=g.gF();if(h==null||h==m)k.add(g);}}}else if(j=="##other"){for(final FB g in ed){if(g.getName()!=null&&g.yH()==null&&!g.SH()){final String h=g.gF();if(h!=null&&h!=m)k.add(g);}}}else{final HashSet<String> i=new HashSet.from(j.split(new RegExp(r"\s+")));if(i.contains("##targetNamespace")){i.remove("##targetNamespace");i.add(m);}if(i.contains("##local")){i.remove("##local");i.add("");}for(final FB g in ed){if(g.getName()!=null&&g.yH()==null&&!g.SH()){final String h=g.gF();if(h!=null&&i.contains(h))k.add(g);}}}return (k);}static String ZE(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (g);return (g.substring(h+1));}static String aE(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (null);else return (g.substring(0,h));}static List<String> sG(final String g,final l h){final String i=h.YD(aE(g));final String j=h.pB;if(ZE(g)=="boolean"&&j==i){final List<String> k=["true","false","1","0"];return (k);}return (null);}String Yd(final FB g){if(fd[g.getName()]!=null)return (fd[g.getName()]);else return (g.getName());}}abstract class TD{void AC(final YB g,final uB h);List<FB> ID();List<FB> XC();String ZD();bool TE(final FB g);bool mD(final FB g);int VE(final List<FB> g,final int h,final bool i);bool eD();}abstract class rC{List<FB> fC();}abstract class jH extends AB{String name;String qI;String bJ;}abstract class nL extends AB{String target;String data;}class gN extends EG implements nL{String target;String data;gN(final sB i,final String g,final String h){this.target=g;this.data=h;nodeName=g;nodeValue=h;nodeType=AB.CK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=i;pB=null;EC=null;localName=null;}String toString(){return ("<?${target} ${data}?>");}}abstract class pL extends yJ{}class dN extends EG implements pL{dN(final sB g,final String h){nodeName="#cdata-section";nodeValue=h;nodeType=AB.BK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}String toString(){String g=nodeValue;if(g==null)g='';return ("<![CDATA[${g}]]>");}}abstract class EG implements AB{static const int kH=1;static const int jN=2;static const int VQ=6;static const int sF=9;static const int WQ=10;static const int XQ=11;static const int ZQ=12;String nodeName;String nodeValue;int nodeType;AB parentNode;List<AB> childNodes;AB firstChild;AB lastChild;AB previousSibling;AB nextSibling;LinkedHashMap<String,lC> attributes;sB ownerDocument;String pB;String EC;String localName;AB insertBefore(AB g,AB h){if(childNodes==null||!childNodes.contains(h))throw new UD("NOT_FOUND_ERR");jd(g);if(nodeType==sF&&g.nodeType==kH&&(this as sB).documentElement!=null)throw new UD("HIERARCHY_REQUEST_ERR");if(childNodes==null)childNodes=new List<AB>();if(g.parentNode!=null)g.parentNode.gC(g);g.parentNode=this;if(nodeType==sF&&g.nodeType==kH)(this as sB).documentElement=g;if(firstChild==h)firstChild=g;g.nextSibling=h;g.previousSibling=h.previousSibling;return (g);}AB gC(AB g){if(childNodes==null||!childNodes.contains(g))throw new UD("NOT_FOUND_ERR");if(nodeType==sF&&g.nodeType==kH)(this as sB).documentElement=null;if(firstChild==g)firstChild=g.nextSibling;if(lastChild==g)lastChild=g.previousSibling;if(g.previousSibling!=null)g.previousSibling.nextSibling=g.nextSibling;if(g.nextSibling!=null)g.nextSibling.previousSibling=g.previousSibling;g.parentNode=null;childNodes.remove(g);return (g);}AB jB(AB g){jd(g);if(nodeType==sF&&g.nodeType==kH&&(this as sB).documentElement!=null)throw new UD("HIERARCHY_REQUEST_ERR");if(childNodes==null)childNodes=new List<AB>();if(g.parentNode!=null)g.parentNode.gC(g);g.parentNode=this;if(nodeType==sF&&g.nodeType==kH)(this as sB).documentElement=g;g.nextSibling=null;if(firstChild==null){g.previousSibling=null;firstChild=g;lastChild=g;}else{lastChild.nextSibling=g;g.previousSibling=lastChild;lastChild=g;}childNodes.add(g);return (g);}bool hasChildNodes(){return (firstChild!=null);}String BP(String g){if(g==null||g==''){return (null);}switch (nodeType){case kH:return (kd(g));case sF:return (((this as sB).documentElement as dG).kd(g));case VQ:case ZQ:case XQ:case WQ:return (null);case jN:if((this as lC).UH!=null){return (((this as lC).UH as dG).kd(g));}return null;default:if(parentNode!=null){return ((parentNode as dG).kd(g));}return (null);}}kd(final String g){final RegExp i=new RegExp(r"/^xmlns:(.*)$/");if(g!=null&&this.pB==g&&EC!=null&&YD(EC)==g){return (EC);}if(attributes!=null){for(lC h in attributes.values){if(i.hasMatch(h.name)&&h.value==g&&YD(h.localName)==g){return (localName);}}}if(parentNode!=null){return ((parentNode as dG).kd(g));}return null;}String YD(String h){switch (nodeType){case kH:if(pB!=null&&this.EC==h){return (pB);}if(attributes!=null){for(lC g in attributes.values){if(g.EC=='xmlns'&&g.localName==h){if(g.value!=null&&g.value!=''){return (g.value);}return (null);}else if(g.localName=='xmlns'&&h==null){if(g.value!=null&&g.value!=''){return (g.value);}return (null);}}}if(parentNode!=null&&parentNode.nodeType!=sF){return parentNode.YD(h);}return null;case sF:return ((this as sB).documentElement.YD(h));case VQ:case ZQ:case WQ:case XQ:return (null);case jN:if(parentNode!=null)return (parentNode.YD(h));return (null);default:if(parentNode!=null)return (parentNode.YD(h));return (null);}}jd(AB g){if(nodeType!=sF&&ownerDocument!=g.ownerDocument)throw new UD("WRONG_DOCUMENT_ERR");if(nodeType==sF&&this!=g.ownerDocument)throw new UD("WRONG_DOCUMENT_ERR");if(nodeType!=kH&&nodeType!=sF)throw new UD("HIERARCHY_REQUEST_ERR");if(g.nodeType==sF)throw new UD("HIERARCHY_REQUEST_ERR");if(nodeType!=sF&&g.nodeType==jN)throw new UD("HIERARCHY_REQUEST_ERR");AB h=this;while(h!=null){if(g==h)throw new UD("HIERARCHY_REQUEST_ERR");h=h.parentNode;}}static String aQ(String g){g=g.replaceAll('&','&amp;');g=g.replaceAll('"','&quot;');g=g.replaceAll('<','&lt;');g=g.replaceAll('>','&gt;');return (g);}}abstract class yJ extends AB{}class mL extends EG implements yJ{mL(final sB g,final String h){nodeName="#text";nodeValue=h;nodeType=AB.kE;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}String toString(){return (EG.aQ(nodeValue));}}abstract class LU extends AB{}class fN extends EG implements LU{fN(final sB g,final String h){nodeName=h;nodeValue=null;nodeType=AB.TQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}String toString(){return ("&${nodeName};");}}abstract class oL extends AB{}class eN extends EG implements oL{eN(final sB g,final String h){nodeName="#comment";nodeValue=h;nodeType=AB.DK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}String toString(){return ("<!--${nodeValue}-->");}}class JC{String id;String BE;List<JC> cC;Object data;int position;JC.HZ(this.id,this.BE,this.position);JC.KZ(this.id,this.cC,this.position);String toString(){StringBuffer g=new StringBuffer();g.write("[${id}");if(BE!=null)g.write(" ${BE}");else{for(JC h in cC){g.write(' ');g.write(h);}}g.write(']');return (g.toString());}}class QQ extends EG implements jH{String name;String qI;String bJ;QQ(final String g,final String h,final String i){name=g;this.qI=h;this.bJ=i;nodeName=g;nodeValue=null;nodeType=AB.qL;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=null;pB=null;EC=null;localName=null;}String toString(){if(qI==null&&bJ!=null)return ('<!DOCTYPE ${name} SYSTEM "${bJ}">');if(qI!=null&&bJ!=null)return ('<!DOCTYPE ${name} PUBLIC "${qI}" "${bJ}">');if(qI!=null)return ('<!DOCTYPE ${name} PUBLIC "${qI}">');return ('<!DOCTYPE ${name}>');}}class xC extends uE{String id;xC(this.id);QC JG(String g,int h){return (null);}QC KG(List<JC> g,int h){if(g[h].id==id)return (new QC.IZ(1,[g[h]]));else return (null);}}class cG extends uE{List<uE> items;cG(this.items);QC JG(String h,int i){for(uE j in items){QC g=j.JG(h,i);if(g!=null)return (g);}return (null);}QC KG(List<JC> h,int i){for(uE j in items){QC g=j.KG(h,i);if(g!=null)return (g);}return (null);}}class NE extends uE{static const int hN=0;static const int iN=1;static const int NU=2;int repeat;uE item;NE.JZ(this.item){repeat=hN;}NE.MZ(this.item){repeat=iN;}NE.OZ(this.item){repeat=NU;}QC JG(String j,int k){if(repeat==hN){QC g=item.JG(j,k);if(g==null)return (new QC.FZ(0,''));else return (g);}StringBuffer h=null;int i=k;while(i<j.length){QC g=item.JG(j,i);if(g==null)break;if(h==null)h=new StringBuffer();h.write(g.kK);i=i+g.PG;}int o=i-k;if(o>0||repeat==iN){String m;if(h!=null)m=h.toString();else m='';return (new QC.FZ(o,m));}else return (null);}QC KG(List<JC> i,int j){if(repeat==hN){QC g=item.KG(i,j);if(g==null)return (new QC.IZ(0,new List<JC>()));else return (g);}List<JC> k=new List<JC>();int h=j;while(h<i.length){QC g=item.KG(i,h);if(g==null)break;k.addAll(g.XH);h=h+g.PG;}int m=h-j;if(m>0||repeat==iN)return (new QC.IZ(m,k));else return (null);}}class mC extends uE{String RH=null;bool HS=false;bool IS=false;bool uV=false;List<String> lO=null;mC(this.RH);mC.LZ(){HS=true;}mC.NZ(){IS=true;}mC.PZ(this.lO);QC JG(String i,int h){String g=i[h];if(RH!=null){if(g==RH)return (new QC.FZ(1,g));}else if(HS){if('0123456789'.contains(g)){return (new QC.FZ(1,g));}}else if(IS){if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.contains(g))return (new QC.FZ(1,g));}else if(uV){return (new QC.FZ(1,g));}else if(lO!=null){for(String j in lO){if(h+j.length<=i.length&&j==i.substring(h,h+j.length))return (null);}return (new QC.FZ(1,g));}return (null);}QC KG(List<JC> g,int h){return (null);}}class DG{Future<sB> AL(String g,{bool disableCache: true}){Completer<sB> i=new Completer<sB>();HttpRequest h=new HttpRequest();if(disableCache){if(!g.contains('.php?')){Random m=new Random();String j="random_workaround=${m.nextDouble()}";if(g.contains('?'))g="${g}&${j}";else g="${g}?${j}";}}h.open('GET',g);h.onLoad.listen((ProgressEvent o){if(h.status!=200){i.completeError(new UD("Error reading ${g}",errorCode:h.status));return;}sB k;if(h.responseText==null){i.completeError(new UD("Error reading ${g}"));return;}try {k=parseFromString(h.responseText);}on UD catch (s){i.completeError(new UD("Error reading ${g}: ${s.message}"));return;}i.complete(k);});h.onError.listen((ProgressEvent o){i.completeError(new UD("Error reading ${g}"));});h.send();return (i.future);}sB parseFromString(String g){kN h=new kN();try {return (h.LP(g));}on Exception catch (i){throw new UD(i.toString());}}}class pD{String name;bool value;pD(this.name,this.value);}abstract class uE{QC JG(String g,int h);QC KG(List<JC> g,int h);}class CD extends uE{List<uE> items;CD(this.items);CD.GZ(String h){items=new List<uE>();for(int g=0;g<h.length;g++ )items.add(new mC(h[g]));}QC JG(String k,int m){StringBuffer g=null;int h=m;for(uE o in items){if(h>=k.length)return (null);QC i=o.JG(k,h);if(i==null)return (null);if(g==null)g=new StringBuffer();g.write(i.kK);h=h+i.PG;}int s=h-m;String j;if(g!=null)j=g.toString();else j='';return (new QC.FZ(s,j));}QC KG(List<JC> i,int j){List<JC> k=new List<JC>();int g=j;for(uE m in items){if(g>=i.length)return (null);QC h=m.KG(i,g);if(h==null)return (null);k.addAll(h.XH);g=g+h.PG;}int o=g-j;return (new QC.IZ(o,k));}}class tE{String name;bool value;tE(this.name,this.value);}abstract class lC extends AB{String name;String value;bool HL;l UH;bool xO;}class UD implements Exception{final String message;final int errorCode;const UD(this.message,{this.errorCode});String toString(){String g="DOMException";if(message!=null)g+= ": ${message}";if(errorCode!=null)g+= ": ${errorCode}";return (g);}}abstract class l extends AB{String tagName;String getAttribute(String g);void setAttribute(String g,String h);lC QM(String g);lC YS(lC g);List<AB> getElementsByTagName(String g);String getAttributeNS(String g,String h);void setAttributeNS(String g,String h,String i);lC RM(String g,String h);bool zB(String g);}class QC{int PG;String kK;List<JC> XH;QC.FZ(this.PG,this.kK);QC.IZ(this.PG,this.XH);}abstract class bN extends AB{}class RQ extends EG implements bN{RQ(final sB g){nodeName="#document-fragment";nodeValue=null;nodeType=AB.OU;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}String toString(){StringBuffer g=new StringBuffer();for(AB h in childNodes){g.write(h.toString());}return (g.toString());}}class zJ implements iH{zJ();sB createDocument(String g,String h,jH i){return (new cN(this,g,h,i));}}abstract class sB extends AB{iH implementation;l documentElement;String vO;String xF;bool hS;String UG;String aR;jH mK;l createElement(String g);bN createDocumentFragment();yJ wG(String g);oL YR(String g);pL XR(String g);nL ZR(String g,String h);List<AB> getElementsByTagName(String g);l createElementNS(String g,String h);AB adoptNode(AB g);}abstract class iH{sB createDocument(String g,String h,jH i);}abstract class AB{static const int FE=1;static const int SQ=2;static const int kE=3;static const int BK=4;static const int TQ=5;static const int UQ=6;static const int CK=7;static const int DK=8;static const int FK=9;static const int qL=10;static const int OU=11;static const int YQ=12;String nodeName;String nodeValue;int nodeType;AB parentNode;List<AB> childNodes;AB firstChild;AB lastChild;AB previousSibling;AB nextSibling;LinkedHashMap<String,lC> attributes;sB ownerDocument;String pB;String EC;String localName;AB insertBefore(AB g,AB h);AB gC(AB g);AB jB(AB g);bool hasChildNodes();String BP(String g);String YD(String g);}class cN extends EG implements sB{iH implementation;l documentElement;String vO;String xF;bool hS;String UG;String aR;jH mK;HashMap<String,l> ld;cN(final iH i,final String h,final String g,final jH j){this.implementation=i;vO=null;xF="UTF-8";hS=false;UG="1.0";aR=null;this.mK=j;ld=new HashMap<String,l>();nodeName="#document";nodeValue=null;nodeType=AB.FK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=null;this.pB=null;EC=null;localName=null;if(g!=null){if(h!=null)documentElement=new dG.RZ(this,h,g);else documentElement=new dG(this,g);documentElement.parentNode=this;}}l createElement(String g){return (new dG(this,g));}bN createDocumentFragment(){return (new RQ(this));}yJ wG(String g){return (new mL(this,g));}oL YR(String g){return (new eN(this,g));}pL XR(String g){return (new dN(this,g));}nL ZR(String g,String h){return (new gN(this,g,h));}List<AB> getElementsByTagName(String h){List<AB> i=new List<AB>();for(AB g in childNodes){if(h=='*'||g.nodeName==h)i.add(g);if(g is l)i.addAll(g.getElementsByTagName(h));}return (i);}l createElementNS(String g,String h){return (new dG.RZ(this,g,h));}AB adoptNode(AB g){if(g.nodeType==AB.FK||g.nodeType==AB.qL||g.nodeType==AB.UQ||g.nodeType==AB.YQ)throw new UD("NOT_SUPPORTED_ERR");if(g.parentNode!=null){g.parentNode.gC(g);}if(g is lC){lC h=g;h.UH=null;h.HL=true;}md(g);return (g);}void md(AB g){g.ownerDocument=this;if(g.attributes!=null){List<String> j=new List<String>();for(lC i in g.attributes.values){if(i.HL)i.ownerDocument=this;else j.add(i.name);}for(String k in j){g.attributes.remove(k);}}if(g.childNodes!=null){for(AB h in g.childNodes){if(h.nodeType!=AB.qL&&h.nodeType!=AB.UQ&&h.nodeType!=AB.YQ)md(h);}}}String toString(){StringBuffer g=new StringBuffer();g.write("<?xml");if(UG!=null)g.write(' version="${UG}"');if(xF!=null)g.write(' encoding="${xF}"');g.writeln("?>");if(mK!=null)g.write(mK.toString());for(AB h in childNodes){g.write(h.toString());}return (g.toString());}}class dG extends EG implements l{String tagName;dG(final sB h,final String g){this.tagName=g;nodeName=g;nodeValue=null;nodeType=AB.FE;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=h;pB=null;EC=null;localName=null;}dG.RZ(final sB i,final String j,final String g){tagName=g;nodeName=g;nodeValue=null;nodeType=AB.FE;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=i;this.pB=j;int h=g.indexOf(":");if(h!=-1){EC=g.substring(0,h);localName=g.substring(h+1);}else{EC=null;localName=g;}}String getAttribute(String i){if(attributes==null)return ("");lC g=attributes[i];if(g==null)return ("");String h=g.nodeValue;if(h==null)return ("");return (h);}void setAttribute(String h,String i){if(attributes==null)attributes=new LinkedHashMap<String,lC>();lC g=attributes[h];if(g==null){g=new AK(ownerDocument,h);g.parentNode=this;g.UH=this;attributes[h]=g;}g.nodeValue=i;}lC QM(String g){if(attributes==null)return (null);return (attributes[g]);}lC YS(lC g){if(ownerDocument!=g.ownerDocument)throw new UD("WRONG_DOCUMENT_ERR");if(attributes==null)attributes=new LinkedHashMap<String,lC>();g.parentNode=this;g.UH=this;attributes[g.name]=g;return (g);}List<AB> getElementsByTagName(String i){List<AB> g=new List<AB>();if(childNodes==null)return (g);for(AB h in childNodes){if(i=='*'||h.nodeName==i)g.add(h);if(h is l)g.addAll(h.getElementsByTagName(i));}return (g);}String getAttributeNS(String h,String i){if(attributes==null)return ("");for(lC g in attributes.values){if(g.pB==h&&g.localName==i){if(g.value==null)return ("");return (g.value);}}return ("");}void setAttributeNS(String m,String h,String o){if(attributes==null)attributes=new LinkedHashMap<String,lC>();String i,j;int k=h.indexOf(":");if(k!=-1){i=h.substring(0,k);j=h.substring(k+1);}else{i=null;j=h;}lC g=RM(m,j);if(g!=null){g.EC=i;g.nodeValue=o;return;}g=new AK.QZ(ownerDocument,m,h);g.parentNode=this;g.UH=this;g.nodeValue=o;attributes[h]=g;}lC RM(String h,String i){if(attributes==null)return (null);for(lC g in attributes.values){if(g.pB==h&&g.localName==i){return (g);}}return (null);}bool zB(String g){if(attributes==null)return (false);return (attributes[g]!=null);}String toString(){StringBuffer g=new StringBuffer();g.write("<${tagName}");if(attributes!=null){for(lC h in attributes.values){g.write(" ");g.write(h.toString());}}if(childNodes!=null&&childNodes.length>0){g.write(">");for(AB i in childNodes){g.write(i.toString());}g.write("</${tagName}>");}else{g.write("/>");}return (g.toString());}}typedef void MU(Token);class tB extends uE{String id;List<tE> conditions;List<pD> changes;uE content;bool ignore;MU action;EK qK;tB(this.id,this.content,{this.conditions: null,this.changes: null,this.ignore: false,this.action: null});QC JG(String m,int j){if(!qK.SR(this))return (null);QC g=content.JG(m,j);if(g==null)return (null);JC h=new JC.HZ(id,g.kK,j);if(action!=null)action(h);qK.QR(this);List<JC> i;if(ignore)i=new List<JC>();else i=[h];QC k=new QC.IZ(g.PG,i);if(!ignore)k.kK=h.BE;return (k);}QC KG(List<JC> j,int k){if(!qK.SR(this))return (null);QC g=content.KG(j,k);if(g==null)return (null);JC i=new JC.KZ(id,g.XH,g.XH[0].position);if(action!=null)action(i);qK.QR(this);List<JC> h;if(ignore)h=new List<JC>();else h=[i];QC m=new QC.IZ(g.PG,h);return (m);}String toString(){return (id);}}class AK extends EG implements lC{bool HL;l UH;bool xO;AK(final sB g,final String h){HL=true;UH=null;xO=false;nodeName=h;nodeValue=null;nodeType=AB.SQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;pB=null;EC=null;localName=null;}AK.QZ(final sB h,final String i,final String j){HL=true;UH=null;xO=false;nodeName=j;nodeValue=null;nodeType=AB.SQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=h;this.pB=i;int g=name.indexOf(":");if(g!=-1){EC=name.substring(0,g);localName=name.substring(g+1);}else{EC=null;localName=name;}}String get name{return (nodeName);}void set name(String g){nodeName=g;}String get value{return (nodeValue);}void set value(String g){nodeValue=g;}String toString(){return ('${nodeName}="${EG.aQ(nodeValue)}"');}}class kN{List<tB> XD;List<tB> nF;sB nE;kN(){nd();}nd(){XD=new List<tB>();tE v=new tE('in_tag',true);XD.add(new tB('CDATA_SECTION_OPEN',new CD.GZ('<![CDATA['),conditions:[new tE('in_cdata_section',false)],changes:[new pD('in_cdata_section',true)]));XD.add(new tB('CDATA_SECTION_DATA',new NE.OZ(new mC.PZ([']]>'])),conditions:[new tE('in_cdata_section',true)]));XD.add(new tB('CDATA_SECTION_CLOSE',new CD.GZ(']]>'),conditions:[new tE('in_cdata_section',true)],changes:[new pD('in_cdata_section',false)]));XD.add(new tB('COMMENT_OPEN',new CD.GZ('<!--'),changes:[new pD('in_comment',true)]));XD.add(new tB('COMMENT_CLOSE',new CD.GZ('-->'),conditions:[new tE('in_comment',true)],changes:[new pD('in_comment',false)]));XD.add(new tB('COMMENT_DATA',new NE.OZ(new mC.PZ(['-->'])),conditions:[new tE('in_comment',true)]));XD.add(new tB('DOC_DECL_OPEN',new CD.GZ('<?xml'),changes:[new pD('in_tag',true),new pD('in_decl',true)]));XD.add(new tB('DOC_DECL_CLOSE',new CD.GZ('?>'),conditions:[new tE('in_decl',true)],changes:[new pD('in_tag',false),new pD('in_decl',false)]));XD.add(new tB('DOCTYPE_OPEN',new CD.GZ('<!DOCTYPE'),changes:[new pD('in_tag',true),new pD('in_doctype',true)]));XD.add(new tB('DOCTYPE_CLOSE',new CD.GZ('>'),conditions:[new tE('in_doctype',true)],changes:[new pD('in_tag',false),new pD('in_doctype',false)]));XD.add(new tB('PI_OPEN',new CD.GZ('<?'),changes:[new pD('in_pi',true)]));uE jS=new cG([new mC.NZ(),new mC('_'),new mC(':')]);uE tD=new cG([new mC.NZ(),new mC.LZ(),new mC('.'),new mC('-'),new mC('_'),new mC(':')]);XD.add(new tB('PI_TARGET',new CD([jS,new NE.MZ(tD)]),conditions:[new tE('in_pi',true),new tE('pi_after_target',false)],changes:[new pD('pi_after_target',true)]));XD.add(new tB('PI_DATA',new NE.OZ(new mC.PZ(['?>'])),conditions:[new tE('pi_after_target',true)]));XD.add(new tB('PI_CLOSE',new CD.GZ('?>'),conditions:[new tE('in_pi',true)],changes:[new pD('in_pi',false),new pD('pi_after_target',false)]));XD.add(new tB('TAG_END_OPEN',new CD.GZ('</'),changes:[new pD('in_tag',true)]));XD.add(new tB('TAG_START_OPEN',new mC('<'),changes:[new pD('in_tag',true)]));XD.add(new tB('TAG_CLOSE',new mC('>'),conditions:[v],changes:[new pD('in_tag',false)]));XD.add(new tB('TAG_EMPTY_CLOSE',new CD.GZ('/>'),conditions:[v],changes:[new pD('in_tag',false)]));XD.add(new tB('ATTR_EQ',new mC('='),conditions:[v]));tB EB=new tB('ENTITY_REF',new CD([new mC('&'),new NE.OZ(new cG([new mC('#'),new mC.LZ(),new mC.NZ()])),new mC(';')]),action:(JC g){String h=g.BE;h=h.substring(1,h.length-1);if(h.startsWith('#')){int KB;if(h[1]=='x'){h=h.substring(2);KB=int.parse(h,radix:16);}else{h=h.substring(1);KB=int.parse(h);}String k=new String.fromCharCode(KB);g.BE=new String.fromCharCode(KB);}else{String k=null;if(h=='amp')k='&';else if(h=='lt')k='<';else if(h=='gt')k='>';else if(h=='apos')k="'";else if(h=='quot')k='"';if(k!=null){g.BE=k;}else{}}});XD.add(EB);XD.add(new tB('ATTR_VALUE',new cG([new CD([new mC('"'),new NE.MZ(new cG([new mC.PZ(['"','&','<']),EB])),new mC('"')]),new CD([new mC("'"),new NE.MZ(new cG([new mC.PZ(["'",'&','<']),EB])),new mC("'")])]),conditions:[v]));XD.add(new tB('PCDATA',new NE.OZ(new mC.PZ(['<','&'])),conditions:[new tE('in_tag',false)]));XD.add(new tB('GENERIC_ID',new CD([jS,new NE.MZ(tD)]),conditions:[v]));XD.add(new tB('WHITE',new cG([new mC(' '),new mC('\n'),new mC('\r'),new mC('\t')]),conditions:[v],ignore:true));nF=new List<tB>();tB QB=new tB('ATTRIBUTE',new CD([new xC('GENERIC_ID'),new xC('ATTR_EQ'),new xC('ATTR_VALUE')]),action:(JC g){String m=g.cC[0].BE;String cB=g.cC[2].BE;cB=cB.substring(1,cB.length-1);lC j=new AK.QZ(nE,null,m);j.value=cB;g.data=j;});nF.add(new tB('DOC_DECL',new CD([new xC('DOC_DECL_OPEN'),new NE.MZ(QB),new xC('DOC_DECL_CLOSE')]),action:(JC g){int QD=g.cC.length-2;if(QD>0){for(int i=1;i<g.cC.length-1;i++ ){Object h=g.cC[i].data;if(h is lC){lC j=h;if(j.name=='version')nE.UG=j.value;else if(j.name=='encoding'){nE.xF=j.value;nE.vO=j.value;}}}}}));nF.add(new tB('DOCTYPE',new CD([new xC('DOCTYPE_OPEN'),new NE.OZ(new cG([new xC('GENERIC_ID'),new xC('ATTR_VALUE')])),new xC('DOCTYPE_CLOSE')]),action:(JC g){String m=g.cC[1].BE;String SB=null;String BB=null;for(int i=2;i<g.cC.length-1;i++ ){if(g.cC[i].id=='GENERIC_ID'&&g.cC[i].BE=='PUBLIC'&&i<g.cC.length-2&&g.cC[i+1].id=='ATTR_VALUE'){SB=g.cC[i+1].BE;SB=SB.substring(1,BB.length-1);}else if(g.cC[i].id=='GENERIC_ID'&&g.cC[i].BE=='SYSTEM'&&i<g.cC.length-2&&g.cC[i+1].id=='ATTR_VALUE'){BB=g.cC[i+1].BE;BB=BB.substring(1,BB.length-1);}}jH qE=new QQ(m,SB,BB);qE.ownerDocument=nE;g.data=qE;}));nF.add(new tB('OUTSIDE_ROOT',new xC('PCDATA'),ignore:true));tB MF=new tB('START_TAG',new CD([new xC('TAG_START_OPEN'),new xC('GENERIC_ID'),new NE.MZ(QB),new xC('TAG_CLOSE')]));tB VG=new tB('END_TAG',new CD([new xC('TAG_END_OPEN'),new xC('GENERIC_ID'),new xC('TAG_CLOSE')]));tB MI=new tB('EMPTY_ELEMENT',new CD([new xC('TAG_START_OPEN'),new xC('GENERIC_ID'),new NE.MZ(QB),new xC('TAG_EMPTY_CLOSE')]));tB eJ=new tB('COMMENT',new CD([new xC('COMMENT_OPEN'),new NE.JZ(new xC('COMMENT_DATA')),new xC('COMMENT_CLOSE')]),action:(JC g){String h;if(g.cC.length==3)h=g.cC[1].BE;else h='';g.data=new eN(nE,h);});tB fJ=new tB('ENTITY_REF',new CD([new xC('ENTITY_REF')]),action:(JC g){String h=g.cC[0].BE;if(h.startsWith('&')&&h.length>1){h=h.substring(1,h.length-1);fN EB=new fN(nE,h);g.data=EB;}else{g.data=new mL(nE,h);}});tB ML=new tB('CDATA',new CD([new xC('CDATA_SECTION_OPEN'),new NE.JZ(new xC('CDATA_SECTION_DATA')),new xC('CDATA_SECTION_CLOSE')]),action:(JC g){String h;if(g.cC.length==3)h=g.cC[1].BE;else h='';g.data=new dN(nE,h);});tB kS=new tB('PI',new CD([new xC('PI_OPEN'),new xC('PI_TARGET'),new NE.JZ(new xC('PI_DATA')),new xC('PI_CLOSE')]),action:(JC g){String vW=g.cC[1].BE;String h;if(g.cC.length==4)h=g.cC[2].BE.replaceAll(new RegExp(r"^\s+"),'');else h='';g.data=new gN(nE,vW,h);});tB BC=new tB('ELEMENT',null,action:(JC g){bool lS=(g.cC[0].id=='EMPTY_ELEMENT');JC hB=g.cC[0];String m=hB.cC[1].BE;if(!lS){JC wW=g.cC[g.cC.length-1];String mS=wW.cC[1].BE;if(mS!=m)throw new Exception("End tag not matching start tag: ${mS} != ${m}");}l s=new dG.RZ(nE,null,m);int QD=hB.cC.length-3;if(QD>0){for(int i=2;i<hB.cC.length-1;i++ ){Object h=hB.cC[i].data;if(h is lC)s.YS(h);}}if(!lS){int xW=g.cC.length-2;if(xW>0){for(int i=1;i<g.cC.length-1;i++ ){JC IC=g.cC[i];if(IC.id=='PCDATA'){yJ yW=new mL(nE,IC.BE);s.jB(yW);}else{Object h=IC.data;if(h is AB)s.jB(h);}}for(AB o=s.firstChild;o!=null;o=o.nextSibling){if(o.nodeType==AB.kE){AB HB=o.nextSibling;while(HB!=null&&HB.nodeType==AB.kE){o.nodeValue+= HB.nodeValue;s.gC(HB);HB=o.nextSibling;}}}}}g.data=s;});BC.content=new cG([new CD([MF,new NE.MZ(new cG([BC,eJ,new xC('PCDATA'),fJ,ML,kS])),VG]),MI]);nF.add(BC);nF.add(QB);nF.add(MF);nF.add(VG);nF.add(MI);nF.add(eJ);nF.add(fJ);nF.add(ML);nF.add(kS);}sB LP(String h){h=h.replaceAll('\r\n','\n');iH k=new zJ();nE=new cN(k,null,null,null);EK i=new EK(XD);List<JC> j=i.LP(h);i=new EK(nF);j=i.LW(j);for(JC m in j){Object g=m.data;if(g is jH)nE.mK=g;else if(g is AB)nE.jB(g);}if(nE.documentElement!=null)od(nE.documentElement);return (nE);}void od(l g){if(g.attributes!=null){for(lC i in g.attributes.values){if(i.name=='xmlns'||(i.EC=='xmlns'&&i.localName==g.EC)){g.pB=i.value;break;}}}if(g.pB==null&&g.parentNode!=null)g.pB=g.parentNode.YD(g.EC);for(AB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l)od(h as l);}}}class EK{List<tB> rules;HashMap<String,bool> iM;EK(this.rules){for(tB g in rules)g.qK=this;}List<JC> LP(String i){List<JC> j=new List<JC>();iM=new HashMap<String,bool>();int g=0;while(g<i.length){int k=g;for(tB m in rules){QC h=m.JG(i,g);if(h==null)continue;g+= h.PG;if(h.XH.length>0){assert(h.PG!=0);j.addAll(h.XH);break;}}if(k==g){throw new UD("parser blocking at character ${g}: ${i.substring(g,min(g+10,i.length))}");}}return (j);}List<JC> LW(List<JC> i){List<JC> j=new List<JC>();iM=new HashMap<String,bool>();int g=0;while(g<i.length){int k=g;for(tB m in rules){QC h=m.KG(i,g);if(h==null)continue;g+= h.PG;if(h.XH.length>0){assert(h.PG!=0);j.addAll(h.XH);break;}}if(k==g){throw new UD("parser blocking at character ${i[g].position}");}}return (j);}bool SR(tB h){if(h.conditions==null)return (true);bool j=false;for(tE i in h.conditions){bool g=iM[i.name];if(g==null)g=false;if(g!=i.value)return (false);}return (true);}void QR(tB g){if(g.changes==null)return;for(pD h in g.changes){iM[h.name]=h.value;}}}class lN{static String mN;static String nN='en_US';static String PU(String g){if(g==null)return QU();if(g=="C")return "en_ISO";if(g.length<5)return g;if(g[2]!='-'&&(g[2]!='_'))return g;var h=g.substring(3);if(h.length<=3)h=h.toUpperCase();return '${g[0]}${g[1]}_${h}';}static String QU(){if(mN==null)mN=nN;return mN;}}Future<String> bQ(){lN.nN=lN.PU(window.navigator.language);return new Future.value(lN.nN);}